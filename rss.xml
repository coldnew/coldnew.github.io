<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>coldnew&amp;#39;s blog</title>
    <link>https://coldnew.github.io/</link>
    <atom:link href="/rss.xml" rel="self" type="application/rss+xml"/>
    
    <description></description>
    <pubDate>Thu, 11 May 2017 16:00:53 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>Android Things 學習筆記: GPIO 的輸出控制</title>
      <link>https://coldnew.github.io/468144f4/</link>
      <guid>https://coldnew.github.io/468144f4/</guid>
      <pubDate>Thu, 11 May 2017 15:43:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/8e801cc4/&quot;&gt;Android Things 學習筆記: Raspberry Pi 3 安裝 OS&lt;/a&gt; 一文中我們搞定了 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 在 Raspberry Pi 3 上的安裝，終於可以開始來寫我們的程式了。
&lt;/p&gt;

&lt;p&gt;
這邊文章讓我們來小試身手，透過 GPIO 的輸出來控制外接於 Raspberry Pi 3 上的 LED 燈。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;div id=&quot;outline-container-org7906f32&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7906f32&quot;&gt;使用設備&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7906f32&quot;&gt;
&lt;p&gt;
要完成本篇文章所描述的部份，你需要以下幾種器材
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;Raspberry Pi 3&lt;/li&gt;

&lt;li&gt;LED (紅)&lt;/li&gt;

&lt;li&gt;電阻 (150 Ω, 1/4W)&lt;/li&gt;

&lt;li&gt;麵包板&lt;/li&gt;

&lt;li&gt;單蕊線或跳線&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge0d9908&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge0d9908&quot;&gt;硬體線路&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge0d9908&quot;&gt;
&lt;p&gt;
下面的硬體線路使用 &lt;a href=&quot;http://fritzing.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Fritzing&lt;/a&gt; 軟體來繪製，我選用 &lt;code&gt;GPIO21&lt;/code&gt; 來當作提供給 LED 的電源端，由於 Raspberry Pi 3 的 GPIO 輸出為 &lt;code&gt;5V DC&lt;/code&gt; 的電壓，稍微再加個 &lt;code&gt;150 Ω&lt;/code&gt; 的電阻來保護我們的 LED 以及 Raspberry Pi 3。
(&lt;a href=&quot;rpi3_schematics.fzz&quot;&gt;下載設計檔案&lt;/a&gt;)
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
&lt;b&gt;注意到電阻值可能會依據你的 LED 不同而改變&lt;/b&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;div class=&quot;row &quot;&gt;&lt;div class=&quot;col-md-6 &quot;&gt;

&lt;p&gt;
&lt;b&gt;麵包板連線&lt;/b&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/rpi3_schematics_bb.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;/div&gt;&lt;div class=&quot;col-md-5&quot;&gt;

&lt;p&gt;
&lt;b&gt;電路連接&lt;/b&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/rpi3_schematics.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;/div&gt; &lt;/div&gt;

&lt;p&gt;
Raspberry Pi 3 與 GPIO 編號的對應關係，可以參考 &lt;a href=&quot;https://www.element14.com/community/docs/DOC-73950/l/raspberry-pi-3-model-b-gpio-40-pin-block-pinout&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Element14&lt;/a&gt; 所提供的圖表，這邊我將我用到的用紅線框出
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/pi3_gpio.png&quot; width=&quot;40%&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1d63bde&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1d63bde&quot;&gt;建立專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1d63bde&quot;&gt;
&lt;p&gt;
由於這是我們的第一個專案，就不透過 &lt;a href=&quot;https://github.com/androidthings/new-project-template&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;androidthings/new-project-template&lt;/a&gt; 這個範例樣板來建立我們的專案，讓我們透過 &lt;a href=&quot;https://developer.android.com/studio/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio&lt;/a&gt; 來一步一步開始吧。
&lt;/p&gt;

&lt;p&gt;
不過建立新專案之前，記得先透過 &lt;a href=&quot;https://developer.android.com/tools/help/adb.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;adb&lt;/a&gt; 連上你的 Raspberry Pi 3
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@osx ~ $ adb connect Android.local
&lt;/pre&gt;

&lt;p&gt;
首先先打開 &lt;a href=&quot;https://developer.android.com/studio/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio&lt;/a&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/a1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來命名我們的專案叫做 &lt;code&gt;Hello Things&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/a2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在選擇 &lt;code&gt;Minimum SDK&lt;/code&gt; 的時候，記得要選擇 &lt;code&gt;API 24&lt;/code&gt; 或是以上的版本
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/a3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 &lt;code&gt;Empty Activity&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/a4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，按下 &lt;code&gt;Finish&lt;/code&gt; 即可
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/a5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgdec6f70&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgdec6f70&quot;&gt;修改專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgdec6f70&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgd2c3441&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgd2c3441&quot;&gt;build.gradle&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgd2c3441&quot;&gt;
&lt;p&gt;
建立好專案後，我們首先要修改 &lt;code&gt;build.gradle&lt;/code&gt; 並加入 Android Things 的依賴
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;dependencies &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;//  &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;...&lt;/span&gt;
    provided &lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;com.google.android.things:androidthings:0.3-devpreview&#39;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
如果你不知道要放在哪裡，請參考下圖
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/b1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5764995&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org5764995&quot;&gt;AndroidManifest.xml&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org5764995&quot;&gt;
&lt;p&gt;
接下來在你的 &lt;code&gt;AndroidManifest.xml&lt;/code&gt; 加入以下東西，我們要讓這個程式可以一開機就啟動
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-diff&quot;&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;--- &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;a/AndroidManifest.xml  2017-05-11 22:13:00.000000000 +0800&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;+++ &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;b/AndroidManifest.xml  2017-05-11 22:13:34.000000000 +0800&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -5,6 +5,9 @@&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;     &amp;lt;application android:allowBackup=&quot;true&quot; android:icon=&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         android:label=&quot;@string/app_name&quot; android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         android:supportsRtl=&quot;true&quot; android:theme=&quot;@style/AppTheme&quot;&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;      &amp;lt;uses-library android:name=&quot;com.google.android.things&quot;/&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         &amp;lt;activity android:name=&quot;.MainActivity&quot;&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;             &amp;lt;intent-filter&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;                 &amp;lt;action android:name=&quot;android.intent.action.MAIN&quot; /&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -12,6 +15,14 @@&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;                 &amp;lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;             &amp;lt;/intent-filter&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         &amp;lt;/activity&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;        &amp;lt;!-- Launch activity automatically on boot --&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;        &amp;lt;intent-filter&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;            &amp;lt;action android:name=&quot;android.intent.action.MAIN&quot;/&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;            &amp;lt;category android:name=&quot;android.intent.category.IOT_LAUNCHER&quot;/&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;            &amp;lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;        &amp;lt;/intent-filter&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;     &amp;lt;/application&amp;gt;&lt;/span&gt;

&lt;span style=&quot;color: #dddddd;&quot;&gt; &amp;lt;/manifest&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
如果你不知道要放在哪裡，請參考下圖
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/b2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org48ebc2c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org48ebc2c&quot;&gt;點亮 LED 燈&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org48ebc2c&quot;&gt;
&lt;p&gt;
是時候來撰寫我們的程式了，讓我們來打開 &lt;code&gt;hellothings/MainActivity.java&lt;/code&gt; 檔案吧!!
&lt;/p&gt;

&lt;p&gt;
首先回顧前面的定義，我們希望可以控制 &lt;code&gt;GPIO21&lt;/code&gt; 來點亮 LED 燈，因此首先在 &lt;code&gt;MainActivity&lt;/code&gt; 這個 class 加入我們的一些設定
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;final&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;String&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;TAG&lt;/span&gt; = &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;HelloThings&quot;&lt;/span&gt;;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;final&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;String&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;LED&lt;/span&gt; = &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;BCM21&quot;&lt;/span&gt;;

&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;Gpio&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;mLedGpio&lt;/span&gt;;          &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;com.google.android.things.pio.Gpio;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來將 &lt;code&gt;onCreate&lt;/code&gt; 修改成以下，我們讓他打開 &lt;code&gt;GPIO21&lt;/code&gt; 並將其設定成 &lt;code&gt;輸出為 1&lt;/code&gt; 的接腳
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;@Override&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;protected&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;onCreate&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Bundle&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;super&lt;/span&gt;.onCreate&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;savedInstanceState&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
    setContentView&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;R.layout.activity_main&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

    &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;com.google.android.things.pio.PeripheralManagerService;&lt;/span&gt;
    &lt;span style=&quot;color: #fff59d;&quot;&gt;PeripheralManagerService&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;service&lt;/span&gt; = &lt;span style=&quot;color: #aaffaa;&quot;&gt;new&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;PeripheralManagerService&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt;;
    Log.d&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Available GPIOs: &quot;&lt;/span&gt; + service.getGpioList&lt;span style=&quot;color: #aaccff;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;; &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;android.util.Log;&lt;/span&gt;

    &lt;span style=&quot;color: #aaffaa;&quot;&gt;try&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        mLedGpio = service.openGpio&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;LED&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
        mLedGpio.setDirection&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;Gpio&lt;/span&gt;.DIRECTION_OUT_INITIALLY_LOW&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
        mLedGpio.setValue&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
        Log.i&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Start blinking LED by GPIO21&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;catch&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;IOException&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        Log.e&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Error on PeripheralIO API&quot;&lt;/span&gt;, e&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
由於我們在 &lt;code&gt;onCreate&lt;/code&gt; 時打開了 &lt;code&gt;GPIO21&lt;/code&gt; ，因此要記得在 &lt;code&gt;onDestroy&lt;/code&gt; 將他關閉
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;@Override&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;protected&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;onDestroy&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;()&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;super&lt;/span&gt;.onDestroy&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt;;
    Log.i&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Closing LED GPIO21 pin&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;try&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        mLedGpio.close&lt;span style=&quot;color: #aaccff;&quot;&gt;()&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;catch&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;IOException&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        Log.e&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Error on PeripheralIO API&quot;&lt;/span&gt;, e&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;finally&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        mLedGpio = &lt;span style=&quot;color: #ccaaff;&quot;&gt;null&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
嘗試執行當前的程式看看，你應該會看到你接在麵包板的 LED 亮了起來，接下來讓我們修改一下程式，讓他變成閃爍燈吧~
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/c1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org037a001&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org037a001&quot;&gt;閃爍吧 LED&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org037a001&quot;&gt;
&lt;p&gt;
成功點亮 LED 後，我們接下來要讓他進行閃爍囉。
&lt;/p&gt;

&lt;p&gt;
延續上面的專案，首先在  &lt;code&gt;MainActivity&lt;/code&gt; 這個 class 加入我們要閃爍多久，以及 Handler 的宣告
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;final&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;INTERVAL_BETWEEN_BLINKS_MS&lt;/span&gt; = 1000;

&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;Handler&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;mHandler&lt;/span&gt; = &lt;span style=&quot;color: #aaffaa;&quot;&gt;new&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;Handler&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;()&lt;/span&gt;; &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;android.os.Handler&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接著在剛剛設定 GPIO 輸出值的後面，設定我們的 Handler 函式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;try&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
     mLedGpio = service.openGpio&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;LED&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
     mLedGpio.setDirection&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;Gpio&lt;/span&gt;.DIRECTION_OUT_INITIALLY_LOW&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
     mLedGpio.setValue&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
     Log.i&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Start blinking LED by GPIO21&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
     mHandler.post&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;mBlinkRunnable&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;; &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;lt;------  Add this&lt;/span&gt;
     &lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;catch&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;IOException&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
         Log.e&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Error on PeripheralIO API&quot;&lt;/span&gt;, e&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
並在後面完成我們的 &lt;code&gt;mBlinkRunnable&lt;/code&gt; 實作
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;Runnable&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;mBlinkRunnable&lt;/span&gt; = &lt;span style=&quot;color: #aaffaa;&quot;&gt;new&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;Runnable&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;()&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #ccaaff;&quot;&gt;@Override&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; run&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;mLedGpio == &lt;span style=&quot;color: #ccaaff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;
            &lt;span style=&quot;color: #aaffaa;&quot;&gt;return&lt;/span&gt;;
        &lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;try&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;
            mLedGpio.setValue&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff3333;&quot;&gt;!&lt;/span&gt;mLedGpio.getValue&lt;span style=&quot;color: #ccaaff;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;;  &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Toggle the GPIO state&lt;/span&gt;
            Log.d&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;GPIO21 set to &quot;&lt;/span&gt; + mLedGpio.getValue&lt;span style=&quot;color: #ccaaff;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;;
            mHandler.postDelayed&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;mBlinkRunnable, INTERVAL_BETWEEN_BLINKS_MS&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;;
        &lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;catch&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;IOException&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;
            Log.e&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Error on PeripheralIO API&quot;&lt;/span&gt;, e&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;;
        &lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
在這邊，我們透過了 &lt;a href=&quot;https://developer.android.com/reference/java/lang/Runnable.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;java.lang.Runnable&lt;/a&gt; 去建立我們的執行緒，而在裡面則透過取得當前的 GPIO 數值將其反向，從而另 LED 閃爍。如果你想要閃爍快一點，可以修改前面宣告的 &lt;code&gt;INTERVAL_BETWEEN_BLINKS_MS&lt;/code&gt; 變數。
&lt;/p&gt;

&lt;p&gt;
由於我們使用了 &lt;a href=&quot;https://developer.android.com/reference/android/os/Handler.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;android.os.Handler&lt;/a&gt; ，記得要在 &lt;code&gt;onDestroy&lt;/code&gt; 時候幹掉他
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;@Override&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;protected&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;onDestroy&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;()&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;super&lt;/span&gt;.onDestroy&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt;;
    mHandler.removeCallbacks&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;mBlinkRunnable&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;; &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;lt;---- Add this&lt;/span&gt;
    Log.i&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Closing LED GPIO21 pin&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;try&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        mLedGpio.close&lt;span style=&quot;color: #aaccff;&quot;&gt;()&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;catch&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;IOException&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        Log.e&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Error on PeripheralIO API&quot;&lt;/span&gt;, e&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;finally&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        mLedGpio = &lt;span style=&quot;color: #ccaaff;&quot;&gt;null&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org3436a15&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org3436a15&quot;&gt;結果&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org3436a15&quot;&gt;
&lt;p&gt;
如果你有照著本文接線並執行程式的話，你應該會得到以下這樣的結果 ~
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/blink.gif&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org38a23c0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org38a23c0&quot;&gt;取得程式碼&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org38a23c0&quot;&gt;
&lt;p&gt;
本文的範例已經放置於 &lt;a href=&quot;https://github.com/coldnew/HelloThings&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 上，你可以直接透過 git 去取得完整專案原始碼
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;cold&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org24d52eb&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org24d52eb&quot;&gt;參考資料&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org24d52eb&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;http://www.survivingwithandroid.com/2016/03/arduino-led-control-android-app.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Arduino Led: Control RGB Led remotely using Arduino and Android app&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;https://androidthings.rocks/2017/01/08/your-first-blinking-led/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Your first blinking LED with Android Things&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/8e801cc4/&quot;&gt;Android Things 學習筆記: Raspberry Pi 3 安裝 OS&lt;/a&gt; 一文中我們搞定了 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 在 Raspberry Pi 3 上的安裝，終於可以開始來寫我們的程式了。
&lt;/p&gt;

&lt;p&gt;
這邊文章讓我們來小試身手，透過 GPIO 的輸出來控制外接於 Raspberry Pi 3 上的 LED 燈。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;div id=&quot;outline-container-org7906f32&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7906f32&quot;&gt;使用設備&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7906f32&quot;&gt;
&lt;p&gt;
要完成本篇文章所描述的部份，你需要以下幾種器材
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;Raspberry Pi 3&lt;/li&gt;

&lt;li&gt;LED (紅)&lt;/li&gt;

&lt;li&gt;電阻 (150 Ω, 1/4W)&lt;/li&gt;

&lt;li&gt;麵包板&lt;/li&gt;

&lt;li&gt;單蕊線或跳線&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge0d9908&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge0d9908&quot;&gt;硬體線路&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge0d9908&quot;&gt;
&lt;p&gt;
下面的硬體線路使用 &lt;a href=&quot;http://fritzing.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Fritzing&lt;/a&gt; 軟體來繪製，我選用 &lt;code&gt;GPIO21&lt;/code&gt; 來當作提供給 LED 的電源端，由於 Raspberry Pi 3 的 GPIO 輸出為 &lt;code&gt;5V DC&lt;/code&gt; 的電壓，稍微再加個 &lt;code&gt;150 Ω&lt;/code&gt; 的電阻來保護我們的 LED 以及 Raspberry Pi 3。
(&lt;a href=&quot;rpi3_schematics.fzz&quot;&gt;下載設計檔案&lt;/a&gt;)
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
&lt;b&gt;注意到電阻值可能會依據你的 LED 不同而改變&lt;/b&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;div class=&quot;row &quot;&gt;&lt;div class=&quot;col-md-6 &quot;&gt;

&lt;p&gt;
&lt;b&gt;麵包板連線&lt;/b&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/rpi3_schematics_bb.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;/div&gt;&lt;div class=&quot;col-md-5&quot;&gt;

&lt;p&gt;
&lt;b&gt;電路連接&lt;/b&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/rpi3_schematics.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;/div&gt; &lt;/div&gt;

&lt;p&gt;
Raspberry Pi 3 與 GPIO 編號的對應關係，可以參考 &lt;a href=&quot;https://www.element14.com/community/docs/DOC-73950/l/raspberry-pi-3-model-b-gpio-40-pin-block-pinout&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Element14&lt;/a&gt; 所提供的圖表，這邊我將我用到的用紅線框出
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/pi3_gpio.png&quot; width=&quot;40%&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1d63bde&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1d63bde&quot;&gt;建立專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1d63bde&quot;&gt;
&lt;p&gt;
由於這是我們的第一個專案，就不透過 &lt;a href=&quot;https://github.com/androidthings/new-project-template&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;androidthings/new-project-template&lt;/a&gt; 這個範例樣板來建立我們的專案，讓我們透過 &lt;a href=&quot;https://developer.android.com/studio/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio&lt;/a&gt; 來一步一步開始吧。
&lt;/p&gt;

&lt;p&gt;
不過建立新專案之前，記得先透過 &lt;a href=&quot;https://developer.android.com/tools/help/adb.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;adb&lt;/a&gt; 連上你的 Raspberry Pi 3
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@osx ~ $ adb connect Android.local
&lt;/pre&gt;

&lt;p&gt;
首先先打開 &lt;a href=&quot;https://developer.android.com/studio/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio&lt;/a&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/a1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來命名我們的專案叫做 &lt;code&gt;Hello Things&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/a2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在選擇 &lt;code&gt;Minimum SDK&lt;/code&gt; 的時候，記得要選擇 &lt;code&gt;API 24&lt;/code&gt; 或是以上的版本
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/a3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 &lt;code&gt;Empty Activity&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/a4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，按下 &lt;code&gt;Finish&lt;/code&gt; 即可
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/a5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgdec6f70&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgdec6f70&quot;&gt;修改專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgdec6f70&quot;&gt;
&lt;/div&gt;&lt;div id=&quot;outline-container-orgd2c3441&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgd2c3441&quot;&gt;build.gradle&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgd2c3441&quot;&gt;
&lt;p&gt;
建立好專案後，我們首先要修改 &lt;code&gt;build.gradle&lt;/code&gt; 並加入 Android Things 的依賴
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;dependencies &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;//  &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;...&lt;/span&gt;
    provided &lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;com.google.android.things:androidthings:0.3-devpreview&#39;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
如果你不知道要放在哪裡，請參考下圖
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/b1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5764995&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org5764995&quot;&gt;AndroidManifest.xml&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org5764995&quot;&gt;
&lt;p&gt;
接下來在你的 &lt;code&gt;AndroidManifest.xml&lt;/code&gt; 加入以下東西，我們要讓這個程式可以一開機就啟動
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-diff&quot;&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;--- &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;a/AndroidManifest.xml  2017-05-11 22:13:00.000000000 +0800&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;+++ &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;b/AndroidManifest.xml  2017-05-11 22:13:34.000000000 +0800&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -5,6 +5,9 @@&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;     &amp;lt;application android:allowBackup=&quot;true&quot; android:icon=&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         android:label=&quot;@string/app_name&quot; android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         android:supportsRtl=&quot;true&quot; android:theme=&quot;@style/AppTheme&quot;&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;      &amp;lt;uses-library android:name=&quot;com.google.android.things&quot;/&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         &amp;lt;activity android:name=&quot;.MainActivity&quot;&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;             &amp;lt;intent-filter&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;                 &amp;lt;action android:name=&quot;android.intent.action.MAIN&quot; /&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -12,6 +15,14 @@&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;                 &amp;lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;             &amp;lt;/intent-filter&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         &amp;lt;/activity&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;        &amp;lt;!-- Launch activity automatically on boot --&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;        &amp;lt;intent-filter&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;            &amp;lt;action android:name=&quot;android.intent.action.MAIN&quot;/&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;            &amp;lt;category android:name=&quot;android.intent.category.IOT_LAUNCHER&quot;/&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;            &amp;lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;        &amp;lt;/intent-filter&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;     &amp;lt;/application&amp;gt;&lt;/span&gt;

&lt;span style=&quot;color: #dddddd;&quot;&gt; &amp;lt;/manifest&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
如果你不知道要放在哪裡，請參考下圖
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/b2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org48ebc2c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org48ebc2c&quot;&gt;點亮 LED 燈&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org48ebc2c&quot;&gt;
&lt;p&gt;
是時候來撰寫我們的程式了，讓我們來打開 &lt;code&gt;hellothings/MainActivity.java&lt;/code&gt; 檔案吧!!
&lt;/p&gt;

&lt;p&gt;
首先回顧前面的定義，我們希望可以控制 &lt;code&gt;GPIO21&lt;/code&gt; 來點亮 LED 燈，因此首先在 &lt;code&gt;MainActivity&lt;/code&gt; 這個 class 加入我們的一些設定
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;final&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;String&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;TAG&lt;/span&gt; = &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;HelloThings&quot;&lt;/span&gt;;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;final&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;String&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;LED&lt;/span&gt; = &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;BCM21&quot;&lt;/span&gt;;

&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;Gpio&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;mLedGpio&lt;/span&gt;;          &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;com.google.android.things.pio.Gpio;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來將 &lt;code&gt;onCreate&lt;/code&gt; 修改成以下，我們讓他打開 &lt;code&gt;GPIO21&lt;/code&gt; 並將其設定成 &lt;code&gt;輸出為 1&lt;/code&gt; 的接腳
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;@Override&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;protected&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;onCreate&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Bundle&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;super&lt;/span&gt;.onCreate&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;savedInstanceState&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
    setContentView&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;R.layout.activity_main&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

    &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;com.google.android.things.pio.PeripheralManagerService;&lt;/span&gt;
    &lt;span style=&quot;color: #fff59d;&quot;&gt;PeripheralManagerService&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;service&lt;/span&gt; = &lt;span style=&quot;color: #aaffaa;&quot;&gt;new&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;PeripheralManagerService&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt;;
    Log.d&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Available GPIOs: &quot;&lt;/span&gt; + service.getGpioList&lt;span style=&quot;color: #aaccff;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;; &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;android.util.Log;&lt;/span&gt;

    &lt;span style=&quot;color: #aaffaa;&quot;&gt;try&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        mLedGpio = service.openGpio&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;LED&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
        mLedGpio.setDirection&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;Gpio&lt;/span&gt;.DIRECTION_OUT_INITIALLY_LOW&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
        mLedGpio.setValue&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
        Log.i&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Start blinking LED by GPIO21&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;catch&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;IOException&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        Log.e&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Error on PeripheralIO API&quot;&lt;/span&gt;, e&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
由於我們在 &lt;code&gt;onCreate&lt;/code&gt; 時打開了 &lt;code&gt;GPIO21&lt;/code&gt; ，因此要記得在 &lt;code&gt;onDestroy&lt;/code&gt; 將他關閉
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;@Override&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;protected&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;onDestroy&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;()&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;super&lt;/span&gt;.onDestroy&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt;;
    Log.i&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Closing LED GPIO21 pin&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;try&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        mLedGpio.close&lt;span style=&quot;color: #aaccff;&quot;&gt;()&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;catch&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;IOException&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        Log.e&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Error on PeripheralIO API&quot;&lt;/span&gt;, e&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;finally&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        mLedGpio = &lt;span style=&quot;color: #ccaaff;&quot;&gt;null&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
嘗試執行當前的程式看看，你應該會看到你接在麵包板的 LED 亮了起來，接下來讓我們修改一下程式，讓他變成閃爍燈吧~
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/c1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org037a001&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org037a001&quot;&gt;閃爍吧 LED&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org037a001&quot;&gt;
&lt;p&gt;
成功點亮 LED 後，我們接下來要讓他進行閃爍囉。
&lt;/p&gt;

&lt;p&gt;
延續上面的專案，首先在  &lt;code&gt;MainActivity&lt;/code&gt; 這個 class 加入我們要閃爍多久，以及 Handler 的宣告
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;final&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;INTERVAL_BETWEEN_BLINKS_MS&lt;/span&gt; = 1000;

&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;Handler&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;mHandler&lt;/span&gt; = &lt;span style=&quot;color: #aaffaa;&quot;&gt;new&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;Handler&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;()&lt;/span&gt;; &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;android.os.Handler&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接著在剛剛設定 GPIO 輸出值的後面，設定我們的 Handler 函式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;try&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
     mLedGpio = service.openGpio&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;LED&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
     mLedGpio.setDirection&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;Gpio&lt;/span&gt;.DIRECTION_OUT_INITIALLY_LOW&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
     mLedGpio.setValue&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
     Log.i&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Start blinking LED by GPIO21&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
     mHandler.post&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;mBlinkRunnable&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;; &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;lt;------  Add this&lt;/span&gt;
     &lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;catch&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;IOException&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
         Log.e&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Error on PeripheralIO API&quot;&lt;/span&gt;, e&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
並在後面完成我們的 &lt;code&gt;mBlinkRunnable&lt;/code&gt; 實作
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;Runnable&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;mBlinkRunnable&lt;/span&gt; = &lt;span style=&quot;color: #aaffaa;&quot;&gt;new&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;Runnable&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;()&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #ccaaff;&quot;&gt;@Override&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; run&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;mLedGpio == &lt;span style=&quot;color: #ccaaff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;
            &lt;span style=&quot;color: #aaffaa;&quot;&gt;return&lt;/span&gt;;
        &lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;try&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;
            mLedGpio.setValue&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff3333;&quot;&gt;!&lt;/span&gt;mLedGpio.getValue&lt;span style=&quot;color: #ccaaff;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;;  &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Toggle the GPIO state&lt;/span&gt;
            Log.d&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;GPIO21 set to &quot;&lt;/span&gt; + mLedGpio.getValue&lt;span style=&quot;color: #ccaaff;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;;
            mHandler.postDelayed&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;mBlinkRunnable, INTERVAL_BETWEEN_BLINKS_MS&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;;
        &lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;catch&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;IOException&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;
            Log.e&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Error on PeripheralIO API&quot;&lt;/span&gt;, e&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;;
        &lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
在這邊，我們透過了 &lt;a href=&quot;https://developer.android.com/reference/java/lang/Runnable.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;java.lang.Runnable&lt;/a&gt; 去建立我們的執行緒，而在裡面則透過取得當前的 GPIO 數值將其反向，從而另 LED 閃爍。如果你想要閃爍快一點，可以修改前面宣告的 &lt;code&gt;INTERVAL_BETWEEN_BLINKS_MS&lt;/code&gt; 變數。
&lt;/p&gt;

&lt;p&gt;
由於我們使用了 &lt;a href=&quot;https://developer.android.com/reference/android/os/Handler.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;android.os.Handler&lt;/a&gt; ，記得要在 &lt;code&gt;onDestroy&lt;/code&gt; 時候幹掉他
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-java&quot;&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;@Override&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;protected&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;onDestroy&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;()&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;super&lt;/span&gt;.onDestroy&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt;;
    mHandler.removeCallbacks&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;mBlinkRunnable&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;; &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;lt;---- Add this&lt;/span&gt;
    Log.i&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Closing LED GPIO21 pin&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;try&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        mLedGpio.close&lt;span style=&quot;color: #aaccff;&quot;&gt;()&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;catch&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;IOException&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        Log.e&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;TAG, &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Error on PeripheralIO API&quot;&lt;/span&gt;, e&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #aaffaa;&quot;&gt;finally&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        mLedGpio = &lt;span style=&quot;color: #ccaaff;&quot;&gt;null&lt;/span&gt;;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org3436a15&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org3436a15&quot;&gt;結果&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org3436a15&quot;&gt;
&lt;p&gt;
如果你有照著本文接線並執行程式的話，你應該會得到以下這樣的結果 ~
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/468144f4/blink.gif&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org38a23c0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org38a23c0&quot;&gt;取得程式碼&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org38a23c0&quot;&gt;
&lt;p&gt;
本文的範例已經放置於 &lt;a href=&quot;https://github.com/coldnew/HelloThings&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 上，你可以直接透過 git 去取得完整專案原始碼
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;cold&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org24d52eb&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org24d52eb&quot;&gt;參考資料&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org24d52eb&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;http://www.survivingwithandroid.com/2016/03/arduino-led-control-android-app.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Arduino Led: Control RGB Led remotely using Arduino and Android app&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;https://androidthings.rocks/2017/01/08/your-first-blinking-led/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Your first blinking LED with Android Things&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/468144f4/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Android Things 學習筆記: Raspberry Pi 3 安裝 OS</title>
      <link>https://coldnew.github.io/8e801cc4/</link>
      <guid>https://coldnew.github.io/8e801cc4/</guid>
      <pubDate>Wed, 10 May 2017 03:42:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;https://coldnew.github.io/399f19c/&quot;&gt;Android Things 學習筆記: 介紹&lt;/a&gt; 一文我們介紹了 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; ，在我們正式開始開發我們的程式之前，我們先將手邊的 &lt;a href=&quot;https://www.raspberrypi.org/products/raspberry-pi-3-model-b/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Raspberry Pi 3 Model B&lt;/a&gt; 裝上可以用 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的映像檔案吧。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
&lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的網頁有針對  &lt;a href=&quot;https://www.raspberrypi.org/products/raspberry-pi-3-model-b/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Raspberry Pi 3 Model B&lt;/a&gt; 的 &lt;a href=&quot;https://developer.android.com/things/hardware/raspberrypi.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Getting Started&lt;/a&gt; 頁面，就讓我們從這一頁開始我們的 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 旅程吧。
&lt;/p&gt;

&lt;div id=&quot;outline-container-org02378d6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org02378d6&quot;&gt;下載映像檔&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org02378d6&quot;&gt;
&lt;p&gt;
首先到 &lt;a href=&quot;https://developer.android.com/things/preview/download.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;System Image Downloads&lt;/a&gt; 去下載 &lt;a href=&quot;https://www.raspberrypi.org/products/raspberry-pi-3-model-b/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Raspberry Pi 3 Model B&lt;/a&gt; 的映像檔案，接著將其解壓縮
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ unzip androidthings_rpi3_devpreview_3.zip
&lt;/pre&gt;

&lt;p&gt;
解壓縮後會得到 &lt;code&gt;iot_rpi3.img&lt;/code&gt; 這個映像檔。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge4a5c7c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge4a5c7c&quot;&gt;燒錄到 sdcard&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge4a5c7c&quot;&gt;
&lt;p&gt;
如果你是在 Linux 下，可以直接透過 &lt;code&gt;dd&lt;/code&gt; 命令將他寫到你的 sdcard
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ sudo dd if=iot_rpi3.img of=/dev/sdc bs=1M
&lt;/pre&gt;

&lt;p&gt;
在 Mac OSX 下，我則是透過 &lt;a href=&quot;https://www.tweaking4all.com/software/macosx-software/macosx-apple-pi-baker/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ApplePi Baker&lt;/a&gt; 這個圖形化的程式來進行燒錄
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8e801cc4/applepi-baker.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6ce1b76&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org6ce1b76&quot;&gt;啟動 RPI3&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org6ce1b76&quot;&gt;
&lt;p&gt;
將你燒好映像檔的 sdcard 插入到  &lt;a href=&quot;https://www.raspberrypi.org/products/raspberry-pi-3-model-b/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Raspberry Pi 3 Model B&lt;/a&gt; 後，插入 USB 電源以及接上網路線，如果你有 HDMI 螢幕的話，可以考慮接上去 (不接也可以)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8e801cc4/raspberrypi-connections.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你有接上 HDMI 的話，開機完成後會看到這樣的畫面，上面會顯示你的 Raspberry Pi 3 的 IP 位址
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8e801cc4/screenshot.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org8351a82&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org8351a82&quot;&gt;連接 ADB&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org8351a82&quot;&gt;
&lt;p&gt;
啟動完 Raspberry Pi 3 後，我們可以透過 &lt;a href=&quot;https://developer.android.com/tools/help/adb.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;adb&lt;/a&gt; 工具去進行連線，假設你的系統有支援 &lt;a href=&quot;https://en.wikipedia.org/wiki/Zero-configuration_networking&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;zeroconf&lt;/a&gt; (在 Linux 下是 &lt;a href=&quot;https://en.wikipedia.org/wiki/Avahi_(software)&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Avahi&lt;/a&gt;, Windows 下是 &lt;a href=&quot;https://support.apple.com/kb/DL999?locale=zh_TW&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Bonjour&lt;/a&gt;) 的話，你可以透過 &lt;code&gt;Android.local&lt;/code&gt; 在同一網域下接觸到你的 Raspberry Pi 3
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ ping Android.local
PING android.local (192.168.20.102): 56 data bytes
64 bytes from 192.168.20.102: icmp_seq=0 ttl=64 time=57.599 ms
64 bytes from 192.168.20.102: icmp_seq=1 ttl=64 time=4.529 ms
^C
--- android.local ping statistics ---
2 packets transmitted, 2 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 4.529/31.064/57.599/26.535 ms
&lt;/pre&gt;

&lt;p&gt;
於是我們就可以透過 &lt;a href=&quot;https://developer.android.com/tools/help/adb.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;adb&lt;/a&gt; 工具去進行連線
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ adb connect Android.local
&lt;/pre&gt;

&lt;p&gt;
你也可以登入進你的 Raspberry Pi 3 去看看裡面有啥東西
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ adb shell
rpi3:/ $ ls
acct    d            etc               init            init.usb.configfs.rc mnt         property_contexts seapp_contexts   storage    ueventd.rpi3.rc
cache   data         file_contexts.bin init.environ.rc init.usb.rc          oem         root              selinux_version  sys        vendor
charger default.prop fstab.rpi3        init.rc         init.zygote32.rc     postinstall sbin              sepolicy         system
config  dev          gapps             init.rpi3.rc    lost+found           proc        sdcard            service_contexts ueventd.rc
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb73f208&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb73f208&quot;&gt;設定 Wi-Fi&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb73f208&quot;&gt;
&lt;p&gt;
當你登入你的 Raspberry Pi 後，如果你想拔掉網路線並起用 Raspberry Pi 3 上面的 Wi-Fi 的話，你可以透過 &lt;a href=&quot;https://developer.android.com/tools/help/adb.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;adb&lt;/a&gt; 去進行設定
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ adb shell am startservice &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -n com.google.wifisetup/.WifiSetupService &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -a WifiSetupService.Connect &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -e ssid &amp;lt;Network_SSID&amp;gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -e passphrase &amp;lt;Network_Passcode&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
(如果無線網路沒密碼的話，可以移除 passphrase 一行)
&lt;/p&gt;

&lt;p&gt;
設定好後，可以透過 &lt;code&gt;logcat&lt;/code&gt; 去進行驗證
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ adb logcat -d | grep Wifi
...
V WifiWatcher: Network state changed to CONNECTED
V WifiWatcher: SSID changed: ...
I WifiConfigurator: Successfully connected to ...
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
也可以透過 &lt;code&gt;ping&lt;/code&gt; 命令確認你的 Raspberry Pi 3 可以順利透過無線上網
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ adb shell ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=57 time=6.67 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=57 time=55.5 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=57 time=23.0 ms
64 bytes from 8.8.8.8: icmp_seq=4 ttl=57 time=245 ms
&lt;/pre&gt;

&lt;p&gt;
如果要移除所有的無線網路設定，則可以透過以下命令進行
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ adb shell am startservice &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -n com.google.wifisetup/.WifiSetupService &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -a WifiSetupService.Reset
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6f58a2a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org6f58a2a&quot;&gt;透過 UART 登入&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org6f58a2a&quot;&gt;
&lt;p&gt;
如果你就是不想接上網路線來對 Raspberry Pi 3 進行設定，那我們也可以透過 &lt;a href=&quot;https://www.adafruit.com/products/954&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;TTL 轉 USB 線&lt;/a&gt; 來接到 Raspberry Pi 上面的 UART 接腳，透過 UART 來進入 console。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8e801cc4/raspberrypi-console.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接上後，看你是要用 &lt;a href=&quot;https://www.gnu.org/s/emacs/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Emacs&lt;/a&gt;、 &lt;a href=&quot;https://www.decisivetactics.com/products/serial/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Serial&lt;/a&gt; (Mac OS)、&lt;a href=&quot;http://www.putty.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Putty&lt;/a&gt; (Windows)、&lt;a href=&quot;https://linux.die.net/man/1/gtkterm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GtkTerm&lt;/a&gt; (Linux) 來進行連線，記得以下東西不要設定錯誤就好:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;Baud Rate: 115200&lt;/li&gt;
&lt;li&gt;Data Bits: 8&lt;/li&gt;
&lt;li&gt;Parity: None&lt;/li&gt;
&lt;li&gt;Stop Bits: 1&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
我自己是習慣透過 &lt;a href=&quot;https://www.gnu.org/s/emacs/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Emacs&lt;/a&gt; 的 &lt;code&gt;M-x serial-term&lt;/code&gt; 命令去進行連接
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8e801cc4/serial.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org575219d&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org575219d&quot;&gt;參考資料&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org575219d&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/things/hardware/raspberrypi.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things: Raspberry Pi 3 Getting Started&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;https://coldnew.github.io/399f19c/&quot;&gt;Android Things 學習筆記: 介紹&lt;/a&gt; 一文我們介紹了 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; ，在我們正式開始開發我們的程式之前，我們先將手邊的 &lt;a href=&quot;https://www.raspberrypi.org/products/raspberry-pi-3-model-b/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Raspberry Pi 3 Model B&lt;/a&gt; 裝上可以用 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的映像檔案吧。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
&lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的網頁有針對  &lt;a href=&quot;https://www.raspberrypi.org/products/raspberry-pi-3-model-b/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Raspberry Pi 3 Model B&lt;/a&gt; 的 &lt;a href=&quot;https://developer.android.com/things/hardware/raspberrypi.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Getting Started&lt;/a&gt; 頁面，就讓我們從這一頁開始我們的 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 旅程吧。
&lt;/p&gt;

&lt;div id=&quot;outline-container-org02378d6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org02378d6&quot;&gt;下載映像檔&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org02378d6&quot;&gt;
&lt;p&gt;
首先到 &lt;a href=&quot;https://developer.android.com/things/preview/download.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;System Image Downloads&lt;/a&gt; 去下載 &lt;a href=&quot;https://www.raspberrypi.org/products/raspberry-pi-3-model-b/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Raspberry Pi 3 Model B&lt;/a&gt; 的映像檔案，接著將其解壓縮
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ unzip androidthings_rpi3_devpreview_3.zip
&lt;/pre&gt;

&lt;p&gt;
解壓縮後會得到 &lt;code&gt;iot_rpi3.img&lt;/code&gt; 這個映像檔。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge4a5c7c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge4a5c7c&quot;&gt;燒錄到 sdcard&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge4a5c7c&quot;&gt;
&lt;p&gt;
如果你是在 Linux 下，可以直接透過 &lt;code&gt;dd&lt;/code&gt; 命令將他寫到你的 sdcard
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ sudo dd if=iot_rpi3.img of=/dev/sdc bs=1M
&lt;/pre&gt;

&lt;p&gt;
在 Mac OSX 下，我則是透過 &lt;a href=&quot;https://www.tweaking4all.com/software/macosx-software/macosx-apple-pi-baker/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ApplePi Baker&lt;/a&gt; 這個圖形化的程式來進行燒錄
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8e801cc4/applepi-baker.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6ce1b76&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org6ce1b76&quot;&gt;啟動 RPI3&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org6ce1b76&quot;&gt;
&lt;p&gt;
將你燒好映像檔的 sdcard 插入到  &lt;a href=&quot;https://www.raspberrypi.org/products/raspberry-pi-3-model-b/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Raspberry Pi 3 Model B&lt;/a&gt; 後，插入 USB 電源以及接上網路線，如果你有 HDMI 螢幕的話，可以考慮接上去 (不接也可以)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8e801cc4/raspberrypi-connections.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你有接上 HDMI 的話，開機完成後會看到這樣的畫面，上面會顯示你的 Raspberry Pi 3 的 IP 位址
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8e801cc4/screenshot.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org8351a82&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org8351a82&quot;&gt;連接 ADB&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org8351a82&quot;&gt;
&lt;p&gt;
啟動完 Raspberry Pi 3 後，我們可以透過 &lt;a href=&quot;https://developer.android.com/tools/help/adb.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;adb&lt;/a&gt; 工具去進行連線，假設你的系統有支援 &lt;a href=&quot;https://en.wikipedia.org/wiki/Zero-configuration_networking&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;zeroconf&lt;/a&gt; (在 Linux 下是 &lt;a href=&quot;https://en.wikipedia.org/wiki/Avahi_(software)&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Avahi&lt;/a&gt;, Windows 下是 &lt;a href=&quot;https://support.apple.com/kb/DL999?locale=zh_TW&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Bonjour&lt;/a&gt;) 的話，你可以透過 &lt;code&gt;Android.local&lt;/code&gt; 在同一網域下接觸到你的 Raspberry Pi 3
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ ping Android.local
PING android.local (192.168.20.102): 56 data bytes
64 bytes from 192.168.20.102: icmp_seq=0 ttl=64 time=57.599 ms
64 bytes from 192.168.20.102: icmp_seq=1 ttl=64 time=4.529 ms
^C
--- android.local ping statistics ---
2 packets transmitted, 2 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 4.529/31.064/57.599/26.535 ms
&lt;/pre&gt;

&lt;p&gt;
於是我們就可以透過 &lt;a href=&quot;https://developer.android.com/tools/help/adb.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;adb&lt;/a&gt; 工具去進行連線
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ adb connect Android.local
&lt;/pre&gt;

&lt;p&gt;
你也可以登入進你的 Raspberry Pi 3 去看看裡面有啥東西
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ adb shell
rpi3:/ $ ls
acct    d            etc               init            init.usb.configfs.rc mnt         property_contexts seapp_contexts   storage    ueventd.rpi3.rc
cache   data         file_contexts.bin init.environ.rc init.usb.rc          oem         root              selinux_version  sys        vendor
charger default.prop fstab.rpi3        init.rc         init.zygote32.rc     postinstall sbin              sepolicy         system
config  dev          gapps             init.rpi3.rc    lost+found           proc        sdcard            service_contexts ueventd.rc
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb73f208&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb73f208&quot;&gt;設定 Wi-Fi&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb73f208&quot;&gt;
&lt;p&gt;
當你登入你的 Raspberry Pi 後，如果你想拔掉網路線並起用 Raspberry Pi 3 上面的 Wi-Fi 的話，你可以透過 &lt;a href=&quot;https://developer.android.com/tools/help/adb.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;adb&lt;/a&gt; 去進行設定
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ adb shell am startservice &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -n com.google.wifisetup/.WifiSetupService &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -a WifiSetupService.Connect &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -e ssid &amp;lt;Network_SSID&amp;gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -e passphrase &amp;lt;Network_Passcode&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
(如果無線網路沒密碼的話，可以移除 passphrase 一行)
&lt;/p&gt;

&lt;p&gt;
設定好後，可以透過 &lt;code&gt;logcat&lt;/code&gt; 去進行驗證
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ adb logcat -d | grep Wifi
...
V WifiWatcher: Network state changed to CONNECTED
V WifiWatcher: SSID changed: ...
I WifiConfigurator: Successfully connected to ...
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
也可以透過 &lt;code&gt;ping&lt;/code&gt; 命令確認你的 Raspberry Pi 3 可以順利透過無線上網
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ adb shell ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=57 time=6.67 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=57 time=55.5 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=57 time=23.0 ms
64 bytes from 8.8.8.8: icmp_seq=4 ttl=57 time=245 ms
&lt;/pre&gt;

&lt;p&gt;
如果要移除所有的無線網路設定，則可以透過以下命令進行
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ adb shell am startservice &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -n com.google.wifisetup/.WifiSetupService &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
       -a WifiSetupService.Reset
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6f58a2a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org6f58a2a&quot;&gt;透過 UART 登入&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org6f58a2a&quot;&gt;
&lt;p&gt;
如果你就是不想接上網路線來對 Raspberry Pi 3 進行設定，那我們也可以透過 &lt;a href=&quot;https://www.adafruit.com/products/954&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;TTL 轉 USB 線&lt;/a&gt; 來接到 Raspberry Pi 上面的 UART 接腳，透過 UART 來進入 console。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8e801cc4/raspberrypi-console.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接上後，看你是要用 &lt;a href=&quot;https://www.gnu.org/s/emacs/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Emacs&lt;/a&gt;、 &lt;a href=&quot;https://www.decisivetactics.com/products/serial/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Serial&lt;/a&gt; (Mac OS)、&lt;a href=&quot;http://www.putty.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Putty&lt;/a&gt; (Windows)、&lt;a href=&quot;https://linux.die.net/man/1/gtkterm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GtkTerm&lt;/a&gt; (Linux) 來進行連線，記得以下東西不要設定錯誤就好:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;Baud Rate: 115200&lt;/li&gt;
&lt;li&gt;Data Bits: 8&lt;/li&gt;
&lt;li&gt;Parity: None&lt;/li&gt;
&lt;li&gt;Stop Bits: 1&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
我自己是習慣透過 &lt;a href=&quot;https://www.gnu.org/s/emacs/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Emacs&lt;/a&gt; 的 &lt;code&gt;M-x serial-term&lt;/code&gt; 命令去進行連接
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8e801cc4/serial.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org575219d&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org575219d&quot;&gt;參考資料&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org575219d&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/things/hardware/raspberrypi.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things: Raspberry Pi 3 Getting Started&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/8e801cc4/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Android Things 學習筆記: 介紹</title>
      <link>https://coldnew.github.io/399f19c/</link>
      <guid>https://coldnew.github.io/399f19c/</guid>
      <pubDate>Tue, 09 May 2017 23:52:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
最近打算稍微了解一下 Google 在推的 &lt;a href=&quot;https://developer.android.com/things&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; ，這是一套以 Android 為基礎改製而成的作業系統，目的在於用於現在很夯的物聯網(Internet of Things, IoT) 上。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;div id=&quot;outline-container-orgc54e781&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc54e781&quot;&gt;關於 Android Things&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc54e781&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 前身為 Google 的 &lt;a href=&quot;http://chinese.engadget.com/2015/05/28/project-brillo-google-iot/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Brillo 專案&lt;/a&gt; ，在約 2016 年底改名為 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 。這東西到底是什麼? 
&lt;/p&gt;

&lt;p&gt;
簡單的來說，隨著 Android 的普及，會使用 Java 寫 Android app 的人越來越多， &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 就是為了這些開發者存在的物連網系統，就如網頁的豪語:
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
If you can build an app, you can build a device. ── Google
&lt;/p&gt;

&lt;p&gt;
(只要你有能力打造出 App，你就能打造出一個裝置。)
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;p&gt;
事實上，你的確可以使用 Java 來寫 app 然後丟到支援 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的開發板上，來透過 GPIO、I²C、PWM 等控制周邊，這過層中底層的部分都幫你包好了，你只要會寫 Java 就可以開發物連網(IoT)裝置。
&lt;/p&gt;

&lt;p&gt;
&lt;del&gt;於是只要花個 22k 請個會寫 Java 的人，你就可以當老闆賣設備了&lt;/del&gt; 。
&lt;/p&gt;

&lt;p&gt;
當然，Google 不可能這麼佛心為了那些只會寫 Java 的人設計一個物連網系統， &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的目的同時也是為了推廣 Android，就如 &lt;a href=&quot;http://suyati.com/launching-android-things-googles-new-os-for-smart-iot-devices/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things - The new OS for smart IoT devices from Google&lt;/a&gt; 這篇文章的圖片那樣:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/399f19c/Android-Things.jpg&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
只要透過你的 Android 手機/平板，你就可以盡情的控制這些 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 設備。
&lt;/p&gt;

&lt;p&gt;
(當然這些東西你還是有辦法在 iOS 上進行控制的， &lt;del&gt;記得再花個 40k 請個會寫 obj-c/swift 的人&lt;/del&gt;)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc9e3381&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc9e3381&quot;&gt;支援的開發板&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc9e3381&quot;&gt;
&lt;p&gt;
那如果我們想要入門 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的話，需要哪些開發板呢?
&lt;/p&gt;

&lt;p&gt;
撰寫這篇文章的時候，官方支援的開發板有 &lt;a href=&quot;https://developer.android.com/things/hardware/developer-kits.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;以下幾種&lt;/a&gt; :
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/399f19c/sbt.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在這些開發板中，考量到價錢以及實用性，我決定採用 &lt;a href=&quot;https://www.raspberrypi.org/products/raspberry-pi-3-model-b/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Raspberry Pi 3 Model B&lt;/a&gt; 來作為我用來學習 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的開發板。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgbfe7b02&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgbfe7b02&quot;&gt;隱憂&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgbfe7b02&quot;&gt;
&lt;p&gt;
雖然 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 是由 Google 所提出的專案，但很多 Google 提出的專案也有面臨過被廢棄的命運，比如 &lt;a href=&quot;http://hk.on.cc/hk/bkn/cnt/finance/20160903/bkn-20160903201859069-0903_00842_001.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Project Arc (積木手機)&lt;/a&gt; 這個計畫也被 Google 廢棄了，  &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 是否值得追隨也是個很大的問題。
&lt;/p&gt;

&lt;p&gt;
另外一個問題是，對於物連網裝置 (Internet of Things, IoT)，我們常用的設備都是不到 1MB 記憶體的微控制器(MCU)裝置，而 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 最低要求要 &lt;code&gt;256MB 的記憶體&lt;/code&gt; 以及動輒 &lt;code&gt;100MB 大小的儲存裝置&lt;/code&gt; ，以成本來考量這其實是蠻浪費的。 (還不如去用 &lt;a href=&quot;https://www.mbed.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;mbed&lt;/a&gt; 還比較划算)
&lt;/p&gt;

&lt;p&gt;
在 &lt;a href=&quot;http://events.linuxfoundation.org/events/embedded-linux-conference-europe&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Embedded Linux Conference 2017&lt;/a&gt; 上的 &lt;a href=&quot;http://events.linuxfoundation.org/sites/events/files/slides/android-things-internals-170223.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things - Internals and cute embedded nonsense hacks&lt;/a&gt; 演講也有提到這些問題。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org8dbc20f&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org8dbc20f&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org8dbc20f&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;https://makerdiary.co/getting-started-with-android-things/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things 來了，老司機快上車~&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;http://technews.tw/2016/12/15/android-things-is-googles-new-os-for-smart-devices/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Google 發表物聯網平台 Android Things，要讓裝置開發和做 App 一樣簡單&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
最近打算稍微了解一下 Google 在推的 &lt;a href=&quot;https://developer.android.com/things&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; ，這是一套以 Android 為基礎改製而成的作業系統，目的在於用於現在很夯的物聯網(Internet of Things, IoT) 上。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;div id=&quot;outline-container-orgc54e781&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc54e781&quot;&gt;關於 Android Things&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc54e781&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 前身為 Google 的 &lt;a href=&quot;http://chinese.engadget.com/2015/05/28/project-brillo-google-iot/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Brillo 專案&lt;/a&gt; ，在約 2016 年底改名為 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 。這東西到底是什麼? 
&lt;/p&gt;

&lt;p&gt;
簡單的來說，隨著 Android 的普及，會使用 Java 寫 Android app 的人越來越多， &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 就是為了這些開發者存在的物連網系統，就如網頁的豪語:
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
If you can build an app, you can build a device. ── Google
&lt;/p&gt;

&lt;p&gt;
(只要你有能力打造出 App，你就能打造出一個裝置。)
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;p&gt;
事實上，你的確可以使用 Java 來寫 app 然後丟到支援 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的開發板上，來透過 GPIO、I²C、PWM 等控制周邊，這過層中底層的部分都幫你包好了，你只要會寫 Java 就可以開發物連網(IoT)裝置。
&lt;/p&gt;

&lt;p&gt;
&lt;del&gt;於是只要花個 22k 請個會寫 Java 的人，你就可以當老闆賣設備了&lt;/del&gt; 。
&lt;/p&gt;

&lt;p&gt;
當然，Google 不可能這麼佛心為了那些只會寫 Java 的人設計一個物連網系統， &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的目的同時也是為了推廣 Android，就如 &lt;a href=&quot;http://suyati.com/launching-android-things-googles-new-os-for-smart-iot-devices/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things - The new OS for smart IoT devices from Google&lt;/a&gt; 這篇文章的圖片那樣:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/399f19c/Android-Things.jpg&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
只要透過你的 Android 手機/平板，你就可以盡情的控制這些 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 設備。
&lt;/p&gt;

&lt;p&gt;
(當然這些東西你還是有辦法在 iOS 上進行控制的， &lt;del&gt;記得再花個 40k 請個會寫 obj-c/swift 的人&lt;/del&gt;)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc9e3381&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc9e3381&quot;&gt;支援的開發板&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc9e3381&quot;&gt;
&lt;p&gt;
那如果我們想要入門 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的話，需要哪些開發板呢?
&lt;/p&gt;

&lt;p&gt;
撰寫這篇文章的時候，官方支援的開發板有 &lt;a href=&quot;https://developer.android.com/things/hardware/developer-kits.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;以下幾種&lt;/a&gt; :
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/399f19c/sbt.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在這些開發板中，考量到價錢以及實用性，我決定採用 &lt;a href=&quot;https://www.raspberrypi.org/products/raspberry-pi-3-model-b/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Raspberry Pi 3 Model B&lt;/a&gt; 來作為我用來學習 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 的開發板。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgbfe7b02&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgbfe7b02&quot;&gt;隱憂&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgbfe7b02&quot;&gt;
&lt;p&gt;
雖然 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 是由 Google 所提出的專案，但很多 Google 提出的專案也有面臨過被廢棄的命運，比如 &lt;a href=&quot;http://hk.on.cc/hk/bkn/cnt/finance/20160903/bkn-20160903201859069-0903_00842_001.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Project Arc (積木手機)&lt;/a&gt; 這個計畫也被 Google 廢棄了，  &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 是否值得追隨也是個很大的問題。
&lt;/p&gt;

&lt;p&gt;
另外一個問題是，對於物連網裝置 (Internet of Things, IoT)，我們常用的設備都是不到 1MB 記憶體的微控制器(MCU)裝置，而 &lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt; 最低要求要 &lt;code&gt;256MB 的記憶體&lt;/code&gt; 以及動輒 &lt;code&gt;100MB 大小的儲存裝置&lt;/code&gt; ，以成本來考量這其實是蠻浪費的。 (還不如去用 &lt;a href=&quot;https://www.mbed.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;mbed&lt;/a&gt; 還比較划算)
&lt;/p&gt;

&lt;p&gt;
在 &lt;a href=&quot;http://events.linuxfoundation.org/events/embedded-linux-conference-europe&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Embedded Linux Conference 2017&lt;/a&gt; 上的 &lt;a href=&quot;http://events.linuxfoundation.org/sites/events/files/slides/android-things-internals-170223.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things - Internals and cute embedded nonsense hacks&lt;/a&gt; 演講也有提到這些問題。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org8dbc20f&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org8dbc20f&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org8dbc20f&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/things/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;https://makerdiary.co/getting-started-with-android-things/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Things 來了，老司機快上車~&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;http://technews.tw/2016/12/15/android-things-is-googles-new-os-for-smart-devices/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Google 發表物聯網平台 Android Things，要讓裝置開發和做 App 一樣簡單&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/399f19c/#disqus_thread</comments>
    </item>
    
    <item>
      <title>使用 yasnippet 自動插入程式碼樣板</title>
      <link>https://coldnew.github.io/7e10e07e/</link>
      <guid>https://coldnew.github.io/7e10e07e/</guid>
      <pubDate>Wed, 03 May 2017 02:19:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;https://coldnew.github.io/e10a343/&quot;&gt;用 insert-shebang 自動插入直譯器指令&lt;/a&gt; 一文中我們提到了如何自動對腳本檔案插入 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; ，這次來談談如何透過 &lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 自動對你的檔案插入你想要的樣板，比如授權資訊 (copyright)、預設標頭檔等等。
&lt;/p&gt;

&lt;p&gt;
在 &lt;a href=&quot;https://www.gnu.org/s/emacs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Emacs&lt;/a&gt; 下雖然有其他套件可以完成這種 &lt;code&gt;插入樣板&lt;/code&gt; 的功能，但是既然我們可以透過 &lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 來辦到，就不需要多學新的樣板標記語言了 :)
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
&lt;b&gt;註&lt;/b&gt;: 本文修改自 2009 年我發佈在 ptt 上的 &lt;a href=&quot;https://www.ptt.cc/bbs/Editor/M.1297600857.A.49F.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;建立新檔案時自動插入樣板 (使用 yasnippet)&lt;/a&gt; 一文。
&lt;/p&gt;

&lt;div id=&quot;outline-container-org2f56733&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org2f56733&quot;&gt;安裝套件&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org2f56733&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 已經收錄在 &lt;a href=&quot;https://melpa.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MELPA&lt;/a&gt; 中，因此你可以直接透過 &lt;code&gt;M-x&lt;/code&gt; 去安裝這套件
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
M-x package-install RET yasnippet RET
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org9cf530b&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org9cf530b&quot;&gt;使用方式&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org9cf530b&quot;&gt;
&lt;p&gt;
在你的 &lt;code&gt;.emacs&lt;/code&gt; 加入以下命令:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-emacs-lisp&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;require&lt;/span&gt; &#39;&lt;span style=&quot;color: #ccaaff;&quot;&gt;yasnippet&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;yas-global-mode 1&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣的話就可以啟用 &lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 這個套件的功能囉～
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc9a80e9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc9a80e9&quot;&gt;對新檔案自動加入樣板&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc9a80e9&quot;&gt;
&lt;p&gt;
我們首先要在你的 &lt;code&gt;.emacs&lt;/code&gt; 加入以下程式碼，這會讓 &lt;a href=&quot;https://www.gnu.org/s/emacs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Emacs&lt;/a&gt; 在開啟新檔案時，觸發 &lt;code&gt;find-file-hook&lt;/code&gt; 並尋找這個新檔案是否有相對應名為 &lt;code&gt;HEADER&lt;/code&gt; 的 &lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 樣板。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-emacs-lisp&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Auto add HEADER in new file&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;add-hook &#39;find-file-hook
          &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;lambda &lt;span style=&quot;color: #aaccff;&quot;&gt;()&lt;/span&gt;
             &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;when&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;and&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;buffer-file-name&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
                        &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;not &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;file-exists-p &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;buffer-file-name&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
                        &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;= &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;point-max&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt; 1&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;
               &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;header-snippet &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;HEADER&quot;&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;
                     &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;yas/fallback-behavior &#39;return-nil&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
                 &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;insert header-snippet&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
                 &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;if can&#39;t expand snippet, delete insert string&lt;/span&gt;
                 &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;not &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;yas/expand&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;
                     &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;delete-region &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;point-min&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;point-max&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，接下來我們要針對我們的目標建立名為 &lt;code&gt;HEADER&lt;/code&gt; 的樣板。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org62d1e17&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org62d1e17&quot;&gt;建立樣板&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org62d1e17&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 對於如何建立樣板(snippet) 有很&lt;a href=&quot;http://joaotavora.github.io/yasnippet/snippet-development.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;完整的說明&lt;/a&gt; ，在這邊，我用簡單的方法來解釋。
&lt;/p&gt;


&lt;p&gt;
首先假設你是要對 &lt;code&gt;C 語言&lt;/code&gt; 建立你的樣板(snippet)，那你先透過 &lt;a href=&quot;https://www.gnu.org/s/emacs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;emacs&lt;/a&gt; 打開隨便一個 &lt;code&gt;xxx.c&lt;/code&gt; 的檔案，接下來透過
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
M-x yas-new-snippet
&lt;/pre&gt;

&lt;p&gt;
去對 &lt;code&gt;C 語言&lt;/code&gt; 建立你的樣板，我們在裡面填入以下內容
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-snippet&quot;&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# -*- mode: snippet -*-&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# name: Header File Template&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# key: HEADER&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# --&lt;/span&gt;

//
//  This is yasnippet example for c-mode
//

&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;#include &amp;lt;stdio.h&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;#include &amp;lt;stdlib.h&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
建立好後，並存成 &lt;code&gt;HEADER&lt;/code&gt; 這個檔案名稱就完成了。 建立一個新的 C 語言檔案看看，你會發現這個檔案直接填入了你剛剛設定的樣板。
&lt;/p&gt;

&lt;p&gt;
(假如你的 snippet 資料夾在 &lt;code&gt;~/.emacs.d/snippets&lt;/code&gt; 則這個 snippet 會存成 &lt;code&gt;~/.emacs.d/snippets/c-mode/HEADER&lt;/code&gt; 這個檔案。)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1fb9ce8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1fb9ce8&quot;&gt;進階設定&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1fb9ce8&quot;&gt;
&lt;p&gt;
除了上面的簡單樣板外，我們也可以透過 &lt;code&gt;emacs-lisp&lt;/code&gt; 作些進階設定，在 &lt;a href=&quot;http://joaotavora.github.io/yasnippet/snippet-development.html#sec-3-2&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Embedded Emacs-lisp code&lt;/a&gt; 這邊就有提到如何在你的樣板(snippet)裡面使用 emacs-lisp 進行更多的擴充。
&lt;/p&gt;

&lt;p&gt;
(注意到 emacs-lisp 程式碼在樣板(snippet)中，要被 &lt;code&gt;``&lt;/code&gt; 包住。)
&lt;/p&gt;

&lt;p&gt;
假設我們想要對 &lt;code&gt;~/OpenSource/&lt;/code&gt; 這個資料夾的檔案都插入 GPL 授權，而其他狀況則是 APACHE 授權，則你可以這樣作：
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-newlisp&quot;&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# -*- mode: snippet -*-&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# name: Header File Template&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# key: HEADER&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# --&lt;/span&gt;

`
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;string-equal &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;file-name-directory &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;buffer-file-name&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
                  &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;expand-file-name &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~/OpenSource/&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;insert &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;GPL&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;else&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;insert &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;APACHE&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
`
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;https://coldnew.github.io/e10a343/&quot;&gt;用 insert-shebang 自動插入直譯器指令&lt;/a&gt; 一文中我們提到了如何自動對腳本檔案插入 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; ，這次來談談如何透過 &lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 自動對你的檔案插入你想要的樣板，比如授權資訊 (copyright)、預設標頭檔等等。
&lt;/p&gt;

&lt;p&gt;
在 &lt;a href=&quot;https://www.gnu.org/s/emacs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Emacs&lt;/a&gt; 下雖然有其他套件可以完成這種 &lt;code&gt;插入樣板&lt;/code&gt; 的功能，但是既然我們可以透過 &lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 來辦到，就不需要多學新的樣板標記語言了 :)
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
&lt;b&gt;註&lt;/b&gt;: 本文修改自 2009 年我發佈在 ptt 上的 &lt;a href=&quot;https://www.ptt.cc/bbs/Editor/M.1297600857.A.49F.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;建立新檔案時自動插入樣板 (使用 yasnippet)&lt;/a&gt; 一文。
&lt;/p&gt;

&lt;div id=&quot;outline-container-org2f56733&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org2f56733&quot;&gt;安裝套件&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org2f56733&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 已經收錄在 &lt;a href=&quot;https://melpa.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MELPA&lt;/a&gt; 中，因此你可以直接透過 &lt;code&gt;M-x&lt;/code&gt; 去安裝這套件
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
M-x package-install RET yasnippet RET
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org9cf530b&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org9cf530b&quot;&gt;使用方式&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org9cf530b&quot;&gt;
&lt;p&gt;
在你的 &lt;code&gt;.emacs&lt;/code&gt; 加入以下命令:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-emacs-lisp&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;require&lt;/span&gt; &#39;&lt;span style=&quot;color: #ccaaff;&quot;&gt;yasnippet&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;yas-global-mode 1&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣的話就可以啟用 &lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 這個套件的功能囉～
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc9a80e9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc9a80e9&quot;&gt;對新檔案自動加入樣板&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc9a80e9&quot;&gt;
&lt;p&gt;
我們首先要在你的 &lt;code&gt;.emacs&lt;/code&gt; 加入以下程式碼，這會讓 &lt;a href=&quot;https://www.gnu.org/s/emacs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Emacs&lt;/a&gt; 在開啟新檔案時，觸發 &lt;code&gt;find-file-hook&lt;/code&gt; 並尋找這個新檔案是否有相對應名為 &lt;code&gt;HEADER&lt;/code&gt; 的 &lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 樣板。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-emacs-lisp&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Auto add HEADER in new file&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;add-hook &#39;find-file-hook
          &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;lambda &lt;span style=&quot;color: #aaccff;&quot;&gt;()&lt;/span&gt;
             &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;when&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;and&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;buffer-file-name&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
                        &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;not &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;file-exists-p &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;buffer-file-name&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
                        &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;= &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;point-max&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt; 1&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;
               &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;header-snippet &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;HEADER&quot;&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;
                     &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;yas/fallback-behavior &#39;return-nil&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
                 &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;insert header-snippet&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
                 &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;if can&#39;t expand snippet, delete insert string&lt;/span&gt;
                 &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;not &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;yas/expand&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;
                     &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;delete-region &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;point-min&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;point-max&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，接下來我們要針對我們的目標建立名為 &lt;code&gt;HEADER&lt;/code&gt; 的樣板。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org62d1e17&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org62d1e17&quot;&gt;建立樣板&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org62d1e17&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://github.com/joaotavora/yasnippet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;yasnippet&lt;/a&gt; 對於如何建立樣板(snippet) 有很&lt;a href=&quot;http://joaotavora.github.io/yasnippet/snippet-development.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;完整的說明&lt;/a&gt; ，在這邊，我用簡單的方法來解釋。
&lt;/p&gt;


&lt;p&gt;
首先假設你是要對 &lt;code&gt;C 語言&lt;/code&gt; 建立你的樣板(snippet)，那你先透過 &lt;a href=&quot;https://www.gnu.org/s/emacs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;emacs&lt;/a&gt; 打開隨便一個 &lt;code&gt;xxx.c&lt;/code&gt; 的檔案，接下來透過
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
M-x yas-new-snippet
&lt;/pre&gt;

&lt;p&gt;
去對 &lt;code&gt;C 語言&lt;/code&gt; 建立你的樣板，我們在裡面填入以下內容
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-snippet&quot;&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# -*- mode: snippet -*-&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# name: Header File Template&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# key: HEADER&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# --&lt;/span&gt;

//
//  This is yasnippet example for c-mode
//

&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;#include &amp;lt;stdio.h&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;#include &amp;lt;stdlib.h&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
建立好後，並存成 &lt;code&gt;HEADER&lt;/code&gt; 這個檔案名稱就完成了。 建立一個新的 C 語言檔案看看，你會發現這個檔案直接填入了你剛剛設定的樣板。
&lt;/p&gt;

&lt;p&gt;
(假如你的 snippet 資料夾在 &lt;code&gt;~/.emacs.d/snippets&lt;/code&gt; 則這個 snippet 會存成 &lt;code&gt;~/.emacs.d/snippets/c-mode/HEADER&lt;/code&gt; 這個檔案。)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1fb9ce8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1fb9ce8&quot;&gt;進階設定&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1fb9ce8&quot;&gt;
&lt;p&gt;
除了上面的簡單樣板外，我們也可以透過 &lt;code&gt;emacs-lisp&lt;/code&gt; 作些進階設定，在 &lt;a href=&quot;http://joaotavora.github.io/yasnippet/snippet-development.html#sec-3-2&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Embedded Emacs-lisp code&lt;/a&gt; 這邊就有提到如何在你的樣板(snippet)裡面使用 emacs-lisp 進行更多的擴充。
&lt;/p&gt;

&lt;p&gt;
(注意到 emacs-lisp 程式碼在樣板(snippet)中，要被 &lt;code&gt;``&lt;/code&gt; 包住。)
&lt;/p&gt;

&lt;p&gt;
假設我們想要對 &lt;code&gt;~/OpenSource/&lt;/code&gt; 這個資料夾的檔案都插入 GPL 授權，而其他狀況則是 APACHE 授權，則你可以這樣作：
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-newlisp&quot;&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# -*- mode: snippet -*-&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# name: Header File Template&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# key: HEADER&lt;/span&gt;
&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# --&lt;/span&gt;

`
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;string-equal &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;file-name-directory &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;buffer-file-name&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
                  &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;expand-file-name &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~/OpenSource/&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;insert &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;GPL&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;else&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;insert &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;APACHE&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
`
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/7e10e07e/#disqus_thread</comments>
    </item>
    
    <item>
      <title>用 insert-shebang 自動插入直譯器指令</title>
      <link>https://coldnew.github.io/e10a343/</link>
      <guid>https://coldnew.github.io/e10a343/</guid>
      <pubDate>Wed, 03 May 2017 01:50:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
我們在寫腳本的時候，總要在檔案的開頭加入 &lt;code&gt;#!&lt;/code&gt; 這樣的開頭來讓系統知道如何執行這個腳本，而 &lt;code&gt;#!&lt;/code&gt; 這樣的東西則稱之為 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 。
&lt;/p&gt;

&lt;p&gt;
每次寫腳本都需要手動撰寫 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 也是很煩的，因此我們可以讓 &lt;a href=&quot;https://www.gnu.org/s/emacs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;emacs&lt;/a&gt; 根據腳本的檔名，自動幫我們加入合適的 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 到檔案的第一行。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
在 &lt;a href=&quot;https://www.gnu.org/s/emacs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;emacs&lt;/a&gt; 上，有一個名為 &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 的套件可以幫助我們達到這個需求。
&lt;/p&gt;

&lt;p&gt;
舉例來說，在建立 &lt;code&gt;xxx.sh&lt;/code&gt; 這樣的檔案時， &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 會自動在檔案開頭加入:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;!/usr/bin/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;env&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; bash&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而如果建立的是 &lt;code&gt;xxx.py&lt;/code&gt; ，則會是:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;!/usr/bin/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;env&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; python&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb87627e&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb87627e&quot;&gt;安裝套件&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb87627e&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 已經收錄在 &lt;a href=&quot;https://melpa.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MELPA&lt;/a&gt; 中，因此你可以直接透過 &lt;code&gt;M-x&lt;/code&gt; 去安裝這套件
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
M-x package-install RET insert-shebang RET
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1c12d8b&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1c12d8b&quot;&gt;使用方式&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1c12d8b&quot;&gt;
&lt;p&gt;
在你的 &lt;code&gt;.emacs&lt;/code&gt; 加入以下命令:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-emacs-lisp&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;require&lt;/span&gt; &#39;&lt;span style=&quot;color: #ccaaff;&quot;&gt;insert-shebang&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣的話就直接啟用 &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 這個套件的功能囉～
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1f13728&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1f13728&quot;&gt;設定這個套件&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1f13728&quot;&gt;
&lt;p&gt;
預設的 &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 其實就已經符合大部分的需求了，如果還想對他進行一些設定，則可以透過以下命令進行:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
M-x customize-group RET insert-shebang RET
&lt;/pre&gt;

&lt;p&gt;
在我撰寫這篇文章的時候， &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 版本是 &lt;a href=&quot;https://github.com/psachin/insert-shebang/blob/e53f893d400fcf6f2870ba0ba957b0dee0692fdd/insert-shebang.el#L48&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;0.9.5&lt;/a&gt; ，大概有以下幾個設定我會有興趣:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
insert-shebang-file-types
&lt;/p&gt;

&lt;p&gt;
預設的 &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 只有對以下幾組副檔名會加入對應的 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-emacs-lisp&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defcustom&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;insert-shebang-file-types&lt;/span&gt;
  &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;py&quot;&lt;/span&gt; . &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;python&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;sh&quot;&lt;/span&gt; . &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;bash&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;pl&quot;&lt;/span&gt; . &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;perl&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;*If nil, add all your file extensions and file types here.&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:type&lt;/span&gt; &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;alist &lt;span style=&quot;color: #ccaaff;&quot;&gt;:key-type&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;string &lt;span style=&quot;color: #ccaaff;&quot;&gt;:tag&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Extension&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
                &lt;span style=&quot;color: #ccaaff;&quot;&gt;:value-type&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;string &lt;span style=&quot;color: #ccaaff;&quot;&gt;:tag&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Interpreter&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:group&lt;/span&gt; &#39;insert-shebang&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
insert-shebang-ignore-extensions
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 預設會去檢查所有你開啟/建立的檔案是否需要加入 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; ，這邊可以指定哪些副檔名不要進行這個檢查。
&lt;/p&gt;

&lt;p&gt;
(老實說我覺得這個設定有點多餘&amp;#x2026;.)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-emacs-lisp&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defcustom&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;insert-shebang-ignore-extensions&lt;/span&gt;
  &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;txt&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;org&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;*Add extensions you want to ignore.&lt;/span&gt;
&lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;List of file extensions to be ignored by default.&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:type&lt;/span&gt; &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;repeat &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;string &lt;span style=&quot;color: #ccaaff;&quot;&gt;:tag&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;extn&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:group&lt;/span&gt; &#39;insert-shebang&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org089b92c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org089b92c&quot;&gt;後記&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org089b92c&quot;&gt;
&lt;p&gt;
雖然這個套件是蠻方便的，但是對於那些沒進行 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 設定的檔案，會丟出一些訊息在 &lt;code&gt;*Message*&lt;/code&gt; 緩衝區也讓我覺得比較討厭。
&lt;/p&gt;

&lt;p&gt;
如果你想插入 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 的同時，並加入一些檔案的資訊，比如授權(copyright)等等，可以參考我另外一篇文章: &lt;a href=&quot;https://coldnew.github.io/7e10e07e/&quot;&gt;使用 yasnippet 自動插入程式碼樣板&lt;/a&gt; 。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
我們在寫腳本的時候，總要在檔案的開頭加入 &lt;code&gt;#!&lt;/code&gt; 這樣的開頭來讓系統知道如何執行這個腳本，而 &lt;code&gt;#!&lt;/code&gt; 這樣的東西則稱之為 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 。
&lt;/p&gt;

&lt;p&gt;
每次寫腳本都需要手動撰寫 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 也是很煩的，因此我們可以讓 &lt;a href=&quot;https://www.gnu.org/s/emacs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;emacs&lt;/a&gt; 根據腳本的檔名，自動幫我們加入合適的 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 到檔案的第一行。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
在 &lt;a href=&quot;https://www.gnu.org/s/emacs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;emacs&lt;/a&gt; 上，有一個名為 &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 的套件可以幫助我們達到這個需求。
&lt;/p&gt;

&lt;p&gt;
舉例來說，在建立 &lt;code&gt;xxx.sh&lt;/code&gt; 這樣的檔案時， &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 會自動在檔案開頭加入:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;!/usr/bin/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;env&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; bash&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而如果建立的是 &lt;code&gt;xxx.py&lt;/code&gt; ，則會是:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;!/usr/bin/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;env&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; python&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb87627e&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb87627e&quot;&gt;安裝套件&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb87627e&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 已經收錄在 &lt;a href=&quot;https://melpa.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MELPA&lt;/a&gt; 中，因此你可以直接透過 &lt;code&gt;M-x&lt;/code&gt; 去安裝這套件
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
M-x package-install RET insert-shebang RET
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1c12d8b&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1c12d8b&quot;&gt;使用方式&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1c12d8b&quot;&gt;
&lt;p&gt;
在你的 &lt;code&gt;.emacs&lt;/code&gt; 加入以下命令:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-emacs-lisp&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;require&lt;/span&gt; &#39;&lt;span style=&quot;color: #ccaaff;&quot;&gt;insert-shebang&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣的話就直接啟用 &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 這個套件的功能囉～
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1f13728&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1f13728&quot;&gt;設定這個套件&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1f13728&quot;&gt;
&lt;p&gt;
預設的 &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 其實就已經符合大部分的需求了，如果還想對他進行一些設定，則可以透過以下命令進行:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
M-x customize-group RET insert-shebang RET
&lt;/pre&gt;

&lt;p&gt;
在我撰寫這篇文章的時候， &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 版本是 &lt;a href=&quot;https://github.com/psachin/insert-shebang/blob/e53f893d400fcf6f2870ba0ba957b0dee0692fdd/insert-shebang.el#L48&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;0.9.5&lt;/a&gt; ，大概有以下幾個設定我會有興趣:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
insert-shebang-file-types
&lt;/p&gt;

&lt;p&gt;
預設的 &lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 只有對以下幾組副檔名會加入對應的 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-emacs-lisp&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defcustom&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;insert-shebang-file-types&lt;/span&gt;
  &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;py&quot;&lt;/span&gt; . &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;python&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;sh&quot;&lt;/span&gt; . &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;bash&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;pl&quot;&lt;/span&gt; . &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;perl&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;*If nil, add all your file extensions and file types here.&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:type&lt;/span&gt; &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;alist &lt;span style=&quot;color: #ccaaff;&quot;&gt;:key-type&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;string &lt;span style=&quot;color: #ccaaff;&quot;&gt;:tag&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Extension&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
                &lt;span style=&quot;color: #ccaaff;&quot;&gt;:value-type&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;string &lt;span style=&quot;color: #ccaaff;&quot;&gt;:tag&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Interpreter&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:group&lt;/span&gt; &#39;insert-shebang&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
insert-shebang-ignore-extensions
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://github.com/psachin/insert-shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;insert-shebang&lt;/a&gt; 預設會去檢查所有你開啟/建立的檔案是否需要加入 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; ，這邊可以指定哪些副檔名不要進行這個檢查。
&lt;/p&gt;

&lt;p&gt;
(老實說我覺得這個設定有點多餘&amp;#x2026;.)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-emacs-lisp&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defcustom&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;insert-shebang-ignore-extensions&lt;/span&gt;
  &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;txt&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;org&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;*Add extensions you want to ignore.&lt;/span&gt;
&lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;List of file extensions to be ignored by default.&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:type&lt;/span&gt; &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;repeat &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;string &lt;span style=&quot;color: #ccaaff;&quot;&gt;:tag&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;extn&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:group&lt;/span&gt; &#39;insert-shebang&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org089b92c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org089b92c&quot;&gt;後記&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org089b92c&quot;&gt;
&lt;p&gt;
雖然這個套件是蠻方便的，但是對於那些沒進行 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 設定的檔案，會丟出一些訊息在 &lt;code&gt;*Message*&lt;/code&gt; 緩衝區也讓我覺得比較討厭。
&lt;/p&gt;

&lt;p&gt;
如果你想插入 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Shebang&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shebang&lt;/a&gt; 的同時，並加入一些檔案的資訊，比如授權(copyright)等等，可以參考我另外一篇文章: &lt;a href=&quot;https://coldnew.github.io/7e10e07e/&quot;&gt;使用 yasnippet 自動插入程式碼樣板&lt;/a&gt; 。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/e10a343/#disqus_thread</comments>
    </item>
    
    <item>
      <title>灣區日報閱讀筆記: 2017/05/01 第 902 期</title>
      <link>https://coldnew.github.io/7a59e714/</link>
      <guid>https://coldnew.github.io/7a59e714/</guid>
      <pubDate>Mon, 01 May 2017 03:50:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
這是我閱讀 &lt;a href=&quot;https://wanqu.co&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;湾区日报&lt;/a&gt; 裡面每天提供五則訊息的筆記，紀錄個人閱讀心得等資訊。
&lt;/p&gt;

&lt;p&gt;
本期文章位址: &lt;a href=&quot;https://wanqu.co/issues/902?s=old-nav&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://wanqu.co/issues/902?s=old-nav&lt;/a&gt;
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;


&lt;div id=&quot;outline-container-org292f928&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org292f928&quot;&gt;The Kano Analysis&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org292f928&quot;&gt;
&lt;blockquote&gt;
&lt;p&gt;

&lt;/p&gt;

&lt;p&gt;
將 Kano Model 應用在設計互聯網產品上，對一批用戶進行簡單的測試：加入這個功能，你的滿意度如何？如果不加的話，你滿意度又如何？收集這倆問題的所有回答、彙總起來就能決定某個功能是否值得花時間去做了。
&lt;/p&gt;

&lt;p&gt;
五類產品功能：1，Desired Features（越多越好，如磁盤容量）；2，Required Features（必須有，但差不多就行了，如輪子能轉就行）；3，Delightful Features（給用戶驚喜，若你不做，他們也不會失落）；4，Indifferent Features（有和沒有都無所謂）；5，Anti-features（加了後，用戶會瘋掉的）。應花力氣做 1 和 2，有額外時間才做 3，避免做 4 和 5。
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://medium.muz.li/the-kano-analysis-c16e7d681158?utm_source=wanqu.co&amp;amp;utm_campaign=Wanqu+Daily&amp;amp;utm_medium=website&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文連結&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
&lt;a href=&quot;http://cdnet.stpi.narl.org.tw/techroom/analysis/2008/pat_08_A003.htm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;狩野模型（Kano Model）&lt;/a&gt; 一般也稱為二維品質模型，所謂二維（Two-dimension）即是包括兩個維度，其一為從顧客觀點的滿意程度，屬於客戶主觀感受，另一為從產品品質觀點的提供，屬於客觀的產品機能或功能。狩野模型示意如下圖所示:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7a59e714/pat_08_A003.jpg&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
(以上引用自 &lt;a href=&quot;http://cdnet.stpi.narl.org.tw/techroom/analysis/2008/pat_08_A003.htm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;產業策略評析：狩野模型（Kano Model）與魅力品質創造&lt;/a&gt; 一文)
&lt;/p&gt;

&lt;p&gt;
剩下的我看不懂 :S，所以只好引用 &lt;a href=&quot;https://wanqu.co&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;湾区日报&lt;/a&gt; 的結論:
&lt;/p&gt;

&lt;p&gt;
五類產品功能：
&lt;/p&gt;

&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;Desired Features（越多越好，如磁盤容量）&lt;/li&gt;
&lt;li&gt;Required Features（必須有，但差不多就行了，如輪子能轉就行）&lt;/li&gt;
&lt;li&gt;Delightful Features（給用戶驚喜，若你不做，他們也不會失落）&lt;/li&gt;
&lt;li&gt;Indifferent Features（有和沒有都無所謂）&lt;/li&gt;
&lt;li&gt;Anti-features（加了後，用戶會瘋掉的）&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;
應花力氣做 1 和 2，有額外時間才做 3，避免做 4 和 5。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id=&quot;outline-container-orga8933a8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga8933a8&quot;&gt;面試的時候如何介紹你自己&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga8933a8&quot;&gt;
&lt;blockquote&gt;
&lt;p&gt;

&lt;/p&gt;

&lt;p&gt;
不只是面試，在很多社交場合都需要介紹自己，介紹自己做過的事，要會講故事、讓人有興趣聽下去。平時要準備一些小段的、不同角度的自我介紹，要用的時候就像調 API 一樣方便：）
&lt;/p&gt;

&lt;p&gt;
名人在電視上接受採訪，好像都能即興演講、侃侃而談；都是平時有準備、有練習、不斷 A/B testing、不斷迭代的，最後總會在合適的時候呈現出合適的版本的說辭。
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://stackoverflow.blog/2017/04/27/how-to-talk-about-yourself-in-an-interview/?utm_source=wanqu.co&amp;amp;utm_campaign=Wanqu+Daily&amp;amp;utm_medium=website&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文連結&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
一言以蔽之: &lt;code&gt;隨時做好說話準備&lt;/code&gt; 。
&lt;/p&gt;

&lt;p&gt;
面試是一個壓力很大的過程，其壓力可能大到讓你講話都吱吱嗚嗚，思考不流暢。
&lt;/p&gt;

&lt;p&gt;
對於做好說話準備，作者提供一個需要準備的列表:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;你做了什麼產品 (What have you built?)&lt;/li&gt;
&lt;li&gt;你工作上遇到最困難的狀況是什麼 (What is the hardest technical problem you have run into?)&lt;/li&gt;
&lt;li&gt;你怎解決他 (How did you solve it?)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
這個列表上的對談，可以幫助面試者了解你的狀況。
&lt;/p&gt;

&lt;p&gt;
那應該如何準備呢? 作者建議用一系列的卡片 (notecards) ，上面列出你正在進行/管理的專案的特色以及目標，如下:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7a59e714/resume-card.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
最後，因為這是 &lt;a href=&quot;https://stackoverflow.blog&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Stack Overflow Blog&lt;/a&gt; 的文章，所以文末也推薦了去 &lt;a href=&quot;http://stackoverflow.com/jobs?utm_source=so-owned&amp;amp;utm_medium=blog&amp;amp;utm_campaign=dev-c4al&amp;amp;utm_content=c4al-link&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Stack Overflow Jobs&lt;/a&gt; 去看看有沒有職缺。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf6b1a8a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgf6b1a8a&quot;&gt;你不是你做的產品的用戶&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgf6b1a8a&quot;&gt;
&lt;blockquote&gt;
&lt;p&gt;

&lt;/p&gt;

&lt;p&gt;
公司創始人或早期員工往往都（號稱）是自己做的產品的忠實用戶，這有個問題：你就會按自己的思維習慣設計產品，亂加各種極其小眾的功能；畢竟世界上大部分人是跟你們很不一樣的。
&lt;/p&gt;

&lt;p&gt;
一個產品的整個生命裡，非用戶數總是遠遠多於已有用戶數；在取悅少數死忠用戶與爭取多數新用戶之間，應優先考慮後者。
&lt;/p&gt;

&lt;p&gt;
&quot;Your customer focus should always be on new or potential users, not early users. Early users will bias experiments, prompt you to build more and more niche features, and stunt growth.&quot;
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://news.greylock.com/you-are-not-your-customer-1621b8eaaf16?utm_source=wanqu.co&amp;amp;utm_campaign=Wanqu+Daily&amp;amp;utm_medium=website&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文連結&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
新創(startup)在一開始會成功的原因，大致上可以區分為兩種:
&lt;/p&gt;

&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;具有獨特的特色(unique insight) 或是解決了自己或是贊助者(founder)的某種問題(pain point)，並假設這問題其他人也會有。&lt;/li&gt;
&lt;li&gt;傾聽用戶，並讓他們理解你所提供的價值(make sure they understand and appreciate the value you&#39;re providing)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;
產品的開發過程中，早期使用者會願意幫忙找到一些產品的缺陷(flaws)，並讓這項產品在他們手中可以良好了運作，但最終，當他們變成死忠用戶(power users)的時候，他們提交的回饋常常都是怎樣讓這個產品可以更好的運作在 &lt;code&gt;他們自己&lt;/code&gt; 身上。
&lt;/p&gt;

&lt;p&gt;
對於一項產品，應該要更加著重在新的用戶上面，雖然死忠用戶(power users)提供的回饋可能會有非常好的特性，但是相對的也會讓你的產品對新用戶而言更加的複雜。
&lt;/p&gt;

&lt;p&gt;
延伸閱讀：
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;https://www.quora.com/What-are-some-of-the-most-important-things-youve-learned-in-marketing&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;What are some of the most important things you&#39;ve learned in marketing?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgdfc1831&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgdfc1831&quot;&gt;Google’s real Kubernetes magic is all about community, not code&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgdfc1831&quot;&gt;
&lt;blockquote&gt;
&lt;p&gt;

&lt;/p&gt;

&lt;p&gt;
作為開源項目，Kubernetes 是非常成功的，Google 懂得放手讓公司外的人貢獻代碼。Google 員工 commit 代碼的比例穩步下降，這是好事。
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;http://www.techrepublic.com/article/googles-real-kubernetes-magic-is-all-about-community-not-code/?utm_source=wanqu.co&amp;amp;utm_campaign=Wanqu+Daily&amp;amp;utm_medium=website&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文連結&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;p&gt;
其實 Google 近幾年開源蠻多程式碼的，不過有一種說法是: 開源給其他人維護，這樣 Google 就可以少花點人力在上面 :)
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://blog.gcp.expert/kubernetes-gke-introduction/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Kubernetes&lt;/a&gt; 是 Google 開源的一套叢集管理系統，其目的是讓使用者透過 Kubernetes 叢集來進行雲端容器叢集的管理，而無需使用者進行複雜的設定工作 (&lt;a href=&quot;https://wild0522.gitbooks.io/yeasy_dp/content/kubernetes/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;參考資料&lt;/a&gt;)。
&lt;/p&gt;

&lt;p&gt;
而這篇文章講到了 Kubernetes 已經在 Google 內部使用了 15 年之久，和他的進爭對手 &lt;a href=&quot;http://mesos.apache.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Apache Mesos&lt;/a&gt; 相比，  &lt;a href=&quot;https://blog.gcp.expert/kubernetes-gke-introduction/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Kubernetes&lt;/a&gt; 有 5 倍大的社群，高達 1,350 個貢獻者，並且有 1,500 個相關工作。
&lt;/p&gt;

&lt;p&gt;
文章後面我就沒啥興趣了，有興趣自己去看，對我而言重要的應該是這個: &lt;a href=&quot;https://github.com/kubernetes/community?utm_campaign=crowdfire&amp;amp;utm_content=crowdfire&amp;amp;utm_medium=social&amp;amp;utm_source=social#1464121790-tw%231493030328731&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;kubernetes/community: Kubernetes community content&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
本篇提及的延伸閱讀:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;http://www.techrepublic.com/article/why-kubernetes-could-be-crowned-king-of-container-management/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Why Kubernetes could be crowned king of container management&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;http://www.techrepublic.com/article/why-kubernetes-may-be-a-bigger-threat-to-amazon-than-googles-cloud/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Why Kubernetes may be a bigger threat to Amazon than Google&#39;s Cloud&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org064c96a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org064c96a&quot;&gt;這可能是本年度最有趣的 bug 了&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org064c96a&quot;&gt;
&lt;blockquote&gt;
&lt;p&gt;

&lt;/p&gt;

&lt;p&gt;
Xfce 是 Linux 上輕量級的桌面環境，GNOME 與 KDE 替代品。不止一個用戶報告了個「bug」：Xfce 的默認桌面的壁紙損壞顯示器屏幕！因為默認的壁紙是老鼠，家裡的貓看了就會去抓顯示器屏幕，把屏幕刮花了！
&lt;/p&gt;

&lt;p&gt;
bug 的修復辦法：把壁紙換成狗。。。但家裡的狗會不會看到了也會來打招呼、舔屏、打架？你看，程序員平時的工作多麼不容易，修復一個 bug，同時引入另一個 bug，總是有活幹。
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;http://www.omgubuntu.co.uk/2017/03/xfce-wallpaper-cat-bug&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文連結&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;p&gt;
這個 bug :)
&lt;/p&gt;

&lt;p&gt;
Xfce 預設的桌面是長這樣的，中間有一隻老鼠
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7a59e714/x1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
其實這個桌布用了很久很久了，但是最近卻有人回報說，自己家的貓看到這個桌面會開始對螢幕抓啊抓啊抓，都把螢幕抓壞了:S。因此這個用戶在 bugzilla 上面開了這個 bug: &lt;a href=&quot;https://bugzilla.xfce.org/show_bug.cgi?id=12117&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;12117 – The default desktop startup screen causes damage to monitor!&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
不過如果進去看這個 bug，會發現到裡面的回應也很有趣:
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
Can&#39;t reproduce this bug, my cat is absolutely indifferent about it. What monitor do you use? Have you tried reporting the bug upstream at the cat vendor?
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;p&gt;
然後還有人在 &lt;a href=&quot;https://www.reddit.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reddit&lt;/a&gt; 上面貼了這篇: &lt;a href=&quot;https://www.reddit.com/r/linux/comments/60rzjn/my_cat_was_fooled_by_xfce/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;My cat was fooled by XFCE：linux&lt;/a&gt; ，這隻貓好可愛啊 XD
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7a59e714/x2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在我寫這篇文章的時候，&lt;a href=&quot;https://bugzilla.xfce.org/show_bug.cgi?id=12117&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;BUG #12117&lt;/a&gt; 還沒被結案，開發者應該也很傻眼吧，其實只要換張桌布就好了啊 :)&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
這是我閱讀 &lt;a href=&quot;https://wanqu.co&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;湾区日报&lt;/a&gt; 裡面每天提供五則訊息的筆記，紀錄個人閱讀心得等資訊。
&lt;/p&gt;

&lt;p&gt;
本期文章位址: &lt;a href=&quot;https://wanqu.co/issues/902?s=old-nav&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://wanqu.co/issues/902?s=old-nav&lt;/a&gt;
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;


&lt;div id=&quot;outline-container-org292f928&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org292f928&quot;&gt;The Kano Analysis&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org292f928&quot;&gt;
&lt;blockquote&gt;
&lt;p&gt;

&lt;/p&gt;

&lt;p&gt;
將 Kano Model 應用在設計互聯網產品上，對一批用戶進行簡單的測試：加入這個功能，你的滿意度如何？如果不加的話，你滿意度又如何？收集這倆問題的所有回答、彙總起來就能決定某個功能是否值得花時間去做了。
&lt;/p&gt;

&lt;p&gt;
五類產品功能：1，Desired Features（越多越好，如磁盤容量）；2，Required Features（必須有，但差不多就行了，如輪子能轉就行）；3，Delightful Features（給用戶驚喜，若你不做，他們也不會失落）；4，Indifferent Features（有和沒有都無所謂）；5，Anti-features（加了後，用戶會瘋掉的）。應花力氣做 1 和 2，有額外時間才做 3，避免做 4 和 5。
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://medium.muz.li/the-kano-analysis-c16e7d681158?utm_source=wanqu.co&amp;amp;utm_campaign=Wanqu+Daily&amp;amp;utm_medium=website&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文連結&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
&lt;a href=&quot;http://cdnet.stpi.narl.org.tw/techroom/analysis/2008/pat_08_A003.htm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;狩野模型（Kano Model）&lt;/a&gt; 一般也稱為二維品質模型，所謂二維（Two-dimension）即是包括兩個維度，其一為從顧客觀點的滿意程度，屬於客戶主觀感受，另一為從產品品質觀點的提供，屬於客觀的產品機能或功能。狩野模型示意如下圖所示:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7a59e714/pat_08_A003.jpg&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
(以上引用自 &lt;a href=&quot;http://cdnet.stpi.narl.org.tw/techroom/analysis/2008/pat_08_A003.htm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;產業策略評析：狩野模型（Kano Model）與魅力品質創造&lt;/a&gt; 一文)
&lt;/p&gt;

&lt;p&gt;
剩下的我看不懂 :S，所以只好引用 &lt;a href=&quot;https://wanqu.co&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;湾区日报&lt;/a&gt; 的結論:
&lt;/p&gt;

&lt;p&gt;
五類產品功能：
&lt;/p&gt;

&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;Desired Features（越多越好，如磁盤容量）&lt;/li&gt;
&lt;li&gt;Required Features（必須有，但差不多就行了，如輪子能轉就行）&lt;/li&gt;
&lt;li&gt;Delightful Features（給用戶驚喜，若你不做，他們也不會失落）&lt;/li&gt;
&lt;li&gt;Indifferent Features（有和沒有都無所謂）&lt;/li&gt;
&lt;li&gt;Anti-features（加了後，用戶會瘋掉的）&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;
應花力氣做 1 和 2，有額外時間才做 3，避免做 4 和 5。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id=&quot;outline-container-orga8933a8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga8933a8&quot;&gt;面試的時候如何介紹你自己&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga8933a8&quot;&gt;
&lt;blockquote&gt;
&lt;p&gt;

&lt;/p&gt;

&lt;p&gt;
不只是面試，在很多社交場合都需要介紹自己，介紹自己做過的事，要會講故事、讓人有興趣聽下去。平時要準備一些小段的、不同角度的自我介紹，要用的時候就像調 API 一樣方便：）
&lt;/p&gt;

&lt;p&gt;
名人在電視上接受採訪，好像都能即興演講、侃侃而談；都是平時有準備、有練習、不斷 A/B testing、不斷迭代的，最後總會在合適的時候呈現出合適的版本的說辭。
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://stackoverflow.blog/2017/04/27/how-to-talk-about-yourself-in-an-interview/?utm_source=wanqu.co&amp;amp;utm_campaign=Wanqu+Daily&amp;amp;utm_medium=website&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文連結&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
一言以蔽之: &lt;code&gt;隨時做好說話準備&lt;/code&gt; 。
&lt;/p&gt;

&lt;p&gt;
面試是一個壓力很大的過程，其壓力可能大到讓你講話都吱吱嗚嗚，思考不流暢。
&lt;/p&gt;

&lt;p&gt;
對於做好說話準備，作者提供一個需要準備的列表:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;你做了什麼產品 (What have you built?)&lt;/li&gt;
&lt;li&gt;你工作上遇到最困難的狀況是什麼 (What is the hardest technical problem you have run into?)&lt;/li&gt;
&lt;li&gt;你怎解決他 (How did you solve it?)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
這個列表上的對談，可以幫助面試者了解你的狀況。
&lt;/p&gt;

&lt;p&gt;
那應該如何準備呢? 作者建議用一系列的卡片 (notecards) ，上面列出你正在進行/管理的專案的特色以及目標，如下:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7a59e714/resume-card.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
最後，因為這是 &lt;a href=&quot;https://stackoverflow.blog&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Stack Overflow Blog&lt;/a&gt; 的文章，所以文末也推薦了去 &lt;a href=&quot;http://stackoverflow.com/jobs?utm_source=so-owned&amp;amp;utm_medium=blog&amp;amp;utm_campaign=dev-c4al&amp;amp;utm_content=c4al-link&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Stack Overflow Jobs&lt;/a&gt; 去看看有沒有職缺。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf6b1a8a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgf6b1a8a&quot;&gt;你不是你做的產品的用戶&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgf6b1a8a&quot;&gt;
&lt;blockquote&gt;
&lt;p&gt;

&lt;/p&gt;

&lt;p&gt;
公司創始人或早期員工往往都（號稱）是自己做的產品的忠實用戶，這有個問題：你就會按自己的思維習慣設計產品，亂加各種極其小眾的功能；畢竟世界上大部分人是跟你們很不一樣的。
&lt;/p&gt;

&lt;p&gt;
一個產品的整個生命裡，非用戶數總是遠遠多於已有用戶數；在取悅少數死忠用戶與爭取多數新用戶之間，應優先考慮後者。
&lt;/p&gt;

&lt;p&gt;
&quot;Your customer focus should always be on new or potential users, not early users. Early users will bias experiments, prompt you to build more and more niche features, and stunt growth.&quot;
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://news.greylock.com/you-are-not-your-customer-1621b8eaaf16?utm_source=wanqu.co&amp;amp;utm_campaign=Wanqu+Daily&amp;amp;utm_medium=website&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文連結&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
新創(startup)在一開始會成功的原因，大致上可以區分為兩種:
&lt;/p&gt;

&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;具有獨特的特色(unique insight) 或是解決了自己或是贊助者(founder)的某種問題(pain point)，並假設這問題其他人也會有。&lt;/li&gt;
&lt;li&gt;傾聽用戶，並讓他們理解你所提供的價值(make sure they understand and appreciate the value you&#39;re providing)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;
產品的開發過程中，早期使用者會願意幫忙找到一些產品的缺陷(flaws)，並讓這項產品在他們手中可以良好了運作，但最終，當他們變成死忠用戶(power users)的時候，他們提交的回饋常常都是怎樣讓這個產品可以更好的運作在 &lt;code&gt;他們自己&lt;/code&gt; 身上。
&lt;/p&gt;

&lt;p&gt;
對於一項產品，應該要更加著重在新的用戶上面，雖然死忠用戶(power users)提供的回饋可能會有非常好的特性，但是相對的也會讓你的產品對新用戶而言更加的複雜。
&lt;/p&gt;

&lt;p&gt;
延伸閱讀：
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;https://www.quora.com/What-are-some-of-the-most-important-things-youve-learned-in-marketing&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;What are some of the most important things you&#39;ve learned in marketing?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgdfc1831&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgdfc1831&quot;&gt;Google’s real Kubernetes magic is all about community, not code&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgdfc1831&quot;&gt;
&lt;blockquote&gt;
&lt;p&gt;

&lt;/p&gt;

&lt;p&gt;
作為開源項目，Kubernetes 是非常成功的，Google 懂得放手讓公司外的人貢獻代碼。Google 員工 commit 代碼的比例穩步下降，這是好事。
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;http://www.techrepublic.com/article/googles-real-kubernetes-magic-is-all-about-community-not-code/?utm_source=wanqu.co&amp;amp;utm_campaign=Wanqu+Daily&amp;amp;utm_medium=website&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文連結&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;p&gt;
其實 Google 近幾年開源蠻多程式碼的，不過有一種說法是: 開源給其他人維護，這樣 Google 就可以少花點人力在上面 :)
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://blog.gcp.expert/kubernetes-gke-introduction/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Kubernetes&lt;/a&gt; 是 Google 開源的一套叢集管理系統，其目的是讓使用者透過 Kubernetes 叢集來進行雲端容器叢集的管理，而無需使用者進行複雜的設定工作 (&lt;a href=&quot;https://wild0522.gitbooks.io/yeasy_dp/content/kubernetes/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;參考資料&lt;/a&gt;)。
&lt;/p&gt;

&lt;p&gt;
而這篇文章講到了 Kubernetes 已經在 Google 內部使用了 15 年之久，和他的進爭對手 &lt;a href=&quot;http://mesos.apache.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Apache Mesos&lt;/a&gt; 相比，  &lt;a href=&quot;https://blog.gcp.expert/kubernetes-gke-introduction/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Kubernetes&lt;/a&gt; 有 5 倍大的社群，高達 1,350 個貢獻者，並且有 1,500 個相關工作。
&lt;/p&gt;

&lt;p&gt;
文章後面我就沒啥興趣了，有興趣自己去看，對我而言重要的應該是這個: &lt;a href=&quot;https://github.com/kubernetes/community?utm_campaign=crowdfire&amp;amp;utm_content=crowdfire&amp;amp;utm_medium=social&amp;amp;utm_source=social#1464121790-tw%231493030328731&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;kubernetes/community: Kubernetes community content&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
本篇提及的延伸閱讀:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;http://www.techrepublic.com/article/why-kubernetes-could-be-crowned-king-of-container-management/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Why Kubernetes could be crowned king of container management&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;http://www.techrepublic.com/article/why-kubernetes-may-be-a-bigger-threat-to-amazon-than-googles-cloud/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Why Kubernetes may be a bigger threat to Amazon than Google&#39;s Cloud&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org064c96a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org064c96a&quot;&gt;這可能是本年度最有趣的 bug 了&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org064c96a&quot;&gt;
&lt;blockquote&gt;
&lt;p&gt;

&lt;/p&gt;

&lt;p&gt;
Xfce 是 Linux 上輕量級的桌面環境，GNOME 與 KDE 替代品。不止一個用戶報告了個「bug」：Xfce 的默認桌面的壁紙損壞顯示器屏幕！因為默認的壁紙是老鼠，家裡的貓看了就會去抓顯示器屏幕，把屏幕刮花了！
&lt;/p&gt;

&lt;p&gt;
bug 的修復辦法：把壁紙換成狗。。。但家裡的狗會不會看到了也會來打招呼、舔屏、打架？你看，程序員平時的工作多麼不容易，修復一個 bug，同時引入另一個 bug，總是有活幹。
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;http://www.omgubuntu.co.uk/2017/03/xfce-wallpaper-cat-bug&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文連結&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;p&gt;
這個 bug :)
&lt;/p&gt;

&lt;p&gt;
Xfce 預設的桌面是長這樣的，中間有一隻老鼠
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7a59e714/x1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
其實這個桌布用了很久很久了，但是最近卻有人回報說，自己家的貓看到這個桌面會開始對螢幕抓啊抓啊抓，都把螢幕抓壞了:S。因此這個用戶在 bugzilla 上面開了這個 bug: &lt;a href=&quot;https://bugzilla.xfce.org/show_bug.cgi?id=12117&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;12117 – The default desktop startup screen causes damage to monitor!&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
不過如果進去看這個 bug，會發現到裡面的回應也很有趣:
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
Can&#39;t reproduce this bug, my cat is absolutely indifferent about it. What monitor do you use? Have you tried reporting the bug upstream at the cat vendor?
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;p&gt;
然後還有人在 &lt;a href=&quot;https://www.reddit.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reddit&lt;/a&gt; 上面貼了這篇: &lt;a href=&quot;https://www.reddit.com/r/linux/comments/60rzjn/my_cat_was_fooled_by_xfce/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;My cat was fooled by XFCE：linux&lt;/a&gt; ，這隻貓好可愛啊 XD
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7a59e714/x2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在我寫這篇文章的時候，&lt;a href=&quot;https://bugzilla.xfce.org/show_bug.cgi?id=12117&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;BUG #12117&lt;/a&gt; 還沒被結案，開發者應該也很傻眼吧，其實只要換張桌布就好了啊 :)&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/7a59e714/#disqus_thread</comments>
    </item>
    
    <item>
      <title>將 Orange Pi Zero 改造成 AirPlay 音頻播放器</title>
      <link>https://coldnew.github.io/d48bba9e/</link>
      <guid>https://coldnew.github.io/d48bba9e/</guid>
      <pubDate>Sun, 23 Apr 2017 12:27:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
最近突然又想自己架設個簡單的 AirPlay 播放器，好透過 wifi 遠端播放我的 iPhone 或是 MacBook 上面的音樂。
&lt;/p&gt;

&lt;p&gt;
剛好手邊的單板電腦都已經有各自的用途，於是便來找一片新的板子，最後鎖定了 &lt;a href=&quot;http://www.orangepi.org/orangepizero/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Orange Pi Zero&lt;/a&gt; 這片開發板 (我選的是記憶體為 256 MB 的版本)。
&lt;/p&gt;

&lt;p&gt;
會選這片的原因，主要是包含運費後他最便宜(大約 NT 362 元)，剩下要自己準備的則是: USB 電源、USB 手機充電線、8GB MicroSD 卡。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
這邊就來紀錄一下我怎樣進行設定的。
&lt;/p&gt;

&lt;div id=&quot;outline-container-orgc0618f0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc0618f0&quot;&gt;下載 Image&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc0618f0&quot;&gt;
&lt;p&gt;
首先連線到 &lt;a href=&quot;http://www.orangepi.org/downloadresources/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;a href=&quot;http://www.orangepi.org/downloadresources/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.orangepi.org/downloadresources/&lt;/a&gt;&lt;/a&gt; ，取得你要用的 Image。由於我只是要用於文字介面，因此選擇 &lt;code&gt;Debian Server&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
下載好 Image 並解壓縮後，可以直接透過 &lt;code&gt;dd&lt;/code&gt; 命令將其燒錄到 SD 卡 (假設 SD 卡設備為: /dev/sdc )
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ sudo dd if=debian_server_For_OrangePizero_v0_9_2.img of=/dev/sdc bs=1m
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org51d1ccd&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org51d1ccd&quot;&gt;連接 UART&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org51d1ccd&quot;&gt;
&lt;p&gt;
將 SD 卡插上後，我會先透過 USB 轉 TTL 的轉接線來登入終端介面
&lt;/p&gt;

&lt;p&gt;
從 &lt;a href=&quot;http://linux-sunxi.org/Xunlong_Orange_Pi_Zero&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xunlong Orange Pi Zero&lt;/a&gt; 上面可以看到 Orange Pi Zero 的腳位是這樣定義的:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a6.jpg&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
因此我們接線的時候，要把 USB 轉 TTL 線上面的 TX 接到 Orange Pi Zero 的 RX, TTL 線上面的 RX 接到 Orange Pi Zero 的 TX:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a5.jpg&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果接上去後，開機沒任何訊息的話，可以試著把 TX 和 RX 線對調，看看是不是接錯了。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgaefb7ee&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgaefb7ee&quot;&gt;預設帳號密碼&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgaefb7ee&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://www.orangepi.org/orangepizero/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Orange Pi Zero&lt;/a&gt; 預設的帳號密碼是這樣的:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;帳號: root&lt;/li&gt;
&lt;li&gt;密碼: orangepi&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
不要輸入錯誤進可以進去啦
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
Debian GNU/Linux 8 OrangePizero ttyS0

OrangePizero login: root
Password:
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgaddae53&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgaddae53&quot;&gt;擴充檔案系統大小&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgaddae53&quot;&gt;
&lt;p&gt;
進入到系統的第一步，當然就是擴充 SD 卡的空間了
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# fs_resize

Disk /dev/mmcblk0: 7.4 GiB, 7969177600 bytes, 15564800 sectors
/dev/mmcblk0p1       40960  172031  131072   64M  b W95 FAT32
/dev/mmcblk0p2      172032 2113536 1941505  948M 83 Linux

Max block: 15563776
Part end: 2113536
Part start: 172032

WARNING: Do you want to resize &quot;/dev/mmcblk0p2&quot; (y/N)?  y
PARTITION RESIZED.
*********************************************
Rootfs Extended. Please REBOOT to take effect
*********************************************
&lt;/pre&gt;

&lt;p&gt;
好了後，我們就可以來進行網路設定，你也可以先接上網路線，然後更新套件。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1230295&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1230295&quot;&gt;設定 wifi&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1230295&quot;&gt;
&lt;p&gt;
我自己對於 wifi 的設定，一直都是習慣使用 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/NetworkManager&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NetworkManager&lt;/a&gt; 來進行的。因此在這邊先啟動 NetworkManager:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# systemctl start NetworkManager
root@OrangePizero:~# systemctl enable NetworkManager
&lt;/pre&gt;

&lt;p&gt;
另外，由於 &lt;a href=&quot;http://www.orangepi.org/orangepizero/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Orange Pi Zero&lt;/a&gt; 有兩個 wifi 設備，一個是 p2p0，另外一個是 wlan1
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# nmcli dev
DEVICE   TYPE      STATE      CONNECTION
eth0     ethernet  connected  eth0
p2p0     wifi      unmanaged  --
gre0     gre       unmanaged  --
lo       loopback  unmanaged  --
wlan1    wifi      unmanaged  --
ip6tnl0  unknown   unmanaged  --
sit0     unknown   unmanaged  --
tunl0    unknown   unmanaged  --
&lt;/pre&gt;

&lt;p&gt;
由於 NetworkManager 預設會先去抓 p2p0 (按照字母排列)，因此我會設定成讓 NetworkManager 忽略 p2p0 這個設備，避免設定 wifi 變得麻煩。
&lt;/p&gt;

&lt;p&gt;
編輯  &lt;code&gt;/etc/NetworkManager/NetworkManager.conf&lt;/code&gt; ，加入以下資訊:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-conf&quot;&gt;[&lt;span style=&quot;color: #fff59d;&quot;&gt;main&lt;/span&gt;]
&lt;span style=&quot;color: #aaccff;&quot;&gt;plugins&lt;/span&gt;=ifupdown,keyfile

[&lt;span style=&quot;color: #fff59d;&quot;&gt;ifupdown&lt;/span&gt;]
&lt;span style=&quot;color: #aaccff;&quot;&gt;managed&lt;/span&gt;=true
[&lt;span style=&quot;color: #fff59d;&quot;&gt;keyfile&lt;/span&gt;]
&lt;span style=&quot;color: #aaccff;&quot;&gt;unmanaged-devices&lt;/span&gt;=interface-name:p2p0
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，重新啟動 NetworkManager
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# systemctl restart NetworkManager
&lt;/pre&gt;

&lt;p&gt;
這樣我們就可以列出我們可以連線的無線網路:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# nmcli dev wifi list
*  SSID        MODE   CHAN  RATE       SIGNAL  BARS  SECURITY
   Edgar       Infra  10    54 Mbit/s  100     ▂▄▆█  WPA1 WPA2
   AUSTIN&amp;amp;FAY  Infra  6     54 Mbit/s  45      ▂▄__  WPA1 WPA2
   75226490    Infra  1     54 Mbit/s  35      ▂▄__  WPA2
   2.4aaaaaaa  Infra  4     54 Mbit/s  34      ▂▄__  WPA1 WPA2
   RT-N16      Infra  6     54 Mbit/s  29      ▂___  WPA2
   a89565282   Infra  1     54 Mbit/s  25      ▂___  WPA1 WPA2
   dlink       Infra  11    54 Mbit/s  20      ▂___  WPA1 WPA2
   mat         Infra  3     54 Mbit/s  22      ▂___  WPA1
&lt;/pre&gt;

&lt;p&gt;
假設我們要連接的 ESSID 為 Edgar，則接下來使用以下命令進行連接 
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# nmtui-connect Edgar
&lt;/pre&gt;

&lt;p&gt;
你會看到出現一個輸入密碼的視窗，輸入進去後應該就可以正常連上網路了
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你想要一個指令就完成這個動作，你可以使用下面的命令 (替換 &amp;lt;essid&amp;gt; 和 &amp;lt;password&amp;gt;)
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# nmcli dev wifi connect &amp;lt;essid&amp;gt; password &amp;lt;password&amp;gt;
&lt;/pre&gt;

&lt;p&gt;
這樣我們就完成無線網路的連接。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgefa2d12&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgefa2d12&quot;&gt;設定 avahi-daemon&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgefa2d12&quot;&gt;
&lt;p&gt;
為了讓 Apple 設備可以透過 &lt;a href=&quot;https://en.wikipedia.org/wiki/Zero-configuration_networking&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zeroconf&lt;/a&gt; 協定找到同一網域下的設備，我們必須啟用 &lt;a href=&quot;https://en.wikipedia.org/wiki/Avahi_(software)&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Avahi&lt;/a&gt;。
&lt;/p&gt;

&lt;p&gt;
這邊啟用 avahi 並將其加入開機啟動項目去。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# systemctl start avahi-daemon
root@OrangePizero:~# systemctl enable avahi-daemon
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgfba2114&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfba2114&quot;&gt;編譯並安裝 shairport-sync&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfba2114&quot;&gt;
&lt;p&gt;
首先，我們要安裝一些軟體來幫助我們編譯並安裝 Shairport。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;root@OrangePizero:~# apt-get install build-essential git autoconf libtool &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
    libdaemon-dev libasound2-dev libpopt-dev libconfig-dev &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
    avahi-daemon libavahi-client-dev &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
    libssl-dev
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
該裝的軟體都裝完以後，我們就可以下載最新的 shairport-sync 程式碼並安裝到系統內。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;git clone https://github.com/mikebrady/shairport-sync.git
&lt;span style=&quot;color: #ccaaff;&quot;&gt;cd&lt;/span&gt; shairport-sync &amp;amp;&amp;amp; autoreconf -i -f
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來就是依照 &lt;a href=&quot;https://github.com/mikebrady/shairport-sync&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shairport-sync&lt;/a&gt; 的 README 進行設置，我是設定了這些參數
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;./configure &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
    --with-alsa --with-stdout --with-pipe --with-avahi &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
    --with-ssl=openssl --with-metadata --with-systemd
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來將整個程式安裝到系統中
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~/shairport-sync# make install
&lt;/pre&gt;

&lt;p&gt;
因為在前面的參數我是設定為給 &lt;i&gt;systemd&lt;/i&gt; 的使用者使用，因此需要增加使用者與群組
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# groupadd -r shairport-sync
root@OrangePizero:~# useradd -r -M -g shairport-sync -s /usr/bin/nologin -G audio shairport-sync
&lt;/pre&gt;

&lt;p&gt;
接著加入到 &lt;i&gt;systemd&lt;/i&gt; 開機設定中，並啟用 shairport-sync 服務
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# systemctl enable shairport-sync
root@OrangePizero:~# systemctl start shairport-sync
&lt;/pre&gt;

&lt;p&gt;
完成後，來設定輸出設備，這邊我採用的是 USB DAC。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org57934f1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org57934f1&quot;&gt;設定 USB DAC&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org57934f1&quot;&gt;
&lt;p&gt;
我自己播放音樂的時候，都是透過 USB DAC 來進行播放的 (這樣音質較好)，因此要多進行一些步驟，讓 &lt;a href=&quot;http://www.orangepi.org/orangepizero/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Orange Pi Zero&lt;/a&gt; 可以透過 USB 音效卡輸出。
&lt;/p&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org00780ab&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org00780ab&quot;&gt;載入需要的驅動&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org00780ab&quot;&gt;
&lt;p&gt;
正常來講，我們只要載入了 &lt;code&gt;snd_usb_audio&lt;/code&gt; 這個驅動，就可以讓 ALSA 識別 USB 音效卡。
&lt;/p&gt;

&lt;p&gt;
不過&amp;#x2026;&amp;#x2026;
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:/lib/modules# modprobe snd_usb_audio
modprobe: ERROR: ../libkmod/libkmod.c:557 kmod_search_moddep() could not open moddep file &#39;/lib/modules/3.4.39/modules.dep.bin&#39;
&lt;/pre&gt;

&lt;p&gt;
好吧，有東西從缺，改用 &lt;code&gt;insmod&lt;/code&gt; 的方式來載入。我們在 &lt;code&gt;/etc/rc.local&lt;/code&gt; 加上這些東西
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;insmod /lib/modules/3.4.39_zero/snd-usbmidi-lib.ko
insmod /lib/modules/3.4.39_zero/snd-hwdep.ko
insmod /lib/modules/3.4.39_zero/snd-usb-audio.ko
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣重開機後，你可以透過 &lt;code&gt;lsmod&lt;/code&gt; 確認需要用到的驅動是否有真的被載入:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# lsmod
Module                  Size  Used by
snd_usb_audio          79205  2
snd_hwdep               5337  1 snd_usb_audio
snd_usbmidi_lib        17391  1 snd_usb_audio
xradio_wlan           230792  0
&lt;/pre&gt;

&lt;p&gt;
如果上面列出的模組有缺的話，可以透過以下命令檢查是否 &lt;code&gt;/etc/rc.local&lt;/code&gt; 有哪個地方出錯
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# systemctl status rc-local
● rc-local.service - /etc/rc.local Compatibility
   Loaded: loaded (/lib/systemd/system/rc-local.service; static)
   Active: active (exited) since Thu 1970-01-01 00:38:08 UTC; 47 years 3 months ago

Jan 01 00:38:07 OrangePizero systemd[1]: Starting /etc/rc.local Compatibility...
Jan 01 00:38:08 OrangePizero systemd[1]: Started /etc/rc.local Compatibility.
&lt;/pre&gt;

&lt;p&gt;
確認該被載入的驅動有正常載入後，我們來指定 ALSA 預設得輸出設備。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org3fc03b3&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org3fc03b3&quot;&gt;指定 ALSA 輸出設備&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org3fc03b3&quot;&gt;
&lt;p&gt;
那我們要怎樣讓 ALSA 知道我們指定的 USB DAC 的輸出位置呢?
&lt;/p&gt;

&lt;p&gt;
首先先列出可以使用的音效卡資訊:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# cat /proc/asound/cards
0 [audiocodec     ]: audiocodec - audiocodec
                     audiocodec
1 [sndhdmi        ]: sndhdmi - sndhdmi
                     sndhdmi
2 [Set            ]: USB-Audio - C-Media USB Headphone Set
                     C-Media USB Headphone Set at usb-sunxi-ohci-1, full speed
&lt;/pre&gt;

&lt;p&gt;
找到編號是 &lt;code&gt;2&lt;/code&gt; 後，我們就可以編輯 &lt;code&gt;/etc/asound.conf&lt;/code&gt; 指定預設的 alsa 設備：
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
defaults.pcm.card 2
defaults.ctl.card 2
&lt;/pre&gt;

&lt;p&gt;
這樣子播放的時候，ALSA 就會選用 &lt;code&gt;USB-Audio - C-Media USB Headphone Set&lt;/code&gt; 這個設備進行播放。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org207f0a4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org207f0a4&quot;&gt;在 macOS 下透過 AirPlay 播放&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org207f0a4&quot;&gt;
&lt;p&gt;
所有設定完成後，只要你的 macOS 和你的 AirPlay 設備在同一個網域，你就可以這樣找到他:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a2.png&quot; width=&quot;40%&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
或是透過 iTunes 選擇設備:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a3.png&quot; width=&quot;40%&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
試試看，播放聲音的時候，聲音是不是透過連接在 Orange Pi 上面的 USB DAC 送出來的 :)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1fa09a5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1fa09a5&quot;&gt;參考資料&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1fa09a5&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;http://linux-sunxi.org/Xunlong_Orange_Pi_Zero&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xunlong Orange Pi Zero - linux-sunxi.org&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;https://wiki.archlinux.org/index.php/NetworkManager#nmcli&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NetworkManager - ArchWiki&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;http://coldnew.github.io/blog/2015/11-12_shairport-sync/&quot;&gt;使用 shairport-sync 在 Raspberry Pi 上上建立 AirPlay 音樂播放器&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;http://piboards.com/2017/02/13/orange-pi-as-time-machine-server/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Orange Pi as Time Machine Server | Pi Boards&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;https://www.linuxbabe.com/linux-server/how-to-enable-etcrc-local-with-systemd&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;How to Enable /etc/rc.local with Systemd&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
最近突然又想自己架設個簡單的 AirPlay 播放器，好透過 wifi 遠端播放我的 iPhone 或是 MacBook 上面的音樂。
&lt;/p&gt;

&lt;p&gt;
剛好手邊的單板電腦都已經有各自的用途，於是便來找一片新的板子，最後鎖定了 &lt;a href=&quot;http://www.orangepi.org/orangepizero/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Orange Pi Zero&lt;/a&gt; 這片開發板 (我選的是記憶體為 256 MB 的版本)。
&lt;/p&gt;

&lt;p&gt;
會選這片的原因，主要是包含運費後他最便宜(大約 NT 362 元)，剩下要自己準備的則是: USB 電源、USB 手機充電線、8GB MicroSD 卡。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
這邊就來紀錄一下我怎樣進行設定的。
&lt;/p&gt;

&lt;div id=&quot;outline-container-orgc0618f0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc0618f0&quot;&gt;下載 Image&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc0618f0&quot;&gt;
&lt;p&gt;
首先連線到 &lt;a href=&quot;http://www.orangepi.org/downloadresources/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;a href=&quot;http://www.orangepi.org/downloadresources/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.orangepi.org/downloadresources/&lt;/a&gt;&lt;/a&gt; ，取得你要用的 Image。由於我只是要用於文字介面，因此選擇 &lt;code&gt;Debian Server&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
下載好 Image 並解壓縮後，可以直接透過 &lt;code&gt;dd&lt;/code&gt; 命令將其燒錄到 SD 卡 (假設 SD 卡設備為: /dev/sdc )
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ sudo dd if=debian_server_For_OrangePizero_v0_9_2.img of=/dev/sdc bs=1m
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org51d1ccd&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org51d1ccd&quot;&gt;連接 UART&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org51d1ccd&quot;&gt;
&lt;p&gt;
將 SD 卡插上後，我會先透過 USB 轉 TTL 的轉接線來登入終端介面
&lt;/p&gt;

&lt;p&gt;
從 &lt;a href=&quot;http://linux-sunxi.org/Xunlong_Orange_Pi_Zero&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xunlong Orange Pi Zero&lt;/a&gt; 上面可以看到 Orange Pi Zero 的腳位是這樣定義的:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a6.jpg&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
因此我們接線的時候，要把 USB 轉 TTL 線上面的 TX 接到 Orange Pi Zero 的 RX, TTL 線上面的 RX 接到 Orange Pi Zero 的 TX:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a5.jpg&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果接上去後，開機沒任何訊息的話，可以試著把 TX 和 RX 線對調，看看是不是接錯了。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgaefb7ee&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgaefb7ee&quot;&gt;預設帳號密碼&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgaefb7ee&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://www.orangepi.org/orangepizero/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Orange Pi Zero&lt;/a&gt; 預設的帳號密碼是這樣的:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;帳號: root&lt;/li&gt;
&lt;li&gt;密碼: orangepi&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
不要輸入錯誤進可以進去啦
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
Debian GNU/Linux 8 OrangePizero ttyS0

OrangePizero login: root
Password:
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgaddae53&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgaddae53&quot;&gt;擴充檔案系統大小&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgaddae53&quot;&gt;
&lt;p&gt;
進入到系統的第一步，當然就是擴充 SD 卡的空間了
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# fs_resize

Disk /dev/mmcblk0: 7.4 GiB, 7969177600 bytes, 15564800 sectors
/dev/mmcblk0p1       40960  172031  131072   64M  b W95 FAT32
/dev/mmcblk0p2      172032 2113536 1941505  948M 83 Linux

Max block: 15563776
Part end: 2113536
Part start: 172032

WARNING: Do you want to resize &quot;/dev/mmcblk0p2&quot; (y/N)?  y
PARTITION RESIZED.
*********************************************
Rootfs Extended. Please REBOOT to take effect
*********************************************
&lt;/pre&gt;

&lt;p&gt;
好了後，我們就可以來進行網路設定，你也可以先接上網路線，然後更新套件。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1230295&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1230295&quot;&gt;設定 wifi&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1230295&quot;&gt;
&lt;p&gt;
我自己對於 wifi 的設定，一直都是習慣使用 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/NetworkManager&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NetworkManager&lt;/a&gt; 來進行的。因此在這邊先啟動 NetworkManager:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# systemctl start NetworkManager
root@OrangePizero:~# systemctl enable NetworkManager
&lt;/pre&gt;

&lt;p&gt;
另外，由於 &lt;a href=&quot;http://www.orangepi.org/orangepizero/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Orange Pi Zero&lt;/a&gt; 有兩個 wifi 設備，一個是 p2p0，另外一個是 wlan1
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# nmcli dev
DEVICE   TYPE      STATE      CONNECTION
eth0     ethernet  connected  eth0
p2p0     wifi      unmanaged  --
gre0     gre       unmanaged  --
lo       loopback  unmanaged  --
wlan1    wifi      unmanaged  --
ip6tnl0  unknown   unmanaged  --
sit0     unknown   unmanaged  --
tunl0    unknown   unmanaged  --
&lt;/pre&gt;

&lt;p&gt;
由於 NetworkManager 預設會先去抓 p2p0 (按照字母排列)，因此我會設定成讓 NetworkManager 忽略 p2p0 這個設備，避免設定 wifi 變得麻煩。
&lt;/p&gt;

&lt;p&gt;
編輯  &lt;code&gt;/etc/NetworkManager/NetworkManager.conf&lt;/code&gt; ，加入以下資訊:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-conf&quot;&gt;[&lt;span style=&quot;color: #fff59d;&quot;&gt;main&lt;/span&gt;]
&lt;span style=&quot;color: #aaccff;&quot;&gt;plugins&lt;/span&gt;=ifupdown,keyfile

[&lt;span style=&quot;color: #fff59d;&quot;&gt;ifupdown&lt;/span&gt;]
&lt;span style=&quot;color: #aaccff;&quot;&gt;managed&lt;/span&gt;=true
[&lt;span style=&quot;color: #fff59d;&quot;&gt;keyfile&lt;/span&gt;]
&lt;span style=&quot;color: #aaccff;&quot;&gt;unmanaged-devices&lt;/span&gt;=interface-name:p2p0
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，重新啟動 NetworkManager
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# systemctl restart NetworkManager
&lt;/pre&gt;

&lt;p&gt;
這樣我們就可以列出我們可以連線的無線網路:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# nmcli dev wifi list
*  SSID        MODE   CHAN  RATE       SIGNAL  BARS  SECURITY
   Edgar       Infra  10    54 Mbit/s  100     ▂▄▆█  WPA1 WPA2
   AUSTIN&amp;amp;FAY  Infra  6     54 Mbit/s  45      ▂▄__  WPA1 WPA2
   75226490    Infra  1     54 Mbit/s  35      ▂▄__  WPA2
   2.4aaaaaaa  Infra  4     54 Mbit/s  34      ▂▄__  WPA1 WPA2
   RT-N16      Infra  6     54 Mbit/s  29      ▂___  WPA2
   a89565282   Infra  1     54 Mbit/s  25      ▂___  WPA1 WPA2
   dlink       Infra  11    54 Mbit/s  20      ▂___  WPA1 WPA2
   mat         Infra  3     54 Mbit/s  22      ▂___  WPA1
&lt;/pre&gt;

&lt;p&gt;
假設我們要連接的 ESSID 為 Edgar，則接下來使用以下命令進行連接 
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# nmtui-connect Edgar
&lt;/pre&gt;

&lt;p&gt;
你會看到出現一個輸入密碼的視窗，輸入進去後應該就可以正常連上網路了
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你想要一個指令就完成這個動作，你可以使用下面的命令 (替換 &amp;lt;essid&amp;gt; 和 &amp;lt;password&amp;gt;)
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# nmcli dev wifi connect &amp;lt;essid&amp;gt; password &amp;lt;password&amp;gt;
&lt;/pre&gt;

&lt;p&gt;
這樣我們就完成無線網路的連接。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgefa2d12&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgefa2d12&quot;&gt;設定 avahi-daemon&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgefa2d12&quot;&gt;
&lt;p&gt;
為了讓 Apple 設備可以透過 &lt;a href=&quot;https://en.wikipedia.org/wiki/Zero-configuration_networking&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zeroconf&lt;/a&gt; 協定找到同一網域下的設備，我們必須啟用 &lt;a href=&quot;https://en.wikipedia.org/wiki/Avahi_(software)&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Avahi&lt;/a&gt;。
&lt;/p&gt;

&lt;p&gt;
這邊啟用 avahi 並將其加入開機啟動項目去。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# systemctl start avahi-daemon
root@OrangePizero:~# systemctl enable avahi-daemon
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgfba2114&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfba2114&quot;&gt;編譯並安裝 shairport-sync&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfba2114&quot;&gt;
&lt;p&gt;
首先，我們要安裝一些軟體來幫助我們編譯並安裝 Shairport。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;root@OrangePizero:~# apt-get install build-essential git autoconf libtool &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
    libdaemon-dev libasound2-dev libpopt-dev libconfig-dev &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
    avahi-daemon libavahi-client-dev &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
    libssl-dev
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
該裝的軟體都裝完以後，我們就可以下載最新的 shairport-sync 程式碼並安裝到系統內。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;git clone https://github.com/mikebrady/shairport-sync.git
&lt;span style=&quot;color: #ccaaff;&quot;&gt;cd&lt;/span&gt; shairport-sync &amp;amp;&amp;amp; autoreconf -i -f
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來就是依照 &lt;a href=&quot;https://github.com/mikebrady/shairport-sync&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;shairport-sync&lt;/a&gt; 的 README 進行設置，我是設定了這些參數
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;./configure &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
    --with-alsa --with-stdout --with-pipe --with-avahi &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
    --with-ssl=openssl --with-metadata --with-systemd
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來將整個程式安裝到系統中
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~/shairport-sync# make install
&lt;/pre&gt;

&lt;p&gt;
因為在前面的參數我是設定為給 &lt;i&gt;systemd&lt;/i&gt; 的使用者使用，因此需要增加使用者與群組
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# groupadd -r shairport-sync
root@OrangePizero:~# useradd -r -M -g shairport-sync -s /usr/bin/nologin -G audio shairport-sync
&lt;/pre&gt;

&lt;p&gt;
接著加入到 &lt;i&gt;systemd&lt;/i&gt; 開機設定中，並啟用 shairport-sync 服務
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# systemctl enable shairport-sync
root@OrangePizero:~# systemctl start shairport-sync
&lt;/pre&gt;

&lt;p&gt;
完成後，來設定輸出設備，這邊我採用的是 USB DAC。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org57934f1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org57934f1&quot;&gt;設定 USB DAC&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org57934f1&quot;&gt;
&lt;p&gt;
我自己播放音樂的時候，都是透過 USB DAC 來進行播放的 (這樣音質較好)，因此要多進行一些步驟，讓 &lt;a href=&quot;http://www.orangepi.org/orangepizero/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Orange Pi Zero&lt;/a&gt; 可以透過 USB 音效卡輸出。
&lt;/p&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org00780ab&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org00780ab&quot;&gt;載入需要的驅動&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org00780ab&quot;&gt;
&lt;p&gt;
正常來講，我們只要載入了 &lt;code&gt;snd_usb_audio&lt;/code&gt; 這個驅動，就可以讓 ALSA 識別 USB 音效卡。
&lt;/p&gt;

&lt;p&gt;
不過&amp;#x2026;&amp;#x2026;
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:/lib/modules# modprobe snd_usb_audio
modprobe: ERROR: ../libkmod/libkmod.c:557 kmod_search_moddep() could not open moddep file &#39;/lib/modules/3.4.39/modules.dep.bin&#39;
&lt;/pre&gt;

&lt;p&gt;
好吧，有東西從缺，改用 &lt;code&gt;insmod&lt;/code&gt; 的方式來載入。我們在 &lt;code&gt;/etc/rc.local&lt;/code&gt; 加上這些東西
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;insmod /lib/modules/3.4.39_zero/snd-usbmidi-lib.ko
insmod /lib/modules/3.4.39_zero/snd-hwdep.ko
insmod /lib/modules/3.4.39_zero/snd-usb-audio.ko
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣重開機後，你可以透過 &lt;code&gt;lsmod&lt;/code&gt; 確認需要用到的驅動是否有真的被載入:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# lsmod
Module                  Size  Used by
snd_usb_audio          79205  2
snd_hwdep               5337  1 snd_usb_audio
snd_usbmidi_lib        17391  1 snd_usb_audio
xradio_wlan           230792  0
&lt;/pre&gt;

&lt;p&gt;
如果上面列出的模組有缺的話，可以透過以下命令檢查是否 &lt;code&gt;/etc/rc.local&lt;/code&gt; 有哪個地方出錯
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# systemctl status rc-local
● rc-local.service - /etc/rc.local Compatibility
   Loaded: loaded (/lib/systemd/system/rc-local.service; static)
   Active: active (exited) since Thu 1970-01-01 00:38:08 UTC; 47 years 3 months ago

Jan 01 00:38:07 OrangePizero systemd[1]: Starting /etc/rc.local Compatibility...
Jan 01 00:38:08 OrangePizero systemd[1]: Started /etc/rc.local Compatibility.
&lt;/pre&gt;

&lt;p&gt;
確認該被載入的驅動有正常載入後，我們來指定 ALSA 預設得輸出設備。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org3fc03b3&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org3fc03b3&quot;&gt;指定 ALSA 輸出設備&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org3fc03b3&quot;&gt;
&lt;p&gt;
那我們要怎樣讓 ALSA 知道我們指定的 USB DAC 的輸出位置呢?
&lt;/p&gt;

&lt;p&gt;
首先先列出可以使用的音效卡資訊:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
root@OrangePizero:~# cat /proc/asound/cards
0 [audiocodec     ]: audiocodec - audiocodec
                     audiocodec
1 [sndhdmi        ]: sndhdmi - sndhdmi
                     sndhdmi
2 [Set            ]: USB-Audio - C-Media USB Headphone Set
                     C-Media USB Headphone Set at usb-sunxi-ohci-1, full speed
&lt;/pre&gt;

&lt;p&gt;
找到編號是 &lt;code&gt;2&lt;/code&gt; 後，我們就可以編輯 &lt;code&gt;/etc/asound.conf&lt;/code&gt; 指定預設的 alsa 設備：
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
defaults.pcm.card 2
defaults.ctl.card 2
&lt;/pre&gt;

&lt;p&gt;
這樣子播放的時候，ALSA 就會選用 &lt;code&gt;USB-Audio - C-Media USB Headphone Set&lt;/code&gt; 這個設備進行播放。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org207f0a4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org207f0a4&quot;&gt;在 macOS 下透過 AirPlay 播放&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org207f0a4&quot;&gt;
&lt;p&gt;
所有設定完成後，只要你的 macOS 和你的 AirPlay 設備在同一個網域，你就可以這樣找到他:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a2.png&quot; width=&quot;40%&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
或是透過 iTunes 選擇設備:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d48bba9e/a3.png&quot; width=&quot;40%&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
試試看，播放聲音的時候，聲音是不是透過連接在 Orange Pi 上面的 USB DAC 送出來的 :)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1fa09a5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1fa09a5&quot;&gt;參考資料&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1fa09a5&quot;&gt;
&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;a href=&quot;http://linux-sunxi.org/Xunlong_Orange_Pi_Zero&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xunlong Orange Pi Zero - linux-sunxi.org&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;https://wiki.archlinux.org/index.php/NetworkManager#nmcli&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NetworkManager - ArchWiki&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;http://coldnew.github.io/blog/2015/11-12_shairport-sync/&quot;&gt;使用 shairport-sync 在 Raspberry Pi 上上建立 AirPlay 音樂播放器&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;http://piboards.com/2017/02/13/orange-pi-as-time-machine-server/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Orange Pi as Time Machine Server | Pi Boards&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;https://www.linuxbabe.com/linux-server/how-to-enable-etcrc-local-with-systemd&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;How to Enable /etc/rc.local with Systemd&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/d48bba9e/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Clasp: Common Lisp using LLVM and C++ for Molecular Metaprogramming 筆記</title>
      <link>https://coldnew.github.io/aacb8a72/</link>
      <guid>https://coldnew.github.io/aacb8a72/</guid>
      <pubDate>Thu, 06 Oct 2016 16:13:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
為了了解  &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 這個可以把 Common Lisp 編譯到 LLVM 上的編譯器是如何實作的，於是找來這場演講。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/8X69_42Mj-g&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;

&lt;br&gt;

&lt;p&gt;
講者這場的投影片我沒找到，到是有找到別場次的: &lt;a href=&quot;https://usercontent.irccloud-cdn.com/file/4QyNmxAz/els.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;投影片下載&lt;/a&gt;
&lt;/p&gt;

&lt;br&gt;

&lt;p&gt;
先簡單講些心得，這場演講是 Google 邀請 &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 的作者 &lt;a href=&quot;https://chem.cst.temple.edu/schafmeister.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Christian Schafmeister&lt;/a&gt; 去進行的演講，講者為一化學教授。這場演講剛開頭講了大約 20 多分鐘的化學，而講者為了解決 Molecular (分子生物學) 的問題，決定透過 Common Lisp 的 metaprogramming 的能力來提昇整體計算程式的開發以及計算能力，因此實作了一個可以將 Common Lisp 編譯到 LLVM 上的編譯器。
&lt;/p&gt;

&lt;p&gt;
目前 Clojure 沒有實作編譯到 LLVM 的其中一個原因是缺少了合適的 GC (Garbage Collector)，因此如果我們想要自行實作 Clojure -&amp;gt; LLVM 編譯器的話，就一定需要自行實現高效能的 GC 才行。
&lt;/p&gt;

&lt;p&gt;
讓我們回到演講，講者需要實作的東西需要用到很多 C++ 函式庫，但是寫 C++ 很麻煩，因此他想用更高階的語言: Common Lisp 來實現自己的程式，結果不小心實作了一個 Common Lisp 編譯器:  &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
而 &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 是以 C++ 實作的，並會把 Common Lisp 程式碼轉成 LLVM IR
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來講者解釋了一下它到底要用這套工具做什麼，這邊就去看影片吧 (簡單來說是解決數學計算)。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
另外一個講者想做的，就是透過 C++ 寫 Common Lisp 模組，並且在 Common Lisp 裡面載入它
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
所以為何會選用 Common Lisp 呢? 當然是因為 LISP 很好用阿，只是那些不會用的人一直嫌 LISP 括號太多~
&lt;/p&gt;

&lt;p&gt;
(然後這群人居然可以寫的下 Javascript，也可謂世界奇觀了~)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
當然，懂 LISP 的人都知道使用 Common Lisp 的其中一個理由一定是因為 LISP 的 Macro 太好用了!!
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a7.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
因此講者選用了 Common Lisp 來進行開發，可是這樣子 C++ 的函式庫要怎麼辦呢？總不能重寫吧?原本的 Common Lisp 缺乏了很方便和 C++ 進行調用的接口
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a8.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
其實 Common Lisp 是有 FFI (foreign FUnction Interface)接口的，可以直接載入用 C 寫的函式庫，不過 FFI 用於 C++ 就會有其他問題，比如我們需要在寫一個 wrapper 去包 C++ 的 class。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a9.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
而實際上，在目前的 Common Lisp 上的確需要透過 C 語言去包一層，讓 Common Lisp 可以使用 C++ 函式庫
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
為了解決這個問題，講者想到了是不是可以透過 C++ template 來處理這一塊
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
事實上在講者早期撰寫的函式庫中，Boost.Python 這個模組就用到了這樣的概念，透過 C++ template 做個 hook 讓 Python 程式可以呼叫 C++ 函式庫
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
因此，講者就做了 &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 這個 Common Lisp 編譯器啦，裡面有些程式碼是從 Embedded Common Lisp 那邊 A 來的呦~
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
然後這時候講者講了讓我 Orz 的一句話&amp;#x2026;..
&lt;/p&gt;

&lt;br&gt;
&lt;blockquote&gt;
&lt;p&gt;
I did not use the compiler because I don&#39;t understand it, I wrote a new one.
&lt;/p&gt;

&lt;p&gt;
I wrote a compiler, I never wrote compiler before.
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
所以 &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 到底有哪些特別的呢?
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b7.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
所以的確  &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 有實作 GC (Garbage Collector)，並且有兩種實作，也就是說如果我想做 Clojure -&amp;gt; LLVM，我也需要自行實作這些 GC 才行。
&lt;/p&gt;

&lt;p&gt;
而這個編譯器還有一個 pointer 追蹤器，可以追蹤指標的使用並且告知 GC。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/c.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
那要怎樣在 Clasp 裡面使用 C++ 函式庫呢? 就這樣 ~
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/c1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
複雜一點的範例則是這樣:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/c2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
編譯成動態函式後，就可以在 Clasp 裡面這樣的載入
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/c3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
介紹完 Clasp 後，就是 QA 囉，有興趣自己去看 QA ~
&lt;/p&gt;


&lt;p&gt;
如果你聽完這個演講後，對於這個 Common Lisp 實作有興趣，可以去 GitHub 下載看看:
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;drmeister/clasp&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
為了了解  &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 這個可以把 Common Lisp 編譯到 LLVM 上的編譯器是如何實作的，於是找來這場演講。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/8X69_42Mj-g&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;

&lt;br&gt;

&lt;p&gt;
講者這場的投影片我沒找到，到是有找到別場次的: &lt;a href=&quot;https://usercontent.irccloud-cdn.com/file/4QyNmxAz/els.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;投影片下載&lt;/a&gt;
&lt;/p&gt;

&lt;br&gt;

&lt;p&gt;
先簡單講些心得，這場演講是 Google 邀請 &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 的作者 &lt;a href=&quot;https://chem.cst.temple.edu/schafmeister.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Christian Schafmeister&lt;/a&gt; 去進行的演講，講者為一化學教授。這場演講剛開頭講了大約 20 多分鐘的化學，而講者為了解決 Molecular (分子生物學) 的問題，決定透過 Common Lisp 的 metaprogramming 的能力來提昇整體計算程式的開發以及計算能力，因此實作了一個可以將 Common Lisp 編譯到 LLVM 上的編譯器。
&lt;/p&gt;

&lt;p&gt;
目前 Clojure 沒有實作編譯到 LLVM 的其中一個原因是缺少了合適的 GC (Garbage Collector)，因此如果我們想要自行實作 Clojure -&amp;gt; LLVM 編譯器的話，就一定需要自行實現高效能的 GC 才行。
&lt;/p&gt;

&lt;p&gt;
讓我們回到演講，講者需要實作的東西需要用到很多 C++ 函式庫，但是寫 C++ 很麻煩，因此他想用更高階的語言: Common Lisp 來實現自己的程式，結果不小心實作了一個 Common Lisp 編譯器:  &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
而 &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 是以 C++ 實作的，並會把 Common Lisp 程式碼轉成 LLVM IR
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來講者解釋了一下它到底要用這套工具做什麼，這邊就去看影片吧 (簡單來說是解決數學計算)。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
另外一個講者想做的，就是透過 C++ 寫 Common Lisp 模組，並且在 Common Lisp 裡面載入它
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
所以為何會選用 Common Lisp 呢? 當然是因為 LISP 很好用阿，只是那些不會用的人一直嫌 LISP 括號太多~
&lt;/p&gt;

&lt;p&gt;
(然後這群人居然可以寫的下 Javascript，也可謂世界奇觀了~)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
當然，懂 LISP 的人都知道使用 Common Lisp 的其中一個理由一定是因為 LISP 的 Macro 太好用了!!
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a7.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
因此講者選用了 Common Lisp 來進行開發，可是這樣子 C++ 的函式庫要怎麼辦呢？總不能重寫吧?原本的 Common Lisp 缺乏了很方便和 C++ 進行調用的接口
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a8.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
其實 Common Lisp 是有 FFI (foreign FUnction Interface)接口的，可以直接載入用 C 寫的函式庫，不過 FFI 用於 C++ 就會有其他問題，比如我們需要在寫一個 wrapper 去包 C++ 的 class。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/a9.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
而實際上，在目前的 Common Lisp 上的確需要透過 C 語言去包一層，讓 Common Lisp 可以使用 C++ 函式庫
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
為了解決這個問題，講者想到了是不是可以透過 C++ template 來處理這一塊
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
事實上在講者早期撰寫的函式庫中，Boost.Python 這個模組就用到了這樣的概念，透過 C++ template 做個 hook 讓 Python 程式可以呼叫 C++ 函式庫
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
因此，講者就做了 &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 這個 Common Lisp 編譯器啦，裡面有些程式碼是從 Embedded Common Lisp 那邊 A 來的呦~
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
然後這時候講者講了讓我 Orz 的一句話&amp;#x2026;..
&lt;/p&gt;

&lt;br&gt;
&lt;blockquote&gt;
&lt;p&gt;
I did not use the compiler because I don&#39;t understand it, I wrote a new one.
&lt;/p&gt;

&lt;p&gt;
I wrote a compiler, I never wrote compiler before.
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
所以 &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 到底有哪些特別的呢?
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/b7.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
所以的確  &lt;a href=&quot;https://github.com/drmeister/clasp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clasp&lt;/a&gt; 有實作 GC (Garbage Collector)，並且有兩種實作，也就是說如果我想做 Clojure -&amp;gt; LLVM，我也需要自行實作這些 GC 才行。
&lt;/p&gt;

&lt;p&gt;
而這個編譯器還有一個 pointer 追蹤器，可以追蹤指標的使用並且告知 GC。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/c.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
那要怎樣在 Clasp 裡面使用 C++ 函式庫呢? 就這樣 ~
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/c1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
複雜一點的範例則是這樣:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/c2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
編譯成動態函式後，就可以在 Clasp 裡面這樣的載入
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/aacb8a72/c3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
介紹完 Clasp 後，就是 QA 囉，有興趣自己去看 QA ~
&lt;/p&gt;


&lt;p&gt;
如果你聽完這個演講後，對於這個 Common Lisp 實作有興趣，可以去 GitHub 下載看看:
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;drmeister/clasp&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/aacb8a72/#disqus_thread</comments>
    </item>
    
    <item>
      <title>ClojuTRE 2016 演講筆記</title>
      <link>https://coldnew.github.io/fec9a5ee/</link>
      <guid>https://coldnew.github.io/fec9a5ee/</guid>
      <pubDate>Sun, 02 Oct 2016 18:13:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
趁著假日來趕一下進度，於是把我看過的 &lt;a href=&quot;http://clojutre.org/2016/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ClojuTRE 2016&lt;/a&gt; 心得/筆記紀錄在這邊。
&lt;/p&gt;

&lt;p&gt;
嗯&amp;#x2026;&amp;#x2026;其實 ClojuTRE 2016 每一場演講我都看完了&amp;#x2026;..
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
當然，我並不是每一場都聽的懂，於是這筆記只能僅供參考，請勿盡信 orz&amp;#x2026;
&lt;/p&gt;

&lt;p&gt;
有些演講真的很難畫重點，還是挑自己有興趣的看吧!!
&lt;/p&gt;

&lt;div id=&quot;outline-container-orgfd6229e&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfd6229e&quot;&gt;Using Clojure to provide computerized psychotherapy&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfd6229e&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/Ze3Acb42f3o?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;

&lt;p&gt;
講者投影片: &lt;a href=&quot;http://clojutre.org/2016/slides/Using-Clojure-to-provide-computerized-psychotherapy.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;下載連結&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
這場演講在講 Clojure 用於心理治療 (psychotherapy) 上，一開始講者提出了問題:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/a1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
對於這些問題，我們可以有一些解法:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/a2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
而更多的問題，則是沒有足夠的人手在心裡治療上，因此講者提到了可以透過電腦來協助，點子來自於 treatment manuals
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/a3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
而 網路認知行為治療 (iCBT, internet-based Cognitive behavior therapy) 則大部分提供了如上面的那樣的自我治療(sel-help)資訊，這種方式減少了一些問題，比如治療師(therapist)和病患之間的距離
&lt;/p&gt;

&lt;p&gt;
然後後面講者繼續講了一些問題，解法一是用 Clojure 寫了些網頁程式&amp;#x2026;.(嗯，看影片吧) ，而這網頁程式透過 &lt;a href=&quot;http://www.luminusweb.net&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Luminus framework&lt;/a&gt; 製作，值得一提的是講者第一個學的程式語言就是 Clojure。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/a4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgaceb030&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgaceb030&quot;&gt;The Universe As A Value&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgaceb030&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/odPAkEO2uPQ?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;

&lt;p&gt;
投影片: &lt;a href=&quot;https://juxt.pro/talks/clojutre-2016.html#/sec-title-slide&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;下載連結&lt;/a&gt;
&lt;/p&gt;


&lt;p&gt;
這場演講第一次聽的時候我傻眼了，於是就再聽了第二次。
&lt;/p&gt;

&lt;p&gt;
講者一開始先稍微講了些關於宇宙 (Universe) 的事情，然後導向愛因斯坦的相對論，我們可以假設有一個觀察者如下
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;observer&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;atom &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:universe&lt;/span&gt; u &lt;span style=&quot;color: #ccaaff;&quot;&gt;:time&lt;/span&gt; t&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而愛因斯坦說過，時間和觀察者是相對的 (time is relative to observer)，兩個不同的觀察者會看到不同的宇宙 (Universe)，也就是說，有許多不同的宇宙(Universe)存在。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
我們可以定義 &lt;code&gt;𝕌&lt;/code&gt; 這個符號為所有可能可以觀察到的宇宙空間(𝕌 is the set of all possible observable universes)，因此，我們就可以定義 Clojure 程式用來選擇下一個 Universe。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;next-u&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;Given an observed universe u, return a possible &#39;next&#39; universe.&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;u t&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;rand-nth &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;filter #&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;consistent? &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt; u t&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; &amp;#120140;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而下一個程式碼，則是讓一個觀察者 (observer) 切換到另外一組 Universe 去
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;switch-universe!&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;Put the given observer in another universe&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;observer&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;swap!
   &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:keys&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;universe time&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;
     &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:universe&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;next-u universe time&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
      &lt;span style=&quot;color: #ccaaff;&quot;&gt;:time&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;inc time&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
   observer&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而我們可以這樣執行我們的觀察者:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;run-observer&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;Run the observer, giving them the impression of passing time&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;observer&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;dorun&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;iterate switch-universe! observer&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來接到了 &lt;a href=&quot;http://toutestquantique.fr/en/pump-probe/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Pump-probe technique&lt;/a&gt; ，嗯&amp;#x2026;我不知道他在講啥 (摀臉)&amp;#x2026;.所以只好秀一下他接下來的投影片:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
接下來話鋒一轉，突然變成說&amp;#x2026;在 ClojureScript 中，無論是 Om 或是 Reagent, 我們都有一個地方定義 app state (universe)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;The app &#39;universe&#39;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;app-state&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;atom
   &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:drawer&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:items&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;ear-plugs&quot;&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;
    shopping
    &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:items&lt;/span&gt;
     &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Coffee&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:quantity&lt;/span&gt; 2&lt;span style=&quot;color: #fff59d;&quot;&gt;}&lt;/span&gt;
      &lt;span style=&quot;color: #fff59d;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Milk&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:quantity&lt;/span&gt; 2&lt;span style=&quot;color: #fff59d;&quot;&gt;}&lt;/span&gt;
      &lt;span style=&quot;color: #fff59d;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Bird seed&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:quantity&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:lots&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接著我們就可以用 &lt;a href=&quot;https://clojuredocs.org/clojure.core/deref&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;deref&lt;/a&gt; 去查看我們的 Universe (app state)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;deref app-state&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;or&lt;/span&gt;

@app-state
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而在這種狀況下，我們滿足了以下兩種規範:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
Consistency
&lt;/p&gt;

&lt;p&gt;
In the render phase, the value we render is constant
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
Concurrency
&lt;/p&gt;

&lt;p&gt;
We can take our time, nobody is waiting for us!
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
這種 app-state 的形式和物件導向 (Object Orientation) 是不同的，我們知道物件導向是這樣的:
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
Object Orientation: Lots of changing state, scatered around.
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
講者舉 &lt;a href=&quot;https://juxt.pro/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://juxt.pro/&lt;/a&gt; 為例，這個網站有很多 state 要去處理，因此我們可以做一個 record 去弄這些 state
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defrecord&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;AppState&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;data-sources&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.IDeref&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;deref &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;this&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;skup&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;refresh! this&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
    &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Return the &#39;universe as a value&#39;&lt;/span&gt;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Skippy McSkipface: https://github.com/juxt/skip&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來我們就可以對這些 state 進行 derefernece 的動作
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
那要怎樣提昇 referesh 的效能呢?我們可以透過這些支援 time-travel 的工具來進行:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
而在開發環境，則可以透過 background watchers 來對資料進行更新的動作
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
而這樣做，講者提出了一個結果:
&lt;/p&gt;



&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
嗯&amp;#x2026;我必須承認我聽了兩次還是聽不太懂 = =
&lt;/p&gt;

&lt;p&gt;
最後講者對比了一下 C 和 Lisp:
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
It seems to me that there have been two really clean, consistent models of programming so far:
the C model and the Lisp model.
&lt;/p&gt;

&lt;p&gt;
&amp;#x2013; Paul Graham
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;blockquote&gt;
&lt;p&gt;
&quot;You&#39;re not constructing it like making a tone of source code and compiling it periodically, you&#39;re constructing it the way you construct a city: build some of it, it&#39;s running all the time, so it&#39;s kind of like a live programming language.&quot;
&lt;/p&gt;

&lt;p&gt;
&amp;#x2013; Dick Gabriel On Lisp, Software Engineering Radio Episode 84
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd8a7767&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgd8a7767&quot;&gt;Native mobile apps with ClojureScript&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgd8a7767&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/6IYm34nDL64?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;

&lt;p&gt;
終於有看到一場在講 react-native 作用於 ClojureScript 上的演講！！ 這之前我有稍微玩過，但沒認真寫這樣的程式。
&lt;/p&gt;

&lt;p&gt;
關於 ClojureScript 作用在 react-native 上的資料，可以到 &lt;a href=&quot;http://cljsrn.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://cljsrn.org/&lt;/a&gt; 去找，或是 &lt;a href=&quot;http://clojurians.net/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clojurians&lt;/a&gt; 的 Slack &lt;code&gt;#cljsrn&lt;/code&gt; 頻道。
&lt;/p&gt;


&lt;p&gt;
這場演講先從 react-native 開始介紹，說明它和 Cordova/HTML5 的不同:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/cljsrn1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來則是以開發者的觀點來看 react-native，一個基本的 react-native 程式長這樣:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-js-jsx&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;import&lt;/span&gt; React, &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt; Component &lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt; from &lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;react&#39;&lt;/span&gt;;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt; Text, View &lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt; from &lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;react-native&#39;&lt;/span&gt;;

&lt;span style=&quot;color: #aaffaa;&quot;&gt;class&lt;/span&gt; WhyReactNativeIsSoGreat &lt;span style=&quot;color: #aaffaa;&quot;&gt;extends&lt;/span&gt; Component &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    render&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;
            &amp;lt;View&amp;gt;
              &amp;lt;Text&amp;gt;
                If you like React on the web, yoou&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;ll like React Native.&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;              &amp;lt;/Text&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;              &amp;lt;Text&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;                You just use native components like &#39;&lt;/span&gt;View&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39; and &#39;&lt;/span&gt;Text&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;,&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;                instead of web components like &#39;&lt;/span&gt;div&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39; and &#39;&lt;/span&gt;span&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;.&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;              &amp;lt;/Text&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;            &amp;lt;/View&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;        );&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;    }&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而 ClojureScript 的相對應改寫則是:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;ns&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;rn-example.core&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:require&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;reagent.core&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:as&lt;/span&gt; r&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;react-native&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;js&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;require
   &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;react-native/Libraries/react-native/react-native.js&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;view&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;adapt-react-class &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;.-View react-native&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;text&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;adapt-react-class &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;.-Text react-native&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;why-react-native-is-so-great&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;view
   &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;text &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;If you like React on the web, you&#39;ll like React Nateive&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
   &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;text &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;You just use native components like &#39;View&#39; and &#39;Text&#39;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;instead of web components like &#39;div&#39; and &#39;span&#39;.&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;


&lt;p&gt;
由上面範例可以看到，除了一開始載入一些 javascript 函式庫需要比較骯髒的手段外，剩下的就很純粹是 Clojure 的資料結構的處理。
&lt;/p&gt;

&lt;p&gt;
而在 ClojureScript 上面，目前有兩個 build tools 針對 ClojureScript 在 react-native 上的:
&lt;/p&gt;

&lt;div class=&quot;row &quot;&gt;&lt;div class=&quot;col-md-6 &quot;&gt;
&lt;div class=&quot;github-card&quot; data-github=&quot;mjmeintjes/boot-react-native&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;/div&gt;&lt;div class=&quot;col-md-6&quot;&gt;
&lt;div class=&quot;github-card&quot; data-github=&quot;drapanjanas/re-natal&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;/div&gt; &lt;/div&gt;

&lt;p&gt;
講者是這樣評論這兩套工具的:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
boot-react-native
&lt;/p&gt;

&lt;p&gt;
Uses boot, works closer to the RN packager but is slower and inferior out of the box experience (persornal experience)
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
re-natal
&lt;/p&gt;

&lt;p&gt;
Uses leinigen, runtime errors are not traceable, templates for re-frame, om.next and rum
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
而最常用的前端框架則是基於 reagent 的 &lt;a href=&quot;https://github.com/Day8/re-frame&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;re-frame&lt;/a&gt; 。
&lt;/p&gt;

&lt;p&gt;
測試方面，則是需要透過 &lt;code&gt;react-native-mock&lt;/code&gt; 去對 ract-native 組件進行測試，圖片和函式庫則是透過 &lt;code&gt;mockery&lt;/code&gt; 來進行測試。
&lt;/p&gt;

&lt;p&gt;
至於效能的比較，就直接看投影片吧：
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/cljsrn2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5b7921b&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org5b7921b&quot;&gt;Isomorphic web apps with Rum&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org5b7921b&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/2fLx4fu9VV8?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;

&lt;p&gt;
本場次為 &lt;a href=&quot;https://github.com/tonsky/rum&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;rum&lt;/a&gt; 這個 ClojureScript 對於 React.js 的封裝的作者的演講，講者 &lt;a href=&quot;https://github.com/tonsky&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;tonsky&lt;/a&gt; 同時也是許多知名 Clojure/Script 函式庫專案的維護者。
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;tonsky/rum&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;

&lt;p&gt;
&lt;a href=&quot;https://github.com/tonsky&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;tonsky&lt;/a&gt; 一開始介紹幾種不同在 ClojureScript 上對於 React.js 的封裝函式庫，然後介紹自己設計  &lt;a href=&quot;https://github.com/tonsky/rum&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;rum&lt;/a&gt;  的幾個動機，其中一個是更好的與 &lt;a href=&quot;https://github.com/tonsky/datascript&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;datascript&lt;/a&gt; 或是其他資料儲存函式庫相容。
&lt;/p&gt;

&lt;p&gt;
所以基本的 rum 程式長怎樣呢?
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;rum&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defc&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;label&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;text class&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:div.lbl&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:class&lt;/span&gt; class&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt; text&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;rum&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;mount &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;label &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Hello&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;header&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
           &lt;span style=&quot;color: #fff59d;&quot;&gt;js&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;document.body&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
包含 state 的複雜點的範例則是:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;mixin&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:will-mount&lt;/span&gt;
   &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;state&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;
     &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;assoc state &lt;span style=&quot;color: #ccaaff;&quot;&gt;:key&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;atom &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;rum&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defc&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;label&lt;/span&gt; &amp;lt; mixin &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;text class&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:div.label&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:class&lt;/span&gt; class&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt; text&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而 rum 也支援 serveri-side 渲染 (&lt;a href=&quot;https://anmonteiro.com/2016/09/om-next-server-side-rendering/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Om.Next 也支援囉~&lt;/a&gt;)，運作的流程是這樣:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/rum1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
那用 rum 有什麼好處呢？講者提出了以下幾點:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;Complex single-page apps with fine control&lt;/li&gt;
&lt;li&gt;Custom/mixed state models&lt;/li&gt;
&lt;li&gt;Server-side rendering and templating&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
而用 rum 的壞處則是:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;Doesn&#39;t teach you how to write apps&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0b7b27c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0b7b27c&quot;&gt;The Story of Sir Owl Lisp&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0b7b27c&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/utOVF0U7Zd8?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;

&lt;p&gt;
&lt;a href=&quot;https://en.wikipedia.org/wiki/Owl_Lisp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Owl Lisp&lt;/a&gt; 是一個純函數式的 Scheme 實現，講者為 &lt;a href=&quot;https://github.com/aoh/owl-lisp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;owl-lisp&lt;/a&gt; 作者，此一專案作為寵物專案 (pet project, 閒暇時做的好玩專案或是殺時間用) 從 2011 年開始自今。
&lt;/p&gt;

&lt;p&gt;
這場演講前面基本上在講古，包含了一些圖靈機、lambda 演算法以及 LISP 語言的故事，後面開始介紹  &lt;a href=&quot;https://github.com/aoh/owl-lisp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;owl-lisp&lt;/a&gt; ，這是一個依照 R7RS 標準的 Scheme 語言。
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;aoh/owl-lisp&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org033fc73&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org033fc73&quot;&gt;Doing data science with Clojure: the good, the bad, the ugly&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org033fc73&quot;&gt;
&lt;br&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/xtmggfGD3RQ?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;

&lt;br&gt;

&lt;p&gt;
投影片連結: &lt;a href=&quot;https://www.slideshare.net/mobile/simonbelak/doing-data-science-with-clojure-65886938&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;線上看&lt;/a&gt;
&lt;/p&gt;


&lt;blockquote&gt;
&lt;p&gt;
Easy things should be easy and hard things should be possible.
&lt;/p&gt;

&lt;p&gt;
&amp;#x2013; L. Wall
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
老實說我聽不太懂講者在講什麼&amp;#x2026;.. Orz&amp;#x2026;
&lt;/p&gt;

&lt;p&gt;
不過講者提到一個他寫的函式庫:
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;sbelak/huri&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;


&lt;p&gt;
然後&amp;#x2026;我還是聽不懂，所以只好把他 quote 的名言秀一下了 orz&amp;#x2026;
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
This is possibly Clojure&#39;s most important property: the syntax expresses the code&#39;s semantic layers. An experienced reader of Clojure can skip over most of the code and have a lossless understanding of its highlevel intent.
&lt;/p&gt;

&lt;p&gt;
&amp;#x2013; Z.Tellman, Elements of Clojure
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
接下來講者稍微提到了 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 這個預計要在 Clojure 1.9 加入的函式庫，可以減少查找問題的時間，以及 &lt;a href=&quot;http://gorilla-repl.org&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;gorilla-repl&lt;/a&gt; 這種類似 ipython notebook 的工具。
&lt;/p&gt;


&lt;p&gt;
在後面，講者終於講到前面他說的函式庫 &lt;a href=&quot;https://github.com/sbelak/huri&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;huri&lt;/a&gt;， 你可以透過他在  &lt;a href=&quot;http://gorilla-repl.org&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;gorilla-repl&lt;/a&gt; 上畫圖。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org287cc21&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org287cc21&quot;&gt;Interactive Clojure code snippets in any web page with KLIPSE&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org287cc21&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/33mTFjPIN10?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;
&lt;p&gt;
投影片連結: &lt;a href=&quot;http://slides.klipse.tech/klipse-clojutre-2016/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;線上看&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;http://app.klipse.tech&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;klipse&lt;/a&gt; 是一個完全運作在瀏覽器上的 cljs REPL，可以動態的驗證 ClojureScript 的運作，該作者同時也寫了不少關於 ClojureScript 運作的文章。
&lt;/p&gt;

&lt;p&gt;
本次演講除了說到 ClojoureScript 的部份，也提到 klipse 可以執行 ruby, python 程式碼，我猜他大概有實現一個簡單的解釋器才對，還沒去看這部份的程式碼。
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;viebel/klipse&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgdb8d5d4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgdb8d5d4&quot;&gt;Distributed transducers&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgdb8d5d4&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/_9jdb5TOShk?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;
&lt;p&gt;
投影片連結: &lt;a href=&quot;https://github.com/mhjort/distributed-transducers-poc/releases/download/v1.0/Distributed.Transducers.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;點我下載&lt;/a&gt;
&lt;/p&gt;


&lt;p&gt;
本篇講述講者實作分佈式版的 fold 函式，並透過 AWS lambda 來加速運作。
&lt;/p&gt;

&lt;p&gt;
講者提供了一個查找類似詞的函式來描述整個要解決問題的狀況:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-1&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;-&amp;gt;&amp;gt;&lt;/span&gt; words
       &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
       &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
       &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;reduce group-by-distance &lt;span style=&quot;color: #aaeecc;&quot;&gt;{}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;similar-words-1 &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;word&quot;&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;sword&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;lord&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;card&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;cat&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt; 2&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {1 #{&quot;sword&quot; &quot;lord&quot;}, 2 #{&quot;card&quot;}}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
當然我們可以把這樣的程式改用 transducer 改寫，來提昇程式的效能
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-2&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;transduce &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;comp &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;
                &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #ff8888;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
             group-by-distance
             words&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
但是這樣的程式無法並行運算，因此我們再用 fold 來改寫
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-3&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;fold &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;partial merge-with concat&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
          group-by-distance
          &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;folder words
                    &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;comp &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #795548;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #795548;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
不過有一個問題，fold 會同時執行兩個函式，一個用來執行 reduce，稱為 &lt;code&gt;reducing function&lt;/code&gt; ，另外一個則是用來合併結果，稱為 &lt;code&gt;combining function&lt;/code&gt; ，而 &lt;code&gt;reducing function&lt;/code&gt; 會並行的執行。(&lt;a href=&quot;https://adambard.com/blog/clojure-reducers-for-mortals/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;參考資料&lt;/a&gt;)
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
fold uses two functions: a &quot;reducing&quot; function, which it calls as a regular reduce across segments of the input collection, and a &quot;combining&quot; function, which combines the results of these reductions.
&lt;/p&gt;
&lt;/blockquote&gt;


&lt;p&gt;
因此我們可以再把這個程式改寫
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-4&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;fold &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;partial merge-with concat&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
          &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;comp &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
              &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #795548;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #795548;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; group-by-distance&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
          words&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣改寫後，效果好多了，但是還有最後一個問題: 並行化的 fold 只能運作在 non-lazy sequence 上，於是再加一些手腳。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-5&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;fold &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;partial merge-with concat&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
          &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;comp &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
              &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #795548;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #795548;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; group-by-distance&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
          &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;vec words&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
跑出來的結果如下，在講者的 HP zBook 筆電 (i7 雙核)上執行的結果是這樣的
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;一般版本:  ~175 s&lt;/li&gt;
&lt;li&gt;Transducer: ~170 s&lt;/li&gt;
&lt;li&gt;Parallel fold: ~108 s&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
做完這些測試後，講者想到了，是否分佈式的 fold 可以提供更好的效能?
&lt;/p&gt;

&lt;p&gt;
講者選用了 AWS Lambda 以及 Amazon SQS 來進行這個測試，整體的架構是這個樣子的:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/ar1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
接下來你要在你的 project.clj 加入以下這些設定
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:plugins&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;lein-clj-lambda &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;0.5.1&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;:lambda&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;demo&quot;&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:handler&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;distributed-transducers-poc.LambdaFn&quot;&lt;/span&gt;
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:memory-size&lt;/span&gt; 1536
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:timeout&lt;/span&gt; 300
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:function-name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;distributed-transducers-poc&quot;&lt;/span&gt;
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:region&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;eu-west-1&quot;&lt;/span&gt;
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:policy-statements&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:Effect&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Allow&quot;&lt;/span&gt;
                                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:Action&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;sqs:*&quot;&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt;
                                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:Resource&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;arn:aws:sqs:eu-west-1:*&quot;&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:s3&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:bucket&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;mhjort-distributed-transducers-poc&quot;&lt;/span&gt;
                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:object-key&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;lambda.jar&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
然後使用下面命令進行 deploy
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
lein lambda install demo
&lt;/pre&gt;

&lt;p&gt;
講者給出了範例，示範用 fold 以及 dfold 執行程式的狀況
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;ns&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;distributed-transducers-poc.demo&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:require&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;distributed-transducers-ppc.rc&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;dfold&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
            &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core.reducers&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:as&lt;/span&gt; r&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;fold + &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;map inc&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; +&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;range 100000&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;dfold + &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;map inc&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; +&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;range 100000&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; 2&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;; &amp;lt;= 2 is how many instance you run&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
那&amp;#x2026; 哪些資料會被送到 SQS 呢?
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;要被執行的東西 (Chunk of items to be processed)&lt;/li&gt;

&lt;li&gt;Reduct function&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
而在最後，使用分佈式 fold 的程式會變成這樣
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-6&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;dfold &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;partial merge-with concat&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
           &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;comp &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
               &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #795548;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #795548;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; group-by-distance&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
           &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;vec words&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
           10&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而最後整體測試結果則是:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;筆電 (一般): ~175 s&lt;/li&gt;
&lt;li&gt;筆電 (transducer): ~170 s&lt;/li&gt;
&lt;li&gt;筆電 (parallel fold): ~108 s&lt;/li&gt;
&lt;li&gt;AWS Lambda (10 nodes, cost 0.01 $): ~40 s&lt;/li&gt;
&lt;li&gt;AWS Lambda (20 nodes, cost 0.02 $): ~28 s&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org38a5fae&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org38a5fae&quot;&gt;Introduction to clojure.spec - Arne Brasseur&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org38a5fae&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/-MeOPF94LhI?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;p&gt;
講者為 &lt;a href=&quot;https://lambdaisland.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;LambdaIsland&lt;/a&gt; 的維護者，該網站提供了一系列的 Clojure/ClojureScript 教學，若有興趣的話可以付費訂閱。
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;
&lt;p&gt;
&lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 是 Clojure 預計在 1.9 版加入的新功能，對於 Clojure 這種動態型別語言而言，雖然容易開發，但是一旦你傳送給函式的型別不對，就很可能造成除錯不易。
&lt;/p&gt;

&lt;p&gt;
在 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 出現之前，比較有名的型別檢查是 &lt;a href=&quot;https://github.com/clojure/core.typed&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;core.typed&lt;/a&gt; 以及 &lt;a href=&quot;https://github.com/plumatic/schema&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;schema&lt;/a&gt; ，而 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 將會成為 buildin 在 Clojure 的一部分函式。
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 的加入並不會導致程式執行變慢，用到他的時間只有在開發時使用 REPL 以及編譯的時候，所以到底要怎樣用呢？
&lt;/p&gt;

&lt;p&gt;
如果你是 leinigen 的用戶，更改你的 &lt;code&gt;project.clj&lt;/code&gt; 成如下
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defperoject&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;myproject&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;0.1.0-SNAPAHOT&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:dependencies&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;org.clojure&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;clojure &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;1.9.0-alpha13&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
boot 的用戶則是在你的 &lt;code&gt;build.boot&lt;/code&gt; 加入
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;set-env!
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:dependencies&lt;/span&gt; &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;org.clojure&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;clojure &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;1.9.0-alpha13&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
於是讓我們開始使用 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 吧! 講者假設現在有一個機器人主廚 (Robot Chef) 正在弄一份菜單 (recipes)，而這份菜單內容是這樣的:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;tomato-sauce-recipe&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;250 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;peeled tomatoes&quot;&lt;/span&gt;
                          3 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:clove&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;garlic&quot;&lt;/span&gt;
                          5 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;pepper&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
   &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;steps&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;heat a pan&quot;&lt;/span&gt;
                    &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;throw everything in&quot;&lt;/span&gt;
                    &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;stir&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
像這種透過 / (slash) 組成的 keyword (關鍵字)，我們稱呼為 namespace keyword
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;grettings&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;kittos&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:grettings/kittos&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
為何要用 namespace keyword 呢？一個原因是可以避免到名稱衝突，所以我們可以把所有的 keyword 合併在同一個 map 中
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;http&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;method&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:get&lt;/span&gt;
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;method&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:stir&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
實際上在 Clojure 中，變數也是包含在 namespace 中的
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;ns&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;robochef.core&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;ingredents&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;,,,&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:robochef.core/ingredients&lt;/span&gt;

&lt;span style=&quot;color: #ccaaff;&quot;&gt;::ingredients&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:robochef.core/ingredients&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
也因此，在一個 map 中使用 namespace 作為 prefix 是很常見的
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;recipe-name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;...&quot;&lt;/span&gt;
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;,,,&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;steps&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;,,,&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;cooking-time&lt;/span&gt; 30&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而在 Clojure 1.9 中，將會有新的語法可以把上面的東西變成這樣
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;recipe&lt;/span&gt; #&lt;span style=&quot;color: #ccaaff;&quot;&gt;:robochef&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:recipes-name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;&quot;&lt;/span&gt;
                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:ingredients&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;,,,&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:steps&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;,,,&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:cooking-time&lt;/span&gt; 30&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;keys&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;steps serves&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt; recipe&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;doseq&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;s steps&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
    ,,,&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
在了解這些前置訊息後，我們終於可以來到 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 了，首先我們把 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 的命名空間(namespace) 指定為 &lt;code&gt;s&lt;/code&gt; ，接下來我們加入以下這些 spec，這會將這些 spec 加入到全域去 (global registry)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;ns&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;robochef.core&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:require&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.spec&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:as&lt;/span&gt; s&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;keep in mind &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;::recipe&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; == &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:robochef.core/recipe&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;::recipe&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;keys &lt;span style=&quot;color: #ccaaff;&quot;&gt;:req&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;::ingredients&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
                        &lt;span style=&quot;color: #ccaaff;&quot;&gt;:opt&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;::steps&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;::ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;* &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;cat &lt;span style=&quot;color: #ccaaff;&quot;&gt;:amount&lt;/span&gt; number?
                                 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:unit&lt;/span&gt; keyword?
                                 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; string?&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;::steps&lt;/span&gt; ,,,&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，我們就可以這樣去驗證，符合 spec 的狀況是這樣的
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;valid? &lt;span style=&quot;color: #ccaaff;&quot;&gt;::robochef/ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;5 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;tea&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;conform &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;5 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;tea&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;[{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:amount&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 5, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:unit&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:g&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:name&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &quot;tea&quot;}]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
那錯誤的情況呢? 我們可以透過 &lt;code&gt;clojure.spec/explain&lt;/code&gt; 來幫我們找出狀況
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;valid? &lt;span style=&quot;color: #ccaaff;&quot;&gt;::robochef/ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;10&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;tea&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; false&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;conform &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;10&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;tea&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:clojure.spec/invalid&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;explain &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;10&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;tea&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;In: [0] val: &quot;10&quot; fails spec:&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;   &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:robochef/ingredients&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; at: [&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:amount&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;] predicate: number?&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
我們也可以用 generator 去產生符合數量並可以通過測試的結果
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;exercise &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; 2&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;([() []]&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;  &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;[(0 &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:Hi&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &quot;0&quot;) [{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:amount&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 0, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:unit&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:Hi&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:name&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &quot;0&quot;}]])&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;


&lt;p&gt;
更多的內容我還在消化中，就請看影片吧 ~
&lt;/p&gt;

&lt;p&gt;
後面演講則稍微提到一下 &lt;a href=&quot;https://github.com/clojure/test.check&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;test.check&lt;/a&gt; 這個測試用的函式庫。
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;clojure/test.check&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org2c2ca75&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org2c2ca75&quot;&gt;Clojure of Things&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org2c2ca75&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/FUV_5Hwi5FU?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;
&lt;p&gt;
講者提及自己的經驗，如何用 Clojure 在目前火紅的 IoT (Internet of things) 上，並使用了 &lt;a href=&quot;http://pibrella.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;pibrella&lt;/a&gt; 這個 Raspberry Pi 的擴充板進行展示，透過 Clojure REPL 動態的控制 pibrella 的 I/O。
&lt;/p&gt;

&lt;p&gt;
作者使用的函式庫目前我沒在網路上找到，但是我猜他是用 &lt;a href=&quot;https://github.com/Pi4J/pi4j&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;pi4j&lt;/a&gt; 來作為 Clojure 控制 Raspberry pi 的函式庫。
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;Pi4J/pi4j&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org58cf0a9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org58cf0a9&quot;&gt;The Next Five Years of ClojureScript&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org58cf0a9&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/mty0RwkPmE8?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;
&lt;p&gt;
這場是目前 ClojureScript 主要維護者 David Nolen 環顧了過去幾年 ClojureScript 開始開發的狀況，以及未來的情況。
&lt;/p&gt;

&lt;p&gt;
在這場演講後半段也提及到如何參與 ClojureScript 推廣/開發等議題，也有人提問 David Nolen 對於 WebAssembly 的看法等等。
&lt;/p&gt;

&lt;p&gt;
這場演講我覺的蠻不錯的，很喜歡這種有講故事風格的演講。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
趁著假日來趕一下進度，於是把我看過的 &lt;a href=&quot;http://clojutre.org/2016/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ClojuTRE 2016&lt;/a&gt; 心得/筆記紀錄在這邊。
&lt;/p&gt;

&lt;p&gt;
嗯&amp;#x2026;&amp;#x2026;其實 ClojuTRE 2016 每一場演講我都看完了&amp;#x2026;..
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
當然，我並不是每一場都聽的懂，於是這筆記只能僅供參考，請勿盡信 orz&amp;#x2026;
&lt;/p&gt;

&lt;p&gt;
有些演講真的很難畫重點，還是挑自己有興趣的看吧!!
&lt;/p&gt;

&lt;div id=&quot;outline-container-orgfd6229e&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfd6229e&quot;&gt;Using Clojure to provide computerized psychotherapy&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfd6229e&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/Ze3Acb42f3o?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;

&lt;p&gt;
講者投影片: &lt;a href=&quot;http://clojutre.org/2016/slides/Using-Clojure-to-provide-computerized-psychotherapy.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;下載連結&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
這場演講在講 Clojure 用於心理治療 (psychotherapy) 上，一開始講者提出了問題:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/a1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
對於這些問題，我們可以有一些解法:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/a2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
而更多的問題，則是沒有足夠的人手在心裡治療上，因此講者提到了可以透過電腦來協助，點子來自於 treatment manuals
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/a3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
而 網路認知行為治療 (iCBT, internet-based Cognitive behavior therapy) 則大部分提供了如上面的那樣的自我治療(sel-help)資訊，這種方式減少了一些問題，比如治療師(therapist)和病患之間的距離
&lt;/p&gt;

&lt;p&gt;
然後後面講者繼續講了一些問題，解法一是用 Clojure 寫了些網頁程式&amp;#x2026;.(嗯，看影片吧) ，而這網頁程式透過 &lt;a href=&quot;http://www.luminusweb.net&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Luminus framework&lt;/a&gt; 製作，值得一提的是講者第一個學的程式語言就是 Clojure。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/a4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgaceb030&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgaceb030&quot;&gt;The Universe As A Value&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgaceb030&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/odPAkEO2uPQ?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;

&lt;p&gt;
投影片: &lt;a href=&quot;https://juxt.pro/talks/clojutre-2016.html#/sec-title-slide&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;下載連結&lt;/a&gt;
&lt;/p&gt;


&lt;p&gt;
這場演講第一次聽的時候我傻眼了，於是就再聽了第二次。
&lt;/p&gt;

&lt;p&gt;
講者一開始先稍微講了些關於宇宙 (Universe) 的事情，然後導向愛因斯坦的相對論，我們可以假設有一個觀察者如下
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;observer&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;atom &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:universe&lt;/span&gt; u &lt;span style=&quot;color: #ccaaff;&quot;&gt;:time&lt;/span&gt; t&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而愛因斯坦說過，時間和觀察者是相對的 (time is relative to observer)，兩個不同的觀察者會看到不同的宇宙 (Universe)，也就是說，有許多不同的宇宙(Universe)存在。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
我們可以定義 &lt;code&gt;𝕌&lt;/code&gt; 這個符號為所有可能可以觀察到的宇宙空間(𝕌 is the set of all possible observable universes)，因此，我們就可以定義 Clojure 程式用來選擇下一個 Universe。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;next-u&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;Given an observed universe u, return a possible &#39;next&#39; universe.&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;u t&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;rand-nth &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;filter #&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;consistent? &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt; u t&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; &amp;#120140;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而下一個程式碼，則是讓一個觀察者 (observer) 切換到另外一組 Universe 去
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;switch-universe!&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;Put the given observer in another universe&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;observer&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;swap!
   &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:keys&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;universe time&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;
     &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:universe&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;next-u universe time&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
      &lt;span style=&quot;color: #ccaaff;&quot;&gt;:time&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;inc time&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
   observer&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而我們可以這樣執行我們的觀察者:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;run-observer&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;Run the observer, giving them the impression of passing time&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;observer&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;dorun&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;iterate switch-universe! observer&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來接到了 &lt;a href=&quot;http://toutestquantique.fr/en/pump-probe/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Pump-probe technique&lt;/a&gt; ，嗯&amp;#x2026;我不知道他在講啥 (摀臉)&amp;#x2026;.所以只好秀一下他接下來的投影片:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
接下來話鋒一轉，突然變成說&amp;#x2026;在 ClojureScript 中，無論是 Om 或是 Reagent, 我們都有一個地方定義 app state (universe)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;The app &#39;universe&#39;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;app-state&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;atom
   &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:drawer&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:items&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;ear-plugs&quot;&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;
    shopping
    &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:items&lt;/span&gt;
     &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Coffee&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:quantity&lt;/span&gt; 2&lt;span style=&quot;color: #fff59d;&quot;&gt;}&lt;/span&gt;
      &lt;span style=&quot;color: #fff59d;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Milk&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:quantity&lt;/span&gt; 2&lt;span style=&quot;color: #fff59d;&quot;&gt;}&lt;/span&gt;
      &lt;span style=&quot;color: #fff59d;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Bird seed&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:quantity&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:lots&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接著我們就可以用 &lt;a href=&quot;https://clojuredocs.org/clojure.core/deref&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;deref&lt;/a&gt; 去查看我們的 Universe (app state)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;deref app-state&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;or&lt;/span&gt;

@app-state
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而在這種狀況下，我們滿足了以下兩種規範:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
Consistency
&lt;/p&gt;

&lt;p&gt;
In the render phase, the value we render is constant
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
Concurrency
&lt;/p&gt;

&lt;p&gt;
We can take our time, nobody is waiting for us!
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
這種 app-state 的形式和物件導向 (Object Orientation) 是不同的，我們知道物件導向是這樣的:
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
Object Orientation: Lots of changing state, scatered around.
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
講者舉 &lt;a href=&quot;https://juxt.pro/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://juxt.pro/&lt;/a&gt; 為例，這個網站有很多 state 要去處理，因此我們可以做一個 record 去弄這些 state
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defrecord&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;AppState&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;data-sources&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.IDeref&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;deref &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;this&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;skup&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;refresh! this&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
    &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Return the &#39;universe as a value&#39;&lt;/span&gt;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Skippy McSkipface: https://github.com/juxt/skip&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來我們就可以對這些 state 進行 derefernece 的動作
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
那要怎樣提昇 referesh 的效能呢?我們可以透過這些支援 time-travel 的工具來進行:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
而在開發環境，則可以透過 background watchers 來對資料進行更新的動作
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
而這樣做，講者提出了一個結果:
&lt;/p&gt;



&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/p6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
嗯&amp;#x2026;我必須承認我聽了兩次還是聽不太懂 = =
&lt;/p&gt;

&lt;p&gt;
最後講者對比了一下 C 和 Lisp:
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
It seems to me that there have been two really clean, consistent models of programming so far:
the C model and the Lisp model.
&lt;/p&gt;

&lt;p&gt;
&amp;#x2013; Paul Graham
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;blockquote&gt;
&lt;p&gt;
&quot;You&#39;re not constructing it like making a tone of source code and compiling it periodically, you&#39;re constructing it the way you construct a city: build some of it, it&#39;s running all the time, so it&#39;s kind of like a live programming language.&quot;
&lt;/p&gt;

&lt;p&gt;
&amp;#x2013; Dick Gabriel On Lisp, Software Engineering Radio Episode 84
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd8a7767&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgd8a7767&quot;&gt;Native mobile apps with ClojureScript&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgd8a7767&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/6IYm34nDL64?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;

&lt;p&gt;
終於有看到一場在講 react-native 作用於 ClojureScript 上的演講！！ 這之前我有稍微玩過，但沒認真寫這樣的程式。
&lt;/p&gt;

&lt;p&gt;
關於 ClojureScript 作用在 react-native 上的資料，可以到 &lt;a href=&quot;http://cljsrn.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://cljsrn.org/&lt;/a&gt; 去找，或是 &lt;a href=&quot;http://clojurians.net/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clojurians&lt;/a&gt; 的 Slack &lt;code&gt;#cljsrn&lt;/code&gt; 頻道。
&lt;/p&gt;


&lt;p&gt;
這場演講先從 react-native 開始介紹，說明它和 Cordova/HTML5 的不同:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/cljsrn1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來則是以開發者的觀點來看 react-native，一個基本的 react-native 程式長這樣:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-js-jsx&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;import&lt;/span&gt; React, &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt; Component &lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt; from &lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;react&#39;&lt;/span&gt;;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt; Text, View &lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt; from &lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;react-native&#39;&lt;/span&gt;;

&lt;span style=&quot;color: #aaffaa;&quot;&gt;class&lt;/span&gt; WhyReactNativeIsSoGreat &lt;span style=&quot;color: #aaffaa;&quot;&gt;extends&lt;/span&gt; Component &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    render&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;
            &amp;lt;View&amp;gt;
              &amp;lt;Text&amp;gt;
                If you like React on the web, yoou&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;ll like React Native.&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;              &amp;lt;/Text&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;              &amp;lt;Text&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;                You just use native components like &#39;&lt;/span&gt;View&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39; and &#39;&lt;/span&gt;Text&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;,&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;                instead of web components like &#39;&lt;/span&gt;div&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39; and &#39;&lt;/span&gt;span&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;.&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;              &amp;lt;/Text&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;            &amp;lt;/View&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;        );&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;    }&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而 ClojureScript 的相對應改寫則是:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;ns&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;rn-example.core&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:require&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;reagent.core&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:as&lt;/span&gt; r&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;react-native&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;js&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;require
   &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;react-native/Libraries/react-native/react-native.js&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;view&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;adapt-react-class &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;.-View react-native&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;text&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;adapt-react-class &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;.-Text react-native&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;why-react-native-is-so-great&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;view
   &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;text &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;If you like React on the web, you&#39;ll like React Nateive&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
   &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;text &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;You just use native components like &#39;View&#39; and &#39;Text&#39;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;instead of web components like &#39;div&#39; and &#39;span&#39;.&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;


&lt;p&gt;
由上面範例可以看到，除了一開始載入一些 javascript 函式庫需要比較骯髒的手段外，剩下的就很純粹是 Clojure 的資料結構的處理。
&lt;/p&gt;

&lt;p&gt;
而在 ClojureScript 上面，目前有兩個 build tools 針對 ClojureScript 在 react-native 上的:
&lt;/p&gt;

&lt;div class=&quot;row &quot;&gt;&lt;div class=&quot;col-md-6 &quot;&gt;
&lt;div class=&quot;github-card&quot; data-github=&quot;mjmeintjes/boot-react-native&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;/div&gt;&lt;div class=&quot;col-md-6&quot;&gt;
&lt;div class=&quot;github-card&quot; data-github=&quot;drapanjanas/re-natal&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;/div&gt; &lt;/div&gt;

&lt;p&gt;
講者是這樣評論這兩套工具的:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
boot-react-native
&lt;/p&gt;

&lt;p&gt;
Uses boot, works closer to the RN packager but is slower and inferior out of the box experience (persornal experience)
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
re-natal
&lt;/p&gt;

&lt;p&gt;
Uses leinigen, runtime errors are not traceable, templates for re-frame, om.next and rum
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
而最常用的前端框架則是基於 reagent 的 &lt;a href=&quot;https://github.com/Day8/re-frame&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;re-frame&lt;/a&gt; 。
&lt;/p&gt;

&lt;p&gt;
測試方面，則是需要透過 &lt;code&gt;react-native-mock&lt;/code&gt; 去對 ract-native 組件進行測試，圖片和函式庫則是透過 &lt;code&gt;mockery&lt;/code&gt; 來進行測試。
&lt;/p&gt;

&lt;p&gt;
至於效能的比較，就直接看投影片吧：
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/cljsrn2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5b7921b&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org5b7921b&quot;&gt;Isomorphic web apps with Rum&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org5b7921b&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/2fLx4fu9VV8?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;

&lt;p&gt;
本場次為 &lt;a href=&quot;https://github.com/tonsky/rum&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;rum&lt;/a&gt; 這個 ClojureScript 對於 React.js 的封裝的作者的演講，講者 &lt;a href=&quot;https://github.com/tonsky&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;tonsky&lt;/a&gt; 同時也是許多知名 Clojure/Script 函式庫專案的維護者。
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;tonsky/rum&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;

&lt;p&gt;
&lt;a href=&quot;https://github.com/tonsky&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;tonsky&lt;/a&gt; 一開始介紹幾種不同在 ClojureScript 上對於 React.js 的封裝函式庫，然後介紹自己設計  &lt;a href=&quot;https://github.com/tonsky/rum&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;rum&lt;/a&gt;  的幾個動機，其中一個是更好的與 &lt;a href=&quot;https://github.com/tonsky/datascript&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;datascript&lt;/a&gt; 或是其他資料儲存函式庫相容。
&lt;/p&gt;

&lt;p&gt;
所以基本的 rum 程式長怎樣呢?
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;rum&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defc&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;label&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;text class&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:div.lbl&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:class&lt;/span&gt; class&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt; text&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;rum&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;mount &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;label &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Hello&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;header&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
           &lt;span style=&quot;color: #fff59d;&quot;&gt;js&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;document.body&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
包含 state 的複雜點的範例則是:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;mixin&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:will-mount&lt;/span&gt;
   &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;state&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;
     &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;assoc state &lt;span style=&quot;color: #ccaaff;&quot;&gt;:key&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;atom &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;rum&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defc&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;label&lt;/span&gt; &amp;lt; mixin &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;text class&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:div.label&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:class&lt;/span&gt; class&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt; text&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而 rum 也支援 serveri-side 渲染 (&lt;a href=&quot;https://anmonteiro.com/2016/09/om-next-server-side-rendering/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Om.Next 也支援囉~&lt;/a&gt;)，運作的流程是這樣:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/rum1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
那用 rum 有什麼好處呢？講者提出了以下幾點:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;Complex single-page apps with fine control&lt;/li&gt;
&lt;li&gt;Custom/mixed state models&lt;/li&gt;
&lt;li&gt;Server-side rendering and templating&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
而用 rum 的壞處則是:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;Doesn&#39;t teach you how to write apps&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0b7b27c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0b7b27c&quot;&gt;The Story of Sir Owl Lisp&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0b7b27c&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/utOVF0U7Zd8?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;

&lt;p&gt;
&lt;a href=&quot;https://en.wikipedia.org/wiki/Owl_Lisp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Owl Lisp&lt;/a&gt; 是一個純函數式的 Scheme 實現，講者為 &lt;a href=&quot;https://github.com/aoh/owl-lisp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;owl-lisp&lt;/a&gt; 作者，此一專案作為寵物專案 (pet project, 閒暇時做的好玩專案或是殺時間用) 從 2011 年開始自今。
&lt;/p&gt;

&lt;p&gt;
這場演講前面基本上在講古，包含了一些圖靈機、lambda 演算法以及 LISP 語言的故事，後面開始介紹  &lt;a href=&quot;https://github.com/aoh/owl-lisp&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;owl-lisp&lt;/a&gt; ，這是一個依照 R7RS 標準的 Scheme 語言。
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;aoh/owl-lisp&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org033fc73&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org033fc73&quot;&gt;Doing data science with Clojure: the good, the bad, the ugly&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org033fc73&quot;&gt;
&lt;br&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/xtmggfGD3RQ?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;

&lt;br&gt;

&lt;p&gt;
投影片連結: &lt;a href=&quot;https://www.slideshare.net/mobile/simonbelak/doing-data-science-with-clojure-65886938&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;線上看&lt;/a&gt;
&lt;/p&gt;


&lt;blockquote&gt;
&lt;p&gt;
Easy things should be easy and hard things should be possible.
&lt;/p&gt;

&lt;p&gt;
&amp;#x2013; L. Wall
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
老實說我聽不太懂講者在講什麼&amp;#x2026;.. Orz&amp;#x2026;
&lt;/p&gt;

&lt;p&gt;
不過講者提到一個他寫的函式庫:
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;sbelak/huri&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;


&lt;p&gt;
然後&amp;#x2026;我還是聽不懂，所以只好把他 quote 的名言秀一下了 orz&amp;#x2026;
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
This is possibly Clojure&#39;s most important property: the syntax expresses the code&#39;s semantic layers. An experienced reader of Clojure can skip over most of the code and have a lossless understanding of its highlevel intent.
&lt;/p&gt;

&lt;p&gt;
&amp;#x2013; Z.Tellman, Elements of Clojure
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;

&lt;p&gt;
接下來講者稍微提到了 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 這個預計要在 Clojure 1.9 加入的函式庫，可以減少查找問題的時間，以及 &lt;a href=&quot;http://gorilla-repl.org&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;gorilla-repl&lt;/a&gt; 這種類似 ipython notebook 的工具。
&lt;/p&gt;


&lt;p&gt;
在後面，講者終於講到前面他說的函式庫 &lt;a href=&quot;https://github.com/sbelak/huri&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;huri&lt;/a&gt;， 你可以透過他在  &lt;a href=&quot;http://gorilla-repl.org&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;gorilla-repl&lt;/a&gt; 上畫圖。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org287cc21&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org287cc21&quot;&gt;Interactive Clojure code snippets in any web page with KLIPSE&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org287cc21&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/33mTFjPIN10?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;
&lt;p&gt;
投影片連結: &lt;a href=&quot;http://slides.klipse.tech/klipse-clojutre-2016/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;線上看&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;http://app.klipse.tech&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;klipse&lt;/a&gt; 是一個完全運作在瀏覽器上的 cljs REPL，可以動態的驗證 ClojureScript 的運作，該作者同時也寫了不少關於 ClojureScript 運作的文章。
&lt;/p&gt;

&lt;p&gt;
本次演講除了說到 ClojoureScript 的部份，也提到 klipse 可以執行 ruby, python 程式碼，我猜他大概有實現一個簡單的解釋器才對，還沒去看這部份的程式碼。
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;viebel/klipse&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgdb8d5d4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgdb8d5d4&quot;&gt;Distributed transducers&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgdb8d5d4&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/_9jdb5TOShk?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;
&lt;p&gt;
投影片連結: &lt;a href=&quot;https://github.com/mhjort/distributed-transducers-poc/releases/download/v1.0/Distributed.Transducers.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;點我下載&lt;/a&gt;
&lt;/p&gt;


&lt;p&gt;
本篇講述講者實作分佈式版的 fold 函式，並透過 AWS lambda 來加速運作。
&lt;/p&gt;

&lt;p&gt;
講者提供了一個查找類似詞的函式來描述整個要解決問題的狀況:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-1&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;-&amp;gt;&amp;gt;&lt;/span&gt; words
       &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
       &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
       &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;reduce group-by-distance &lt;span style=&quot;color: #aaeecc;&quot;&gt;{}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;similar-words-1 &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;word&quot;&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;sword&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;lord&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;card&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;cat&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt; 2&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {1 #{&quot;sword&quot; &quot;lord&quot;}, 2 #{&quot;card&quot;}}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
當然我們可以把這樣的程式改用 transducer 改寫，來提昇程式的效能
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-2&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;transduce &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;comp &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;
                &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #ff8888;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
             group-by-distance
             words&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
但是這樣的程式無法並行運算，因此我們再用 fold 來改寫
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-3&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;fold &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;partial merge-with concat&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
          group-by-distance
          &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;folder words
                    &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;comp &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #795548;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #795548;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
不過有一個問題，fold 會同時執行兩個函式，一個用來執行 reduce，稱為 &lt;code&gt;reducing function&lt;/code&gt; ，另外一個則是用來合併結果，稱為 &lt;code&gt;combining function&lt;/code&gt; ，而 &lt;code&gt;reducing function&lt;/code&gt; 會並行的執行。(&lt;a href=&quot;https://adambard.com/blog/clojure-reducers-for-mortals/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;參考資料&lt;/a&gt;)
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
fold uses two functions: a &quot;reducing&quot; function, which it calls as a regular reduce across segments of the input collection, and a &quot;combining&quot; function, which combines the results of these reductions.
&lt;/p&gt;
&lt;/blockquote&gt;


&lt;p&gt;
因此我們可以再把這個程式改寫
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-4&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;fold &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;partial merge-with concat&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
          &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;comp &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
              &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #795548;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #795548;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; group-by-distance&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
          words&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣改寫後，效果好多了，但是還有最後一個問題: 並行化的 fold 只能運作在 non-lazy sequence 上，於是再加一些手腳。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-5&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;fold &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;partial merge-with concat&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
          &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;comp &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
              &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #795548;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #795548;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; group-by-distance&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
          &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;vec words&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
跑出來的結果如下，在講者的 HP zBook 筆電 (i7 雙核)上執行的結果是這樣的
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;一般版本:  ~175 s&lt;/li&gt;
&lt;li&gt;Transducer: ~170 s&lt;/li&gt;
&lt;li&gt;Parallel fold: ~108 s&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
做完這些測試後，講者想到了，是否分佈式的 fold 可以提供更好的效能?
&lt;/p&gt;

&lt;p&gt;
講者選用了 AWS Lambda 以及 Amazon SQS 來進行這個測試，整體的架構是這個樣子的:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/fec9a5ee/ar1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
接下來你要在你的 project.clj 加入以下這些設定
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:plugins&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;lein-clj-lambda &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;0.5.1&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;:lambda&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;demo&quot;&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:handler&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;distributed-transducers-poc.LambdaFn&quot;&lt;/span&gt;
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:memory-size&lt;/span&gt; 1536
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:timeout&lt;/span&gt; 300
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:function-name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;distributed-transducers-poc&quot;&lt;/span&gt;
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:region&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;eu-west-1&quot;&lt;/span&gt;
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:policy-statements&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:Effect&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Allow&quot;&lt;/span&gt;
                                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:Action&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;sqs:*&quot;&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt;
                                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:Resource&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;arn:aws:sqs:eu-west-1:*&quot;&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;
                  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:s3&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:bucket&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;mhjort-distributed-transducers-poc&quot;&lt;/span&gt;
                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:object-key&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;lambda.jar&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
然後使用下面命令進行 deploy
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
lein lambda install demo
&lt;/pre&gt;

&lt;p&gt;
講者給出了範例，示範用 fold 以及 dfold 執行程式的狀況
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;ns&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;distributed-transducers-poc.demo&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:require&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;distributed-transducers-ppc.rc&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;dfold&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
            &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core.reducers&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:as&lt;/span&gt; r&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;fold + &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;map inc&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; +&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;range 100000&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;dfold + &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;map inc&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; +&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;range 100000&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; 2&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;; &amp;lt;= 2 is how many instance you run&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
那&amp;#x2026; 哪些資料會被送到 SQS 呢?
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;要被執行的東西 (Chunk of items to be processed)&lt;/li&gt;

&lt;li&gt;Reduct function&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
而在最後，使用分佈式 fold 的程式會變成這樣
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;similar-words-6&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;word words min-distance&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;dfold &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;partial merge-with concat&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
           &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;comp &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;map &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;partial levensthein-distance word&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
               &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;filter &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #795548;&quot;&gt;[&lt;/span&gt;d _&lt;span style=&quot;color: #795548;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;&amp;lt;= d min-distance&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; group-by-distance&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
           &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;vec words&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
           10&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而最後整體測試結果則是:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;筆電 (一般): ~175 s&lt;/li&gt;
&lt;li&gt;筆電 (transducer): ~170 s&lt;/li&gt;
&lt;li&gt;筆電 (parallel fold): ~108 s&lt;/li&gt;
&lt;li&gt;AWS Lambda (10 nodes, cost 0.01 $): ~40 s&lt;/li&gt;
&lt;li&gt;AWS Lambda (20 nodes, cost 0.02 $): ~28 s&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org38a5fae&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org38a5fae&quot;&gt;Introduction to clojure.spec - Arne Brasseur&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org38a5fae&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/-MeOPF94LhI?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;
&lt;blockquote&gt;
&lt;p&gt;
講者為 &lt;a href=&quot;https://lambdaisland.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;LambdaIsland&lt;/a&gt; 的維護者，該網站提供了一系列的 Clojure/ClojureScript 教學，若有興趣的話可以付費訂閱。
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;
&lt;p&gt;
&lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 是 Clojure 預計在 1.9 版加入的新功能，對於 Clojure 這種動態型別語言而言，雖然容易開發，但是一旦你傳送給函式的型別不對，就很可能造成除錯不易。
&lt;/p&gt;

&lt;p&gt;
在 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 出現之前，比較有名的型別檢查是 &lt;a href=&quot;https://github.com/clojure/core.typed&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;core.typed&lt;/a&gt; 以及 &lt;a href=&quot;https://github.com/plumatic/schema&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;schema&lt;/a&gt; ，而 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 將會成為 buildin 在 Clojure 的一部分函式。
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 的加入並不會導致程式執行變慢，用到他的時間只有在開發時使用 REPL 以及編譯的時候，所以到底要怎樣用呢？
&lt;/p&gt;

&lt;p&gt;
如果你是 leinigen 的用戶，更改你的 &lt;code&gt;project.clj&lt;/code&gt; 成如下
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defperoject&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;myproject&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;0.1.0-SNAPAHOT&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:dependencies&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;org.clojure&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;clojure &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;1.9.0-alpha13&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
boot 的用戶則是在你的 &lt;code&gt;build.boot&lt;/code&gt; 加入
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;set-env!
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:dependencies&lt;/span&gt; &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;org.clojure&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;clojure &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;1.9.0-alpha13&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
於是讓我們開始使用 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 吧! 講者假設現在有一個機器人主廚 (Robot Chef) 正在弄一份菜單 (recipes)，而這份菜單內容是這樣的:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;tomato-sauce-recipe&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;250 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;peeled tomatoes&quot;&lt;/span&gt;
                          3 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:clove&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;garlic&quot;&lt;/span&gt;
                          5 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;pepper&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
   &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;steps&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;heat a pan&quot;&lt;/span&gt;
                    &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;throw everything in&quot;&lt;/span&gt;
                    &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;stir&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
像這種透過 / (slash) 組成的 keyword (關鍵字)，我們稱呼為 namespace keyword
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;grettings&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;kittos&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:grettings/kittos&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
為何要用 namespace keyword 呢？一個原因是可以避免到名稱衝突，所以我們可以把所有的 keyword 合併在同一個 map 中
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;http&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;method&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:get&lt;/span&gt;
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;method&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:stir&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
實際上在 Clojure 中，變數也是包含在 namespace 中的
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;ns&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;robochef.core&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;ingredents&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;,,,&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:robochef.core/ingredients&lt;/span&gt;

&lt;span style=&quot;color: #ccaaff;&quot;&gt;::ingredients&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:robochef.core/ingredients&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
也因此，在一個 map 中使用 namespace 作為 prefix 是很常見的
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;recipe-name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;...&quot;&lt;/span&gt;
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;,,,&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;steps&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;,,,&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;cooking-time&lt;/span&gt; 30&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而在 Clojure 1.9 中，將會有新的語法可以把上面的東西變成這樣
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;recipe&lt;/span&gt; #&lt;span style=&quot;color: #ccaaff;&quot;&gt;:robochef&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:recipes-name&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;&quot;&lt;/span&gt;
                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:ingredients&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;,,,&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:steps&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;,,,&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
                       &lt;span style=&quot;color: #ccaaff;&quot;&gt;:cooking-time&lt;/span&gt; 30&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;keys&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;steps serves&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt; recipe&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;doseq&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;s steps&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
    ,,,&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
在了解這些前置訊息後，我們終於可以來到 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 了，首先我們把 &lt;a href=&quot;http://clojure.org/about/spec&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.spec&lt;/a&gt; 的命名空間(namespace) 指定為 &lt;code&gt;s&lt;/code&gt; ，接下來我們加入以下這些 spec，這會將這些 spec 加入到全域去 (global registry)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;ns&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;robochef.core&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:require&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.spec&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:as&lt;/span&gt; s&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;keep in mind &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;::recipe&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; == &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:robochef.core/recipe&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;::recipe&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;keys &lt;span style=&quot;color: #ccaaff;&quot;&gt;:req&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;::ingredients&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
                        &lt;span style=&quot;color: #ccaaff;&quot;&gt;:opt&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;::steps&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;::ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;* &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;cat &lt;span style=&quot;color: #ccaaff;&quot;&gt;:amount&lt;/span&gt; number?
                                 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:unit&lt;/span&gt; keyword?
                                 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; string?&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;::steps&lt;/span&gt; ,,,&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，我們就可以這樣去驗證，符合 spec 的狀況是這樣的
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;valid? &lt;span style=&quot;color: #ccaaff;&quot;&gt;::robochef/ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;5 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;tea&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;conform &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;5 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;tea&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;[{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:amount&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 5, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:unit&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:g&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:name&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &quot;tea&quot;}]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
那錯誤的情況呢? 我們可以透過 &lt;code&gt;clojure.spec/explain&lt;/code&gt; 來幫我們找出狀況
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;valid? &lt;span style=&quot;color: #ccaaff;&quot;&gt;::robochef/ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;10&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;tea&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; false&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;conform &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;10&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;tea&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:clojure.spec/invalid&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;explain &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;10&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;tea&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;In: [0] val: &quot;10&quot; fails spec:&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;   &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:robochef/ingredients&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; at: [&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:amount&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;] predicate: number?&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
我們也可以用 generator 去產生符合數量並可以通過測試的結果
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;exercise &lt;span style=&quot;color: #ccaaff;&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;robochef&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;ingredients&lt;/span&gt; 2&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;([() []]&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;  &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;[(0 &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:Hi&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &quot;0&quot;) [{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:amount&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 0, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:unit&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:Hi&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:name&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &quot;0&quot;}]])&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;


&lt;p&gt;
更多的內容我還在消化中，就請看影片吧 ~
&lt;/p&gt;

&lt;p&gt;
後面演講則稍微提到一下 &lt;a href=&quot;https://github.com/clojure/test.check&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;test.check&lt;/a&gt; 這個測試用的函式庫。
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;clojure/test.check&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org2c2ca75&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org2c2ca75&quot;&gt;Clojure of Things&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org2c2ca75&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/FUV_5Hwi5FU?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;
&lt;p&gt;
講者提及自己的經驗，如何用 Clojure 在目前火紅的 IoT (Internet of things) 上，並使用了 &lt;a href=&quot;http://pibrella.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;pibrella&lt;/a&gt; 這個 Raspberry Pi 的擴充板進行展示，透過 Clojure REPL 動態的控制 pibrella 的 I/O。
&lt;/p&gt;

&lt;p&gt;
作者使用的函式庫目前我沒在網路上找到，但是我猜他是用 &lt;a href=&quot;https://github.com/Pi4J/pi4j&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;pi4j&lt;/a&gt; 來作為 Clojure 控制 Raspberry pi 的函式庫。
&lt;/p&gt;

&lt;div class=&quot;github-card&quot; data-github=&quot;Pi4J/pi4j&quot; data-width=&quot;400&quot; data-height=&quot;&quot; data-theme=&quot;default&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org58cf0a9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org58cf0a9&quot;&gt;The Next Five Years of ClojureScript&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org58cf0a9&quot;&gt;
&lt;br&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/mty0RwkPmE8?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;br&gt;
&lt;p&gt;
這場是目前 ClojureScript 主要維護者 David Nolen 環顧了過去幾年 ClojureScript 開始開發的狀況，以及未來的情況。
&lt;/p&gt;

&lt;p&gt;
在這場演講後半段也提及到如何參與 ClojureScript 推廣/開發等議題，也有人提問 David Nolen 對於 WebAssembly 的看法等等。
&lt;/p&gt;

&lt;p&gt;
這場演講我覺的蠻不錯的，很喜歡這種有講故事風格的演講。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/fec9a5ee/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Unknown perls from the Clojure standard library 筆記</title>
      <link>https://coldnew.github.io/eea89759/</link>
      <guid>https://coldnew.github.io/eea89759/</guid>
      <pubDate>Tue, 27 Sep 2016 10:58:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
看完 &lt;a href=&quot;http://clojutre.org/2015/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ClojuTRE 2015&lt;/a&gt; 的 &lt;a href=&quot;https://www.youtube.com/watch?v=QI9Fc5TT87A&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Unknown pearls from the Clojure standard library - Renzo Borgatti&lt;/a&gt; 演講後，來紀錄個筆記。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/QI9Fc5TT87A&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;

&lt;p&gt;
這場演講介紹了一些在 clojure.core 裡面的函式，這些函式平常可能不太有機會用到，但是可以協助我們除錯程式的問題。
&lt;/p&gt;

&lt;p&gt;
投影片: &lt;a href=&quot;https://github.com/reborg/clojuTRE-2015/raw/master/slides/renzo-borgatti-stdlib.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;下載連結&lt;/a&gt;
&lt;/p&gt;

&lt;div id=&quot;outline-container-org4ad0709&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org4ad0709&quot;&gt;destructure&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org4ad0709&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://clojure.org/guides/destructuring&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;destructure&lt;/a&gt; (解構) 在 Clojure 裡面是個非常實用的功能，可以方便我們對資料直接指派變數去代替它，如下:
&lt;/p&gt;

&lt;div class=&quot;row &quot;&gt;&lt;div class=&quot;col-md-6 &quot;&gt;

&lt;p&gt;
&lt;b&gt;No destructuring&lt;/b&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;data &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
      a &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;nth data 0&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
      b &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;nth data 1&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
      c &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;nth data 2&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;a:&quot;&lt;/span&gt; a &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;b:&quot;&lt;/span&gt; b &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;c:&quot;&lt;/span&gt; c&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; a: 1 b: 2 c: 3&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;&lt;div class=&quot;col-md-6&quot;&gt;

&lt;p&gt;
&lt;b&gt;With destructuring&lt;/b&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;a b c&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
   &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;a:&quot;&lt;/span&gt; a &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;b:&quot;&lt;/span&gt; b &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;c:&quot;&lt;/span&gt; c&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
 &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; a: 1 b: 2 c: 3&lt;/span&gt;
 &amp;#65279;
 &amp;#65279;
 &amp;#65279;
&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt; &lt;/div&gt;

&lt;p&gt;
我們可以透過 &lt;a href=&quot;https://clojuredocs.org/clojure.core/destructure&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;destructure&lt;/a&gt; 去觀察一個東西是如何被解構的，這邊是投影片給的範例:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;destructure &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;x y &amp;amp; others&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt; v&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [v2 v&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;     &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;x (nth v2 0 nil)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;     &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;y (nth v2 1 nil)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;     &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;others (nthnext v2 2)]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
當然投影片給的是整理後的結果，實際上我執行得到的結果是這樣的
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;vec__23596
 v
 seq__23597
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;seq vec__23596&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
 first__23598
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;first seq__23597&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
 seq__23597
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;next seq__23597&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
 x
 first__23598
 first__23598
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;first seq__23597&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
 seq__23597
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;next seq__23597&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
 y
 first__23598
 others
 seq__23597&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org29188b4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org29188b4&quot;&gt;reductions&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org29188b4&quot;&gt;
&lt;p&gt;
我們在 Clojure 中很常用 &lt;a href=&quot;http://clojuredocs.org/clojure.core/reduce&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reduce&lt;/a&gt; 去將一個函數作用到 list 上的每兩個元素上，然後返回最後的結果，最常見的簡單函數就是一個 list 的元素全部相加
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reduce + &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;range 10&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 45&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而 &lt;a href=&quot;http://clojuredocs.org/clojure.core/reduce&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reduce&lt;/a&gt; 的運作過程，則可以透過 &lt;a href=&quot;https://clojuredocs.org/clojure.core/reductions&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reductions&lt;/a&gt; 來協助我們進行查看，可以看到這邊最後得到的 &lt;code&gt;45&lt;/code&gt; 就是我們想要的結果。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reductions + &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;range 10&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  (0 1 3 6 10 15 21 28 36 45)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org88f56bc&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org88f56bc&quot;&gt;test&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org88f56bc&quot;&gt;
&lt;p&gt;
在 Clojure 中，我們可以在 &lt;a href=&quot;http://clojure.org/reference/metadata&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;metadata&lt;/a&gt; 中設定好對一個函數的測試方式，然後呼叫 &lt;a href=&quot;https://clojuredocs.org/clojure.core/test&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;test&lt;/a&gt; 對該函數進行測試，這項功能很適合用在小函式的一些 assertion 測試上。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;add+&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:test&lt;/span&gt; #&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;do&lt;/span&gt;
            &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;assert &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;= &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;add+ 2 3&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt; 5&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;
            &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;assert &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;= &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;add+ 4 4&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt; 8&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;x y&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;+ x y&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;test #&#39;add+&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;lt;= trigger&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:ok&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
你也可以透過 &lt;a href=&quot;https://clojuredocs.org/clojure.core/meta&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;meta&lt;/a&gt; 去查看你這個函式的 metadata 或是測試用的函式資訊
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;meta #&#39;addd+&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:arglists&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;x y&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:test&lt;/span&gt; #function&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;hello.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;fn--23678&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:line&lt;/span&gt; 350,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:column&lt;/span&gt; 4,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:file&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;/home/coldnew/Workspace/hello/src/hello/cpre.clj&quot;&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; add+,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:ns&lt;/span&gt; #namespace&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;hello.core&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgfd64bec&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfd64bec&quot;&gt;clojure.pprint/cl-format&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfd64bec&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.pprint/cl-format&lt;/a&gt; 是 Clojure 移植 Common Lisp 的 format 函式，對於同時寫 Clojure 和 ClojureScript 的開發者而言， &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 可以同時用於 Clojure 和 ClojureScript 上，方便了不少。
&lt;/p&gt;

&lt;p&gt;
(註:  &lt;a href=&quot;http://dev.clojure.org/jira/browse/CLJS-324&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CLJS-324 ISSUE&lt;/a&gt; 尚未被解決前，Clojure 的 &lt;a href=&quot;https://clojuredocs.org/clojure.core/format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;format&lt;/a&gt; 是無法用於 ClojureScript 上的)
&lt;/p&gt;

&lt;p&gt;
如果要更多關於 &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 的使用，可以看看  &lt;a href=&quot;http://www.gigamonkeys.com/book/a-few-format-recipes.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Praticle Common Lisp&lt;/a&gt; 一書，我在 &lt;a href=&quot;http://coldnew.github.io/blog/2016/03-27_leftpad/&quot;&gt;clojure/clojurescript 與 left-pad&lt;/a&gt; 一文亦有提到如何透過 &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 實作 Clojure/ClojureScript 皆可以用的 leftpad 函式。
&lt;/p&gt;

&lt;p&gt;
投影片上給的範例則是這樣:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.pprint&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;:r&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;&lt;/span&gt; 1234&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; one thousand, two hundred thirty-fourth&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.pprint&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~@r&quot;&lt;/span&gt; 1234&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; MCCXXXIV&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org2d12659&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org2d12659&quot;&gt;clojure.java.browse/browse-url&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org2d12659&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.java.browse/browse-url&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.java.browse/browse-url&lt;/a&gt; 會呼叫系統預設的瀏覽器，開啟你所指定的網頁。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.java.browse&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;browse-url &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;http://localhost:3000&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1629338&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1629338&quot;&gt;clojure.java.javadoc/javadoc&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1629338&quot;&gt;
&lt;p&gt;
Clojure 畢竟是 JVM 上的語言，有時候我們需要查看一些 javadoc，或是查看 Clojure 內部的 Java 實現，可以透過 &lt;a href=&quot;https://clojuredocs.org/clojure.java.javadoc/javadoc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.java.javadoc/javadoc&lt;/a&gt; 來查看
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.java.javadoc&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;javadoc &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;list* 1 &lt;span style=&quot;color: #aaccff;&quot;&gt;[]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; open clojure.lang.Cons Javadoc&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6c14176&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org6c14176&quot;&gt;clojure.reflect/reflect&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org6c14176&quot;&gt;
&lt;p&gt;
老實說我看了還是不知道這是什麼，也許是和 Java 的 &lt;a href=&quot;http://stackoverflow.com/questions/37628/what-is-reflection-and-why-is-it-useful&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reflection&lt;/a&gt; 有關，不過我們還是可以在 &lt;a href=&quot;https://clojuredocs.org/clojure.reflect/reflect&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.reflect/reflect&lt;/a&gt; 的文檔中看出一些東西
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.reflect&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;reflect&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.pprint&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;print-table&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Here we have a simple function that prints the&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;important bits of the class definition in a table.&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;-&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;String&lt;/span&gt;
     reflect
     &lt;span style=&quot;color: #ccaaff;&quot;&gt;:members&lt;/span&gt;
     print-table&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|                    &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:name&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; |           &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:return-type&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; | &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:declaring-class&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; |                                       &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:parameter-types&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; |                       &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:exception-types&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; |                        &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:flags&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|--------------------------+------------------------+------------------+--------------------------------------------------------+----------------------------------------+-------------------------------|&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|               replaceAll |       java.lang.String | java.lang.String |                    [java.lang.String java.lang.String] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|   CASE_INSENSITIVE_ORDER |                        | java.lang.String |                                                        |                                        |     #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:static&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:final&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|                  indexOf |                    int | java.lang.String |                    [char&amp;lt;&amp;gt; int int char&amp;lt;&amp;gt; int int int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:static&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|           codePointCount |                    int | java.lang.String |                                              [int int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|                 getChars |                   void | java.lang.String |                                   [int int char&amp;lt;&amp;gt; int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|            regionMatches |                boolean | java.lang.String |                         [int java.lang.String int int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|                  isEmpty |                boolean | java.lang.String |                                                     [] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|              codePointAt |                    int | java.lang.String |                                                  [int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|              lastIndexOf |                    int | java.lang.String |                                     [java.lang.String] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|               startsWith |                boolean | java.lang.String |                                 [java.lang.String int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;...etc&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
講者在投影片中給的範例則是這個: (注意到結果是節錄呦~)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.reflect&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;reflect&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;with-out-str &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.pprint&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;write &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;reflect &lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;extract from a typical output:&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; invoke,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:return-type&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;java.lang.Object&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:declaring-class&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.Keyword&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:parameter-types&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;java.lang.Object&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;java.lang.Object&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:exception-types&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:flags&lt;/span&gt; #&lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:public&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:final&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd6d9545&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgd6d9545&quot;&gt;clojure.inspector/inspect-tree&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgd6d9545&quot;&gt;
&lt;p&gt;
我們在處理一些樹狀資料時(ex: JSON 格式)，有個圖示化的工具可以方便瀏覽所有資訊，這邊可以透過 &lt;a href=&quot;https://clojuredocs.org/clojure.inspector/inspect-tree&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.inspector/inspect-tree&lt;/a&gt; 來查看
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.inspector&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:as&lt;/span&gt; i&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;m&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;a&quot;&lt;/span&gt;
        &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;c&quot;&lt;/span&gt;
            &lt;span style=&quot;color: #ccaaff;&quot;&gt;:d&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;
            &lt;span style=&quot;color: #ccaaff;&quot;&gt;:e&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:f&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;f&quot;&lt;/span&gt;
                &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;g&quot;&lt;/span&gt;
                &lt;span style=&quot;color: #ccaaff;&quot;&gt;:h&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;h&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;
        &lt;span style=&quot;color: #ccaaff;&quot;&gt;:i&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
        &lt;span style=&quot;color: #ccaaff;&quot;&gt;:l&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:m&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;m&quot;&lt;/span&gt;
            &lt;span style=&quot;color: #ccaaff;&quot;&gt;:n&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;n&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;
        &lt;span style=&quot;color: #ccaaff;&quot;&gt;:o&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:p&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;p&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:q&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;q&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;inspect-tree m&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣呼叫，會得到如下的視窗
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/eea89759/inspect-tree.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org46eebdb&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org46eebdb&quot;&gt;clojure.lang.PersistentQueue&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org46eebdb&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://github.com/clojure/clojure/blob/master/src/jvm/clojure/lang/PersistentQueue.java&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.lang.persistentQueue&lt;/a&gt; 是 Clojure 下並未寫在 doc 上面的 Queue 實現 (java) ，我們可以用它來實作我們需要的 queue (佇列) 功能
&lt;/p&gt;


&lt;p&gt;
基本上，你有以下幾種方法可以對你的 PersistentQueue 進行處理
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
peek
&lt;/p&gt;

&lt;p&gt;
取得 queue 最頂端的資料(head)
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
pop
&lt;/p&gt;

&lt;p&gt;
回傳不包含最頂端資料(head)的一個新的 PersistentQueue
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
conj
&lt;/p&gt;

&lt;p&gt;
將資料加入到 queue 的尾巴
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
empty?
&lt;/p&gt;

&lt;p&gt;
檢測 queue 是否為空的
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
seq
&lt;/p&gt;

&lt;p&gt;
將 queue 的資料變成序列 (sequence)
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
投影片上，講者是舉這範例:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.PersistentQueue&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;EMPTY&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;buf&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;reduce conj e &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;range 10&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;peek buf&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 0&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;peek &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;pop buf&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 1&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;peek &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;pop &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;pop buf&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 2&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而 &lt;a href=&quot;http://stackoverflow.com/questions/3136453/immutable-queue-in-clojure&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;StackOverflow&lt;/a&gt; 則是有人舉出了如何透過  &lt;a href=&quot;https://github.com/clojure/clojure/blob/master/src/jvm/clojure/lang/PersistentQueue.java&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.lang.persistentQueue&lt;/a&gt; 實現自己的 queue 函式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;queue&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[]&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.PersistentQueue&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;EMPTY&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;coll&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;reduce conj &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.PersistentQueue&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;EMPTY&lt;/span&gt; coll&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defmethod&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;print-method&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.PersistentQueue&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;q ^&lt;span style=&quot;color: #fff59d;&quot;&gt;java.io.Writer&lt;/span&gt; w&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;.write&lt;/span&gt; w &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;#queue &quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;print-method &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;sequence q&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; w&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;comment
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;*data-readers*&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&#39;queue #&#39;queue&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;read-string &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;pr-str &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;queue &lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgea7b166&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgea7b166&quot;&gt;fnil&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgea7b166&quot;&gt;
&lt;p&gt;
我們在用 Clojure 處理東西的時候，有時候可能是資料本身就是 nil 的情況，這種狀況下對 nil 進行處理可能就會導致 Exception 的狀況發生
&lt;/p&gt;

&lt;p&gt;
在傳統的 LISP 中，常以 &lt;code&gt;or&lt;/code&gt; 作為一個保護，一旦遇到 nil 的情況，則回傳預設值
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;or&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; 10&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 10&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/fnil&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;fnil&lt;/a&gt; 則是用來替你的函式多加一層保護，讓函式遇到 nil 的狀況可以避免一些 Exception 的發生
&lt;/p&gt;

&lt;p&gt;
講者在投影片上提供的範例是這樣的:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;m&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:host&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:port&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;update m &lt;span style=&quot;color: #ccaaff;&quot;&gt;:port&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;fnil #&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;parseInt&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;80&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:host&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &quot;127.0.0.1&quot;, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:port&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 80}&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;m&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:host&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:port&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;8008&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;update m &lt;span style=&quot;color: #ccaaff;&quot;&gt;:port&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;fnil #&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;parseInt&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;80&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:host&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &quot;127.0.0.1&quot;, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:port&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 8008}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
不過我們也可以將其拆開來看，這樣會更好理解
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;parseInt&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;10&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 10&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;parseInt&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  Unhandled java.lang.NumberFormatException&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;fnil #&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;parseInt&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; 80&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;1000&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 1000&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org371e5d4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org371e5d4&quot;&gt;counted?&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org371e5d4&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/counted_q&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;counted?&lt;/a&gt; 是 O(1) 的操作，用來查看目標是否具有實作 &lt;a href=&quot;https://clojuredocs.org/clojure.core/count&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;count&lt;/a&gt; 函式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt; 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? #&lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;asdf&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; false&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;into-array &lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;TYPE&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5edd9cf&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org5edd9cf&quot;&gt;reversible?&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org5edd9cf&quot;&gt;
&lt;p&gt;
[[&lt;a href=&quot;https://clojuredocs.org/clojure.core/reversible_q%5D%5Breversibl%5B%5Bfile&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://clojuredocs.org/clojure.core/reversible_q][reversibl[[file&lt;/a&gt;:][]]] 也是 O(1) 的操作，用來查看目標是否有實作 &lt;a href=&quot;https://clojuredocs.org/clojure.core/reversible_q&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reversible&lt;/a&gt; 函式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? &lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;sorted-map&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;sorted-set&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  false&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? &lt;span style=&quot;color: #81d4fa;&quot;&gt;{}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  false&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? #&lt;span style=&quot;color: #81d4fa;&quot;&gt;{}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org97ef289&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org97ef289&quot;&gt;vector-of&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org97ef289&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/vector-of&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;vector-of&lt;/a&gt; 會根據你提供的類型 (permitive type) 來將參數轉換成相對應型別的向量 (vector)
&lt;/p&gt;

&lt;p&gt;
可以使用的類型有 &lt;code&gt;:int&lt;/code&gt; , &lt;code&gt;:long&lt;/code&gt; , &lt;code&gt;:float&lt;/code&gt; , &lt;code&gt;:double&lt;/code&gt; , &lt;code&gt;:byte&lt;/code&gt; , &lt;code&gt;:short&lt;/code&gt; , &lt;code&gt;:char&lt;/code&gt; , &lt;code&gt;:boolean&lt;/code&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;conj &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;vector-of &lt;span style=&quot;color: #ccaaff;&quot;&gt;:int&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; 1 2 3&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [1 2 3]  ; &amp;lt;-- note, these are unboxed internally&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;vector-of &lt;span style=&quot;color: #ccaaff;&quot;&gt;:int&lt;/span&gt; 1 2 3&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [1 2 3]  ; same here&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;vector-of &lt;span style=&quot;color: #ccaaff;&quot;&gt;:float&lt;/span&gt; 1 2 3&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [1.0 2.0 3.0]&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;type &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;conj &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;vector-of &lt;span style=&quot;color: #ccaaff;&quot;&gt;:int&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; 1 2 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; clojure.core.Vec&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;type &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;conj &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;vector-of &lt;span style=&quot;color: #ccaaff;&quot;&gt;:float&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; 1 2 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; clojure.core.Vec&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org261ee3a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org261ee3a&quot;&gt;clojure.set/rename-keys&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org261ee3a&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.set/rename-keys&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.set/rename-keys&lt;/a&gt; 可以用來改變目前現有的 hash-map 的關鍵字 (keyword) 名稱
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.set&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.set&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;rename-keys &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1, &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:new-a&lt;/span&gt;, &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:new-b&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:new-a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 1, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:new-b&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 2}&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;cloure.set&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;rename-keys &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:new-b&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 1}&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;You need to be careful about key collisions.  You probably shouldn&#39;t&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;depend on the exact behavior.&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.set&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;rename-keys &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 1}&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.set&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;rename-keys  &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;  &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 1}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga9b4ed9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga9b4ed9&quot;&gt;clojure.data/diff&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga9b4ed9&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.data/diff&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.data/diff&lt;/a&gt; 用來對兩個序列(sequence)進行比較，並回傳比較的結果
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.data&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.data&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;diff &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 3 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt; 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; ({&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 1} {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 3, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:c&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 3} {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 2})&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.data&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;diff &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;5 9 3 2 3 7&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [[1 2] [5 9 nil 2 3 7] [nil nil 3]]&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.data&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;diff &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;set &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;set &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;5 9 3 2 3 7&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [#{1}  #{7 9 5}        #{3 2}]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgcf7c054&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgcf7c054&quot;&gt;munge&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgcf7c054&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/munge&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;munge&lt;/a&gt; 這個函式並未有文檔，因此只能實際看看用途了
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;foo&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;foo&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  #&#39;user/foo&lt;/span&gt;

foo
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; #&amp;lt;user$foo user$foo@a0dc71&amp;gt;&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;munge foo&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;user_DOLLARSIGN_foo_CIRCA_a0dc71&quot;&lt;/span&gt;


&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;doseq&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;c &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;remove #&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Character&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;isLetterOrDigit&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;map char &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;range 32 127&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;println c &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;-&amp;gt;&quot;&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;munge c&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Prints:&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;   &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;-&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;! -&amp;gt; _BANG_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&quot; -&amp;gt; _DOUBLEQUOTE_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# -&amp;gt; _SHARP_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;$ -&amp;gt; $&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;% -&amp;gt; _PERCENT_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;amp; -&amp;gt; _AMPERSAND_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&#39; -&amp;gt; _SINGLEQUOTE_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;( -&amp;gt; (&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;) -&amp;gt; )&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;* -&amp;gt; _STAR_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;+ -&amp;gt; _PLUS_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;, -&amp;gt; ,&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;- -&amp;gt; _&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;. -&amp;gt; .&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;/ -&amp;gt; _SLASH_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;: -&amp;gt; _COLON_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;; -&amp;gt; ;&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;lt; -&amp;gt; _LT_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;= -&amp;gt; _EQ_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;gt; -&amp;gt; _GT_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;? -&amp;gt; _QMARK_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;@ -&amp;gt; _CIRCA_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;[ -&amp;gt; _LBRACK_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;\ -&amp;gt; _BSLASH_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;] -&amp;gt; _RBRACK_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;^ -&amp;gt; _CARET_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;_ -&amp;gt; _&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;` -&amp;gt; `&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;{ -&amp;gt; _LBRACE_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;| -&amp;gt; _BAR_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} -&amp;gt; _RBRACE_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;~ -&amp;gt; _TILDE_&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb1592f0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb1592f0&quot;&gt;gensym&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb1592f0&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/gensym&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;gensym&lt;/a&gt; 會產生不衝突名稱的 symbol，這個應該是在 macro 實現時，Clojure 所使用到的函式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;gensym &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;foo&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; foo2020&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;gensym &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;foo&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; foo2027&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga3737c6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga3737c6&quot;&gt;seque&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga3737c6&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/seque&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;seque&lt;/a&gt; 是一種 &lt;code&gt;阻塞隊列(Linked Blocking Queue, LBQ)&lt;/code&gt; 的實作，這種實現是線程安全(thread safe)的，可以確保資料先進先出(first in first out, FIFO) 的狀況。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;start &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;System&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;nanoTime&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
      q &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;seque
         &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;iterate
          #&lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;do&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;sleep 400&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;inc &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
          0&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;sleep five seconds...&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;sleep 5000&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;doseq&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;i &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;take 20 q&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;int &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;/ &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;- &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;System&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;nanoTime&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt; start&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt; 1e7&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;
             &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;:&quot;&lt;/span&gt; i&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;


&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;The iterate form returns a lazy seq that delays nearly a half-second&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;before returning each subsequent item.  Here seque starts a thread&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;generating the lazy seq.&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;The body of the let allows the seque thread to get ahead by five seconds&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;before it begins consuming the seq using doseq.  The doseq prints a&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;timestamp and the value from the seq when it becomes available.  The&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;first 11 or so are available almost instantly, until the consuming&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;doseq catches up with the producing iterate, at which point the consumer&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;blocks for 400ms before each item can be printed.&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;sleep five seconds...&lt;/span&gt;
500 : 0
500 : 1
500 : 2
500 : 3
500 : 4
500 : 5
500 : 6
500 : 7
500 : 8
500 : 9
500 : 10
500 : 11
520 : 12
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;......&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org4004cf5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org4004cf5&quot;&gt;clojure.zip/zippers&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org4004cf5&quot;&gt;
&lt;p&gt;
clojure.zip 是用來處理樹狀結構用函式庫，這篇文章有很好的解釋: &lt;a href=&quot;http://blog.lambdaliu.com/posts-output/2016-04-05-understand-clojure-zipper-with-picture/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;(λx.Liu)Blog=Hacking: Understand clojure.zip with picture&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.zip/zipper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.zip/zipper&lt;/a&gt; 則是用來將資料包裝起來，這樣我們就可以透過 clojure.zip 來處理這些樹狀資料
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;zp&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.zip&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;zipper vector? seq &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;_ c&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt; c&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
                            &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt; 2 3 &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;40 50 60&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [[[1 2 3] [&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;] 2 3 [40 50 60]] nil]&lt;/span&gt;


&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.zip&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;down zp&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:l&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[]&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:pnodes&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt; 2 3 &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;40 50 60&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:ppath&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:r&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt; 2 3 &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;40 50 60&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;


&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;-&amp;gt;&lt;/span&gt; zp
    &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.zip&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;down
    first&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;


&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;-&amp;gt;&lt;/span&gt; zp
    &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.zip&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;down
    &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.zip&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;right&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:l&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:pnodes&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt; 2 3 &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;40 50 60&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:ppath&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:r&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;2 3 &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;40 50 60&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
看完 &lt;a href=&quot;http://clojutre.org/2015/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ClojuTRE 2015&lt;/a&gt; 的 &lt;a href=&quot;https://www.youtube.com/watch?v=QI9Fc5TT87A&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Unknown pearls from the Clojure standard library - Renzo Borgatti&lt;/a&gt; 演講後，來紀錄個筆記。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/QI9Fc5TT87A&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;

&lt;p&gt;
這場演講介紹了一些在 clojure.core 裡面的函式，這些函式平常可能不太有機會用到，但是可以協助我們除錯程式的問題。
&lt;/p&gt;

&lt;p&gt;
投影片: &lt;a href=&quot;https://github.com/reborg/clojuTRE-2015/raw/master/slides/renzo-borgatti-stdlib.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;下載連結&lt;/a&gt;
&lt;/p&gt;

&lt;div id=&quot;outline-container-org4ad0709&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org4ad0709&quot;&gt;destructure&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org4ad0709&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://clojure.org/guides/destructuring&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;destructure&lt;/a&gt; (解構) 在 Clojure 裡面是個非常實用的功能，可以方便我們對資料直接指派變數去代替它，如下:
&lt;/p&gt;

&lt;div class=&quot;row &quot;&gt;&lt;div class=&quot;col-md-6 &quot;&gt;

&lt;p&gt;
&lt;b&gt;No destructuring&lt;/b&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;data &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
      a &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;nth data 0&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
      b &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;nth data 1&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
      c &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;nth data 2&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;a:&quot;&lt;/span&gt; a &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;b:&quot;&lt;/span&gt; b &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;c:&quot;&lt;/span&gt; c&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; a: 1 b: 2 c: 3&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;&lt;div class=&quot;col-md-6&quot;&gt;

&lt;p&gt;
&lt;b&gt;With destructuring&lt;/b&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;a b c&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
   &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;a:&quot;&lt;/span&gt; a &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;b:&quot;&lt;/span&gt; b &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;c:&quot;&lt;/span&gt; c&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
 &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; a: 1 b: 2 c: 3&lt;/span&gt;
 &amp;#65279;
 &amp;#65279;
 &amp;#65279;
&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt; &lt;/div&gt;

&lt;p&gt;
我們可以透過 &lt;a href=&quot;https://clojuredocs.org/clojure.core/destructure&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;destructure&lt;/a&gt; 去觀察一個東西是如何被解構的，這邊是投影片給的範例:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;destructure &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;x y &amp;amp; others&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt; v&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [v2 v&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;     &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;x (nth v2 0 nil)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;     &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;y (nth v2 1 nil)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;     &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;others (nthnext v2 2)]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
當然投影片給的是整理後的結果，實際上我執行得到的結果是這樣的
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;vec__23596
 v
 seq__23597
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;seq vec__23596&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
 first__23598
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;first seq__23597&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
 seq__23597
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;next seq__23597&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
 x
 first__23598
 first__23598
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;first seq__23597&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
 seq__23597
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;next seq__23597&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
 y
 first__23598
 others
 seq__23597&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org29188b4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org29188b4&quot;&gt;reductions&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org29188b4&quot;&gt;
&lt;p&gt;
我們在 Clojure 中很常用 &lt;a href=&quot;http://clojuredocs.org/clojure.core/reduce&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reduce&lt;/a&gt; 去將一個函數作用到 list 上的每兩個元素上，然後返回最後的結果，最常見的簡單函數就是一個 list 的元素全部相加
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reduce + &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;range 10&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 45&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而 &lt;a href=&quot;http://clojuredocs.org/clojure.core/reduce&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reduce&lt;/a&gt; 的運作過程，則可以透過 &lt;a href=&quot;https://clojuredocs.org/clojure.core/reductions&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reductions&lt;/a&gt; 來協助我們進行查看，可以看到這邊最後得到的 &lt;code&gt;45&lt;/code&gt; 就是我們想要的結果。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reductions + &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;range 10&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  (0 1 3 6 10 15 21 28 36 45)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org88f56bc&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org88f56bc&quot;&gt;test&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org88f56bc&quot;&gt;
&lt;p&gt;
在 Clojure 中，我們可以在 &lt;a href=&quot;http://clojure.org/reference/metadata&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;metadata&lt;/a&gt; 中設定好對一個函數的測試方式，然後呼叫 &lt;a href=&quot;https://clojuredocs.org/clojure.core/test&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;test&lt;/a&gt; 對該函數進行測試，這項功能很適合用在小函式的一些 assertion 測試上。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;add+&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:test&lt;/span&gt; #&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;do&lt;/span&gt;
            &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;assert &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;= &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;add+ 2 3&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt; 5&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;
            &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;assert &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;= &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;add+ 4 4&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt; 8&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;x y&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;+ x y&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;test #&#39;add+&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;lt;= trigger&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:ok&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
你也可以透過 &lt;a href=&quot;https://clojuredocs.org/clojure.core/meta&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;meta&lt;/a&gt; 去查看你這個函式的 metadata 或是測試用的函式資訊
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;meta #&#39;addd+&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:arglists&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;x y&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:test&lt;/span&gt; #function&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;hello.core&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;fn--23678&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:line&lt;/span&gt; 350,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:column&lt;/span&gt; 4,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:file&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;/home/coldnew/Workspace/hello/src/hello/cpre.clj&quot;&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; add+,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:ns&lt;/span&gt; #namespace&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;hello.core&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgfd64bec&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfd64bec&quot;&gt;clojure.pprint/cl-format&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfd64bec&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.pprint/cl-format&lt;/a&gt; 是 Clojure 移植 Common Lisp 的 format 函式，對於同時寫 Clojure 和 ClojureScript 的開發者而言， &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 可以同時用於 Clojure 和 ClojureScript 上，方便了不少。
&lt;/p&gt;

&lt;p&gt;
(註:  &lt;a href=&quot;http://dev.clojure.org/jira/browse/CLJS-324&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CLJS-324 ISSUE&lt;/a&gt; 尚未被解決前，Clojure 的 &lt;a href=&quot;https://clojuredocs.org/clojure.core/format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;format&lt;/a&gt; 是無法用於 ClojureScript 上的)
&lt;/p&gt;

&lt;p&gt;
如果要更多關於 &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 的使用，可以看看  &lt;a href=&quot;http://www.gigamonkeys.com/book/a-few-format-recipes.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Praticle Common Lisp&lt;/a&gt; 一書，我在 &lt;a href=&quot;http://coldnew.github.io/blog/2016/03-27_leftpad/&quot;&gt;clojure/clojurescript 與 left-pad&lt;/a&gt; 一文亦有提到如何透過 &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 實作 Clojure/ClojureScript 皆可以用的 leftpad 函式。
&lt;/p&gt;

&lt;p&gt;
投影片上給的範例則是這樣:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.pprint&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;:r&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;&lt;/span&gt; 1234&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; one thousand, two hundred thirty-fourth&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.pprint&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~@r&quot;&lt;/span&gt; 1234&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; MCCXXXIV&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org2d12659&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org2d12659&quot;&gt;clojure.java.browse/browse-url&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org2d12659&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.java.browse/browse-url&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.java.browse/browse-url&lt;/a&gt; 會呼叫系統預設的瀏覽器，開啟你所指定的網頁。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.java.browse&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;browse-url &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;http://localhost:3000&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org1629338&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org1629338&quot;&gt;clojure.java.javadoc/javadoc&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org1629338&quot;&gt;
&lt;p&gt;
Clojure 畢竟是 JVM 上的語言，有時候我們需要查看一些 javadoc，或是查看 Clojure 內部的 Java 實現，可以透過 &lt;a href=&quot;https://clojuredocs.org/clojure.java.javadoc/javadoc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.java.javadoc/javadoc&lt;/a&gt; 來查看
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.java.javadoc&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;javadoc &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;list* 1 &lt;span style=&quot;color: #aaccff;&quot;&gt;[]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; open clojure.lang.Cons Javadoc&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6c14176&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org6c14176&quot;&gt;clojure.reflect/reflect&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org6c14176&quot;&gt;
&lt;p&gt;
老實說我看了還是不知道這是什麼，也許是和 Java 的 &lt;a href=&quot;http://stackoverflow.com/questions/37628/what-is-reflection-and-why-is-it-useful&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reflection&lt;/a&gt; 有關，不過我們還是可以在 &lt;a href=&quot;https://clojuredocs.org/clojure.reflect/reflect&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.reflect/reflect&lt;/a&gt; 的文檔中看出一些東西
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.reflect&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;reflect&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.pprint&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;print-table&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Here we have a simple function that prints the&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;important bits of the class definition in a table.&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;-&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;String&lt;/span&gt;
     reflect
     &lt;span style=&quot;color: #ccaaff;&quot;&gt;:members&lt;/span&gt;
     print-table&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|                    &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:name&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; |           &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:return-type&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; | &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:declaring-class&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; |                                       &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:parameter-types&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; |                       &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:exception-types&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; |                        &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:flags&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|--------------------------+------------------------+------------------+--------------------------------------------------------+----------------------------------------+-------------------------------|&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|               replaceAll |       java.lang.String | java.lang.String |                    [java.lang.String java.lang.String] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|   CASE_INSENSITIVE_ORDER |                        | java.lang.String |                                                        |                                        |     #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:static&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:final&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|                  indexOf |                    int | java.lang.String |                    [char&amp;lt;&amp;gt; int int char&amp;lt;&amp;gt; int int int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:static&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|           codePointCount |                    int | java.lang.String |                                              [int int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|                 getChars |                   void | java.lang.String |                                   [int int char&amp;lt;&amp;gt; int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|            regionMatches |                boolean | java.lang.String |                         [int java.lang.String int int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|                  isEmpty |                boolean | java.lang.String |                                                     [] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|              codePointAt |                    int | java.lang.String |                                                  [int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|              lastIndexOf |                    int | java.lang.String |                                     [java.lang.String] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;|               startsWith |                boolean | java.lang.String |                                 [java.lang.String int] |                                     [] |                    #{&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:public&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} |&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;...etc&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
講者在投影片中給的範例則是這個: (注意到結果是節錄呦~)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.reflect&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;reflect&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;with-out-str &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.pprint&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;write &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;reflect &lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;extract from a typical output:&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:name&lt;/span&gt; invoke,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:return-type&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;java.lang.Object&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:declaring-class&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.Keyword&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:parameter-types&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;java.lang.Object&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;java.lang.Object&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:exception-types&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt;,
 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:flags&lt;/span&gt; #&lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:public&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:final&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd6d9545&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgd6d9545&quot;&gt;clojure.inspector/inspect-tree&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgd6d9545&quot;&gt;
&lt;p&gt;
我們在處理一些樹狀資料時(ex: JSON 格式)，有個圖示化的工具可以方便瀏覽所有資訊，這邊可以透過 &lt;a href=&quot;https://clojuredocs.org/clojure.inspector/inspect-tree&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.inspector/inspect-tree&lt;/a&gt; 來查看
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.inspector&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:as&lt;/span&gt; i&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;m&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;a&quot;&lt;/span&gt;
        &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;c&quot;&lt;/span&gt;
            &lt;span style=&quot;color: #ccaaff;&quot;&gt;:d&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;
            &lt;span style=&quot;color: #ccaaff;&quot;&gt;:e&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:f&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;f&quot;&lt;/span&gt;
                &lt;span style=&quot;color: #ccaaff;&quot;&gt;:g&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;g&quot;&lt;/span&gt;
                &lt;span style=&quot;color: #ccaaff;&quot;&gt;:h&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;h&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;
        &lt;span style=&quot;color: #ccaaff;&quot;&gt;:i&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
        &lt;span style=&quot;color: #ccaaff;&quot;&gt;:l&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:m&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;m&quot;&lt;/span&gt;
            &lt;span style=&quot;color: #ccaaff;&quot;&gt;:n&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;n&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;}&lt;/span&gt;
        &lt;span style=&quot;color: #ccaaff;&quot;&gt;:o&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:p&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;p&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:q&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;q&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;inspect-tree m&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣呼叫，會得到如下的視窗
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/eea89759/inspect-tree.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org46eebdb&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org46eebdb&quot;&gt;clojure.lang.PersistentQueue&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org46eebdb&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://github.com/clojure/clojure/blob/master/src/jvm/clojure/lang/PersistentQueue.java&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.lang.persistentQueue&lt;/a&gt; 是 Clojure 下並未寫在 doc 上面的 Queue 實現 (java) ，我們可以用它來實作我們需要的 queue (佇列) 功能
&lt;/p&gt;


&lt;p&gt;
基本上，你有以下幾種方法可以對你的 PersistentQueue 進行處理
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
peek
&lt;/p&gt;

&lt;p&gt;
取得 queue 最頂端的資料(head)
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
pop
&lt;/p&gt;

&lt;p&gt;
回傳不包含最頂端資料(head)的一個新的 PersistentQueue
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
conj
&lt;/p&gt;

&lt;p&gt;
將資料加入到 queue 的尾巴
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
empty?
&lt;/p&gt;

&lt;p&gt;
檢測 queue 是否為空的
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
seq
&lt;/p&gt;

&lt;p&gt;
將 queue 的資料變成序列 (sequence)
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
投影片上，講者是舉這範例:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;e&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.PersistentQueue&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;EMPTY&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;buf&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;reduce conj e &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;range 10&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;peek buf&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 0&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;peek &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;pop buf&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 1&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;peek &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;pop &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;pop buf&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 2&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而 &lt;a href=&quot;http://stackoverflow.com/questions/3136453/immutable-queue-in-clojure&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;StackOverflow&lt;/a&gt; 則是有人舉出了如何透過  &lt;a href=&quot;https://github.com/clojure/clojure/blob/master/src/jvm/clojure/lang/PersistentQueue.java&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.lang.persistentQueue&lt;/a&gt; 實現自己的 queue 函式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;queue&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[]&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.PersistentQueue&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;EMPTY&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;coll&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;reduce conj &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.PersistentQueue&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;EMPTY&lt;/span&gt; coll&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defmethod&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;print-method&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.lang.PersistentQueue&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;q ^&lt;span style=&quot;color: #fff59d;&quot;&gt;java.io.Writer&lt;/span&gt; w&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;.write&lt;/span&gt; w &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;#queue &quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;print-method &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;sequence q&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; w&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;comment
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;*data-readers*&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;{&lt;/span&gt;&#39;queue #&#39;queue&lt;span style=&quot;color: #aaeecc;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;read-string &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;pr-str &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;queue &lt;span style=&quot;color: #fff59d;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #fff59d;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgea7b166&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgea7b166&quot;&gt;fnil&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgea7b166&quot;&gt;
&lt;p&gt;
我們在用 Clojure 處理東西的時候，有時候可能是資料本身就是 nil 的情況，這種狀況下對 nil 進行處理可能就會導致 Exception 的狀況發生
&lt;/p&gt;

&lt;p&gt;
在傳統的 LISP 中，常以 &lt;code&gt;or&lt;/code&gt; 作為一個保護，一旦遇到 nil 的情況，則回傳預設值
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;or&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; 10&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 10&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/fnil&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;fnil&lt;/a&gt; 則是用來替你的函式多加一層保護，讓函式遇到 nil 的狀況可以避免一些 Exception 的發生
&lt;/p&gt;

&lt;p&gt;
講者在投影片上提供的範例是這樣的:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;m&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:host&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:port&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;update m &lt;span style=&quot;color: #ccaaff;&quot;&gt;:port&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;fnil #&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;parseInt&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;80&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:host&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &quot;127.0.0.1&quot;, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:port&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 80}&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;m&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:host&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:port&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;8008&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;update m &lt;span style=&quot;color: #ccaaff;&quot;&gt;:port&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;fnil #&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;parseInt&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;80&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:host&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &quot;127.0.0.1&quot;, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:port&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 8008}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
不過我們也可以將其拆開來看，這樣會更好理解
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;parseInt&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;10&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 10&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;parseInt&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  Unhandled java.lang.NumberFormatException&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;fnil #&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;parseInt&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; 80&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;1000&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; 1000&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org371e5d4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org371e5d4&quot;&gt;counted?&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org371e5d4&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/counted_q&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;counted?&lt;/a&gt; 是 O(1) 的操作，用來查看目標是否具有實作 &lt;a href=&quot;https://clojuredocs.org/clojure.core/count&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;count&lt;/a&gt; 函式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt; 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? #&lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;asdf&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; false&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counted? &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;into-array &lt;span style=&quot;color: #fff59d;&quot;&gt;Integer&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;TYPE&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5edd9cf&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org5edd9cf&quot;&gt;reversible?&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org5edd9cf&quot;&gt;
&lt;p&gt;
[[&lt;a href=&quot;https://clojuredocs.org/clojure.core/reversible_q%5D%5Breversibl%5B%5Bfile&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://clojuredocs.org/clojure.core/reversible_q][reversibl[[file&lt;/a&gt;:][]]] 也是 O(1) 的操作，用來查看目標是否有實作 &lt;a href=&quot;https://clojuredocs.org/clojure.core/reversible_q&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;reversible&lt;/a&gt; 函式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? &lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;sorted-map&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;sorted-set&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  true&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? &#39;&lt;span style=&quot;color: #81d4fa;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  false&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? &lt;span style=&quot;color: #81d4fa;&quot;&gt;{}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  false&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;reversible? #&lt;span style=&quot;color: #81d4fa;&quot;&gt;{}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org97ef289&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org97ef289&quot;&gt;vector-of&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org97ef289&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/vector-of&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;vector-of&lt;/a&gt; 會根據你提供的類型 (permitive type) 來將參數轉換成相對應型別的向量 (vector)
&lt;/p&gt;

&lt;p&gt;
可以使用的類型有 &lt;code&gt;:int&lt;/code&gt; , &lt;code&gt;:long&lt;/code&gt; , &lt;code&gt;:float&lt;/code&gt; , &lt;code&gt;:double&lt;/code&gt; , &lt;code&gt;:byte&lt;/code&gt; , &lt;code&gt;:short&lt;/code&gt; , &lt;code&gt;:char&lt;/code&gt; , &lt;code&gt;:boolean&lt;/code&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;conj &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;vector-of &lt;span style=&quot;color: #ccaaff;&quot;&gt;:int&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; 1 2 3&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [1 2 3]  ; &amp;lt;-- note, these are unboxed internally&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;vector-of &lt;span style=&quot;color: #ccaaff;&quot;&gt;:int&lt;/span&gt; 1 2 3&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [1 2 3]  ; same here&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;vector-of &lt;span style=&quot;color: #ccaaff;&quot;&gt;:float&lt;/span&gt; 1 2 3&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [1.0 2.0 3.0]&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;type &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;conj &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;vector-of &lt;span style=&quot;color: #ccaaff;&quot;&gt;:int&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; 1 2 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; clojure.core.Vec&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;type &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;conj &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;vector-of &lt;span style=&quot;color: #ccaaff;&quot;&gt;:float&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt; 1 2 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; clojure.core.Vec&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org261ee3a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org261ee3a&quot;&gt;clojure.set/rename-keys&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org261ee3a&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.set/rename-keys&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.set/rename-keys&lt;/a&gt; 可以用來改變目前現有的 hash-map 的關鍵字 (keyword) 名稱
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.set&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.set&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;rename-keys &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1, &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:new-a&lt;/span&gt;, &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:new-b&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:new-a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 1, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:new-b&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 2}&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;cloure.set&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;rename-keys &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:new-b&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 1}&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;You need to be careful about key collisions.  You probably shouldn&#39;t&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;depend on the exact behavior.&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.set&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;rename-keys &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 1}&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.set&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;rename-keys  &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;  &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 1}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga9b4ed9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga9b4ed9&quot;&gt;clojure.data/diff&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga9b4ed9&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.data/diff&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.data/diff&lt;/a&gt; 用來對兩個序列(sequence)進行比較，並回傳比較的結果
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;require &#39;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.data&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.data&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;diff &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 1 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; 3 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt; 2 &lt;span style=&quot;color: #ccaaff;&quot;&gt;:c&lt;/span&gt; 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; ({&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 1} {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 3, &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:c&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 3} {&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; 2})&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.data&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;diff &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;5 9 3 2 3 7&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [[1 2] [5 9 nil 2 3 7] [nil nil 3]]&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.data&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;diff &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;set &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;set &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;5 9 3 2 3 7&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [#{1}  #{7 9 5}        #{3 2}]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgcf7c054&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgcf7c054&quot;&gt;munge&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgcf7c054&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/munge&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;munge&lt;/a&gt; 這個函式並未有文檔，因此只能實際看看用途了
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;foo&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;foo&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;  #&#39;user/foo&lt;/span&gt;

foo
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; #&amp;lt;user$foo user$foo@a0dc71&amp;gt;&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;munge foo&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;user_DOLLARSIGN_foo_CIRCA_a0dc71&quot;&lt;/span&gt;


&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;doseq&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;c &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;remove #&lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Character&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;isLetterOrDigit&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;map char &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;range 32 127&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;println c &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;-&amp;gt;&quot;&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;munge c&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Prints:&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;   &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;-&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;! -&amp;gt; _BANG_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&quot; -&amp;gt; _DOUBLEQUOTE_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;# -&amp;gt; _SHARP_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;$ -&amp;gt; $&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;% -&amp;gt; _PERCENT_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;amp; -&amp;gt; _AMPERSAND_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&#39; -&amp;gt; _SINGLEQUOTE_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;( -&amp;gt; (&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;) -&amp;gt; )&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;* -&amp;gt; _STAR_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;+ -&amp;gt; _PLUS_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;, -&amp;gt; ,&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;- -&amp;gt; _&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;. -&amp;gt; .&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;/ -&amp;gt; _SLASH_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;: -&amp;gt; _COLON_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;; -&amp;gt; ;&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;lt; -&amp;gt; _LT_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;= -&amp;gt; _EQ_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;gt; -&amp;gt; _GT_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;? -&amp;gt; _QMARK_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;@ -&amp;gt; _CIRCA_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;[ -&amp;gt; _LBRACK_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;\ -&amp;gt; _BSLASH_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;] -&amp;gt; _RBRACK_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;^ -&amp;gt; _CARET_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;_ -&amp;gt; _&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;` -&amp;gt; `&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;{ -&amp;gt; _LBRACE_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;| -&amp;gt; _BAR_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;} -&amp;gt; _RBRACE_&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;~ -&amp;gt; _TILDE_&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb1592f0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb1592f0&quot;&gt;gensym&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb1592f0&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/gensym&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;gensym&lt;/a&gt; 會產生不衝突名稱的 symbol，這個應該是在 macro 實現時，Clojure 所使用到的函式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;gensym &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;foo&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; foo2020&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;gensym &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;foo&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; foo2027&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga3737c6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga3737c6&quot;&gt;seque&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga3737c6&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.core/seque&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;seque&lt;/a&gt; 是一種 &lt;code&gt;阻塞隊列(Linked Blocking Queue, LBQ)&lt;/code&gt; 的實作，這種實現是線程安全(thread safe)的，可以確保資料先進先出(first in first out, FIFO) 的狀況。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;start &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;System&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;nanoTime&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
      q &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;seque
         &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;iterate
          #&lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;do&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;sleep 400&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;inc &lt;span style=&quot;color: #aaccff;&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;
          0&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;sleep five seconds...&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;sleep 5000&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;doseq&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;i &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;take 20 q&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;println &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;int &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;/ &lt;span style=&quot;color: #fff59d;&quot;&gt;(&lt;/span&gt;- &lt;span style=&quot;color: #ff8888;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;System&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;nanoTime&lt;/span&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;)&lt;/span&gt; start&lt;span style=&quot;color: #fff59d;&quot;&gt;)&lt;/span&gt; 1e7&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;
             &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;:&quot;&lt;/span&gt; i&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;


&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;The iterate form returns a lazy seq that delays nearly a half-second&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;before returning each subsequent item.  Here seque starts a thread&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;generating the lazy seq.&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;The body of the let allows the seque thread to get ahead by five seconds&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;before it begins consuming the seq using doseq.  The doseq prints a&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;timestamp and the value from the seq when it becomes available.  The&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;first 11 or so are available almost instantly, until the consuming&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;doseq catches up with the producing iterate, at which point the consumer&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;blocks for 400ms before each item can be printed.&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;;&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;sleep five seconds...&lt;/span&gt;
500 : 0
500 : 1
500 : 2
500 : 3
500 : 4
500 : 5
500 : 6
500 : 7
500 : 8
500 : 9
500 : 10
500 : 11
520 : 12
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;......&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org4004cf5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org4004cf5&quot;&gt;clojure.zip/zippers&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org4004cf5&quot;&gt;
&lt;p&gt;
clojure.zip 是用來處理樹狀結構用函式庫，這篇文章有很好的解釋: &lt;a href=&quot;http://blog.lambdaliu.com/posts-output/2016-04-05-understand-clojure-zipper-with-picture/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;(λx.Liu)Blog=Hacking: Understand clojure.zip with picture&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.zip/zipper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.zip/zipper&lt;/a&gt; 則是用來將資料包裝起來，這樣我們就可以透過 clojure.zip 來處理這些樹狀資料
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;zp&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.zip&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;zipper vector? seq &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;fn&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;_ c&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt; c&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;
                            &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt; 2 3 &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;40 50 60&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; [[[1 2 3] [&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:a&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;] 2 3 [40 50 60]] nil]&lt;/span&gt;


&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.zip&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;down zp&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:l&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[]&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:pnodes&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt; 2 3 &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;40 50 60&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:ppath&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:r&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt; 2 3 &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;40 50 60&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;


&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;-&amp;gt;&lt;/span&gt; zp
    &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.zip&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;down
    first&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;


&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;-&amp;gt;&lt;/span&gt; zp
    &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.zip&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;down
    &lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.zip&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;right&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;
 &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:l&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:pnodes&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;1 2 3&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:a&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:b&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt; 2 3 &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;40 50 60&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:ppath&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt;,
  &lt;span style=&quot;color: #ccaaff;&quot;&gt;:r&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;2 3 &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;40 50 60&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/eea89759/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board 開發記錄: 使用 Yocto 建立系統</title>
      <link>https://coldnew.github.io/c3e8558e/</link>
      <guid>https://coldnew.github.io/c3e8558e/</guid>
      <pubDate>Sun, 11 Sep 2016 13:47:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/zybo-board/zynq_linux_simple/&quot;&gt;zybo board 開發記錄: 執行 Linux 作業系統&lt;/a&gt; 一文中，我們提到了如何自行編譯 u-boot、Linux kernel、busybox 來讓 Zybo Board 可以開機進到 SD 卡上的 Linux 系統。這一次，我們要來談談怎樣使用 &lt;a href=&quot;https://www.yoctoproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Yocto Project&lt;/a&gt; 來建立 Zybo board 的 Linux 系統。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
&lt;a href=&quot;https://www.yoctoproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Yocto Project&lt;/a&gt; 是近年來各大 SoC 商以及開發板商皆參與的 Linux 系統構件工具，透過 Yocto Project 的協助，使用者可以針對自己的需求構件想要的映像檔(image)或是 Root File System，和 Yocto 類似功能的工具則是 &lt;a href=&quot;https://buildroot.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;buildroot&lt;/a&gt; 。
&lt;/p&gt;

&lt;p&gt;
本文將以 &lt;a href=&quot;http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 作為目標開發板，示範如何使用 Yocto 來構件他的系統。
&lt;/p&gt;

&lt;div id=&quot;outline-container-org8beac39&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org8beac39&quot;&gt;預先準備&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org8beac39&quot;&gt;
&lt;p&gt;
根據你使用的 Linux 發行板的不同，你需要安裝一些套件，這邊列出一些發行板的資訊，詳細請參考 &lt;a href=&quot;http://www.yoctoproject.org/docs/2.0/ref-manual/ref-manual.html#intro-requirements&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Yocto Project Reference Manual&lt;/a&gt;
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
Debian/Ubuntu
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@debian ~ $ sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib build-essential chrpath socat
&lt;/pre&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
Fedora
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@fedora ~ $ sudo dnf install gawk make wget tar bzip2 gzip python unzip perl patch diffutils diffstat git cpp gcc gcc-c++ glibc-devel texinfo chrpath ccache perl-Data-Dumper perl-Text-ParseWords perl-Thread-Queue socat findutils which
&lt;/pre&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
Gentoo
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ emerge -v dev-vcs/git dev-util/diffstat app-arch/unzip sys-apps/texinfo app-admin/chrpath media-libs/libsdl2 sys-apps/iproute2 x11-terms/xterm net-nds/rpcbind
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
如果你和我一樣，使用 Gentoo Linux 的話，在 Gentoo Linux 下要確認你使用的是 Python 2.7
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ eselect python set python2.7

eselect python list
Available Python interpreters:
  &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;1&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;   python2.7 *
  &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;2&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;   python3.2
  &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;3&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;   python3.3

python
Python 2.7.5 &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;default, Oct 19 2013, 22:52:27&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgbfd5174&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgbfd5174&quot;&gt;格式化 MicroSD 卡&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgbfd5174&quot;&gt;
&lt;p&gt;
在這次的開發中，我們要設定 MicroSD 卡片成兩個分區，第一個是 &lt;code&gt;fat32&lt;/code&gt; 格式，第二個則使用 &lt;code&gt;ext4&lt;/code&gt; 格式，若不會使用 &lt;code&gt;fdisk&lt;/code&gt; 命令的話，可以透過 &lt;code&gt;gparted&lt;/code&gt; 來進行格式化，以下是我格式化卡片的範例 (8GB 卡片)。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/c3e8558e/format.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org11b8df8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org11b8df8&quot;&gt;下載 Poky&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org11b8df8&quot;&gt;
&lt;p&gt;
在開始用 &lt;a href=&quot;https://www.yoctoproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Yocto Project&lt;/a&gt; 之前，我們需要下載 Poky, Poky 是 Yocto 的構件系統，基本上我們會用到的東西都會在 poky 資料夾內
&lt;/p&gt;

&lt;p&gt;
注意到我們這邊切換到 &lt;code&gt;krogoth&lt;/code&gt; 這個分支，Yocto 裡面不同的分支(branch) 代表了不同版本。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ git clone git://git.yoctoproject.org/poky -b krogoth
&lt;/pre&gt;

&lt;p&gt;
好了後，進入到 poky 資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky $ cd poky
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org12cdb65&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org12cdb65&quot;&gt;下載 meta-xilinx&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org12cdb65&quot;&gt;
&lt;p&gt;
Yocto 對於不同的 SoC 廠商，會有提供不同的 layer 來對特定的開源程式加上合適的 patch，或是添加不同 SoC 廠各自需要的韌體(firmware)，以及各開發板特定的設定。
在 Xilinx 平台上，我們需要下載 &lt;code&gt;meta-xilinx&lt;/code&gt; ，我們需要的 kernel 以及 Zybo board 的設定資訊都在裡面。
&lt;/p&gt;

&lt;p&gt;
這邊一樣切換到 &lt;code&gt;krogoth&lt;/code&gt; 這個分支(branch)
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky $ git clone git://github.com/Xilinx/meta-xilinx -b krogoth
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge69e8e9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge69e8e9&quot;&gt;切換到編譯用目錄&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge69e8e9&quot;&gt;
&lt;p&gt;
接下來，我們將透過 &lt;code&gt;source&lt;/code&gt; 指令暫時修改當前 shell 的環境變數，並切換到 &lt;code&gt;build&lt;/code&gt; 資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky $ source oe-init-build-env build
You had no conf/local.conf file. This configuration file has therefore been
created for you with some default values. You may wish to edit it to, for
example, select a different MACHINE (target hardware). See conf/local.conf
for more information as common configuration options are commented.

You had no conf/bblayers.conf file. This configuration file has therefore been
created for you with some default values. To add additional metadata layers
into your configuration please add entries to conf/bblayers.conf.

The Yocto Project has extensive documentation about OE including a reference
manual which can be found at:
    http://yoctoproject.org/documentation

For more information about OpenEmbedded see their website:
    http://www.openembedded.org/


### Shell environment set up for builds. ###

You can now run &#39;bitbake &amp;lt;target&amp;gt;&#39;

Common targets are:
    core-image-minimal
    core-image-sato
    meta-toolchain
    meta-ide-support

You can also run generated qemu images with a command like &#39;runqemu qemux86&#39;
&lt;/pre&gt;

&lt;p&gt;
預設的目標機器是 &lt;code&gt;qemux86&lt;/code&gt; 因此我們需要修改一下，不過先看一下當前目錄結構
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky/build $ tree  .
. &amp;lt;b&amp;gt;
└── conf &amp;lt;b&amp;gt;
    ├── bblayers.conf
    ├── local.conf
    └── templateconf.cfg

1 directory, 3 files
&lt;/pre&gt;

&lt;p&gt;
我們首先要修改 &lt;code&gt;conf/bblayers.conf&lt;/code&gt; ，在上面添加我們剛剛下載的 &lt;code&gt;meta-xilinx&lt;/code&gt; ，修改完會像這樣
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;POKY_BBLAYERS_CONF_VERSION is increased each time build/conf/bblayers.conf&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;changes incompatibly&lt;/span&gt;
POKY_BBLAYERS_CONF_VERSION = &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;2&quot;&lt;/span&gt;

BBPATH = &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;${TOPDIR}&quot;&lt;/span&gt;
BBFILES ?= &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;&quot;&lt;/span&gt;

BBLAYERS ?= &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot; \&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;  /home/coldnew/poky/meta \&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;  /home/coldnew/poky/meta-poky \&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;  /home/coldnew/poky/meta-yocto-bsp \&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;  /home/coldnew/poky/meta-xilinx \&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;  &quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來，修改 &lt;code&gt;conf/local.conf&lt;/code&gt; ，這份檔案可以用來設定要編譯的目標機器，在這邊，我們將目標機器改成 &lt;code&gt;zybo-linux-bd-zynq7&lt;/code&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;MACHINE ??= &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;zybo-linux-bd-zynq7&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
都改好了後，就可以開始準備編譯了
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5c14375&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org5c14375&quot;&gt;編譯 core-image-minimal&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org5c14375&quot;&gt;
&lt;p&gt;
Yocto 下有許多預設的 image 可以進行編譯，其中最基本的 image 就是 &lt;code&gt;core-image-minimal&lt;/code&gt; 了，裡面只會包含一些幾本的組件而已，我們可以透過他來確認我們編譯出來的 rootfs 是否能用。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky/build $ bitbake core-image-minimal
Parsing recipes: 100% |#######################################################################################################################| Time: 00:01:03
Parsing of 883 .bb files complete (0 cached, 883 parsed). 1313 targets, 71 skipped, 0 masked, 0 errors.
NOTE: Resolving any missing task queue dependencies

Build Configuration:
BB_VERSION        = &quot;1.30.0&quot;
BUILD_SYS         = &quot;x86_64-linux&quot;
NATIVELSBSTRING   = &quot;Gentoo-2.3&quot;
TARGET_SYS        = &quot;arm-poky-linux-gnueabi&quot;
MACHINE           = &quot;zybo-linux-bd-zynq7&quot;
DISTRO            = &quot;poky&quot;
DISTRO_VERSION    = &quot;2.1.1&quot;
TUNE_FEATURES     = &quot;arm armv7a vfp thumb neon       callconvention-hard       cortexa9&quot;
TARGET_FPU        = &quot;hard&quot;
meta
meta-poky
meta-yocto-bsp    = &quot;krogoth:aad7166704021d82ad3a5ec468552f8f10360d41&quot;
meta-xilinx       = &quot;krogoth:dcd1c218f943c3657b138cb05012c90c65f32a35&quot;

NOTE: Fetching uninative binary shim from http://downloads.yoctoproject.org/releases/uninative/1.0.1/x86_64-nativesdk-libc.tar.bz2;sha256sum=acf1e44a0ac2e855e81da6426197d36358bf7b4e88e552ef933128498c8910f8
NOTE: Preparing RunQueue
NOTE: Executing SetScene Tasks
NOTE: Executing RunQueue Tasks
Currently 4 running tasks (78 of 2127):
0: gcc-source-5.3.0-5.3.0-r0 do_unpack (pid 10582)
1: m4-native-1.4.17-r0 do_configure (pid 14097)
2: binutils-cross-arm-2.26-r0 do_unpack (pid 14533)
3: glibc-initial-2.23-r0 do_fetch (pid 15428)
&lt;/pre&gt;

&lt;p&gt;
接下來因為這是第一次編譯，Yocto 需要下載原始碼以及進行編譯，會花很多時間，所以這時候可以去睡個覺或是看看書等它編譯完成，第二次編譯後會因為有快取機制 (cache)，就不須要花這樣多的時間來進行編譯囉~
&lt;/p&gt;

&lt;p&gt;
編譯好了以後，我們切入到 &lt;code&gt;tmp/deploy/images/zybo-linux-bd-zynq7/&lt;/code&gt; 資料夾，裡面有的就是我們需要的檔案
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky/build $ ls tmp/deploy/images/zybo-linux-bd-zynq7/
bitstream                                                                    modules--4.4-xilinx+git0+89cc643aff-r0-zybo-linux-bd-zynq7-20160910030958.tgz
bitstream-+gitAUTOINC+63ca49fe02-r0.bit                                      modules-zybo-linux-bd-zynq7.tgz
boot.bin                                                                     README_-_DO_NOT_DELETE_FILES_IN_THIS_DIRECTORY.txt
boot.bin-zybo-linux-bd-zynq7                                                 u-boot-dtb.img
boot.bin-zybo-linux-bd-zynq7-v2016.03+gitAUTOINC+df61a74e68-r0               u-boot.elf
core-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.cpio            u-boot-zybo-linux-bd-zynq7.elf
core-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.cpio.gz.u-boot  u-boot-zybo-linux-bd-zynq7.img
core-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.manifest        u-boot-zybo-linux-bd-zynq7-v2016.03+gitAUTOINC+df61a74e68-r0.elf
core-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.tar.gz          u-boot-zybo-linux-bd-zynq7-v2016.03+gitAUTOINC+df61a74e68-r0.img
core-image-minimal-zybo-linux-bd-zynq7.cpio                                  uImage
core-image-minimal-zybo-linux-bd-zynq7.cpio.gz.u-boot                        uImage--4.4-xilinx+git0+89cc643aff-r0-zybo-linux-bd-zynq7-20160910030958.bin
core-image-minimal-zybo-linux-bd-zynq7.manifest                              uImage-zybo-linux-bd-zynq7.bin
core-image-minimal-zybo-linux-bd-zynq7.tar.gz                                zybo-linux-bd-zynq7.dtb
download.bit
&lt;/pre&gt;

&lt;p&gt;
我們將以下這些檔案複製到 SD 卡的第一個分區
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
bitstream  boot.bin  u-boot-dtb.img  uImage  zybo-linux-bd-zynq7.dtb
&lt;/pre&gt;

&lt;p&gt;
接下來，在 SD 卡的第一個分割區 (fat32) 建立 &lt;code&gt;uEnv.txt&lt;/code&gt; 檔案，用來告訴 u-boot 開機的方式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;kernel_image&lt;/span&gt;=uImage
&lt;span style=&quot;color: #aaccff;&quot;&gt;devicetree_image&lt;/span&gt;=zybo-linux-bd-zynq7.dtb
&lt;span style=&quot;color: #aaccff;&quot;&gt;bootargs&lt;/span&gt;=&lt;span style=&quot;color: #aaccff;&quot;&gt;root&lt;/span&gt;=/dev/mmcblk0p2 rw rootwait
&lt;span style=&quot;color: #aaccff;&quot;&gt;uenvcmd&lt;/span&gt;=fatload mmc 0 0x3000000 $&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;kernel_image&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt; &amp;amp;&amp;amp; fatload mmc 0 0x2A00000 $&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;devicetree_image&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt; &amp;amp;&amp;amp; bootm 0x3000000 - 0x2A00000
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，將 &lt;code&gt;core-image-minimal-zybo-linux-bd-zynq7.tar.gz&lt;/code&gt; 解壓縮到 SD 卡的第二個分割區
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo /tmp/sdc2 $ sudo tar xvf ~/poky/build/tmp/deploy/images/zybo-linux-bd-zynq7/core-image-minimal-zybo-linux-bd-zynq7.tar.gz
&lt;/pre&gt;

&lt;p&gt;
如果你需要 kernel modules 的話，將 &lt;code&gt;modules-zybo-linux-bd-zynq7.tgz&lt;/code&gt; 解壓到 SD 卡的第二個分割區
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo /tmp/sdc2 $ sudo tar xvf ~/poky/build/tmp/deploy/images/zybo-linux-bd-zynq7/modules-zybo-linux-bd-zynq7.tgz
&lt;/pre&gt;

&lt;p&gt;
至此，我們 SD 卡開機的準備已經完成!!
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgfd155b0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfd155b0&quot;&gt;測試開機與結果&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfd155b0&quot;&gt;
&lt;p&gt;
是時候來測試結果了，要注意到你的 Zybo Board 的 &lt;code&gt;JP5&lt;/code&gt; 要設定成下面這樣，這樣給電時，Zynq 才會讀取 SD 卡上面的 u-boot 並將位元流 (bitstream) 燒錄到 FPGA 中。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/c3e8558e/sdboot.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
插入剛剛建立好的 SD 卡，並提供電源後，我們可以使用可以接收 UART 相關的程式，如 gtkterm、teraterm、screen、emacs 等，啟動它並開啟 &lt;code&gt;/dev/ttyUSB1&lt;/code&gt; 後，設定 baudrate 為 &lt;code&gt;115200&lt;/code&gt; ，就可以看到開機並進入到 rootfs 囉。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/c3e8558e/console.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0f233b5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0f233b5&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0f233b5&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;https://github.com/Xilinx/meta-xilinx/blob/master/README.booting.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Booting meta-xilinx boards&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://www.yoctoproject.org/docs/2.0/ref-manual/ref-manual.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Yocto Project Reference Manual&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/zybo-board/zynq_linux_simple/&quot;&gt;zybo board 開發記錄: 執行 Linux 作業系統&lt;/a&gt; 一文中，我們提到了如何自行編譯 u-boot、Linux kernel、busybox 來讓 Zybo Board 可以開機進到 SD 卡上的 Linux 系統。這一次，我們要來談談怎樣使用 &lt;a href=&quot;https://www.yoctoproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Yocto Project&lt;/a&gt; 來建立 Zybo board 的 Linux 系統。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
&lt;a href=&quot;https://www.yoctoproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Yocto Project&lt;/a&gt; 是近年來各大 SoC 商以及開發板商皆參與的 Linux 系統構件工具，透過 Yocto Project 的協助，使用者可以針對自己的需求構件想要的映像檔(image)或是 Root File System，和 Yocto 類似功能的工具則是 &lt;a href=&quot;https://buildroot.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;buildroot&lt;/a&gt; 。
&lt;/p&gt;

&lt;p&gt;
本文將以 &lt;a href=&quot;http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 作為目標開發板，示範如何使用 Yocto 來構件他的系統。
&lt;/p&gt;

&lt;div id=&quot;outline-container-org8beac39&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org8beac39&quot;&gt;預先準備&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org8beac39&quot;&gt;
&lt;p&gt;
根據你使用的 Linux 發行板的不同，你需要安裝一些套件，這邊列出一些發行板的資訊，詳細請參考 &lt;a href=&quot;http://www.yoctoproject.org/docs/2.0/ref-manual/ref-manual.html#intro-requirements&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Yocto Project Reference Manual&lt;/a&gt;
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
Debian/Ubuntu
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@debian ~ $ sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib build-essential chrpath socat
&lt;/pre&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
Fedora
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@fedora ~ $ sudo dnf install gawk make wget tar bzip2 gzip python unzip perl patch diffutils diffstat git cpp gcc gcc-c++ glibc-devel texinfo chrpath ccache perl-Data-Dumper perl-Text-ParseWords perl-Thread-Queue socat findutils which
&lt;/pre&gt;
&lt;/div&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
Gentoo
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ emerge -v dev-vcs/git dev-util/diffstat app-arch/unzip sys-apps/texinfo app-admin/chrpath media-libs/libsdl2 sys-apps/iproute2 x11-terms/xterm net-nds/rpcbind
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
如果你和我一樣，使用 Gentoo Linux 的話，在 Gentoo Linux 下要確認你使用的是 Python 2.7
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ eselect python set python2.7

eselect python list
Available Python interpreters:
  &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;1&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;   python2.7 *
  &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;2&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;   python3.2
  &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;3&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;   python3.3

python
Python 2.7.5 &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;default, Oct 19 2013, 22:52:27&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgbfd5174&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgbfd5174&quot;&gt;格式化 MicroSD 卡&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgbfd5174&quot;&gt;
&lt;p&gt;
在這次的開發中，我們要設定 MicroSD 卡片成兩個分區，第一個是 &lt;code&gt;fat32&lt;/code&gt; 格式，第二個則使用 &lt;code&gt;ext4&lt;/code&gt; 格式，若不會使用 &lt;code&gt;fdisk&lt;/code&gt; 命令的話，可以透過 &lt;code&gt;gparted&lt;/code&gt; 來進行格式化，以下是我格式化卡片的範例 (8GB 卡片)。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/c3e8558e/format.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org11b8df8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org11b8df8&quot;&gt;下載 Poky&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org11b8df8&quot;&gt;
&lt;p&gt;
在開始用 &lt;a href=&quot;https://www.yoctoproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Yocto Project&lt;/a&gt; 之前，我們需要下載 Poky, Poky 是 Yocto 的構件系統，基本上我們會用到的東西都會在 poky 資料夾內
&lt;/p&gt;

&lt;p&gt;
注意到我們這邊切換到 &lt;code&gt;krogoth&lt;/code&gt; 這個分支，Yocto 裡面不同的分支(branch) 代表了不同版本。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ git clone git://git.yoctoproject.org/poky -b krogoth
&lt;/pre&gt;

&lt;p&gt;
好了後，進入到 poky 資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky $ cd poky
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org12cdb65&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org12cdb65&quot;&gt;下載 meta-xilinx&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org12cdb65&quot;&gt;
&lt;p&gt;
Yocto 對於不同的 SoC 廠商，會有提供不同的 layer 來對特定的開源程式加上合適的 patch，或是添加不同 SoC 廠各自需要的韌體(firmware)，以及各開發板特定的設定。
在 Xilinx 平台上，我們需要下載 &lt;code&gt;meta-xilinx&lt;/code&gt; ，我們需要的 kernel 以及 Zybo board 的設定資訊都在裡面。
&lt;/p&gt;

&lt;p&gt;
這邊一樣切換到 &lt;code&gt;krogoth&lt;/code&gt; 這個分支(branch)
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky $ git clone git://github.com/Xilinx/meta-xilinx -b krogoth
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge69e8e9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge69e8e9&quot;&gt;切換到編譯用目錄&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge69e8e9&quot;&gt;
&lt;p&gt;
接下來，我們將透過 &lt;code&gt;source&lt;/code&gt; 指令暫時修改當前 shell 的環境變數，並切換到 &lt;code&gt;build&lt;/code&gt; 資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky $ source oe-init-build-env build
You had no conf/local.conf file. This configuration file has therefore been
created for you with some default values. You may wish to edit it to, for
example, select a different MACHINE (target hardware). See conf/local.conf
for more information as common configuration options are commented.

You had no conf/bblayers.conf file. This configuration file has therefore been
created for you with some default values. To add additional metadata layers
into your configuration please add entries to conf/bblayers.conf.

The Yocto Project has extensive documentation about OE including a reference
manual which can be found at:
    http://yoctoproject.org/documentation

For more information about OpenEmbedded see their website:
    http://www.openembedded.org/


### Shell environment set up for builds. ###

You can now run &#39;bitbake &amp;lt;target&amp;gt;&#39;

Common targets are:
    core-image-minimal
    core-image-sato
    meta-toolchain
    meta-ide-support

You can also run generated qemu images with a command like &#39;runqemu qemux86&#39;
&lt;/pre&gt;

&lt;p&gt;
預設的目標機器是 &lt;code&gt;qemux86&lt;/code&gt; 因此我們需要修改一下，不過先看一下當前目錄結構
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky/build $ tree  .
. &amp;lt;b&amp;gt;
└── conf &amp;lt;b&amp;gt;
    ├── bblayers.conf
    ├── local.conf
    └── templateconf.cfg

1 directory, 3 files
&lt;/pre&gt;

&lt;p&gt;
我們首先要修改 &lt;code&gt;conf/bblayers.conf&lt;/code&gt; ，在上面添加我們剛剛下載的 &lt;code&gt;meta-xilinx&lt;/code&gt; ，修改完會像這樣
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;POKY_BBLAYERS_CONF_VERSION is increased each time build/conf/bblayers.conf&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;changes incompatibly&lt;/span&gt;
POKY_BBLAYERS_CONF_VERSION = &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;2&quot;&lt;/span&gt;

BBPATH = &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;${TOPDIR}&quot;&lt;/span&gt;
BBFILES ?= &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;&quot;&lt;/span&gt;

BBLAYERS ?= &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot; \&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;  /home/coldnew/poky/meta \&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;  /home/coldnew/poky/meta-poky \&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;  /home/coldnew/poky/meta-yocto-bsp \&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;  /home/coldnew/poky/meta-xilinx \&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;  &quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來，修改 &lt;code&gt;conf/local.conf&lt;/code&gt; ，這份檔案可以用來設定要編譯的目標機器，在這邊，我們將目標機器改成 &lt;code&gt;zybo-linux-bd-zynq7&lt;/code&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;MACHINE ??= &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;zybo-linux-bd-zynq7&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
都改好了後，就可以開始準備編譯了
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5c14375&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org5c14375&quot;&gt;編譯 core-image-minimal&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org5c14375&quot;&gt;
&lt;p&gt;
Yocto 下有許多預設的 image 可以進行編譯，其中最基本的 image 就是 &lt;code&gt;core-image-minimal&lt;/code&gt; 了，裡面只會包含一些幾本的組件而已，我們可以透過他來確認我們編譯出來的 rootfs 是否能用。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky/build $ bitbake core-image-minimal
Parsing recipes: 100% |#######################################################################################################################| Time: 00:01:03
Parsing of 883 .bb files complete (0 cached, 883 parsed). 1313 targets, 71 skipped, 0 masked, 0 errors.
NOTE: Resolving any missing task queue dependencies

Build Configuration:
BB_VERSION        = &quot;1.30.0&quot;
BUILD_SYS         = &quot;x86_64-linux&quot;
NATIVELSBSTRING   = &quot;Gentoo-2.3&quot;
TARGET_SYS        = &quot;arm-poky-linux-gnueabi&quot;
MACHINE           = &quot;zybo-linux-bd-zynq7&quot;
DISTRO            = &quot;poky&quot;
DISTRO_VERSION    = &quot;2.1.1&quot;
TUNE_FEATURES     = &quot;arm armv7a vfp thumb neon       callconvention-hard       cortexa9&quot;
TARGET_FPU        = &quot;hard&quot;
meta
meta-poky
meta-yocto-bsp    = &quot;krogoth:aad7166704021d82ad3a5ec468552f8f10360d41&quot;
meta-xilinx       = &quot;krogoth:dcd1c218f943c3657b138cb05012c90c65f32a35&quot;

NOTE: Fetching uninative binary shim from http://downloads.yoctoproject.org/releases/uninative/1.0.1/x86_64-nativesdk-libc.tar.bz2;sha256sum=acf1e44a0ac2e855e81da6426197d36358bf7b4e88e552ef933128498c8910f8
NOTE: Preparing RunQueue
NOTE: Executing SetScene Tasks
NOTE: Executing RunQueue Tasks
Currently 4 running tasks (78 of 2127):
0: gcc-source-5.3.0-5.3.0-r0 do_unpack (pid 10582)
1: m4-native-1.4.17-r0 do_configure (pid 14097)
2: binutils-cross-arm-2.26-r0 do_unpack (pid 14533)
3: glibc-initial-2.23-r0 do_fetch (pid 15428)
&lt;/pre&gt;

&lt;p&gt;
接下來因為這是第一次編譯，Yocto 需要下載原始碼以及進行編譯，會花很多時間，所以這時候可以去睡個覺或是看看書等它編譯完成，第二次編譯後會因為有快取機制 (cache)，就不須要花這樣多的時間來進行編譯囉~
&lt;/p&gt;

&lt;p&gt;
編譯好了以後，我們切入到 &lt;code&gt;tmp/deploy/images/zybo-linux-bd-zynq7/&lt;/code&gt; 資料夾，裡面有的就是我們需要的檔案
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/poky/build $ ls tmp/deploy/images/zybo-linux-bd-zynq7/
bitstream                                                                    modules--4.4-xilinx+git0+89cc643aff-r0-zybo-linux-bd-zynq7-20160910030958.tgz
bitstream-+gitAUTOINC+63ca49fe02-r0.bit                                      modules-zybo-linux-bd-zynq7.tgz
boot.bin                                                                     README_-_DO_NOT_DELETE_FILES_IN_THIS_DIRECTORY.txt
boot.bin-zybo-linux-bd-zynq7                                                 u-boot-dtb.img
boot.bin-zybo-linux-bd-zynq7-v2016.03+gitAUTOINC+df61a74e68-r0               u-boot.elf
core-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.cpio            u-boot-zybo-linux-bd-zynq7.elf
core-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.cpio.gz.u-boot  u-boot-zybo-linux-bd-zynq7.img
core-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.manifest        u-boot-zybo-linux-bd-zynq7-v2016.03+gitAUTOINC+df61a74e68-r0.elf
core-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.tar.gz          u-boot-zybo-linux-bd-zynq7-v2016.03+gitAUTOINC+df61a74e68-r0.img
core-image-minimal-zybo-linux-bd-zynq7.cpio                                  uImage
core-image-minimal-zybo-linux-bd-zynq7.cpio.gz.u-boot                        uImage--4.4-xilinx+git0+89cc643aff-r0-zybo-linux-bd-zynq7-20160910030958.bin
core-image-minimal-zybo-linux-bd-zynq7.manifest                              uImage-zybo-linux-bd-zynq7.bin
core-image-minimal-zybo-linux-bd-zynq7.tar.gz                                zybo-linux-bd-zynq7.dtb
download.bit
&lt;/pre&gt;

&lt;p&gt;
我們將以下這些檔案複製到 SD 卡的第一個分區
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
bitstream  boot.bin  u-boot-dtb.img  uImage  zybo-linux-bd-zynq7.dtb
&lt;/pre&gt;

&lt;p&gt;
接下來，在 SD 卡的第一個分割區 (fat32) 建立 &lt;code&gt;uEnv.txt&lt;/code&gt; 檔案，用來告訴 u-boot 開機的方式
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;kernel_image&lt;/span&gt;=uImage
&lt;span style=&quot;color: #aaccff;&quot;&gt;devicetree_image&lt;/span&gt;=zybo-linux-bd-zynq7.dtb
&lt;span style=&quot;color: #aaccff;&quot;&gt;bootargs&lt;/span&gt;=&lt;span style=&quot;color: #aaccff;&quot;&gt;root&lt;/span&gt;=/dev/mmcblk0p2 rw rootwait
&lt;span style=&quot;color: #aaccff;&quot;&gt;uenvcmd&lt;/span&gt;=fatload mmc 0 0x3000000 $&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;kernel_image&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt; &amp;amp;&amp;amp; fatload mmc 0 0x2A00000 $&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;devicetree_image&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt; &amp;amp;&amp;amp; bootm 0x3000000 - 0x2A00000
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，將 &lt;code&gt;core-image-minimal-zybo-linux-bd-zynq7.tar.gz&lt;/code&gt; 解壓縮到 SD 卡的第二個分割區
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo /tmp/sdc2 $ sudo tar xvf ~/poky/build/tmp/deploy/images/zybo-linux-bd-zynq7/core-image-minimal-zybo-linux-bd-zynq7.tar.gz
&lt;/pre&gt;

&lt;p&gt;
如果你需要 kernel modules 的話，將 &lt;code&gt;modules-zybo-linux-bd-zynq7.tgz&lt;/code&gt; 解壓到 SD 卡的第二個分割區
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo /tmp/sdc2 $ sudo tar xvf ~/poky/build/tmp/deploy/images/zybo-linux-bd-zynq7/modules-zybo-linux-bd-zynq7.tgz
&lt;/pre&gt;

&lt;p&gt;
至此，我們 SD 卡開機的準備已經完成!!
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgfd155b0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfd155b0&quot;&gt;測試開機與結果&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfd155b0&quot;&gt;
&lt;p&gt;
是時候來測試結果了，要注意到你的 Zybo Board 的 &lt;code&gt;JP5&lt;/code&gt; 要設定成下面這樣，這樣給電時，Zynq 才會讀取 SD 卡上面的 u-boot 並將位元流 (bitstream) 燒錄到 FPGA 中。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/c3e8558e/sdboot.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
插入剛剛建立好的 SD 卡，並提供電源後，我們可以使用可以接收 UART 相關的程式，如 gtkterm、teraterm、screen、emacs 等，啟動它並開啟 &lt;code&gt;/dev/ttyUSB1&lt;/code&gt; 後，設定 baudrate 為 &lt;code&gt;115200&lt;/code&gt; ，就可以看到開機並進入到 rootfs 囉。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/c3e8558e/console.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0f233b5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0f233b5&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0f233b5&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;https://github.com/Xilinx/meta-xilinx/blob/master/README.booting.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Booting meta-xilinx boards&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://www.yoctoproject.org/docs/2.0/ref-manual/ref-manual.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Yocto Project Reference Manual&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/c3e8558e/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board 開發記錄: 執行 Linux 作業系統</title>
      <link>https://coldnew.github.io/d9dfdd56/</link>
      <guid>https://coldnew.github.io/d9dfdd56/</guid>
      <pubDate>Sun, 17 Jul 2016 11:45:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/zybo-board/zynq_led_flash/&quot;&gt;zybo board 開發記錄: Zynq 與 LED 閃爍控制&lt;/a&gt; 一文中我們談到了如何透過 C 語言撰寫獨立的程式，讓它控制 Zynq 的處理器系統 (Processing System, PS) 去閃爍 LED 的亮暗。既然 Zynq 的處理器系統 (Processing System, PS) 使用的是 ARM Cortex-A9 的處理器，那當然也可以讓我們跑 Linux 在 Zybo Board 上。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
本文將簡述如何自行編譯 u-boot 以及 Linux Kernel，並搭配 Busybox 製作簡單的 RootFS 執行於 Zybo Board 上。
&lt;/p&gt;

&lt;div id=&quot;outline-container-orgbaab6be&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgbaab6be&quot;&gt;開發目標&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgbaab6be&quot;&gt;
&lt;p&gt;
在這次的開發中，我們要編譯 u-boot、Linux，並使用 Busybox 製作簡單的 Rootfs 後，透過製作 SD 卡來讓 Zybo Board 透過 SD 卡開機。
&lt;/p&gt;

&lt;p&gt;
要注意到的是，由於我們要透過 SD 卡開機進入到 Linux 系統，因此我們要透過 &lt;code&gt;JP5&lt;/code&gt; 去更改開機模式。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/zybo_config_pins.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6bfcd8a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org6bfcd8a&quot;&gt;了解開機流程&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org6bfcd8a&quot;&gt;
&lt;p&gt;
既然我們要讓 Zybo board 執行 Linux 系統，就要先來了解一下開機流程，才知道我們大概需要準備哪些東西。從  &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_1/ug1165-zynq-embedded-design-tutorial.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC: Embedded Design Tutorial - A Hands-On Guide to Effective Embedded System Design (UG1165)&lt;/a&gt; 可以看到 Zynq-7000 執行 Linux 系統的開機流程圖。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/bootp.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
也就是說，當開始提供電源給 Zynq 處理器系統 (Processing System, PS) 並完成重置(reset) 後，Zynq 內建的 Boot ROM 會去載入 &lt;code&gt;第一階段開機程式 (First Stage Boot Loader, FSBL)&lt;/code&gt; ，接著載入 &lt;code&gt;位元流 (bitstream)&lt;/code&gt; 去初始化整個 &lt;code&gt;可程式邏輯(Programmable Logic, PL)&lt;/code&gt; 。 完成後，接下來就是透過 U-Boot 去載入 Linux Kernel、Device Tree 以及 Root File System。
&lt;/p&gt;

&lt;p&gt;
了解了這個，我們就知道我們大概要準備哪些東西了。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6b9243f&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org6b9243f&quot;&gt;設定好環境&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org6b9243f&quot;&gt;
&lt;p&gt;
在安裝玩 Vivado 與 Xilinx SDK 後，實際上包含 Zynq 在用的 ARM toolchain 亦同時被安裝到系統中，我們只要使用 &lt;code&gt;source&lt;/code&gt; 命令即可讓當前的環境知道 xilinx-arm toolchain 的路徑。這邊以 Viavdo 2016.2 作為範例。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ source /opt/Xilinx/Vivado/2016.2/settings64.sh
&lt;/pre&gt;

&lt;p&gt;
這樣就可以獲得 arm-xilinx-* toolchain 的命令，實際上有哪些呢? 輸入個 arm-xilinx- 按下 TAB 看看
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ arm-xilinx-
arm-xilinx-eabi-addr2line            arm-xilinx-eabi-gcc-4.9.2            arm-xilinx-eabi-objcopy
arm-xilinx-linux-gnueabi-ar          arm-xilinx-linux-gnueabi-gcc-ar      arm-xilinx-linux-gnueabi-objdump
arm-xilinx-eabi-ar                   arm-xilinx-eabi-gcc-ar               arm-xilinx-eabi-objdump
arm-xilinx-linux-gnueabi-as          arm-xilinx-linux-gnueabi-gcc-nm      arm-xilinx-linux-gnueabi-ranlib
arm-xilinx-eabi-as                   arm-xilinx-eabi-gcc-nm               arm-xilinx-eabi-ranlib
arm-xilinx-linux-gnueabi-c++         arm-xilinx-linux-gnueabi-gcc-ranlib  arm-xilinx-linux-gnueabi-readelf
arm-xilinx-eabi-c++                  arm-xilinx-eabi-gcc-ranlib           arm-xilinx-eabi-readelf
arm-xilinx-linux-gnueabi-c++filt     arm-xilinx-linux-gnueabi-gcov        arm-xilinx-linux-gnueabi-size
arm-xilinx-eabi-c++filt              arm-xilinx-eabi-gcov                 arm-xilinx-eabi-size
arm-xilinx-linux-gnueabi-cpp         arm-xilinx-linux-gnueabi-gdb         arm-xilinx-linux-gnueabi-sprite
arm-xilinx-eabi-cpp                  arm-xilinx-eabi-gdb                  arm-xilinx-eabi-sprite
arm-xilinx-linux-gnueabi-elfedit     arm-xilinx-linux-gnueabi-gprof       arm-xilinx-linux-gnueabi-strings
arm-xilinx-eabi-elfedit              arm-xilinx-eabi-gprof                arm-xilinx-eabi-strings
arm-xilinx-linux-gnueabi-g++         arm-xilinx-linux-gnueabi-ld          arm-xilinx-linux-gnueabi-strip
arm-xilinx-eabi-g++                  arm-xilinx-eabi-ld                   arm-xilinx-eabi-strip
arm-xilinx-linux-gnueabi-gcc         arm-xilinx-linux-gnueabi-nm
arm-xilinx-eabi-gcc                  arm-xilinx-eabi-nm                   arm-xilinx-linux-gnueabi-addr2line
arm-xilinx-linux-gnueabi-gcc-4.9.2   arm-xilinx-linux-gnueabi-objcopy
&lt;/pre&gt;

&lt;p&gt;
如果你系統上已經有其他的 ARM toolchain 的話，可以考慮跳過這一步驟，接下來要格式化 Micro SD 卡。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgcb3524e&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgcb3524e&quot;&gt;格式化 MicroSD 卡&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgcb3524e&quot;&gt;
&lt;p&gt;
在這次的開發中，我們要設定 MicroSD 卡片成兩個分區，第一個是 &lt;code&gt;fat32&lt;/code&gt; 格式，第二個則使用 &lt;code&gt;ext4&lt;/code&gt; 格式，若不會使用 &lt;code&gt;fdisk&lt;/code&gt; 命令的話，可以透過 &lt;code&gt;gparted&lt;/code&gt; 來進行格式化，以下是我格式化卡片的範例 (8GB 卡片)。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/format.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
(實際上在本文的範例中，只會用到第一個分區，第二個分區是為了往後文章要開機到大一點的 rootfs 準備的。)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org766f8f2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org766f8f2&quot;&gt;編譯 u-boot&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org766f8f2&quot;&gt;
&lt;p&gt;
我們首先去 &lt;a href=&quot;https://github.com/DigilentInc/u-boot-Digilent-Dev&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 下載 DigilentInc 加入 zybo board 後的 u-boot 版本，要注意這邊要選擇 &lt;code&gt;master-next&lt;/code&gt; 分支。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;git clone https://github.com/DigilentInc/u-boot-Digilent-Dev.git -b master-next
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
完成後進入到該資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ cd u-boot-Digilent-Dev
&lt;/pre&gt;

&lt;p&gt;
編譯 u-boot，記得指派編譯目標為 &lt;code&gt;zynq_zybo_config&lt;/code&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/u-boot-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make zynq_zybo_config
coldnew@gentoo ~/u-boot-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
編譯完成後，注意一下 &lt;code&gt;u-boot&lt;/code&gt; 這個檔案，他就是我們等等要用到的 u-boot 執行檔，不過由於 Xilinx Tool 要找有 .elf 副檔名的檔案，因此我們把它複製成 &lt;code&gt;u-boot.elf&lt;/code&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/u-boot-Digilent-Dev $ cp u-boot u-boot.elf
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0fffd38&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0fffd38&quot;&gt;編譯 Linux kernel&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0fffd38&quot;&gt;
&lt;p&gt;
編譯好 u-boot 後，接下來就是編譯 Linux Kernel 了，我們一樣選擇 DigilentInc 加入 zybo board 後的 Linux Kernel 版本，記得要選 &lt;code&gt;master-next&lt;/code&gt; 分支。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;git clone https://github.com/DigilentInc/Linux-Digilent-Dev.git -b master-next
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接著，當然就是編譯了，不過在這之前請先確定你有裝 &lt;code&gt;u-boot-tools&lt;/code&gt; 這套件，我們需要裡面的 mkimage 指令，Gentoo Linux 可以直接用以下命令來安裝。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ sudo emerge dev-embedded/u-boot-tools
&lt;/pre&gt;

&lt;p&gt;
完成後進入 Linux Kernel 資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ cd Linux-Digilent-Dev
&lt;/pre&gt;

&lt;p&gt;
編譯我們需要的 &lt;code&gt;uImage&lt;/code&gt; 文件，記得要指定 config 為 &lt;code&gt;xilinx_zynq_defconfig&lt;/code&gt; 以及設定 &lt;code&gt;UIMAGE_LOADADDR&lt;/code&gt; 為 &lt;code&gt;0x8000&lt;/code&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/Linux-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make xilinx_zynq_defconfig
coldnew@gentoo ~/Linux-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make
coldnew@gentoo ~/Linux-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make &lt;span style=&quot;color: #aaccff;&quot;&gt;UIMAGE_LOADADDR&lt;/span&gt;=0x8000 uImage
coldnew@gentoo ~/Linux-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make zynq-zybo.dtb
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
編譯完後，我們會需要 &lt;code&gt;arch/arm/boot/uImage&lt;/code&gt; 以及 &lt;code&gt;arch/arm/boot/dts/zynq-zybo.dtb&lt;/code&gt; 這兩個檔案，後者就是 device tree 編譯出來的資料檔。
&lt;/p&gt;

&lt;p&gt;
由於放入到 SD 卡上的 device tree 檔案名稱為 &lt;code&gt;devicetree.dtb&lt;/code&gt; ，因此這邊將 &lt;code&gt;zynq-zybo.dtb&lt;/code&gt; 改一下名。
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/Linux-Digilent-Dev $ cp arch/arm/boot/dts/zynq-zybo.dtb devicetree.dtb
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
如果你想手動修改 Device Tree 並再重新編譯的話，也可以這樣去產生我們要的 &lt;code&gt;devicetree.dtb&lt;/code&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/Linux-Digilent-Dev $ ./scripts/dtc/dtc -I dts -O dtb -o devicetree.dtb arch/arm/boot/dts/zynq-zybo.dts
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf924950&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgf924950&quot;&gt;編譯 BusyBox&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgf924950&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://www.busybox.net/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Busybox&lt;/a&gt; 是一個非常有趣的程式，舉凡我們在 Linux 下最常用的命令如 ls、cd 等到 sed、vi 他都具有相對應的簡單實現，此外，這些命令實際上都只是一個軟連結 (symlink) 連結到名為 busybox 的執行檔，也就是說，如果我們將 busybox 進行靜態編譯 (static link)，則製作出來的系統整體大小大約為 2 MB (kernel) + 1.4 MB (busybox)，而這個系統卻又可以具有許多 UN*X 下的常用命令，也因此 busybox 很常用於空間有限的系統。
&lt;/p&gt;

&lt;p&gt;
我們在這個開發過程中，由於只是驗證執行 Linux 系統的功能，因此選用 Busybox 來作為我們的 rootfs。
&lt;/p&gt;

&lt;p&gt;
首先先下載 Busybox 的原始碼，這裡選用 &lt;code&gt;1_25_stable&lt;/code&gt; 這個穩定分支
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;git clone git://git.busybox.net/busybox -b 1_25_stable
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
進行我們自己的設定
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make menuconfig
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
在進行設定時有以下幾點要確實注意，我們要將 busybox 編譯為靜態連結，並且增加 &lt;code&gt;init&lt;/code&gt; 功能，主要設定如下:
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
Busybox Settings  ---&amp;gt;
        Build Options  ---&amp;gt;
               [*] Build BusyBox as a static binary (no shared libs)

Init Utilities  ---&amp;gt;
        [*] init

Login/Password Management Utilities  ---&amp;gt;
        [*] getty

Shells  ---&amp;gt;
        [*] ash
&lt;/pre&gt;

&lt;p&gt;
設定完成後開始進行編譯
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
編譯完成後透過 &lt;code&gt;make install&lt;/code&gt; 命令，會將編譯出來的 busybox 與軟連結(symlink)產生在 &lt;code&gt;_install&lt;/code&gt; 資料夾內
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@Rosia ~/busybox $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make install
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
建立一些缺少的資料夾 (/dev、/sys &amp;#x2026;etc)
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox $ cd _install &amp;amp;&amp;amp; mkdir -p proc sys dev etc/init.d root
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
建立 &lt;code&gt;etc/init.d/rcS&lt;/code&gt; 作為啟動腳本，並添加以下內容
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox/_install $ vim etc/init.d/rcS

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;!/bin/sh&lt;/span&gt;
mount -t proc none /proc
mount -t sysfs none /sys
/sbin/mdev -s
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
將 &lt;code&gt;etc/init.d/rcS&lt;/code&gt; 加入可執行權限
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/busybox/_install $ chmod +x etc/init.d/rcS
&lt;/pre&gt;

&lt;p&gt;
建立 &lt;code&gt;etc/inittab&lt;/code&gt; ，這會讓我們可以透過 UART 登入 zybo board
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox/_install $ vim etc/inittab

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;!/bin/sh&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Init script&lt;/span&gt;
::sysinit:/etc/init.d/rcS
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Start shell on the serial ports&lt;/span&gt;
::respawn:/sbin/getty -L ttyPS0 115200 vt100
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;What to do when restarting the init process&lt;/span&gt;
::restart:/sbin/init
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;What to do before rebooting&lt;/span&gt;
::shutdown:/bin/umount -a -r
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
設定預設的 &lt;code&gt;/etc/passwd&lt;/code&gt; 檔案，我們要讓 root 用戶登入時不用輸入密碼
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox/_install $ vim etc/passwd

root::0:0:root:/root:/bin/sh
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
建立 &lt;code&gt;/init&lt;/code&gt; 並軟連結到 &lt;code&gt;/sbin/init&lt;/code&gt; ，避免 Linux Kernel 開機時找不到 rootfs 的 init。
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox/_install $ ln -s /sbin/init init
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來，由於這次我們只是要開機到 ramdisk 上的 rootfs, 因此將 busybox 做出的 rootfs 打包成 cpio 格式。
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/busybox/_install $ find . | sudo cpio -H newc -o | gzip -9 &amp;gt; ../uramdisk.cpio.gz
&lt;/pre&gt;

&lt;p&gt;
再透過 &lt;code&gt;mkimage&lt;/code&gt; 將這個 &lt;code&gt;uramdisk.cpio.gz&lt;/code&gt; 檔案轉成 uboot 用的 &lt;code&gt;uramdisk.image.gz&lt;/code&gt;
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/busybox/_install $  mkimage -A arm -T ramdisk -C gzip -d ../uramdisk.cpio.gz ../uramdisk.image.gz
Image Name:
Created:      Sun Jul 17 19:02:08 2016
Image Type:   ARM Linux RAMDisk Image (gzip compressed)
Data Size:    1042106 Bytes = 1017.68 kB = 0.99 MB
Load Address: 00000000
Entry Point:  00000000
&lt;/pre&gt;

&lt;p&gt;
在這邊的這個 &lt;code&gt;uramdisk.image.gz&lt;/code&gt; 就是我們開機會進入到的 rootfs，也是我們等等要放到 SD 卡第一個磁區的檔案。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd939aaf&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgd939aaf&quot;&gt;編譯位元流 (bitstream)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgd939aaf&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;https://coldnew.github.io/zybo-board/linux_bd/&quot;&gt;zybo board 開發記錄: 升級 Digilent 提供的設計檔&lt;/a&gt; 一文中，我們提到了怎樣升級 &lt;a href=&quot;http://store.digilentinc.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilent&lt;/a&gt; 提供的預先定義好接腳的設定檔 (zybo_base_system) ，這次的專案，我們就直接用這個設定檔案來進行 Linux 開機的動作。
&lt;/p&gt;

&lt;p&gt;
首先你必須根據該篇文章，將你的 Zybo board 設定檔案升級到你用的 Vivado 版本，完成後我們重新建立一個乾淨的專案。
&lt;/p&gt;

&lt;p&gt;
先來把先前生成的舊專案清掉:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ sh cleanup.sh
&lt;/pre&gt;

&lt;p&gt;
接下來用 Vivado 2016.2 重新生出新的專案 ~
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ /opt/Xilinx/Vivado/2016.2/bin/vivado -mode batch -source create_project.tcl
&lt;/pre&gt;

&lt;p&gt;
完成後，會看到 &lt;code&gt;ZYBO/Projects/linux_bd/proj&lt;/code&gt; 目錄變成這樣:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ tree -L 1
. &amp;lt;b&amp;gt;
├── cleanup.cmd
├── cleanup.sh
├── create_project.tcl
├── ip_upgrade.log &amp;lt;g&amp;gt;
├── linux_bd.cache &amp;lt;b&amp;gt;
├── linux_bd.hw &amp;lt;b&amp;gt;
├── linux_bd.ip_user_files &amp;lt;b&amp;gt;
├── linux_bd.sim &amp;lt;b&amp;gt;
├── linux_bd.srcs &amp;lt;b&amp;gt;
├── linux_bd.xpr
├── vivado.jou
└── vivado.log &amp;lt;g&amp;gt;

5 directories, 7 files
&lt;/pre&gt;

&lt;p&gt;
我們使用 Vivado 打開 &lt;code&gt;linux_bd.xpr&lt;/code&gt; 這個專案。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/oprj.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你有興趣看他生出來的 Block Design 是怎樣的，也可以切到 Block Design 那頁看看
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/linux_bd.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
我們直接點選 &lt;code&gt;Program and Debug -&amp;gt; Generate Bitstream&lt;/code&gt; 產生我們要的位元流 (bitstream)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ge.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge8faa53&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge8faa53&quot;&gt;建立 FSBL&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge8faa53&quot;&gt;
&lt;p&gt;
到此，我們除了 &lt;code&gt;第一階段開機程式 (First Stage Boot Loader, FSBL)&lt;/code&gt; 外，其他的程式都已經編譯出執行檔了，讓我們來處理 FSBL 吧。
&lt;/p&gt;

&lt;p&gt;
首先點選 &lt;code&gt;File -&amp;gt; Export -&amp;gt; Export hardware&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/e1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
記得要勾選 &lt;code&gt;Include bitstream&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/e2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
完成後，執行 Xilinx SDK
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/e3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
透過 &lt;code&gt;File -&amp;gt; New -&amp;gt; Application Project&lt;/code&gt; 去建立我們的新專案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
設定這個專案為 &lt;code&gt;standalone&lt;/code&gt; 的專案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇樣板為 &lt;code&gt;Zynq FSBL&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇我們剛剛建立的 &lt;code&gt;FSBL&lt;/code&gt; 專案，按下右鍵選擇 &lt;code&gt;Build Project&lt;/code&gt; 進行編譯
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0d5bb38&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0d5bb38&quot;&gt;建立 BOOT.bin&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0d5bb38&quot;&gt;
&lt;p&gt;
編譯完 FSBL 後，選擇 &lt;code&gt;Xilinx Tools -&amp;gt; Create Boot Image&lt;/code&gt; 去建立我們的 BOOT.bin
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在 &lt;code&gt;Boot image partitions&lt;/code&gt; 那邊，加入我們的 bitstream 以及 u-boot 檔案，記得要按照順序加入。
&lt;/p&gt;

&lt;p&gt;
完成後，點選 &lt;code&gt;Create Image&lt;/code&gt; 就會產生我們要的 &lt;code&gt;BOOT.bin&lt;/code&gt; 到指定路徑。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在這個步驟中，如果你是指令控的話，我們也可以在產生 FSBL.elf 後，建立一個名為 &lt;code&gt;boot.bif&lt;/code&gt; 的檔案，其內容如下
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;arch = zynq; split = false; format = BIN&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;the_ROM_image&lt;/span&gt;:
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;bootloader&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;/path/to/fsbl-build/fsbl.elf
    /path/to/linux_bd/linux_bd.sdk/linux_bd_wrapper.bit
    /path/to/u-boot/u-boot.elf
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來透過 &lt;code&gt;bootgen&lt;/code&gt; 這個命令去產生 &lt;code&gt;BOOT.bin&lt;/code&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ bootgen -image boot.bif -w on -o i BOOT.bin
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgfd5152e&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfd5152e&quot;&gt;將檔案複製到 Micro SD 卡&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfd5152e&quot;&gt;
&lt;p&gt;
好了，我們已經完成了所有準備動作，是時候將檔案放到 Micro SD 卡並看看結果了，在本文中我們會將以下幾個檔案放到 &lt;code&gt;第一個分割區 (fat32)&lt;/code&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo /tmp/sdc1 $ tree -L 1
&lt;span style=&quot;color: #ccaaff;&quot;&gt;.&lt;/span&gt;
&amp;#9500;&amp;#9472;&amp;#9472; BOOT.bin
&amp;#9500;&amp;#9472;&amp;#9472; devicetree.dtb
&amp;#9500;&amp;#9472;&amp;#9472; uImage
&amp;#9492;&amp;#9472;&amp;#9472; uramdisk.image.gz

0 directories, 4 files
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
也就是說我們的 SD 卡有的東西，要像 &lt;a href=&quot;http://www.zynqbook.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Zynq Book&lt;/a&gt; p.439 這張圖那樣
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/f2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org7657fc9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7657fc9&quot;&gt;測試開機與結果&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7657fc9&quot;&gt;
&lt;p&gt;
是時候來測試結果了，要注意到你的 Zybo Board 的 &lt;code&gt;JP5&lt;/code&gt; 要設定成下面這樣，這樣給電時，Zynq 才會讀取 SD 卡上面的 u-boot 並將位元流 (bitstream) 燒錄到 FPGA 中。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/sdboot.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
插入剛剛建立好的 SD 卡，並提供電源後，我們可以使用可以接收 UART 相關的程式，如 gtkterm、teraterm、screen、emacs 等，啟動它並開啟 &lt;code&gt;/dev/ttyUSB1&lt;/code&gt; 後，設定 baudrate 為 &lt;code&gt;115200&lt;/code&gt; ，就可以看到開機到 rootfs 的狀態。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/s1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgcc86d44&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgcc86d44&quot;&gt;取得程式碼&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgcc86d44&quot;&gt;
&lt;p&gt;
本文的範例已經放置於 &lt;a href=&quot;https://github.com/coldnew/zybo-examples&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 上，你可以到以下的 repo 去尋找，具體專案對應的教學名稱，則請參考 &lt;code&gt;README.md&lt;/code&gt; 檔案
&lt;/p&gt;

&lt;div data-theme=&quot;default&quot; data-height=&quot;&quot; data-width=&quot;400&quot; data-github=&quot;coldnew/zybo-examples&quot; class=&quot;github-card&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf3cfd47&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgf3cfd47&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgf3cfd47&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_1/ug1165-zynq-embedded-design-tutorial.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC: Embedded Design Tutorial - A Hands-On Guide to Effective Embedded System Design (UG1165)&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://www.dbrss.org/zybo/tutorial4.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO Zync-7000 Development Board Work - Booting Linux on the ZYBO&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[3]&lt;/code&gt; &lt;a href=&quot;http://www.zynqbook.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Zynq Book&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/zybo-board/zynq_led_flash/&quot;&gt;zybo board 開發記錄: Zynq 與 LED 閃爍控制&lt;/a&gt; 一文中我們談到了如何透過 C 語言撰寫獨立的程式，讓它控制 Zynq 的處理器系統 (Processing System, PS) 去閃爍 LED 的亮暗。既然 Zynq 的處理器系統 (Processing System, PS) 使用的是 ARM Cortex-A9 的處理器，那當然也可以讓我們跑 Linux 在 Zybo Board 上。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
本文將簡述如何自行編譯 u-boot 以及 Linux Kernel，並搭配 Busybox 製作簡單的 RootFS 執行於 Zybo Board 上。
&lt;/p&gt;

&lt;div id=&quot;outline-container-orgbaab6be&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgbaab6be&quot;&gt;開發目標&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgbaab6be&quot;&gt;
&lt;p&gt;
在這次的開發中，我們要編譯 u-boot、Linux，並使用 Busybox 製作簡單的 Rootfs 後，透過製作 SD 卡來讓 Zybo Board 透過 SD 卡開機。
&lt;/p&gt;

&lt;p&gt;
要注意到的是，由於我們要透過 SD 卡開機進入到 Linux 系統，因此我們要透過 &lt;code&gt;JP5&lt;/code&gt; 去更改開機模式。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/zybo_config_pins.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6bfcd8a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org6bfcd8a&quot;&gt;了解開機流程&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org6bfcd8a&quot;&gt;
&lt;p&gt;
既然我們要讓 Zybo board 執行 Linux 系統，就要先來了解一下開機流程，才知道我們大概需要準備哪些東西。從  &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_1/ug1165-zynq-embedded-design-tutorial.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC: Embedded Design Tutorial - A Hands-On Guide to Effective Embedded System Design (UG1165)&lt;/a&gt; 可以看到 Zynq-7000 執行 Linux 系統的開機流程圖。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/bootp.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
也就是說，當開始提供電源給 Zynq 處理器系統 (Processing System, PS) 並完成重置(reset) 後，Zynq 內建的 Boot ROM 會去載入 &lt;code&gt;第一階段開機程式 (First Stage Boot Loader, FSBL)&lt;/code&gt; ，接著載入 &lt;code&gt;位元流 (bitstream)&lt;/code&gt; 去初始化整個 &lt;code&gt;可程式邏輯(Programmable Logic, PL)&lt;/code&gt; 。 完成後，接下來就是透過 U-Boot 去載入 Linux Kernel、Device Tree 以及 Root File System。
&lt;/p&gt;

&lt;p&gt;
了解了這個，我們就知道我們大概要準備哪些東西了。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6b9243f&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org6b9243f&quot;&gt;設定好環境&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org6b9243f&quot;&gt;
&lt;p&gt;
在安裝玩 Vivado 與 Xilinx SDK 後，實際上包含 Zynq 在用的 ARM toolchain 亦同時被安裝到系統中，我們只要使用 &lt;code&gt;source&lt;/code&gt; 命令即可讓當前的環境知道 xilinx-arm toolchain 的路徑。這邊以 Viavdo 2016.2 作為範例。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ source /opt/Xilinx/Vivado/2016.2/settings64.sh
&lt;/pre&gt;

&lt;p&gt;
這樣就可以獲得 arm-xilinx-* toolchain 的命令，實際上有哪些呢? 輸入個 arm-xilinx- 按下 TAB 看看
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ arm-xilinx-
arm-xilinx-eabi-addr2line            arm-xilinx-eabi-gcc-4.9.2            arm-xilinx-eabi-objcopy
arm-xilinx-linux-gnueabi-ar          arm-xilinx-linux-gnueabi-gcc-ar      arm-xilinx-linux-gnueabi-objdump
arm-xilinx-eabi-ar                   arm-xilinx-eabi-gcc-ar               arm-xilinx-eabi-objdump
arm-xilinx-linux-gnueabi-as          arm-xilinx-linux-gnueabi-gcc-nm      arm-xilinx-linux-gnueabi-ranlib
arm-xilinx-eabi-as                   arm-xilinx-eabi-gcc-nm               arm-xilinx-eabi-ranlib
arm-xilinx-linux-gnueabi-c++         arm-xilinx-linux-gnueabi-gcc-ranlib  arm-xilinx-linux-gnueabi-readelf
arm-xilinx-eabi-c++                  arm-xilinx-eabi-gcc-ranlib           arm-xilinx-eabi-readelf
arm-xilinx-linux-gnueabi-c++filt     arm-xilinx-linux-gnueabi-gcov        arm-xilinx-linux-gnueabi-size
arm-xilinx-eabi-c++filt              arm-xilinx-eabi-gcov                 arm-xilinx-eabi-size
arm-xilinx-linux-gnueabi-cpp         arm-xilinx-linux-gnueabi-gdb         arm-xilinx-linux-gnueabi-sprite
arm-xilinx-eabi-cpp                  arm-xilinx-eabi-gdb                  arm-xilinx-eabi-sprite
arm-xilinx-linux-gnueabi-elfedit     arm-xilinx-linux-gnueabi-gprof       arm-xilinx-linux-gnueabi-strings
arm-xilinx-eabi-elfedit              arm-xilinx-eabi-gprof                arm-xilinx-eabi-strings
arm-xilinx-linux-gnueabi-g++         arm-xilinx-linux-gnueabi-ld          arm-xilinx-linux-gnueabi-strip
arm-xilinx-eabi-g++                  arm-xilinx-eabi-ld                   arm-xilinx-eabi-strip
arm-xilinx-linux-gnueabi-gcc         arm-xilinx-linux-gnueabi-nm
arm-xilinx-eabi-gcc                  arm-xilinx-eabi-nm                   arm-xilinx-linux-gnueabi-addr2line
arm-xilinx-linux-gnueabi-gcc-4.9.2   arm-xilinx-linux-gnueabi-objcopy
&lt;/pre&gt;

&lt;p&gt;
如果你系統上已經有其他的 ARM toolchain 的話，可以考慮跳過這一步驟，接下來要格式化 Micro SD 卡。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgcb3524e&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgcb3524e&quot;&gt;格式化 MicroSD 卡&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgcb3524e&quot;&gt;
&lt;p&gt;
在這次的開發中，我們要設定 MicroSD 卡片成兩個分區，第一個是 &lt;code&gt;fat32&lt;/code&gt; 格式，第二個則使用 &lt;code&gt;ext4&lt;/code&gt; 格式，若不會使用 &lt;code&gt;fdisk&lt;/code&gt; 命令的話，可以透過 &lt;code&gt;gparted&lt;/code&gt; 來進行格式化，以下是我格式化卡片的範例 (8GB 卡片)。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/format.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
(實際上在本文的範例中，只會用到第一個分區，第二個分區是為了往後文章要開機到大一點的 rootfs 準備的。)
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org766f8f2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org766f8f2&quot;&gt;編譯 u-boot&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org766f8f2&quot;&gt;
&lt;p&gt;
我們首先去 &lt;a href=&quot;https://github.com/DigilentInc/u-boot-Digilent-Dev&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 下載 DigilentInc 加入 zybo board 後的 u-boot 版本，要注意這邊要選擇 &lt;code&gt;master-next&lt;/code&gt; 分支。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;git clone https://github.com/DigilentInc/u-boot-Digilent-Dev.git -b master-next
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
完成後進入到該資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ cd u-boot-Digilent-Dev
&lt;/pre&gt;

&lt;p&gt;
編譯 u-boot，記得指派編譯目標為 &lt;code&gt;zynq_zybo_config&lt;/code&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/u-boot-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make zynq_zybo_config
coldnew@gentoo ~/u-boot-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
編譯完成後，注意一下 &lt;code&gt;u-boot&lt;/code&gt; 這個檔案，他就是我們等等要用到的 u-boot 執行檔，不過由於 Xilinx Tool 要找有 .elf 副檔名的檔案，因此我們把它複製成 &lt;code&gt;u-boot.elf&lt;/code&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/u-boot-Digilent-Dev $ cp u-boot u-boot.elf
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0fffd38&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0fffd38&quot;&gt;編譯 Linux kernel&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0fffd38&quot;&gt;
&lt;p&gt;
編譯好 u-boot 後，接下來就是編譯 Linux Kernel 了，我們一樣選擇 DigilentInc 加入 zybo board 後的 Linux Kernel 版本，記得要選 &lt;code&gt;master-next&lt;/code&gt; 分支。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;git clone https://github.com/DigilentInc/Linux-Digilent-Dev.git -b master-next
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接著，當然就是編譯了，不過在這之前請先確定你有裝 &lt;code&gt;u-boot-tools&lt;/code&gt; 這套件，我們需要裡面的 mkimage 指令，Gentoo Linux 可以直接用以下命令來安裝。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ sudo emerge dev-embedded/u-boot-tools
&lt;/pre&gt;

&lt;p&gt;
完成後進入 Linux Kernel 資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ cd Linux-Digilent-Dev
&lt;/pre&gt;

&lt;p&gt;
編譯我們需要的 &lt;code&gt;uImage&lt;/code&gt; 文件，記得要指定 config 為 &lt;code&gt;xilinx_zynq_defconfig&lt;/code&gt; 以及設定 &lt;code&gt;UIMAGE_LOADADDR&lt;/code&gt; 為 &lt;code&gt;0x8000&lt;/code&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/Linux-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make xilinx_zynq_defconfig
coldnew@gentoo ~/Linux-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make
coldnew@gentoo ~/Linux-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make &lt;span style=&quot;color: #aaccff;&quot;&gt;UIMAGE_LOADADDR&lt;/span&gt;=0x8000 uImage
coldnew@gentoo ~/Linux-Digilent-Dev $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make zynq-zybo.dtb
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
編譯完後，我們會需要 &lt;code&gt;arch/arm/boot/uImage&lt;/code&gt; 以及 &lt;code&gt;arch/arm/boot/dts/zynq-zybo.dtb&lt;/code&gt; 這兩個檔案，後者就是 device tree 編譯出來的資料檔。
&lt;/p&gt;

&lt;p&gt;
由於放入到 SD 卡上的 device tree 檔案名稱為 &lt;code&gt;devicetree.dtb&lt;/code&gt; ，因此這邊將 &lt;code&gt;zynq-zybo.dtb&lt;/code&gt; 改一下名。
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/Linux-Digilent-Dev $ cp arch/arm/boot/dts/zynq-zybo.dtb devicetree.dtb
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
如果你想手動修改 Device Tree 並再重新編譯的話，也可以這樣去產生我們要的 &lt;code&gt;devicetree.dtb&lt;/code&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/Linux-Digilent-Dev $ ./scripts/dtc/dtc -I dts -O dtb -o devicetree.dtb arch/arm/boot/dts/zynq-zybo.dts
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf924950&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgf924950&quot;&gt;編譯 BusyBox&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgf924950&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://www.busybox.net/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Busybox&lt;/a&gt; 是一個非常有趣的程式，舉凡我們在 Linux 下最常用的命令如 ls、cd 等到 sed、vi 他都具有相對應的簡單實現，此外，這些命令實際上都只是一個軟連結 (symlink) 連結到名為 busybox 的執行檔，也就是說，如果我們將 busybox 進行靜態編譯 (static link)，則製作出來的系統整體大小大約為 2 MB (kernel) + 1.4 MB (busybox)，而這個系統卻又可以具有許多 UN*X 下的常用命令，也因此 busybox 很常用於空間有限的系統。
&lt;/p&gt;

&lt;p&gt;
我們在這個開發過程中，由於只是驗證執行 Linux 系統的功能，因此選用 Busybox 來作為我們的 rootfs。
&lt;/p&gt;

&lt;p&gt;
首先先下載 Busybox 的原始碼，這裡選用 &lt;code&gt;1_25_stable&lt;/code&gt; 這個穩定分支
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;git clone git://git.busybox.net/busybox -b 1_25_stable
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
進行我們自己的設定
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make menuconfig
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
在進行設定時有以下幾點要確實注意，我們要將 busybox 編譯為靜態連結，並且增加 &lt;code&gt;init&lt;/code&gt; 功能，主要設定如下:
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
Busybox Settings  ---&amp;gt;
        Build Options  ---&amp;gt;
               [*] Build BusyBox as a static binary (no shared libs)

Init Utilities  ---&amp;gt;
        [*] init

Login/Password Management Utilities  ---&amp;gt;
        [*] getty

Shells  ---&amp;gt;
        [*] ash
&lt;/pre&gt;

&lt;p&gt;
設定完成後開始進行編譯
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
編譯完成後透過 &lt;code&gt;make install&lt;/code&gt; 命令，會將編譯出來的 busybox 與軟連結(symlink)產生在 &lt;code&gt;_install&lt;/code&gt; 資料夾內
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@Rosia ~/busybox $ &lt;span style=&quot;color: #aaccff;&quot;&gt;ARCH&lt;/span&gt;=arm &lt;span style=&quot;color: #aaccff;&quot;&gt;CROSS_COMPILE&lt;/span&gt;=arm-xilinx-linux-gnueabi- make install
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
建立一些缺少的資料夾 (/dev、/sys &amp;#x2026;etc)
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox $ cd _install &amp;amp;&amp;amp; mkdir -p proc sys dev etc/init.d root
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
建立 &lt;code&gt;etc/init.d/rcS&lt;/code&gt; 作為啟動腳本，並添加以下內容
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox/_install $ vim etc/init.d/rcS

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;!/bin/sh&lt;/span&gt;
mount -t proc none /proc
mount -t sysfs none /sys
/sbin/mdev -s
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
將 &lt;code&gt;etc/init.d/rcS&lt;/code&gt; 加入可執行權限
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/busybox/_install $ chmod +x etc/init.d/rcS
&lt;/pre&gt;

&lt;p&gt;
建立 &lt;code&gt;etc/inittab&lt;/code&gt; ，這會讓我們可以透過 UART 登入 zybo board
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox/_install $ vim etc/inittab

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;!/bin/sh&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Init script&lt;/span&gt;
::sysinit:/etc/init.d/rcS
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Start shell on the serial ports&lt;/span&gt;
::respawn:/sbin/getty -L ttyPS0 115200 vt100
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;What to do when restarting the init process&lt;/span&gt;
::restart:/sbin/init
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;What to do before rebooting&lt;/span&gt;
::shutdown:/bin/umount -a -r
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
設定預設的 &lt;code&gt;/etc/passwd&lt;/code&gt; 檔案，我們要讓 root 用戶登入時不用輸入密碼
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox/_install $ vim etc/passwd

root::0:0:root:/root:/bin/sh
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
建立 &lt;code&gt;/init&lt;/code&gt; 並軟連結到 &lt;code&gt;/sbin/init&lt;/code&gt; ，避免 Linux Kernel 開機時找不到 rootfs 的 init。
&lt;/p&gt;
&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~/busybox/_install $ ln -s /sbin/init init
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來，由於這次我們只是要開機到 ramdisk 上的 rootfs, 因此將 busybox 做出的 rootfs 打包成 cpio 格式。
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/busybox/_install $ find . | sudo cpio -H newc -o | gzip -9 &amp;gt; ../uramdisk.cpio.gz
&lt;/pre&gt;

&lt;p&gt;
再透過 &lt;code&gt;mkimage&lt;/code&gt; 將這個 &lt;code&gt;uramdisk.cpio.gz&lt;/code&gt; 檔案轉成 uboot 用的 &lt;code&gt;uramdisk.image.gz&lt;/code&gt;
&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/busybox/_install $  mkimage -A arm -T ramdisk -C gzip -d ../uramdisk.cpio.gz ../uramdisk.image.gz
Image Name:
Created:      Sun Jul 17 19:02:08 2016
Image Type:   ARM Linux RAMDisk Image (gzip compressed)
Data Size:    1042106 Bytes = 1017.68 kB = 0.99 MB
Load Address: 00000000
Entry Point:  00000000
&lt;/pre&gt;

&lt;p&gt;
在這邊的這個 &lt;code&gt;uramdisk.image.gz&lt;/code&gt; 就是我們開機會進入到的 rootfs，也是我們等等要放到 SD 卡第一個磁區的檔案。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd939aaf&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgd939aaf&quot;&gt;編譯位元流 (bitstream)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgd939aaf&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;https://coldnew.github.io/zybo-board/linux_bd/&quot;&gt;zybo board 開發記錄: 升級 Digilent 提供的設計檔&lt;/a&gt; 一文中，我們提到了怎樣升級 &lt;a href=&quot;http://store.digilentinc.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilent&lt;/a&gt; 提供的預先定義好接腳的設定檔 (zybo_base_system) ，這次的專案，我們就直接用這個設定檔案來進行 Linux 開機的動作。
&lt;/p&gt;

&lt;p&gt;
首先你必須根據該篇文章，將你的 Zybo board 設定檔案升級到你用的 Vivado 版本，完成後我們重新建立一個乾淨的專案。
&lt;/p&gt;

&lt;p&gt;
先來把先前生成的舊專案清掉:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ sh cleanup.sh
&lt;/pre&gt;

&lt;p&gt;
接下來用 Vivado 2016.2 重新生出新的專案 ~
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ /opt/Xilinx/Vivado/2016.2/bin/vivado -mode batch -source create_project.tcl
&lt;/pre&gt;

&lt;p&gt;
完成後，會看到 &lt;code&gt;ZYBO/Projects/linux_bd/proj&lt;/code&gt; 目錄變成這樣:
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ tree -L 1
. &amp;lt;b&amp;gt;
├── cleanup.cmd
├── cleanup.sh
├── create_project.tcl
├── ip_upgrade.log &amp;lt;g&amp;gt;
├── linux_bd.cache &amp;lt;b&amp;gt;
├── linux_bd.hw &amp;lt;b&amp;gt;
├── linux_bd.ip_user_files &amp;lt;b&amp;gt;
├── linux_bd.sim &amp;lt;b&amp;gt;
├── linux_bd.srcs &amp;lt;b&amp;gt;
├── linux_bd.xpr
├── vivado.jou
└── vivado.log &amp;lt;g&amp;gt;

5 directories, 7 files
&lt;/pre&gt;

&lt;p&gt;
我們使用 Vivado 打開 &lt;code&gt;linux_bd.xpr&lt;/code&gt; 這個專案。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/oprj.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你有興趣看他生出來的 Block Design 是怎樣的，也可以切到 Block Design 那頁看看
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/linux_bd.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
我們直接點選 &lt;code&gt;Program and Debug -&amp;gt; Generate Bitstream&lt;/code&gt; 產生我們要的位元流 (bitstream)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ge.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge8faa53&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge8faa53&quot;&gt;建立 FSBL&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge8faa53&quot;&gt;
&lt;p&gt;
到此，我們除了 &lt;code&gt;第一階段開機程式 (First Stage Boot Loader, FSBL)&lt;/code&gt; 外，其他的程式都已經編譯出執行檔了，讓我們來處理 FSBL 吧。
&lt;/p&gt;

&lt;p&gt;
首先點選 &lt;code&gt;File -&amp;gt; Export -&amp;gt; Export hardware&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/e1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
記得要勾選 &lt;code&gt;Include bitstream&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/e2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
完成後，執行 Xilinx SDK
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/e3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
透過 &lt;code&gt;File -&amp;gt; New -&amp;gt; Application Project&lt;/code&gt; 去建立我們的新專案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
設定這個專案為 &lt;code&gt;standalone&lt;/code&gt; 的專案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇樣板為 &lt;code&gt;Zynq FSBL&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇我們剛剛建立的 &lt;code&gt;FSBL&lt;/code&gt; 專案，按下右鍵選擇 &lt;code&gt;Build Project&lt;/code&gt; 進行編譯
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0d5bb38&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0d5bb38&quot;&gt;建立 BOOT.bin&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0d5bb38&quot;&gt;
&lt;p&gt;
編譯完 FSBL 後，選擇 &lt;code&gt;Xilinx Tools -&amp;gt; Create Boot Image&lt;/code&gt; 去建立我們的 BOOT.bin
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在 &lt;code&gt;Boot image partitions&lt;/code&gt; 那邊，加入我們的 bitstream 以及 u-boot 檔案，記得要按照順序加入。
&lt;/p&gt;

&lt;p&gt;
完成後，點選 &lt;code&gt;Create Image&lt;/code&gt; 就會產生我們要的 &lt;code&gt;BOOT.bin&lt;/code&gt; 到指定路徑。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/ax6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在這個步驟中，如果你是指令控的話，我們也可以在產生 FSBL.elf 後，建立一個名為 &lt;code&gt;boot.bif&lt;/code&gt; 的檔案，其內容如下
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;arch = zynq; split = false; format = BIN&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;the_ROM_image&lt;/span&gt;:
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;bootloader&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt;/path/to/fsbl-build/fsbl.elf
    /path/to/linux_bd/linux_bd.sdk/linux_bd_wrapper.bit
    /path/to/u-boot/u-boot.elf
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來透過 &lt;code&gt;bootgen&lt;/code&gt; 這個命令去產生 &lt;code&gt;BOOT.bin&lt;/code&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo ~ $ bootgen -image boot.bif -w on -o i BOOT.bin
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgfd5152e&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfd5152e&quot;&gt;將檔案複製到 Micro SD 卡&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfd5152e&quot;&gt;
&lt;p&gt;
好了，我們已經完成了所有準備動作，是時候將檔案放到 Micro SD 卡並看看結果了，在本文中我們會將以下幾個檔案放到 &lt;code&gt;第一個分割區 (fat32)&lt;/code&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@gentoo /tmp/sdc1 $ tree -L 1
&lt;span style=&quot;color: #ccaaff;&quot;&gt;.&lt;/span&gt;
&amp;#9500;&amp;#9472;&amp;#9472; BOOT.bin
&amp;#9500;&amp;#9472;&amp;#9472; devicetree.dtb
&amp;#9500;&amp;#9472;&amp;#9472; uImage
&amp;#9492;&amp;#9472;&amp;#9472; uramdisk.image.gz

0 directories, 4 files
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
也就是說我們的 SD 卡有的東西，要像 &lt;a href=&quot;http://www.zynqbook.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Zynq Book&lt;/a&gt; p.439 這張圖那樣
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/f2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org7657fc9&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7657fc9&quot;&gt;測試開機與結果&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7657fc9&quot;&gt;
&lt;p&gt;
是時候來測試結果了，要注意到你的 Zybo Board 的 &lt;code&gt;JP5&lt;/code&gt; 要設定成下面這樣，這樣給電時，Zynq 才會讀取 SD 卡上面的 u-boot 並將位元流 (bitstream) 燒錄到 FPGA 中。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/sdboot.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
插入剛剛建立好的 SD 卡，並提供電源後，我們可以使用可以接收 UART 相關的程式，如 gtkterm、teraterm、screen、emacs 等，啟動它並開啟 &lt;code&gt;/dev/ttyUSB1&lt;/code&gt; 後，設定 baudrate 為 &lt;code&gt;115200&lt;/code&gt; ，就可以看到開機到 rootfs 的狀態。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/d9dfdd56/s1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgcc86d44&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgcc86d44&quot;&gt;取得程式碼&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgcc86d44&quot;&gt;
&lt;p&gt;
本文的範例已經放置於 &lt;a href=&quot;https://github.com/coldnew/zybo-examples&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 上，你可以到以下的 repo 去尋找，具體專案對應的教學名稱，則請參考 &lt;code&gt;README.md&lt;/code&gt; 檔案
&lt;/p&gt;

&lt;div data-theme=&quot;default&quot; data-height=&quot;&quot; data-width=&quot;400&quot; data-github=&quot;coldnew/zybo-examples&quot; class=&quot;github-card&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf3cfd47&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgf3cfd47&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgf3cfd47&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_1/ug1165-zynq-embedded-design-tutorial.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC: Embedded Design Tutorial - A Hands-On Guide to Effective Embedded System Design (UG1165)&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://www.dbrss.org/zybo/tutorial4.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO Zync-7000 Development Board Work - Booting Linux on the ZYBO&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[3]&lt;/code&gt; &lt;a href=&quot;http://www.zynqbook.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Zynq Book&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/d9dfdd56/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board 開發記錄: Zynq 與 LED 閃爍控制</title>
      <link>https://coldnew.github.io/dec85bd3/</link>
      <guid>https://coldnew.github.io/dec85bd3/</guid>
      <pubDate>Tue, 05 Jul 2016 15:41:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/zybo-board/pl_led/&quot;&gt;zybo board 開發記錄: 透過可程式邏輯控制 LED 閃爍&lt;/a&gt; 一文中我們說到了怎樣純粹使用 可程式邏輯 (Programmable Logic, PL) 去控制 Zybo board 上面的四個 LED 燈 (LD0 ~ LD3)，接下來就讓我們透過 Zynq 上的 ARM 處理器來作到同樣的一件事情吧。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
本文主要參考自 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilentinc&lt;/a&gt; 的 &lt;a href=&quot;https://reference.digilentinc.com/zybo/gsg&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Getting Start Guide&lt;/a&gt; 並加入我自己試玩的一些心得。
&lt;/p&gt;

&lt;div id=&quot;outline-container-orgacf71fc&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgacf71fc&quot;&gt;開發目標&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgacf71fc&quot;&gt;
&lt;p&gt;
我們要透過 Zynq 上的 ARM 處理器，也就是 處理系統 (Processing System, PS)去控制 LED，具體目標與電路資訊如下:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/zybo_led.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
根據 &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO FPGA Board Reference Manual&lt;/a&gt; 上面的資料，我們想要控制的這四個在板子上的 LED 都是位於可程式邏輯區(Programmable Logic, PL)可以碰觸到的地方，如果你想要透過 Zynq 去對這些 LED 進行控制，你就會需要透過  AXI GPIO 的幫助，就像這樣:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/zynq_axi_gpio_led.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5e38c17&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org5e38c17&quot;&gt;認識 AXI 匯流排&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org5e38c17&quot;&gt;
&lt;p&gt;
AXI 匯流排是作什麼用的？我們就從 Zynq 的架構來看 (參照 &lt;a href=&quot;http://www.zynqbook.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Zynq Book&lt;/a&gt; p.28)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/zynq_hw_arch.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
由上圖可以看到 AXI 匯流排橫跨了處理器系統 (Processing System, PS) 與可程式邏輯 (Programmable Logc, PL) 兩區，並連接到週邊。
&lt;/p&gt;

&lt;p&gt;
實際上，AXI 協議為 ARM 的協議規範，來自於 AMBA 匯流排架構，若你對整個協議的內容有興趣，可以到 ARM 的 &lt;a href=&quot;http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.set.amba/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;網站&lt;/a&gt; 去下載規格書。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0f85614&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0f85614&quot;&gt;建立我們的專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0f85614&quot;&gt;
&lt;p&gt;
我們首先當然是建立我們的專案了，在進行這一步前，請先確定你有按照 &lt;a href=&quot;https://coldnew.github.io/zybo-board/vivado_zybo_setting_file/&quot;&gt;讓 Vivado 有 Zybo Board 的設定檔&lt;/a&gt; 一文所說，將 Zybo board 的設計導入。
&lt;/p&gt;

&lt;p&gt;
啟動了 Vivado 後，點選 &lt;code&gt;Create New Project&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/create_prj0.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來指定好你的專案名稱與路徑
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cprj1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
選擇 &lt;code&gt;RTL Project&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/new_prj.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
在開發板選項中，選擇 &lt;code&gt;Zybo Board&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/new_prj2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
完成專案建立
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cprj2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org36150c6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org36150c6&quot;&gt;建立 Block Design&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org36150c6&quot;&gt;
&lt;p&gt;
當我們的設計需要用到 Zynq 的處理器系統(Processing System, PS)時候，就需要透過 Block Design 來建立我們的電路設計，首先點選 &lt;code&gt;IP Integrator -&amp;gt; Create Block Design&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接著點選 &lt;code&gt;OK&lt;/code&gt; 建立我們的 block design
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
點選 &lt;code&gt;Add IP&lt;/code&gt; 按鈕去增加我們需要的 IP 核
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
我們首先尋找 &lt;code&gt;Zynq&lt;/code&gt; 並將 &lt;code&gt;ZYNQ7 Processing System&lt;/code&gt; 加入到我們的 Block Design，並點選 &lt;code&gt;Run Block Automation&lt;/code&gt; 對 Zynq 處理器進行一些設定
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
進入到 &lt;code&gt;Run Block Automation&lt;/code&gt; 的設定頁面後，確認 &lt;code&gt;processing_system7_0&lt;/code&gt; 有被勾選到，並且 &lt;code&gt;Cross Trigger In&lt;/code&gt; 以及 &lt;code&gt;Cross Trigger Out&lt;/code&gt; 都是 &lt;code&gt;Disable&lt;/code&gt; 的狀態，點選 Ok 結束設定。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
上面的設定好了後，就會看到 ZYNQ7 Processing System 的 DDR 以及 FIXED_IO 都有接線出來
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
點選 &lt;code&gt;Add IP&lt;/code&gt; 按鈕去增加我們需要的 IP 核，這次我們要增加 &lt;code&gt;AXI_GPIO&lt;/code&gt; ，用來對可程式邏輯(Programmable Logic, PL)區域的 LED 進行控制，完成後點選上方的 &lt;code&gt;Run Connection Automation&lt;/code&gt; 按鈕
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb7.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在 &lt;code&gt;Run Conenction Automation&lt;/code&gt; 視窗內，我們選擇 &lt;code&gt;Custom&lt;/code&gt; (其實也可以在這邊直接選擇 &lt;code&gt;leds 4bits&lt;/code&gt;)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb8-1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來勾選 &lt;code&gt;S_AXI&lt;/code&gt; ，並點選 Ok 進行確認。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb8.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
好了後會像這樣，我們接下來對 &lt;code&gt;axi_gpio_0&lt;/code&gt; 這個區塊點兩下，進行手動設定
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb9.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在 &lt;code&gt;IP Configuration&lt;/code&gt; 頁面，設定 GPIO 為輸出腳，並設寬度為 &lt;code&gt;4&lt;/code&gt; ，這邊我將輸出預設值設定為 0xF, 也就是預設這四個 LED 用的輸出腳都是 High 的電壓。完成後點選 OK, 結束 AXI_GPIO 的設定。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb10.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
接下來點選 &lt;code&gt;Validate Design&lt;/code&gt; 按鈕，我們要確認我們的 Block Design 沒問題才能夠繼續往下走。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb11.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
正常來講不會有啥問題才對，我們結束 Block Design 的工作
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb12.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org7765361&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7765361&quot;&gt;加入 Constraints&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7765361&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/zybo-board/pl_led/&quot;&gt;zybo board 開發記錄: 透過可程式邏輯控制 LED 閃爍&lt;/a&gt; 一文有提到如何取得 Constraints 檔案，不過為了讓這篇文章完整，我們再講一次。
&lt;/p&gt;

&lt;p&gt;
我們先連結到 &lt;a href=&quot;https://reference.digilentinc.com/zybo:zybo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Resource Center&lt;/a&gt; 去下載 &lt;code&gt;Master XDC&lt;/code&gt; 檔案。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/dl_constraints.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
你也可以直接透過 wget 命令下載並解壓出 &lt;code&gt;ZYBO_Master.xdc&lt;/code&gt; 這個檔案，它就是本節要加入的 Constraints 檔
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo /tmp $ wget https://reference.digilentinc.com/_media/zybo/zybo_master_xdc.zip
coldnew@gentoo /tmp $ unzip zybo_master_xdc.zip
Archive:  zybo_master_xdc.zip
  inflating: ZYBO_Master.xdc
&lt;/pre&gt;

&lt;p&gt;
接下來一樣選擇 &lt;code&gt;Project Manager -&amp;gt; Add sources&lt;/code&gt; 來增加檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/as1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
這次我們要增加的是 Constraints 檔，因此選擇 &lt;code&gt;Add or create constraints&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/add_constraints1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
透過 &lt;code&gt;Add Files&lt;/code&gt; 添加剛剛下載的 ZYBO_Master.xdc 檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/add_constraints2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org209e2aa&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org209e2aa&quot;&gt;ZYBO_Master.xdc&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org209e2aa&quot;&gt;
&lt;p&gt;
在 ZYBO_Master.xdc 裡面，預設所有對應接腳都是被註解掉的，這邊我們反註解我們需要的 led 接腳，要記得一下這邊的 I/O 名稱，我們等等要和產生出來的 HDL Wrapper 進行對應的工作。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;LEDs&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L23P_T3_35&lt;/span&gt;
set_property PACKAGE_PIN M14 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;0&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;0&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L23N_T3_35&lt;/span&gt;
set_property PACKAGE_PIN M15 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_0_35&lt;/span&gt;
set_property PACKAGE_PIN G14 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;2&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;2&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L3N_T0_DQS_AD1N_35&lt;/span&gt;
set_property PACKAGE_PIN D18 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣我們就可以準備將 Block Design 和硬體接腳對應在一起了。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org221e042&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org221e042&quot;&gt;產生 HDL Wrapper&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org221e042&quot;&gt;
&lt;p&gt;
接下來我們要透過 Block Design 產生我們的 HDL wrapper，對你的 Block Design 檔案點選右鍵，選擇 &lt;code&gt;Create HDL Wrapper&lt;/code&gt; 。它會根據你專案設定的語言 (VHDL 或是 Verilog) 來產生相對的 HDL 程式碼。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
產生出來的東西我們可能需要改些東西，為了避免麻煩這邊我選第一個選項。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，假設你的 Block Design 檔案叫做 design_1.bd，那就會產生 design_1_wrapper.v 或是 design_1_wrapper.vhdl 這樣的檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
我們接著要修改這個 HDL Wrapper，這是為什麼呢? 回去看一下前面做好的 Block Design 以及 Constraints 的資訊，我們可以看到 Block Design 設定好的 AXI_GPIO 其輸出腳叫做 &lt;code&gt;gpio_rtl&lt;/code&gt; ，而在 Constraints 中，我們目標的 LED 輸出腳名稱是 &lt;code&gt;led&lt;/code&gt; ，因此我們要調整一下這個 HDL Wrapper 讓 &lt;code&gt;gpio_rtl&lt;/code&gt; 和 &lt;code&gt;led&lt;/code&gt; 可以對應在一起。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
由於在本範例中，design_1_wrapper.v 也就是 toplevel 的模組，因此在這邊將對外的 &lt;code&gt;gpio_rtl_tri_o&lt;/code&gt; 接腳改為 &lt;code&gt;led&lt;/code&gt; 讓它接出即可。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-diff&quot;&gt;&lt;span style=&quot;color: #dddddd;&quot;&gt;diff --git a/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v b/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;index 7b1b0bd..c57caa0 100644&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;--- &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;a/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;+++ &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;b/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -31,7 +31,7 @@&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt; module design_1_wrapper&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;     FIXED_IO_ps_clk,&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;     FIXED_IO_ps_porb,&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;     FIXED_IO_ps_srstb,&lt;/span&gt;
&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;    gpio_rtl_tri_o);&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;    led);&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout [14:0]DDR_addr;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout [2:0]DDR_ba;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout DDR_cas_n;&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -53,7 +53,7 @@&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt; module design_1_wrapper&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout FIXED_IO_ps_clk;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout FIXED_IO_ps_porb;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout FIXED_IO_ps_srstb;&lt;/span&gt;
&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;  output [3:0]gpio_rtl_tri_o;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;  output [3:0]led;&lt;/span&gt;

&lt;span style=&quot;color: #dddddd;&quot;&gt;   wire [14:0]DDR_addr;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   wire [2:0]DDR_ba;&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -76,7 +76,7 @@&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt; module design_1_wrapper&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   wire FIXED_IO_ps_clk;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   wire FIXED_IO_ps_porb;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   wire FIXED_IO_ps_srstb;&lt;/span&gt;
&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;  wire [3:0]gpio_rtl_tri_o;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;  wire [3:0]led;&lt;/span&gt;

&lt;span style=&quot;color: #dddddd;&quot;&gt;   design_1 design_1_i&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;        (.DDR_addr(DDR_addr),&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -100,5 +100,5 @@&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt; module design_1_wrapper&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         .FIXED_IO_ps_clk(FIXED_IO_ps_clk),&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         .FIXED_IO_ps_porb(FIXED_IO_ps_porb),&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         .FIXED_IO_ps_srstb(FIXED_IO_ps_srstb),&lt;/span&gt;
&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;        .gpio_rtl_tri_o(gpio_rtl_tri_o));&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;        .gpio_rtl_tri_o(led));&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt; endmodule&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
改好後，點選上方的 &lt;code&gt;Run Implementation&lt;/code&gt; 來確認我們這樣的修改是否能編譯/驗證成功。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc6b6ca4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc6b6ca4&quot;&gt;產生位元流 (bitstream)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc6b6ca4&quot;&gt;
&lt;p&gt;
前面的處理都好了後，接下來點選 &lt;code&gt;Program and Debug -&amp;gt; Generate Bitstream&lt;/code&gt; 去讓 Vivado 將這個專案產生出位元流 (bitstream)，ZYNQ 會根據 bitstream 的資訊對 FPGA 進行設定。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
當 bitstream 產生完成後，由於我們這次的實作，是要透過寫 C 語言程式來控制 Zynq 進行 LED 的亮暗，因此要先將剛剛產生的硬體資訊輸出給 Xilinx SDK 去。
&lt;/p&gt;

&lt;p&gt;
點選 &lt;code&gt;File -&amp;gt; Export -&amp;gt; Export Hardware&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w7.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
確定你有勾選 &lt;code&gt;Include bitstream&lt;/code&gt; ，點選 Ok
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w8.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
完成後，啟動 Xilinx SDK
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w9.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org83158d6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org83158d6&quot;&gt;Xilinx SDK&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org83158d6&quot;&gt;
&lt;p&gt;
我們啟動 Xilinx SDK 後，可以先看到一些像是位址映射 (Address Map) 的資訊
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 &lt;code&gt;File -&amp;gt; New -&amp;gt; Application Project&lt;/code&gt; 去建立新的專案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
這邊我命名這個專案叫做 LED，並且為獨立的程式
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 &lt;code&gt;Empty Application&lt;/code&gt; ，我們要自己來寫我們的程式。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
當專案建立完成後，會自動打開 &lt;code&gt;LED_bsp&lt;/code&gt; 裡面的 &lt;code&gt;system.mss&lt;/code&gt; ，裡面會顯示我們所用的週邊範例程式碼以及使用手冊的連結，我們可以點選這些連結來了解這些週邊要怎樣使用。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/doc.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你連結點選不開的話，可以到你安裝 SDK 的路徑下去尋找，比如說我裝的是 Vivado 2016.2，則手冊的路徑在
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
/opt/Xilinx/SDK/2016.2/data/embeddedsw/XilinxProcessorIPLib/drivers
&lt;/pre&gt;

&lt;p&gt;
這裡給個結果的範例，比如我想要查詢 xgpio 的資料，則可以看到如下的 HTML 檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/doc2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6b905ba&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org6b905ba&quot;&gt;建立 main.c&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org6b905ba&quot;&gt;
&lt;p&gt;
由於我們建立的是空白專案，必須自己添加自己的主程式，因此我們對 LED 專案的 src 按下右鍵，選擇建立新的檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
這邊將它命名為 &lt;code&gt;main.c&lt;/code&gt; ，也就是我們唯一的主程式，點選 &lt;code&gt;Finish&lt;/code&gt; 完成檔案建立。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在 main.c 加入以下程式碼，具體功能待會在說明。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;xparameters.h&quot;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;xgpio.h&quot;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;stdio.h&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;stdlib.h&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;gt;&lt;/span&gt;

&lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;simple_delay&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;simple_delay&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;volatile&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;i&lt;/span&gt; = 0;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;i = 0; i &amp;lt; simple_delay; i++&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;

&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;main&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;argc&lt;/span&gt;, &lt;span style=&quot;color: #fff59d;&quot;&gt;char&lt;/span&gt; *&lt;span style=&quot;color: #aaccff;&quot;&gt;argv&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #fff59d;&quot;&gt;XGpio&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;led_gpio&lt;/span&gt;;              &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;LED Instance &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;

        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Initialize LED GPIO settings &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
        XGpio_Initialize&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, XPAR_AXI_GPIO_0_DEVICE_ID&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
        XGpio_SetDataDirection&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, 1, 0&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Output something via UART1, 115200 baudrate &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
        printf&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Start to blink led_gpio !!!\n\r&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

        &lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;led_value&lt;/span&gt; = 0x03;   &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;default led_gpio value &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;1&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
                printf&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;led_gpio value set to 0x%X\n\r&quot;&lt;/span&gt;, led_value&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;

                &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Set GPIO Channel 1 value. &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
                XGpio_DiscreteWrite&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, 1 , led_value&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;

                &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;sleep and change led_gpio value &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
                simple_delay&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;10000000&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
                led_value = ~led_value;
        &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;

        &lt;span style=&quot;color: #aaffaa;&quot;&gt;return&lt;/span&gt; 0;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd92801f&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgd92801f&quot;&gt;main.c&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgd92801f&quot;&gt;
&lt;p&gt;
在 main.c 的開頭，我們載入了需要使用的幾個標頭檔，在 Xilinx SDK 中，已經包含了一些預設好的函式庫等功能，具體資訊請查閱 &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_3/oslib_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xilinx OS and Libraries Document Collection&lt;/a&gt; (UG643) 手冊。
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;xparameters.h&lt;/code&gt; 這個標頭檔則是 Xilinx SDK 自己產生的，裡面會包含一些關於你使用的 IP Core 的資訊，比如標準輸出的基底位址 (base address) 或是其他和你這份硬體相關的設定。而 &lt;code&gt;xgpio.h&lt;/code&gt; 則提供了一些高階的抽象函式，讓你開發 GPIO 相關的功能可以更加輕鬆。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;xparameters.h&quot;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;xgpio.h&quot;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;stdio.h&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;stdlib.h&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
我們用一個非常簡單的延遲 (delay) 函式讓 CPU 很忙碌的計算，來達到延遲程式的效果。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;simple_delay&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;simple_delay&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;volatile&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;i&lt;/span&gt; = 0;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;i = 0; i &amp;lt; simple_delay; i++&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來是我們的主程式，我們將它拆開來看，後面見到的程式碼都會塞到主程式中。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;main&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;argc&lt;/span&gt;, &lt;span style=&quot;color: #fff59d;&quot;&gt;char&lt;/span&gt; *&lt;span style=&quot;color: #aaccff;&quot;&gt;argv&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;code&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;return&lt;/span&gt; 0;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
是時候進入到 GPIO 的功能設定，注意到 &lt;code&gt;XPAR_AXI_GPIO_0_DEVICE_ID&lt;/code&gt; 這個，你可以把它對應回我們的 Block Design 的 &lt;code&gt;axi_gpio_0&lt;/code&gt; ，這個巨集(Macro)即是 Xilinx SDK 產生，定義在 &lt;code&gt;xparameter.h&lt;/code&gt; 裡面。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;XGpio&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;led_gpio&lt;/span&gt;;              &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;LED Instance &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Initialize LED GPIO settings &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
XGpio_Initialize&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, XPAR_AXI_GPIO_0_DEVICE_ID&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;;
XGpio_SetDataDirection&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, 1, 0&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
我們透過 printf 去顯示一些簡單得除錯訊息，這邊的訊息會透過 UART 輸出，你可以透過電腦端的軟體來收到(ex: gtkterm、teraterm)，我自己是透過 emacs 的 &lt;code&gt;serial-term&lt;/code&gt; 命令來收訊息，baud rate 則是設定為 &lt;code&gt;115200&lt;/code&gt; 、連接目標則是 &lt;code&gt;/dev/ttyUSB1&lt;/code&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Output something via UART1, 115200 baudrate &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
printf&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Start to blink led !!!\n\r&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
最後，使用一個無窮迴圈去控制 LED 數值的變化，並透過 &lt;code&gt;XGpio_DiscreteWrite&lt;/code&gt; 去對 GPIO 的通道 1 (參考前面 Block Design) 進行資料寫入的工程，再調整下一次到迴圈時要的 LED 數值，一直重複這些動作。
&lt;/p&gt;

&lt;p&gt;
就這樣，我們的程式完成了。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;led_value&lt;/span&gt; = 0x03;   &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;default led value &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;1&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
        printf&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;led value set to 0x%X\n\n&quot;&lt;/span&gt;, led_value&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Set GPIO Channel 1 value. &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
        XGpio_DiscreteWrite&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, 1, led_value&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;sleep and change led value &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
        simple_delay&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;10000000&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
        led_value = ~led_value;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb1a109b&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb1a109b&quot;&gt;下載到 Zybo board&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb1a109b&quot;&gt;
&lt;p&gt;
確定此時你有將 Zybo board 接到電腦，並且你 &lt;code&gt;JP5&lt;/code&gt; 設定在 &lt;code&gt;QSPI&lt;/code&gt; 模式下，就像這樣
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/qspi.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 &lt;code&gt;Xilinx Tools -&amp;gt; Program FPGA&lt;/code&gt; 進行 FPGA 的燒錄。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/d1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
確認要燒錄的資料無誤後，點選 &lt;code&gt;Program&lt;/code&gt; 將位元流 (bitstream) 燒錄到 FPGA 去，燒完後你會發現 LD0 ~ LD3 都是亮燈的狀態，因為我們在 Block Design 預設 AXI_GPIO 輸出為 &lt;code&gt;0xF&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/d2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
選擇 &lt;code&gt;Run -&amp;gt; Run Configuration&lt;/code&gt; 進行執行前的一些設定。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/d3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
我們在 &lt;code&gt;Xilinx C/C++ Application(GDB)&lt;/code&gt; 建立一個新的設定，由於我們已經燒錄好 FPGA 因此只需要重起處理器系統 (Processing System, PS)即可。
&lt;/p&gt;

&lt;p&gt;
確認你有啟用 &lt;code&gt;ps7_init&lt;/code&gt; 這些設定，ps7_init 定義了一些初始化的程式，我們之所以能夠使用 &lt;code&gt;printf&lt;/code&gt; 將資訊透過 UART 輸出，也是透過 ps7_init 的協助，具體請參考 &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_2/ug1165-zynq-embedded-design-tutorial.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC: Embedded Design Tutorial A Hands-On Guide to Effective Embedded System Design (UG1165)&lt;/a&gt;, p.24 頁。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/d4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
除了這邊設定外，別忘記指定要跑的專案，Xilinx SDK 是允許同份硬體設計檔跑很多種專案的，以本文範例而言，我們要跑得專案叫做 &lt;code&gt;LED&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/d5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
都設定好後，點選 &lt;code&gt;Run&lt;/code&gt; 然後祈禱一切正常!!
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf2e427f&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgf2e427f&quot;&gt;結果&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgf2e427f&quot;&gt;
&lt;p&gt;
在你執行 &lt;i&gt;Program device&lt;/i&gt; 以及 &lt;i&gt;Run&lt;/i&gt; 後，Xilinx SDK 會將位元流(bitstream) 下載到我們的 Zybo Board，接著重設 CPU 後執行我們下載的程式，最後完成的成果如下
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/result.gif&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你有啟用可以接收 UART 相關的程式，如 gtkterm、teraterm、screen、emacs 等的話，啟動它並開啟 &lt;code&gt;/dev/ttyUSB1&lt;/code&gt; 後，設定 baudrate 為 &lt;code&gt;115200&lt;/code&gt; ，就會看到我們程式透過 &lt;code&gt;printf&lt;/code&gt; 輸出的訊息
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/s.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5b8b14c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org5b8b14c&quot;&gt;取得程式碼&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org5b8b14c&quot;&gt;
&lt;p&gt;
本文的範例已經放置於 &lt;a href=&quot;https://github.com/coldnew/zybo-examples&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 上，你可以到以下的 repo 去尋找，具體專案對應的教學名稱，則請參考 &lt;code&gt;README.md&lt;/code&gt; 檔案
&lt;/p&gt;

&lt;div data-theme=&quot;default&quot; data-height=&quot;&quot; data-width=&quot;400&quot; data-github=&quot;coldnew/zybo-examples&quot; class=&quot;github-card&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgfe42d52&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfe42d52&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfe42d52&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;http://www.zynqbook.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Zynq Book&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://sunsided.github.io/zybo-tutorial/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO Quick-Start Tutorial&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[3]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_1/ug1043-embedded-system-tools.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;XILINX - Embedded System Tools Reference Manual&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[4]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/ip_documentation/axi_gpio/v2_0/pg144-axi-gpio.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AXI GPIO v2.0 LogiCORE IP Product Guide&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[5]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_3/oslib_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xilinx OS and Libraries Document Collection (UG643)&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[6]&lt;/code&gt; &lt;a href=&quot;http://www.dbrss.org/zybo/tutorial1.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO Zync-7000 Development Board Work - Getting the LEDs to flash&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[7]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_2/ug1165-zynq-embedded-design-tutorial.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC: Embedded Design Tutorial A Hands-On Guide to Effective Embedded System Design (UG1165)&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/zybo-board/pl_led/&quot;&gt;zybo board 開發記錄: 透過可程式邏輯控制 LED 閃爍&lt;/a&gt; 一文中我們說到了怎樣純粹使用 可程式邏輯 (Programmable Logic, PL) 去控制 Zybo board 上面的四個 LED 燈 (LD0 ~ LD3)，接下來就讓我們透過 Zynq 上的 ARM 處理器來作到同樣的一件事情吧。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
本文主要參考自 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilentinc&lt;/a&gt; 的 &lt;a href=&quot;https://reference.digilentinc.com/zybo/gsg&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Getting Start Guide&lt;/a&gt; 並加入我自己試玩的一些心得。
&lt;/p&gt;

&lt;div id=&quot;outline-container-orgacf71fc&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgacf71fc&quot;&gt;開發目標&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgacf71fc&quot;&gt;
&lt;p&gt;
我們要透過 Zynq 上的 ARM 處理器，也就是 處理系統 (Processing System, PS)去控制 LED，具體目標與電路資訊如下:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/zybo_led.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
根據 &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO FPGA Board Reference Manual&lt;/a&gt; 上面的資料，我們想要控制的這四個在板子上的 LED 都是位於可程式邏輯區(Programmable Logic, PL)可以碰觸到的地方，如果你想要透過 Zynq 去對這些 LED 進行控制，你就會需要透過  AXI GPIO 的幫助，就像這樣:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/zynq_axi_gpio_led.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5e38c17&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org5e38c17&quot;&gt;認識 AXI 匯流排&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org5e38c17&quot;&gt;
&lt;p&gt;
AXI 匯流排是作什麼用的？我們就從 Zynq 的架構來看 (參照 &lt;a href=&quot;http://www.zynqbook.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Zynq Book&lt;/a&gt; p.28)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/zynq_hw_arch.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
由上圖可以看到 AXI 匯流排橫跨了處理器系統 (Processing System, PS) 與可程式邏輯 (Programmable Logc, PL) 兩區，並連接到週邊。
&lt;/p&gt;

&lt;p&gt;
實際上，AXI 協議為 ARM 的協議規範，來自於 AMBA 匯流排架構，若你對整個協議的內容有興趣，可以到 ARM 的 &lt;a href=&quot;http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.set.amba/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;網站&lt;/a&gt; 去下載規格書。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0f85614&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0f85614&quot;&gt;建立我們的專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0f85614&quot;&gt;
&lt;p&gt;
我們首先當然是建立我們的專案了，在進行這一步前，請先確定你有按照 &lt;a href=&quot;https://coldnew.github.io/zybo-board/vivado_zybo_setting_file/&quot;&gt;讓 Vivado 有 Zybo Board 的設定檔&lt;/a&gt; 一文所說，將 Zybo board 的設計導入。
&lt;/p&gt;

&lt;p&gt;
啟動了 Vivado 後，點選 &lt;code&gt;Create New Project&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/create_prj0.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來指定好你的專案名稱與路徑
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cprj1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
選擇 &lt;code&gt;RTL Project&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/new_prj.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
在開發板選項中，選擇 &lt;code&gt;Zybo Board&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/new_prj2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
完成專案建立
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cprj2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org36150c6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org36150c6&quot;&gt;建立 Block Design&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org36150c6&quot;&gt;
&lt;p&gt;
當我們的設計需要用到 Zynq 的處理器系統(Processing System, PS)時候，就需要透過 Block Design 來建立我們的電路設計，首先點選 &lt;code&gt;IP Integrator -&amp;gt; Create Block Design&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接著點選 &lt;code&gt;OK&lt;/code&gt; 建立我們的 block design
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
點選 &lt;code&gt;Add IP&lt;/code&gt; 按鈕去增加我們需要的 IP 核
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
我們首先尋找 &lt;code&gt;Zynq&lt;/code&gt; 並將 &lt;code&gt;ZYNQ7 Processing System&lt;/code&gt; 加入到我們的 Block Design，並點選 &lt;code&gt;Run Block Automation&lt;/code&gt; 對 Zynq 處理器進行一些設定
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
進入到 &lt;code&gt;Run Block Automation&lt;/code&gt; 的設定頁面後，確認 &lt;code&gt;processing_system7_0&lt;/code&gt; 有被勾選到，並且 &lt;code&gt;Cross Trigger In&lt;/code&gt; 以及 &lt;code&gt;Cross Trigger Out&lt;/code&gt; 都是 &lt;code&gt;Disable&lt;/code&gt; 的狀態，點選 Ok 結束設定。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
上面的設定好了後，就會看到 ZYNQ7 Processing System 的 DDR 以及 FIXED_IO 都有接線出來
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
點選 &lt;code&gt;Add IP&lt;/code&gt; 按鈕去增加我們需要的 IP 核，這次我們要增加 &lt;code&gt;AXI_GPIO&lt;/code&gt; ，用來對可程式邏輯(Programmable Logic, PL)區域的 LED 進行控制，完成後點選上方的 &lt;code&gt;Run Connection Automation&lt;/code&gt; 按鈕
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb7.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在 &lt;code&gt;Run Conenction Automation&lt;/code&gt; 視窗內，我們選擇 &lt;code&gt;Custom&lt;/code&gt; (其實也可以在這邊直接選擇 &lt;code&gt;leds 4bits&lt;/code&gt;)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb8-1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來勾選 &lt;code&gt;S_AXI&lt;/code&gt; ，並點選 Ok 進行確認。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb8.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
好了後會像這樣，我們接下來對 &lt;code&gt;axi_gpio_0&lt;/code&gt; 這個區塊點兩下，進行手動設定
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb9.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在 &lt;code&gt;IP Configuration&lt;/code&gt; 頁面，設定 GPIO 為輸出腳，並設寬度為 &lt;code&gt;4&lt;/code&gt; ，這邊我將輸出預設值設定為 0xF, 也就是預設這四個 LED 用的輸出腳都是 High 的電壓。完成後點選 OK, 結束 AXI_GPIO 的設定。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb10.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
接下來點選 &lt;code&gt;Validate Design&lt;/code&gt; 按鈕，我們要確認我們的 Block Design 沒問題才能夠繼續往下走。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb11.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
正常來講不會有啥問題才對，我們結束 Block Design 的工作
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/cb12.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org7765361&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7765361&quot;&gt;加入 Constraints&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7765361&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/zybo-board/pl_led/&quot;&gt;zybo board 開發記錄: 透過可程式邏輯控制 LED 閃爍&lt;/a&gt; 一文有提到如何取得 Constraints 檔案，不過為了讓這篇文章完整，我們再講一次。
&lt;/p&gt;

&lt;p&gt;
我們先連結到 &lt;a href=&quot;https://reference.digilentinc.com/zybo:zybo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Resource Center&lt;/a&gt; 去下載 &lt;code&gt;Master XDC&lt;/code&gt; 檔案。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/dl_constraints.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
你也可以直接透過 wget 命令下載並解壓出 &lt;code&gt;ZYBO_Master.xdc&lt;/code&gt; 這個檔案，它就是本節要加入的 Constraints 檔
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo /tmp $ wget https://reference.digilentinc.com/_media/zybo/zybo_master_xdc.zip
coldnew@gentoo /tmp $ unzip zybo_master_xdc.zip
Archive:  zybo_master_xdc.zip
  inflating: ZYBO_Master.xdc
&lt;/pre&gt;

&lt;p&gt;
接下來一樣選擇 &lt;code&gt;Project Manager -&amp;gt; Add sources&lt;/code&gt; 來增加檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/as1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
這次我們要增加的是 Constraints 檔，因此選擇 &lt;code&gt;Add or create constraints&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/add_constraints1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
透過 &lt;code&gt;Add Files&lt;/code&gt; 添加剛剛下載的 ZYBO_Master.xdc 檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/add_constraints2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org209e2aa&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org209e2aa&quot;&gt;ZYBO_Master.xdc&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org209e2aa&quot;&gt;
&lt;p&gt;
在 ZYBO_Master.xdc 裡面，預設所有對應接腳都是被註解掉的，這邊我們反註解我們需要的 led 接腳，要記得一下這邊的 I/O 名稱，我們等等要和產生出來的 HDL Wrapper 進行對應的工作。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;LEDs&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L23P_T3_35&lt;/span&gt;
set_property PACKAGE_PIN M14 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;0&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;0&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L23N_T3_35&lt;/span&gt;
set_property PACKAGE_PIN M15 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_0_35&lt;/span&gt;
set_property PACKAGE_PIN G14 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;2&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;2&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L3N_T0_DQS_AD1N_35&lt;/span&gt;
set_property PACKAGE_PIN D18 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣我們就可以準備將 Block Design 和硬體接腳對應在一起了。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org221e042&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org221e042&quot;&gt;產生 HDL Wrapper&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org221e042&quot;&gt;
&lt;p&gt;
接下來我們要透過 Block Design 產生我們的 HDL wrapper，對你的 Block Design 檔案點選右鍵，選擇 &lt;code&gt;Create HDL Wrapper&lt;/code&gt; 。它會根據你專案設定的語言 (VHDL 或是 Verilog) 來產生相對的 HDL 程式碼。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
產生出來的東西我們可能需要改些東西，為了避免麻煩這邊我選第一個選項。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
好了後，假設你的 Block Design 檔案叫做 design_1.bd，那就會產生 design_1_wrapper.v 或是 design_1_wrapper.vhdl 這樣的檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
我們接著要修改這個 HDL Wrapper，這是為什麼呢? 回去看一下前面做好的 Block Design 以及 Constraints 的資訊，我們可以看到 Block Design 設定好的 AXI_GPIO 其輸出腳叫做 &lt;code&gt;gpio_rtl&lt;/code&gt; ，而在 Constraints 中，我們目標的 LED 輸出腳名稱是 &lt;code&gt;led&lt;/code&gt; ，因此我們要調整一下這個 HDL Wrapper 讓 &lt;code&gt;gpio_rtl&lt;/code&gt; 和 &lt;code&gt;led&lt;/code&gt; 可以對應在一起。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
由於在本範例中，design_1_wrapper.v 也就是 toplevel 的模組，因此在這邊將對外的 &lt;code&gt;gpio_rtl_tri_o&lt;/code&gt; 接腳改為 &lt;code&gt;led&lt;/code&gt; 讓它接出即可。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-diff&quot;&gt;&lt;span style=&quot;color: #dddddd;&quot;&gt;diff --git a/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v b/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;index 7b1b0bd..c57caa0 100644&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;--- &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;a/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;+++ &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;b/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -31,7 +31,7 @@&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt; module design_1_wrapper&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;     FIXED_IO_ps_clk,&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;     FIXED_IO_ps_porb,&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;     FIXED_IO_ps_srstb,&lt;/span&gt;
&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;    gpio_rtl_tri_o);&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;    led);&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout [14:0]DDR_addr;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout [2:0]DDR_ba;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout DDR_cas_n;&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -53,7 +53,7 @@&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt; module design_1_wrapper&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout FIXED_IO_ps_clk;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout FIXED_IO_ps_porb;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   inout FIXED_IO_ps_srstb;&lt;/span&gt;
&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;  output [3:0]gpio_rtl_tri_o;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;  output [3:0]led;&lt;/span&gt;

&lt;span style=&quot;color: #dddddd;&quot;&gt;   wire [14:0]DDR_addr;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   wire [2:0]DDR_ba;&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -76,7 +76,7 @@&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt; module design_1_wrapper&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   wire FIXED_IO_ps_clk;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   wire FIXED_IO_ps_porb;&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;   wire FIXED_IO_ps_srstb;&lt;/span&gt;
&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;  wire [3:0]gpio_rtl_tri_o;&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;  wire [3:0]led;&lt;/span&gt;

&lt;span style=&quot;color: #dddddd;&quot;&gt;   design_1 design_1_i&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;        (.DDR_addr(DDR_addr),&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -100,5 +100,5 @@&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt; module design_1_wrapper&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         .FIXED_IO_ps_clk(FIXED_IO_ps_clk),&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         .FIXED_IO_ps_porb(FIXED_IO_ps_porb),&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;         .FIXED_IO_ps_srstb(FIXED_IO_ps_srstb),&lt;/span&gt;
&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;        .gpio_rtl_tri_o(gpio_rtl_tri_o));&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;        .gpio_rtl_tri_o(led));&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt; endmodule&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
改好後，點選上方的 &lt;code&gt;Run Implementation&lt;/code&gt; 來確認我們這樣的修改是否能編譯/驗證成功。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc6b6ca4&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc6b6ca4&quot;&gt;產生位元流 (bitstream)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc6b6ca4&quot;&gt;
&lt;p&gt;
前面的處理都好了後，接下來點選 &lt;code&gt;Program and Debug -&amp;gt; Generate Bitstream&lt;/code&gt; 去讓 Vivado 將這個專案產生出位元流 (bitstream)，ZYNQ 會根據 bitstream 的資訊對 FPGA 進行設定。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
當 bitstream 產生完成後，由於我們這次的實作，是要透過寫 C 語言程式來控制 Zynq 進行 LED 的亮暗，因此要先將剛剛產生的硬體資訊輸出給 Xilinx SDK 去。
&lt;/p&gt;

&lt;p&gt;
點選 &lt;code&gt;File -&amp;gt; Export -&amp;gt; Export Hardware&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w7.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
確定你有勾選 &lt;code&gt;Include bitstream&lt;/code&gt; ，點選 Ok
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w8.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
完成後，啟動 Xilinx SDK
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/w9.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org83158d6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org83158d6&quot;&gt;Xilinx SDK&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org83158d6&quot;&gt;
&lt;p&gt;
我們啟動 Xilinx SDK 後，可以先看到一些像是位址映射 (Address Map) 的資訊
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 &lt;code&gt;File -&amp;gt; New -&amp;gt; Application Project&lt;/code&gt; 去建立新的專案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
這邊我命名這個專案叫做 LED，並且為獨立的程式
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 &lt;code&gt;Empty Application&lt;/code&gt; ，我們要自己來寫我們的程式。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
當專案建立完成後，會自動打開 &lt;code&gt;LED_bsp&lt;/code&gt; 裡面的 &lt;code&gt;system.mss&lt;/code&gt; ，裡面會顯示我們所用的週邊範例程式碼以及使用手冊的連結，我們可以點選這些連結來了解這些週邊要怎樣使用。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/doc.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你連結點選不開的話，可以到你安裝 SDK 的路徑下去尋找，比如說我裝的是 Vivado 2016.2，則手冊的路徑在
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
/opt/Xilinx/SDK/2016.2/data/embeddedsw/XilinxProcessorIPLib/drivers
&lt;/pre&gt;

&lt;p&gt;
這裡給個結果的範例，比如我想要查詢 xgpio 的資料，則可以看到如下的 HTML 檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/doc2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org6b905ba&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org6b905ba&quot;&gt;建立 main.c&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org6b905ba&quot;&gt;
&lt;p&gt;
由於我們建立的是空白專案，必須自己添加自己的主程式，因此我們對 LED 專案的 src 按下右鍵，選擇建立新的檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
這邊將它命名為 &lt;code&gt;main.c&lt;/code&gt; ，也就是我們唯一的主程式，點選 &lt;code&gt;Finish&lt;/code&gt; 完成檔案建立。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/x6.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在 main.c 加入以下程式碼，具體功能待會在說明。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;xparameters.h&quot;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;xgpio.h&quot;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;stdio.h&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;stdlib.h&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;gt;&lt;/span&gt;

&lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;simple_delay&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;simple_delay&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;volatile&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;i&lt;/span&gt; = 0;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;i = 0; i &amp;lt; simple_delay; i++&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;

&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;main&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;argc&lt;/span&gt;, &lt;span style=&quot;color: #fff59d;&quot;&gt;char&lt;/span&gt; *&lt;span style=&quot;color: #aaccff;&quot;&gt;argv&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #fff59d;&quot;&gt;XGpio&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;led_gpio&lt;/span&gt;;              &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;LED Instance &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;

        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Initialize LED GPIO settings &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
        XGpio_Initialize&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, XPAR_AXI_GPIO_0_DEVICE_ID&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
        XGpio_SetDataDirection&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, 1, 0&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Output something via UART1, 115200 baudrate &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
        printf&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Start to blink led_gpio !!!\n\r&quot;&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

        &lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;led_value&lt;/span&gt; = 0x03;   &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;default led_gpio value &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;1&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
                printf&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;led_gpio value set to 0x%X\n\r&quot;&lt;/span&gt;, led_value&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;

                &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Set GPIO Channel 1 value. &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
                XGpio_DiscreteWrite&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, 1 , led_value&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;

                &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;sleep and change led_gpio value &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
                simple_delay&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;10000000&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;;
                led_value = ~led_value;
        &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;

        &lt;span style=&quot;color: #aaffaa;&quot;&gt;return&lt;/span&gt; 0;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd92801f&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgd92801f&quot;&gt;main.c&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgd92801f&quot;&gt;
&lt;p&gt;
在 main.c 的開頭，我們載入了需要使用的幾個標頭檔，在 Xilinx SDK 中，已經包含了一些預設好的函式庫等功能，具體資訊請查閱 &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_3/oslib_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xilinx OS and Libraries Document Collection&lt;/a&gt; (UG643) 手冊。
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;xparameters.h&lt;/code&gt; 這個標頭檔則是 Xilinx SDK 自己產生的，裡面會包含一些關於你使用的 IP Core 的資訊，比如標準輸出的基底位址 (base address) 或是其他和你這份硬體相關的設定。而 &lt;code&gt;xgpio.h&lt;/code&gt; 則提供了一些高階的抽象函式，讓你開發 GPIO 相關的功能可以更加輕鬆。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;xparameters.h&quot;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;xgpio.h&quot;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;stdio.h&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span style=&quot;color: #ff8888;&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;stdlib.h&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
我們用一個非常簡單的延遲 (delay) 函式讓 CPU 很忙碌的計算，來達到延遲程式的效果。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;simple_delay&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;simple_delay&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;volatile&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;i&lt;/span&gt; = 0;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;i = 0; i &amp;lt; simple_delay; i++&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來是我們的主程式，我們將它拆開來看，後面見到的程式碼都會塞到主程式中。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;main&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;argc&lt;/span&gt;, &lt;span style=&quot;color: #fff59d;&quot;&gt;char&lt;/span&gt; *&lt;span style=&quot;color: #aaccff;&quot;&gt;argv&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;[]&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;code&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;return&lt;/span&gt; 0;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
是時候進入到 GPIO 的功能設定，注意到 &lt;code&gt;XPAR_AXI_GPIO_0_DEVICE_ID&lt;/code&gt; 這個，你可以把它對應回我們的 Block Design 的 &lt;code&gt;axi_gpio_0&lt;/code&gt; ，這個巨集(Macro)即是 Xilinx SDK 產生，定義在 &lt;code&gt;xparameter.h&lt;/code&gt; 裡面。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;XGpio&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;led_gpio&lt;/span&gt;;              &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;LED Instance &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Initialize LED GPIO settings &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
XGpio_Initialize&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, XPAR_AXI_GPIO_0_DEVICE_ID&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;;
XGpio_SetDataDirection&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, 1, 0&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
我們透過 printf 去顯示一些簡單得除錯訊息，這邊的訊息會透過 UART 輸出，你可以透過電腦端的軟體來收到(ex: gtkterm、teraterm)，我自己是透過 emacs 的 &lt;code&gt;serial-term&lt;/code&gt; 命令來收訊息，baud rate 則是設定為 &lt;code&gt;115200&lt;/code&gt; 、連接目標則是 &lt;code&gt;/dev/ttyUSB1&lt;/code&gt; 。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Output something via UART1, 115200 baudrate &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
printf&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;Start to blink led !!!\n\r&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
最後，使用一個無窮迴圈去控制 LED 數值的變化，並透過 &lt;code&gt;XGpio_DiscreteWrite&lt;/code&gt; 去對 GPIO 的通道 1 (參考前面 Block Design) 進行資料寫入的工程，再調整下一次到迴圈時要的 LED 數值，一直重複這些動作。
&lt;/p&gt;

&lt;p&gt;
就這樣，我們的程式完成了。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-c&quot;&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;led_value&lt;/span&gt; = 0x03;   &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;default led value &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;while&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;1&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
        printf&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;led value set to 0x%X\n\n&quot;&lt;/span&gt;, led_value&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Set GPIO Channel 1 value. &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
        XGpio_DiscreteWrite&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&amp;amp;led_gpio, 1, led_value&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;sleep and change led value &lt;/span&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;*/&lt;/span&gt;
        simple_delay&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;10000000&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;
        led_value = ~led_value;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb1a109b&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb1a109b&quot;&gt;下載到 Zybo board&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb1a109b&quot;&gt;
&lt;p&gt;
確定此時你有將 Zybo board 接到電腦，並且你 &lt;code&gt;JP5&lt;/code&gt; 設定在 &lt;code&gt;QSPI&lt;/code&gt; 模式下，就像這樣
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/qspi.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 &lt;code&gt;Xilinx Tools -&amp;gt; Program FPGA&lt;/code&gt; 進行 FPGA 的燒錄。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/d1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
確認要燒錄的資料無誤後，點選 &lt;code&gt;Program&lt;/code&gt; 將位元流 (bitstream) 燒錄到 FPGA 去，燒完後你會發現 LD0 ~ LD3 都是亮燈的狀態，因為我們在 Block Design 預設 AXI_GPIO 輸出為 &lt;code&gt;0xF&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/d2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
選擇 &lt;code&gt;Run -&amp;gt; Run Configuration&lt;/code&gt; 進行執行前的一些設定。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/d3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
我們在 &lt;code&gt;Xilinx C/C++ Application(GDB)&lt;/code&gt; 建立一個新的設定，由於我們已經燒錄好 FPGA 因此只需要重起處理器系統 (Processing System, PS)即可。
&lt;/p&gt;

&lt;p&gt;
確認你有啟用 &lt;code&gt;ps7_init&lt;/code&gt; 這些設定，ps7_init 定義了一些初始化的程式，我們之所以能夠使用 &lt;code&gt;printf&lt;/code&gt; 將資訊透過 UART 輸出，也是透過 ps7_init 的協助，具體請參考 &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_2/ug1165-zynq-embedded-design-tutorial.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC: Embedded Design Tutorial A Hands-On Guide to Effective Embedded System Design (UG1165)&lt;/a&gt;, p.24 頁。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/d4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
除了這邊設定外，別忘記指定要跑的專案，Xilinx SDK 是允許同份硬體設計檔跑很多種專案的，以本文範例而言，我們要跑得專案叫做 &lt;code&gt;LED&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/d5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
都設定好後，點選 &lt;code&gt;Run&lt;/code&gt; 然後祈禱一切正常!!
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf2e427f&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgf2e427f&quot;&gt;結果&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgf2e427f&quot;&gt;
&lt;p&gt;
在你執行 &lt;i&gt;Program device&lt;/i&gt; 以及 &lt;i&gt;Run&lt;/i&gt; 後，Xilinx SDK 會將位元流(bitstream) 下載到我們的 Zybo Board，接著重設 CPU 後執行我們下載的程式，最後完成的成果如下
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/result.gif&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你有啟用可以接收 UART 相關的程式，如 gtkterm、teraterm、screen、emacs 等的話，啟動它並開啟 &lt;code&gt;/dev/ttyUSB1&lt;/code&gt; 後，設定 baudrate 為 &lt;code&gt;115200&lt;/code&gt; ，就會看到我們程式透過 &lt;code&gt;printf&lt;/code&gt; 輸出的訊息
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/dec85bd3/s.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org5b8b14c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org5b8b14c&quot;&gt;取得程式碼&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org5b8b14c&quot;&gt;
&lt;p&gt;
本文的範例已經放置於 &lt;a href=&quot;https://github.com/coldnew/zybo-examples&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 上，你可以到以下的 repo 去尋找，具體專案對應的教學名稱，則請參考 &lt;code&gt;README.md&lt;/code&gt; 檔案
&lt;/p&gt;

&lt;div data-theme=&quot;default&quot; data-height=&quot;&quot; data-width=&quot;400&quot; data-github=&quot;coldnew/zybo-examples&quot; class=&quot;github-card&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgfe42d52&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgfe42d52&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgfe42d52&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;http://www.zynqbook.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Zynq Book&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://sunsided.github.io/zybo-tutorial/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO Quick-Start Tutorial&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[3]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_1/ug1043-embedded-system-tools.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;XILINX - Embedded System Tools Reference Manual&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[4]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/ip_documentation/axi_gpio/v2_0/pg144-axi-gpio.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AXI GPIO v2.0 LogiCORE IP Product Guide&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[5]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_3/oslib_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xilinx OS and Libraries Document Collection (UG643)&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[6]&lt;/code&gt; &lt;a href=&quot;http://www.dbrss.org/zybo/tutorial1.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO Zync-7000 Development Board Work - Getting the LEDs to flash&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[7]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_2/ug1165-zynq-embedded-design-tutorial.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC: Embedded Design Tutorial A Hands-On Guide to Effective Embedded System Design (UG1165)&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/dec85bd3/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board 開發記錄: 透過可程式邏輯控制 LED 閃爍</title>
      <link>https://coldnew.github.io/6c5717d7/</link>
      <guid>https://coldnew.github.io/6c5717d7/</guid>
      <pubDate>Sat, 02 Jul 2016 08:40:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在進入到這種混搭 ARM/FPGA 的開發板的世界之前，很多人都是從純粹的 FPGA 開發板玩起，因此也讓我們看看如何僅透過可程式邏輯(Programmable Logic, PL) 來對 Zybo board 上面的 LED 進行閃爍控制。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
本文將採用業界比較常用的 Verilog 進行示範。
&lt;/p&gt;

&lt;div id=&quot;outline-container-org2dbfcfe&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org2dbfcfe&quot;&gt;開發目標&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org2dbfcfe&quot;&gt;
&lt;p&gt;
我們要透過純粹的可程式邏輯(Programmable Logic, PL) 去控制 LED，也就是說，我們只寫硬體描述語言 Verilog 來控制 Zybo board 上面的 LED，讓他依照我們設定的頻率進行閃爍/亮滅。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/zybo_led.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
根據 &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO FPGA Board Reference Manual&lt;/a&gt; 上面的資訊，我們想要控制的這四個在板子上的 LED 都是位於可程式邏輯區(Programmable Logic, PL)可以碰觸到的地方，如果你想要透過 Zynq 去對這些 LED 進行控制，你就會需要透過  AXI GPIO 的幫助，就像這樣:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/zynq_axi_gpio_led.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
關於如何在 Zynq 下面控制這幾個 LED，這部份我們將下一篇文章再來提及。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org91bbe5f&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org91bbe5f&quot;&gt;建立我們的專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org91bbe5f&quot;&gt;
&lt;p&gt;
我們首先當然是建立我們的專案了，在進行這一步前，請先確定你有按照 &lt;a href=&quot;https://coldnew.github.io/zybo-board/vivado_zybo_setting_file/&quot;&gt;讓 Vivado 有 Zybo Board 的設定檔&lt;/a&gt; 一文所說，將 Zybo board 的設計導入。
&lt;/p&gt;

&lt;p&gt;
啟動了 Vivado 後，點選 &lt;code&gt;Create Project&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/create_prj0.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來指定好你的專案名稱與路徑
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/create_prj1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
選擇 &lt;code&gt;RTL Project&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/new_prj.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
在開發板選項中，選擇 &lt;code&gt;Zybo Board&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/new_prj2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
完成專案建立
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/new_prj3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org964ec7c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org964ec7c&quot;&gt;撰寫程式&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org964ec7c&quot;&gt;
&lt;p&gt;
在專案建立完後，接下來就是添加並撰寫我們的 Verilog 程式，點選 &lt;code&gt;Project Manager -&amp;gt; Add sources&lt;/code&gt; 來增加檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/create_prj2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
由於我們要增加的是可程式邏輯的設計檔，因此選擇 &lt;code&gt;Add or create design sources&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/add_sources1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 &lt;code&gt;Create File&lt;/code&gt; 去建立 &lt;code&gt;top.v&lt;/code&gt; 這個檔案，這也同時是我們的主程式
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/add_sources2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
建立好 top.v 後，點選它來進行編輯
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/add_sources3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd0f47fb&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgd0f47fb&quot;&gt;top.v&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgd0f47fb&quot;&gt;
&lt;p&gt;
在我們的主程式 top.v 中，我們定義了一組暫存器用來存放當前計數的狀態，每計數 125 百萬次後，就讓 led 暫存器的數值增加，反之則是讓計數器的內容增加。
&lt;/p&gt;

&lt;p&gt;
選擇計數 125 百萬次的原因，在於我們會把 &lt;code&gt;clk&lt;/code&gt; 這個輸入，連結到 &lt;code&gt;125M Hz&lt;/code&gt; 的時脈輸入，這個時脈是由 50M Hz 的石英振盪器經過 Ethernet PHY 後所產生的
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/clock_source.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
也就是說，由於我們的時脈輸入將會設定為 125 MHz，因此讓計數器計數 125 百萬次後調整 LED 暫存器的資訊，相當於 &lt;code&gt;每 1 秒&lt;/code&gt; 修改一次 LED 暫存器的內容
&lt;/p&gt;

&lt;p&gt;
我們的 top.v 程式如下
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-verilog&quot;&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;`timescale&lt;/span&gt; 1ns / 1ps

&lt;span style=&quot;color: #aaffaa;&quot;&gt;module&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;top&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;output&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;3:0&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt; led,
           &lt;span style=&quot;color: #fff59d;&quot;&gt;input&lt;/span&gt; clk&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;;

   &lt;span style=&quot;color: #fff59d;&quot;&gt;reg&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;3:0&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;     led;
   &lt;span style=&quot;color: #fff59d;&quot;&gt;reg&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;26:0&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;    counter;

   &lt;span style=&quot;color: #aaffaa;&quot;&gt;always&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;@&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;posedge&lt;/span&gt; clk&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;begin&lt;/span&gt;
      &lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counter == 27&#39;d1250000000&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;begin&lt;/span&gt;
         led &amp;lt;= led + 1;
         counter &amp;lt;= 0;
      &lt;span style=&quot;color: #fff59d;&quot;&gt;end&lt;/span&gt;
      &lt;span style=&quot;color: #aaffaa;&quot;&gt;else&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;begin&lt;/span&gt;
         counter &amp;lt;= counter +1;
      &lt;span style=&quot;color: #fff59d;&quot;&gt;end&lt;/span&gt;
   &lt;span style=&quot;color: #fff59d;&quot;&gt;end&lt;/span&gt;

&lt;span style=&quot;color: #aaffaa;&quot;&gt;endmodule&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org4a4ef50&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org4a4ef50&quot;&gt;加入 Constraints&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org4a4ef50&quot;&gt;
&lt;p&gt;
我們撰寫好了 Verilog 模組 top.v，接下來就是要讓這模組的 I/O 和 Zybo board 的腳位對應到，我們先連結到 &lt;a href=&quot;https://reference.digilentinc.com/zybo:zybo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Resource Center&lt;/a&gt; 去下載 &lt;code&gt;Master XDC&lt;/code&gt; 檔案。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/dl_constraints.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
你也可以直接透過 wget 命令下載並解壓出 &lt;code&gt;ZYBO_Master.xdc&lt;/code&gt; 這個檔案，它就是本節要加入的 Constraints 檔
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo /tmp $ wget https://reference.digilentinc.com/_media/zybo/zybo_master_xdc.zip
coldnew@gentoo /tmp $ unzip zybo_master_xdc.zip
Archive:  zybo_master_xdc.zip
  inflating: ZYBO_Master.xdc
&lt;/pre&gt;

&lt;p&gt;
接下來一樣選擇 &lt;code&gt;Project Manager -&amp;gt; Add sources&lt;/code&gt; 來增加檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/create_prj2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
這次我們要增加的是 Constraints 檔，因此選擇 &lt;code&gt;Add or create constraints&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/add_constraints1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
透過 &lt;code&gt;Add Files&lt;/code&gt; 添加剛剛下載的 ZYBO_Master.xdc 檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/add_constraints2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb69a3e8&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgb69a3e8&quot;&gt;ZYBO_Master.xdc&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgb69a3e8&quot;&gt;
&lt;p&gt;
在 ZYBO_Master.xdc 裡面，預設所有對應接腳都是被註解掉的，這邊我們反註解我們需要的 clk 以及 led 接腳，要注意到這邊的 I/O 名稱要對應到前面所寫的 top.v 裡面的 I/O 名稱。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Clock signal&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L11P_T1_SRCC_35&lt;/span&gt;
set_property PACKAGE_PIN L16 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports clk&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports clk&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;create_clock -add -name sys_clk_pin -period 8.00 -waveform {0 4} [get_ports clk]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;LEDs&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L23P_T3_35&lt;/span&gt;
set_property PACKAGE_PIN M14 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;0&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;0&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L23N_T3_35&lt;/span&gt;
set_property PACKAGE_PIN M15 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_0_35&lt;/span&gt;
set_property PACKAGE_PIN G14 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;2&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;2&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L3N_T0_DQS_AD1N_35&lt;/span&gt;
set_property PACKAGE_PIN D18 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣我們就把 Verilog 模組和實際硬體對應的部份解決了
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org4726a46&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org4726a46&quot;&gt;產生位元流 (bitstream)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org4726a46&quot;&gt;
&lt;p&gt;
前面的處理都好了後，接下來點選 &lt;code&gt;Program and Debug -&amp;gt; Generate Bitstream&lt;/code&gt; 去讓 Vivado 將這個專案產生出位元流 (bitstream)，ZYNQ 會根據 bitstream 的資訊對 FPGA 進行設定。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/gen_bitstream.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
當 bitstream 產生完成後，會彈出一個視窗，這邊我們選擇 &lt;code&gt;Open Harware Manager&lt;/code&gt; 進入到下載程序
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/hwm1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id=&quot;outline-container-org54c603a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org54c603a&quot;&gt;下載到 Zybo board&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org54c603a&quot;&gt;
&lt;p&gt;
確定此時你有將 Zybo board 接到電腦，並且你 &lt;code&gt;JP5&lt;/code&gt; 設定在 &lt;code&gt;QSPI&lt;/code&gt; 模式下，就像這樣
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/qspi.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
點選 &lt;code&gt;Open target&lt;/code&gt; 選擇我們的目標開發板
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/hwm2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 Auto Connect 讓 Vivado 自行尋找下載目標
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/hwm3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
Vivado 告訴我們找到了一台使用 &lt;code&gt;xc7z010&lt;/code&gt; IC 的板子，就是我們的 Zybo board，選擇這個進行燒錄
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/hwm4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在下載前，Vivado 會在確認一次 bitstream 的位置，確認無誤後點選 &lt;code&gt;Program&lt;/code&gt; 進行燒錄
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/hwm5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf8929dd&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgf8929dd&quot;&gt;結果&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgf8929dd&quot;&gt;
&lt;p&gt;
在你執行 &lt;i&gt;Program device&lt;/i&gt; 後，Vivado 會將剛剛產生的 bitstream 下載到我們的 Zybo Board 並執行它，最後完成的成果如下
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/result.gif&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgeb712b6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgeb712b6&quot;&gt;取得程式碼&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgeb712b6&quot;&gt;
&lt;p&gt;
本文的範例已經放置於 &lt;a href=&quot;https://github.com/coldnew/zybo-examples&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 上，你可以到以下的 repo 去尋找，具體專案對應的教學名稱，則請參考 &lt;code&gt;README.md&lt;/code&gt; 檔案
&lt;/p&gt;

&lt;div data-theme=&quot;default&quot; data-height=&quot;&quot; data-width=&quot;400&quot; data-github=&quot;coldnew/zybo-examples&quot; class=&quot;github-card&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id=&quot;outline-container-org4a00a6c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org4a00a6c&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org4a00a6c&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;http://johanngoetz.blogspot.tw/2014/04/first-steps-with-zybo-development-board.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FPGA Programming: First Steps with the ZYBO Development Board&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://www.borisivanov.com/fpga/verilog_zybo1.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Simple Verilog example useing Vivado 2015 with zybo FPGA board v0.1&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[3]&lt;/code&gt; &lt;a href=&quot;http://ece.gmu.edu/coursewebpages/ECE/ECE699_SW_HW/S15/viewgraphs/ECE699_lecture_3.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ECE 699: Lecture 3 General Purpose Input Output GPIO&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[4]&lt;/code&gt; &lt;a href=&quot;http://www.beyond-circuits.com/wordpress/tutorial/tutorial1/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Tutorial 1: The Simplest FPGA in the World | Beyond Circuits&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在進入到這種混搭 ARM/FPGA 的開發板的世界之前，很多人都是從純粹的 FPGA 開發板玩起，因此也讓我們看看如何僅透過可程式邏輯(Programmable Logic, PL) 來對 Zybo board 上面的 LED 進行閃爍控制。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
本文將採用業界比較常用的 Verilog 進行示範。
&lt;/p&gt;

&lt;div id=&quot;outline-container-org2dbfcfe&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org2dbfcfe&quot;&gt;開發目標&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org2dbfcfe&quot;&gt;
&lt;p&gt;
我們要透過純粹的可程式邏輯(Programmable Logic, PL) 去控制 LED，也就是說，我們只寫硬體描述語言 Verilog 來控制 Zybo board 上面的 LED，讓他依照我們設定的頻率進行閃爍/亮滅。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/zybo_led.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
根據 &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO FPGA Board Reference Manual&lt;/a&gt; 上面的資訊，我們想要控制的這四個在板子上的 LED 都是位於可程式邏輯區(Programmable Logic, PL)可以碰觸到的地方，如果你想要透過 Zynq 去對這些 LED 進行控制，你就會需要透過  AXI GPIO 的幫助，就像這樣:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/zynq_axi_gpio_led.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
關於如何在 Zynq 下面控制這幾個 LED，這部份我們將下一篇文章再來提及。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org91bbe5f&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org91bbe5f&quot;&gt;建立我們的專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org91bbe5f&quot;&gt;
&lt;p&gt;
我們首先當然是建立我們的專案了，在進行這一步前，請先確定你有按照 &lt;a href=&quot;https://coldnew.github.io/zybo-board/vivado_zybo_setting_file/&quot;&gt;讓 Vivado 有 Zybo Board 的設定檔&lt;/a&gt; 一文所說，將 Zybo board 的設計導入。
&lt;/p&gt;

&lt;p&gt;
啟動了 Vivado 後，點選 &lt;code&gt;Create Project&lt;/code&gt; 。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/create_prj0.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
接下來指定好你的專案名稱與路徑
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/create_prj1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
選擇 &lt;code&gt;RTL Project&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/new_prj.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
在開發板選項中，選擇 &lt;code&gt;Zybo Board&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/new_prj2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
完成專案建立
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/new_prj3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org964ec7c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org964ec7c&quot;&gt;撰寫程式&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org964ec7c&quot;&gt;
&lt;p&gt;
在專案建立完後，接下來就是添加並撰寫我們的 Verilog 程式，點選 &lt;code&gt;Project Manager -&amp;gt; Add sources&lt;/code&gt; 來增加檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/create_prj2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
由於我們要增加的是可程式邏輯的設計檔，因此選擇 &lt;code&gt;Add or create design sources&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/add_sources1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 &lt;code&gt;Create File&lt;/code&gt; 去建立 &lt;code&gt;top.v&lt;/code&gt; 這個檔案，這也同時是我們的主程式
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/add_sources2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
建立好 top.v 後，點選它來進行編輯
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/add_sources3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd0f47fb&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgd0f47fb&quot;&gt;top.v&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgd0f47fb&quot;&gt;
&lt;p&gt;
在我們的主程式 top.v 中，我們定義了一組暫存器用來存放當前計數的狀態，每計數 125 百萬次後，就讓 led 暫存器的數值增加，反之則是讓計數器的內容增加。
&lt;/p&gt;

&lt;p&gt;
選擇計數 125 百萬次的原因，在於我們會把 &lt;code&gt;clk&lt;/code&gt; 這個輸入，連結到 &lt;code&gt;125M Hz&lt;/code&gt; 的時脈輸入，這個時脈是由 50M Hz 的石英振盪器經過 Ethernet PHY 後所產生的
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/clock_source.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
也就是說，由於我們的時脈輸入將會設定為 125 MHz，因此讓計數器計數 125 百萬次後調整 LED 暫存器的資訊，相當於 &lt;code&gt;每 1 秒&lt;/code&gt; 修改一次 LED 暫存器的內容
&lt;/p&gt;

&lt;p&gt;
我們的 top.v 程式如下
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-verilog&quot;&gt;&lt;span style=&quot;color: #ff8888;&quot;&gt;`timescale&lt;/span&gt; 1ns / 1ps

&lt;span style=&quot;color: #aaffaa;&quot;&gt;module&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;top&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;output&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;[&lt;/span&gt;3:0&lt;span style=&quot;color: #81d4fa;&quot;&gt;]&lt;/span&gt; led,
           &lt;span style=&quot;color: #fff59d;&quot;&gt;input&lt;/span&gt; clk&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;;

   &lt;span style=&quot;color: #fff59d;&quot;&gt;reg&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;3:0&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;     led;
   &lt;span style=&quot;color: #fff59d;&quot;&gt;reg&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;26:0&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;    counter;

   &lt;span style=&quot;color: #aaffaa;&quot;&gt;always&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;@&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;posedge&lt;/span&gt; clk&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;begin&lt;/span&gt;
      &lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;counter == 27&#39;d1250000000&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;begin&lt;/span&gt;
         led &amp;lt;= led + 1;
         counter &amp;lt;= 0;
      &lt;span style=&quot;color: #fff59d;&quot;&gt;end&lt;/span&gt;
      &lt;span style=&quot;color: #aaffaa;&quot;&gt;else&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;begin&lt;/span&gt;
         counter &amp;lt;= counter +1;
      &lt;span style=&quot;color: #fff59d;&quot;&gt;end&lt;/span&gt;
   &lt;span style=&quot;color: #fff59d;&quot;&gt;end&lt;/span&gt;

&lt;span style=&quot;color: #aaffaa;&quot;&gt;endmodule&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org4a4ef50&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org4a4ef50&quot;&gt;加入 Constraints&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org4a4ef50&quot;&gt;
&lt;p&gt;
我們撰寫好了 Verilog 模組 top.v，接下來就是要讓這模組的 I/O 和 Zybo board 的腳位對應到，我們先連結到 &lt;a href=&quot;https://reference.digilentinc.com/zybo:zybo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Resource Center&lt;/a&gt; 去下載 &lt;code&gt;Master XDC&lt;/code&gt; 檔案。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/dl_constraints.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
你也可以直接透過 wget 命令下載並解壓出 &lt;code&gt;ZYBO_Master.xdc&lt;/code&gt; 這個檔案，它就是本節要加入的 Constraints 檔
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo /tmp $ wget https://reference.digilentinc.com/_media/zybo/zybo_master_xdc.zip
coldnew@gentoo /tmp $ unzip zybo_master_xdc.zip
Archive:  zybo_master_xdc.zip
  inflating: ZYBO_Master.xdc
&lt;/pre&gt;

&lt;p&gt;
接下來一樣選擇 &lt;code&gt;Project Manager -&amp;gt; Add sources&lt;/code&gt; 來增加檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/create_prj2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
這次我們要增加的是 Constraints 檔，因此選擇 &lt;code&gt;Add or create constraints&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/add_constraints1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
透過 &lt;code&gt;Add Files&lt;/code&gt; 添加剛剛下載的 ZYBO_Master.xdc 檔案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/add_constraints2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb69a3e8&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgb69a3e8&quot;&gt;ZYBO_Master.xdc&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgb69a3e8&quot;&gt;
&lt;p&gt;
在 ZYBO_Master.xdc 裡面，預設所有對應接腳都是被註解掉的，這邊我們反註解我們需要的 clk 以及 led 接腳，要注意到這邊的 I/O 名稱要對應到前面所寫的 top.v 裡面的 I/O 名稱。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Clock signal&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L11P_T1_SRCC_35&lt;/span&gt;
set_property PACKAGE_PIN L16 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports clk&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports clk&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;create_clock -add -name sys_clk_pin -period 8.00 -waveform {0 4} [get_ports clk]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;LEDs&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L23P_T3_35&lt;/span&gt;
set_property PACKAGE_PIN M14 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;0&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;0&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L23N_T3_35&lt;/span&gt;
set_property PACKAGE_PIN M15 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;1&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_0_35&lt;/span&gt;
set_property PACKAGE_PIN G14 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;2&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;2&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;##&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;IO_L3N_T0_DQS_AD1N_35&lt;/span&gt;
set_property PACKAGE_PIN D18 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
set_property IOSTANDARD LVCMOS33 &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt;get_ports &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;led&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;3&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣我們就把 Verilog 模組和實際硬體對應的部份解決了
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org4726a46&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org4726a46&quot;&gt;產生位元流 (bitstream)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org4726a46&quot;&gt;
&lt;p&gt;
前面的處理都好了後，接下來點選 &lt;code&gt;Program and Debug -&amp;gt; Generate Bitstream&lt;/code&gt; 去讓 Vivado 將這個專案產生出位元流 (bitstream)，ZYNQ 會根據 bitstream 的資訊對 FPGA 進行設定。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/gen_bitstream.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
當 bitstream 產生完成後，會彈出一個視窗，這邊我們選擇 &lt;code&gt;Open Harware Manager&lt;/code&gt; 進入到下載程序
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/hwm1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id=&quot;outline-container-org54c603a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org54c603a&quot;&gt;下載到 Zybo board&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org54c603a&quot;&gt;
&lt;p&gt;
確定此時你有將 Zybo board 接到電腦，並且你 &lt;code&gt;JP5&lt;/code&gt; 設定在 &lt;code&gt;QSPI&lt;/code&gt; 模式下，就像這樣
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/qspi.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
點選 &lt;code&gt;Open target&lt;/code&gt; 選擇我們的目標開發板
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/hwm2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
選擇 Auto Connect 讓 Vivado 自行尋找下載目標
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/hwm3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
Vivado 告訴我們找到了一台使用 &lt;code&gt;xc7z010&lt;/code&gt; IC 的板子，就是我們的 Zybo board，選擇這個進行燒錄
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/hwm4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
在下載前，Vivado 會在確認一次 bitstream 的位置，確認無誤後點選 &lt;code&gt;Program&lt;/code&gt; 進行燒錄
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/hwm5.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf8929dd&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgf8929dd&quot;&gt;結果&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgf8929dd&quot;&gt;
&lt;p&gt;
在你執行 &lt;i&gt;Program device&lt;/i&gt; 後，Vivado 會將剛剛產生的 bitstream 下載到我們的 Zybo Board 並執行它，最後完成的成果如下
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/6c5717d7/result.gif&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgeb712b6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgeb712b6&quot;&gt;取得程式碼&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgeb712b6&quot;&gt;
&lt;p&gt;
本文的範例已經放置於 &lt;a href=&quot;https://github.com/coldnew/zybo-examples&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 上，你可以到以下的 repo 去尋找，具體專案對應的教學名稱，則請參考 &lt;code&gt;README.md&lt;/code&gt; 檔案
&lt;/p&gt;

&lt;div data-theme=&quot;default&quot; data-height=&quot;&quot; data-width=&quot;400&quot; data-github=&quot;coldnew/zybo-examples&quot; class=&quot;github-card&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id=&quot;outline-container-org4a00a6c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org4a00a6c&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org4a00a6c&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;http://johanngoetz.blogspot.tw/2014/04/first-steps-with-zybo-development-board.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FPGA Programming: First Steps with the ZYBO Development Board&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://www.borisivanov.com/fpga/verilog_zybo1.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Simple Verilog example useing Vivado 2015 with zybo FPGA board v0.1&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[3]&lt;/code&gt; &lt;a href=&quot;http://ece.gmu.edu/coursewebpages/ECE/ECE699_SW_HW/S15/viewgraphs/ECE699_lecture_3.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ECE 699: Lecture 3 General Purpose Input Output GPIO&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[4]&lt;/code&gt; &lt;a href=&quot;http://www.beyond-circuits.com/wordpress/tutorial/tutorial1/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Tutorial 1: The Simplest FPGA in the World | Beyond Circuits&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/6c5717d7/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board 開發記錄: 讓 Vivado 有 Zybo Board 的設定檔</title>
      <link>https://coldnew.github.io/cd57308/</link>
      <guid>https://coldnew.github.io/cd57308/</guid>
      <pubDate>Mon, 27 Jun 2016 09:49:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在透過 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 去建立新的專案的時候，開發板沒有 Zybo Board 的選項可以選，我們就必須自己去設定關於 Zybo Board 的資訊。幸好， &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilentinc&lt;/a&gt; 針對這個問題有提供關於 Zybo Board 的設定檔，就讓我們來搞定他吧。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
關於 Zybo Board 的設定檔可以在 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilentinc&lt;/a&gt; 的 GitHub 上找到
&lt;/p&gt;

&lt;div data-theme=&quot;default&quot; data-height=&quot;150&quot; data-width=&quot;400&quot; data-github=&quot;Digilent/vivado-boards&quot; class=&quot;github-card&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;

&lt;div id=&quot;outline-container-org9a484a3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org9a484a3&quot;&gt;下載設定檔&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org9a484a3&quot;&gt;
&lt;p&gt;
我們可以透過 git 或是直接下載 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilentinc&lt;/a&gt; 位於 GitHub 的 &lt;a href=&quot;https://github.com/Digilent/vivado-boards/archive/master.zip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;設定檔&lt;/a&gt; ，這邊採用 wget 進行下載。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ wget https://github.com/Digilent/vivado-boards/archive/master.zip
&lt;/pre&gt;

&lt;p&gt;
下載完成後，將其解壓
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ unzip master.zip
&lt;/pre&gt;

&lt;p&gt;
你會看到裡面有以下內容，實際上這份壓縮包包含了所有 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilentinc&lt;/a&gt; 設計的 Xilinx 相關的開發板的設定資訊。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/vivado-boards-master $ tree -L 3 .
. &amp;lt;b&amp;gt;
├── new &amp;lt;b&amp;gt;
│   └── board_files &amp;lt;b&amp;gt;
│       ├── arty &amp;lt;b&amp;gt;
│       ├── arty-z20  &amp;lt;b&amp;gt;
│       ├── basys3  &amp;lt;b&amp;gt;
│       ├── cmod_a7-15t  &amp;lt;b&amp;gt;
│       ├── cmod_a7-35t  &amp;lt;b&amp;gt;
│       ├── genesys2  &amp;lt;b&amp;gt;
│       ├── nexys4  &amp;lt;b&amp;gt;
│       ├── nexys4_ddr  &amp;lt;b&amp;gt;
│       ├── nexys_video  &amp;lt;b&amp;gt;
│       └── zybo  &amp;lt;b&amp;gt;
├── old  &amp;lt;b&amp;gt;
│   └── board_parts  &amp;lt;b&amp;gt;
│       ├── artix7  &amp;lt;b&amp;gt;
│       ├── kintex7  &amp;lt;b&amp;gt;
│       └── zynq  &amp;lt;b&amp;gt;
└── README.md

17 directories, 1 file
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge20ed09&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge20ed09&quot;&gt;安裝設定檔&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge20ed09&quot;&gt;
&lt;p&gt;
接下來就是進行安裝了，假設你的 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 安裝到 &lt;code&gt;/opt/Xilinx/Vivado/2016.1/&lt;/code&gt; 的話，我們要把 &lt;code&gt;vivado-boards-master/new/board_files&lt;/code&gt; 複製過去
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/vivado-boards-master $ cp -rf new/board_files /opt/Xilinx/Vivado/2016.1/data/boards/
&lt;/pre&gt;

&lt;p&gt;
完成後，你在 &lt;code&gt;/opt/Xilinx/Vivado/2016.1/data/boards/&lt;/code&gt; 的資料應該會像這樣
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo /opt/Xilinx/Vivado/2016.1/data/boards/board_files $ tree -L 1 .
. &amp;lt;b&amp;gt;
├── ac701 &amp;lt;b&amp;gt;
├── arty &amp;lt;b&amp;gt;
├── basys3 &amp;lt;b&amp;gt;
├── cmod_a7-15t &amp;lt;b&amp;gt;
├── cmod_a7-35t &amp;lt;b&amp;gt;
├── genesys2 &amp;lt;b&amp;gt;
├── nexys4 &amp;lt;b&amp;gt;
├── nexys4_ddr &amp;lt;b&amp;gt;
├── nexys_video &amp;lt;b&amp;gt;
├── README.md
├── zc702 &amp;lt;b&amp;gt;
├── zed &amp;lt;b&amp;gt;
└── zybo &amp;lt;b&amp;gt;

12 directories, 1 file
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb034d03&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb034d03&quot;&gt;建立專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb034d03&quot;&gt;
&lt;p&gt;
如果你安裝過程都沒遇到問題，重新啟動 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 建立新的專案，就可以看到 Zybo Board 的開發板設定囉~
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/cd57308/zybo_create_prj.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org27a33e5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org27a33e5&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org27a33e5&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;https://reference.digilentinc.com/vivado/boardfiles2015&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://reference.digilentinc.com/vivado/boardfiles2015&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在透過 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 去建立新的專案的時候，開發板沒有 Zybo Board 的選項可以選，我們就必須自己去設定關於 Zybo Board 的資訊。幸好， &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilentinc&lt;/a&gt; 針對這個問題有提供關於 Zybo Board 的設定檔，就讓我們來搞定他吧。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
關於 Zybo Board 的設定檔可以在 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilentinc&lt;/a&gt; 的 GitHub 上找到
&lt;/p&gt;

&lt;div data-theme=&quot;default&quot; data-height=&quot;150&quot; data-width=&quot;400&quot; data-github=&quot;Digilent/vivado-boards&quot; class=&quot;github-card&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;

&lt;div id=&quot;outline-container-org9a484a3&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org9a484a3&quot;&gt;下載設定檔&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org9a484a3&quot;&gt;
&lt;p&gt;
我們可以透過 git 或是直接下載 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilentinc&lt;/a&gt; 位於 GitHub 的 &lt;a href=&quot;https://github.com/Digilent/vivado-boards/archive/master.zip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;設定檔&lt;/a&gt; ，這邊採用 wget 進行下載。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ wget https://github.com/Digilent/vivado-boards/archive/master.zip
&lt;/pre&gt;

&lt;p&gt;
下載完成後，將其解壓
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ unzip master.zip
&lt;/pre&gt;

&lt;p&gt;
你會看到裡面有以下內容，實際上這份壓縮包包含了所有 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilentinc&lt;/a&gt; 設計的 Xilinx 相關的開發板的設定資訊。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/vivado-boards-master $ tree -L 3 .
. &amp;lt;b&amp;gt;
├── new &amp;lt;b&amp;gt;
│   └── board_files &amp;lt;b&amp;gt;
│       ├── arty &amp;lt;b&amp;gt;
│       ├── arty-z20  &amp;lt;b&amp;gt;
│       ├── basys3  &amp;lt;b&amp;gt;
│       ├── cmod_a7-15t  &amp;lt;b&amp;gt;
│       ├── cmod_a7-35t  &amp;lt;b&amp;gt;
│       ├── genesys2  &amp;lt;b&amp;gt;
│       ├── nexys4  &amp;lt;b&amp;gt;
│       ├── nexys4_ddr  &amp;lt;b&amp;gt;
│       ├── nexys_video  &amp;lt;b&amp;gt;
│       └── zybo  &amp;lt;b&amp;gt;
├── old  &amp;lt;b&amp;gt;
│   └── board_parts  &amp;lt;b&amp;gt;
│       ├── artix7  &amp;lt;b&amp;gt;
│       ├── kintex7  &amp;lt;b&amp;gt;
│       └── zynq  &amp;lt;b&amp;gt;
└── README.md

17 directories, 1 file
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge20ed09&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge20ed09&quot;&gt;安裝設定檔&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge20ed09&quot;&gt;
&lt;p&gt;
接下來就是進行安裝了，假設你的 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 安裝到 &lt;code&gt;/opt/Xilinx/Vivado/2016.1/&lt;/code&gt; 的話，我們要把 &lt;code&gt;vivado-boards-master/new/board_files&lt;/code&gt; 複製過去
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/vivado-boards-master $ cp -rf new/board_files /opt/Xilinx/Vivado/2016.1/data/boards/
&lt;/pre&gt;

&lt;p&gt;
完成後，你在 &lt;code&gt;/opt/Xilinx/Vivado/2016.1/data/boards/&lt;/code&gt; 的資料應該會像這樣
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo /opt/Xilinx/Vivado/2016.1/data/boards/board_files $ tree -L 1 .
. &amp;lt;b&amp;gt;
├── ac701 &amp;lt;b&amp;gt;
├── arty &amp;lt;b&amp;gt;
├── basys3 &amp;lt;b&amp;gt;
├── cmod_a7-15t &amp;lt;b&amp;gt;
├── cmod_a7-35t &amp;lt;b&amp;gt;
├── genesys2 &amp;lt;b&amp;gt;
├── nexys4 &amp;lt;b&amp;gt;
├── nexys4_ddr &amp;lt;b&amp;gt;
├── nexys_video &amp;lt;b&amp;gt;
├── README.md
├── zc702 &amp;lt;b&amp;gt;
├── zed &amp;lt;b&amp;gt;
└── zybo &amp;lt;b&amp;gt;

12 directories, 1 file
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb034d03&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb034d03&quot;&gt;建立專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb034d03&quot;&gt;
&lt;p&gt;
如果你安裝過程都沒遇到問題，重新啟動 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 建立新的專案，就可以看到 Zybo Board 的開發板設定囉~
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/cd57308/zybo_create_prj.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org27a33e5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org27a33e5&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org27a33e5&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;https://reference.digilentinc.com/vivado/boardfiles2015&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://reference.digilentinc.com/vivado/boardfiles2015&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/cd57308/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board 開發記錄: Xilinx SDK 在 Linux 的一些注意事項</title>
      <link>https://coldnew.github.io/8d3a2531/</link>
      <guid>https://coldnew.github.io/8d3a2531/</guid>
      <pubDate>Mon, 27 Jun 2016 07:38:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在使用 Xilinx 的開發環境 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado 2016.1&lt;/a&gt; 有遇到一些問題，特別紀錄之。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
(Xilinx 的開發環境 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 使用 Java 開發，而 Altera 的 &lt;a href=&quot;http://dl.altera.com/?edition=lite&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Quartus&lt;/a&gt; 使用 Qt 開發，以我遇到的狀況來說，後者在 Linux 上的體驗好多了。)
&lt;/p&gt;

&lt;div id=&quot;outline-container-orgb4d67f0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb4d67f0&quot;&gt;安裝 Vivado 在其他的 Linux 平台&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb4d67f0&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 安裝程式在非官方支援的 Linux 平台上可能會導致安裝出問題，以我的 Gentoo Linux 為例，我必須把解壓出的 &lt;code&gt;xsetup&lt;/code&gt; 安裝腳本裡面的這部分修改掉，不然會在 64bit 並具有 32bit 函式庫的 Gentoo Linux 下安裝失敗。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;ERROR out if this installation is running on 32 bit OS&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;and does not support 32 bit installation&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;$(&lt;/span&gt;&lt;span style=&quot;color: #fa8072;&quot;&gt;uname&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt; -i)&quot;&lt;/span&gt; != &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;x86_64&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;; &lt;span style=&quot;color: #aaffaa;&quot;&gt;then&lt;/span&gt;
    &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;check that the 32 bit library directory exist or not&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;lnx32LibDir&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;${workingDir}/lib/lnx32.o&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt; &lt;span style=&quot;color: #ff3333;&quot;&gt;!&lt;/span&gt; -d $&lt;span style=&quot;color: #aaccff;&quot;&gt;lnx32LibDir&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;; &lt;span style=&quot;color: #aaffaa;&quot;&gt;then&lt;/span&gt;
        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;terminate with an ERROR&lt;/span&gt;
        &lt;span style=&quot;color: #ccaaff;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;ERROR: This installation is not supported on 32 bit platforms.&quot;&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;exit&lt;/span&gt; 1  &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;lt;----- NOTE: Just remove this line if your linux is 64-bit system&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;fi&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;fi&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org32d606a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org32d606a&quot;&gt;讓 Linux 辨識 USB UART&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org32d606a&quot;&gt;
&lt;p&gt;
如果你接上 USB 到 Zybo Board 的 USB UART 接腳，卻沒在你的 Linux 上面看到任何 &lt;code&gt;/dev/ttyUSB*&lt;/code&gt; 被建立的話，那就是你少裝了一些 UDEV rule，這邊的說明可以在  &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_2/ug973-vivado-release-notes-install-license.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado Design Suite User Guide&lt;/a&gt; 找到，簡單的說&amp;#x2026;.
&lt;/p&gt;

&lt;p&gt;
假設你的 vivado 安裝在 &lt;code&gt;/opt/Xilinx/Vivado/2016.1&lt;/code&gt; 的話，我們可以透過以下程式來安裝 udev 設定。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
/opt/Xilinx/Vivado/2016.1/data/xicom/cable_drivers/lin64/install_script/install_drivers/install_digilent.sh
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org7e47f2d&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7e47f2d&quot;&gt;HiDPI 環境下的 Vivado 問題&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7e47f2d&quot;&gt;
&lt;p&gt;
我是在 Macbook Pro 2015 上直接安裝 Gentoo Linux 來執行 Vivado, 因此會遇到顯示出來的 Vivado 程式因為 DPI 設定的問題，導致畫面太小，像這樣
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8d3a2531/vivado_hidpi_issue.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
這問題的元兇是 &lt;a href=&quot;http://www.oracle.com/technetwork/java/javase/downloads/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Oracle JDK&lt;/a&gt; 使用 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Swing_%28Java%29&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Java Swing&lt;/a&gt; 時，在 Linux 上並未支援 HiDPI 解析度，導致出現的畫面太小，這 &lt;a href=&quot;http://openjdk.java.net/jeps/263&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;問題&lt;/a&gt; 據說會修正在 JDK 9 上，目前我們只能用一些臨時解 (workround)來處理這狀況，或是將 Vivado 視窗移動到解析度沒那樣好的外接螢幕上也可以。
&lt;/p&gt;

&lt;p&gt;
針對 HiDPI 下，我採用的另外一種解決方案是使用 &lt;a href=&quot;https://github.com/feklee/vncdesk&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;vncdesk&lt;/a&gt; 來協助我們透過 VNC 協定對特定的程式進行視窗的縮放功能，該程式會在背景啟動一個 VNC 伺服器，然後在根據我們的設定啟動我們需要的程式，接著呼叫 VNC Client 並進行畫面縮放來達到我們的要求。
&lt;/p&gt;

&lt;p&gt;
在 Gentoo Linux 上，你可以透過我寫好的 &lt;a href=&quot;https://github.com/coldnew/coldnew-overlay/blob/master/app-misc/vncdesk/vncdesk-1.4.0.ebuild&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ebuild&lt;/a&gt; 來安裝 vncdesk
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ sudo emerge app-misc/vncdesk
&lt;/pre&gt;

&lt;p&gt;
另外要注意到的是，vncdesk 只支援 Python 3.x，因此你也需要將系統的 python 版本切換到 3.x 系列，這邊我將它切換到 Python 3.4 去。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ sudo eselect python list
Available Python interpreters, in order of preference:
  [1]   python2.7
  [2]   python3.4
  [3]   python3.5 (fallback)
coldnew@gentoo ~ $ sudo eselect python set 2
&lt;/pre&gt;

&lt;p&gt;
完成後，接下來我們要建立一些設定檔案，我們首先先建立 &lt;code&gt;~/.vncdesk&lt;/code&gt; 資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ mkdir -p ~/.vncdesk
&lt;/pre&gt;

&lt;p&gt;
假設我們要使用 &lt;code&gt;DISPLAY=:21&lt;/code&gt; 來作為 Vivado 顯示用的位置的話，我們要建立 &lt;code&gt;~/.vncdesk/21&lt;/code&gt; 這樣的資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ mkdir -p ~/.vncdesk/21
&lt;/pre&gt;

&lt;p&gt;
而在 &lt;code&gt;~/.vncdesk/21&lt;/code&gt; 則要再建立以下兩個檔案
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/vncdesk/21 $ tree .
. &amp;lt;b&amp;gt;
├── settings.ini
└── startup &amp;lt;g&amp;gt;

0 directories, 2 files
&lt;/pre&gt;

&lt;p&gt;
我們先來看 &lt;code&gt;settings.ini&lt;/code&gt; 這個檔案，這是 vncdesk 最主要的設定，裡面包含了你要建立的視窗名稱、大小以及縮放度
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-conf&quot;&gt;[&lt;span style=&quot;color: #fff59d;&quot;&gt;desktop&lt;/span&gt;]
&lt;span style=&quot;color: #aaccff;&quot;&gt;width&lt;/span&gt; = 1280
&lt;span style=&quot;color: #aaccff;&quot;&gt;height&lt;/span&gt; = 800

[&lt;span style=&quot;color: #fff59d;&quot;&gt;window&lt;/span&gt;]
&lt;span style=&quot;color: #aaccff;&quot;&gt;title&lt;/span&gt; = Xilinx Vivado
&lt;span style=&quot;color: #aaccff;&quot;&gt;name&lt;/span&gt; = vivado in vncdesk
&lt;span style=&quot;color: #aaccff;&quot;&gt;class&lt;/span&gt; = FigInVncdesk
&lt;span style=&quot;color: #aaccff;&quot;&gt;scale_factor&lt;/span&gt; = 1.8
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來則是我們執行程式用的腳本 &lt;code&gt;startup&lt;/code&gt; ，記得這個檔案需要加上執行權限，在這份檔案中，我們先設定幾個環境變數，接著由於可能會有多視窗的需求，因此啟用 &lt;code&gt;openbox&lt;/code&gt; 1 作為窗口管理程式，最後則是啟動 vivado 這隻程式。
&lt;/p&gt;

&lt;p&gt;
注意到 &lt;code&gt;export SWT_GTK3=0&lt;/code&gt; 這個設定，待會會解釋它到底會有啥影響，總之先照著設定就是了。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;!/bin/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;sh&lt;/span&gt;

&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;LC_ALL&lt;/span&gt;=C
&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;SWT_GTK3&lt;/span&gt;=0   &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Fix annoying error on Xilinx SDK&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Make java application look more nice&lt;/span&gt;
&lt;span style=&quot;color: #aaccff;&quot;&gt;_SILENT_JAVA_OPTIONS&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;-Dawt.useSystemAAFontSettings=on -Dsun.java2d.xrender=true -Dswing.aatext=true&quot;&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;unset&lt;/span&gt; _JAVA_OPTIONS
&lt;span style=&quot;color: #ccaaff;&quot;&gt;alias&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;java&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;java $_SILENT_JAVA_OPTIONS&#39;&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;start window manager&lt;/span&gt;
openbox &amp;amp;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Source vivado env before launch&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;TARGET_DIR&lt;/span&gt;=/opt/Xilinx/Vivado/2016.1
&lt;span style=&quot;color: #ccaaff;&quot;&gt;source&lt;/span&gt; $&lt;span style=&quot;color: #aaccff;&quot;&gt;TARGET_DIR&lt;/span&gt;/settings64.sh

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Launch Vivado&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;cd&lt;/span&gt; /tmp
&lt;span style=&quot;color: #aaffaa;&quot;&gt;exec&lt;/span&gt; $&lt;span style=&quot;color: #aaccff;&quot;&gt;TARGET_DIR&lt;/span&gt;/bin/vivado
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這兩個設定都建立好以後，我們就可以用以下命令去執行畫面有縮放過的 Vivado 程式
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ vncdesk 21
&lt;/pre&gt;

&lt;p&gt;
顯示的畫面會變成這樣，在 HiDPI 的環境下也就清楚多了
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8d3a2531/vncdesk.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgeccf3dd&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgeccf3dd&quot;&gt;一定要設定 export SWT_GTK3=0&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgeccf3dd&quot;&gt;
&lt;p&gt;
在上面我們說了要設定 &lt;code&gt;SWT_GTK3=0&lt;/code&gt; ，如果不設定的話，很容易出現問題，以我遇到的狀況來講，我在 Xilinx SDK 想要建立 Zynq Boot Image，但是視窗卻不會給我彈出來
&lt;/p&gt;

&lt;iframe width=&quot;420&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/AQtjDvPhMiQ&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;

&lt;p&gt;
如果你設定了 &lt;code&gt;SWT_GTK3=0&lt;/code&gt; 後在啟動 Xilinx SDK，這問題就不見囉 = =|||
&lt;/p&gt;

&lt;iframe width=&quot;420&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/dRtCMgc-bHA&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org348c450&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org348c450&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org348c450&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_2/ug973-vivado-release-notes-install-license.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado Design Suite User Guide&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在使用 Xilinx 的開發環境 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado 2016.1&lt;/a&gt; 有遇到一些問題，特別紀錄之。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
(Xilinx 的開發環境 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 使用 Java 開發，而 Altera 的 &lt;a href=&quot;http://dl.altera.com/?edition=lite&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Quartus&lt;/a&gt; 使用 Qt 開發，以我遇到的狀況來說，後者在 Linux 上的體驗好多了。)
&lt;/p&gt;

&lt;div id=&quot;outline-container-orgb4d67f0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb4d67f0&quot;&gt;安裝 Vivado 在其他的 Linux 平台&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb4d67f0&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 安裝程式在非官方支援的 Linux 平台上可能會導致安裝出問題，以我的 Gentoo Linux 為例，我必須把解壓出的 &lt;code&gt;xsetup&lt;/code&gt; 安裝腳本裡面的這部分修改掉，不然會在 64bit 並具有 32bit 函式庫的 Gentoo Linux 下安裝失敗。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;ERROR out if this installation is running on 32 bit OS&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;and does not support 32 bit installation&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;$(&lt;/span&gt;&lt;span style=&quot;color: #fa8072;&quot;&gt;uname&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt; -i)&quot;&lt;/span&gt; != &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;x86_64&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;; &lt;span style=&quot;color: #aaffaa;&quot;&gt;then&lt;/span&gt;
    &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;check that the 32 bit library directory exist or not&lt;/span&gt;
    &lt;span style=&quot;color: #aaccff;&quot;&gt;lnx32LibDir&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;${workingDir}/lib/lnx32.o&quot;&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;[&lt;/span&gt; &lt;span style=&quot;color: #ff3333;&quot;&gt;!&lt;/span&gt; -d $&lt;span style=&quot;color: #aaccff;&quot;&gt;lnx32LibDir&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;]&lt;/span&gt;; &lt;span style=&quot;color: #aaffaa;&quot;&gt;then&lt;/span&gt;
        &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;terminate with an ERROR&lt;/span&gt;
        &lt;span style=&quot;color: #ccaaff;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;ERROR: This installation is not supported on 32 bit platforms.&quot;&lt;/span&gt;
        &lt;span style=&quot;color: #aaffaa;&quot;&gt;exit&lt;/span&gt; 1  &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;&amp;lt;----- NOTE: Just remove this line if your linux is 64-bit system&lt;/span&gt;
    &lt;span style=&quot;color: #aaffaa;&quot;&gt;fi&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa;&quot;&gt;fi&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org32d606a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org32d606a&quot;&gt;讓 Linux 辨識 USB UART&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org32d606a&quot;&gt;
&lt;p&gt;
如果你接上 USB 到 Zybo Board 的 USB UART 接腳，卻沒在你的 Linux 上面看到任何 &lt;code&gt;/dev/ttyUSB*&lt;/code&gt; 被建立的話，那就是你少裝了一些 UDEV rule，這邊的說明可以在  &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_2/ug973-vivado-release-notes-install-license.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado Design Suite User Guide&lt;/a&gt; 找到，簡單的說&amp;#x2026;.
&lt;/p&gt;

&lt;p&gt;
假設你的 vivado 安裝在 &lt;code&gt;/opt/Xilinx/Vivado/2016.1&lt;/code&gt; 的話，我們可以透過以下程式來安裝 udev 設定。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
/opt/Xilinx/Vivado/2016.1/data/xicom/cable_drivers/lin64/install_script/install_drivers/install_digilent.sh
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org7e47f2d&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7e47f2d&quot;&gt;HiDPI 環境下的 Vivado 問題&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7e47f2d&quot;&gt;
&lt;p&gt;
我是在 Macbook Pro 2015 上直接安裝 Gentoo Linux 來執行 Vivado, 因此會遇到顯示出來的 Vivado 程式因為 DPI 設定的問題，導致畫面太小，像這樣
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8d3a2531/vivado_hidpi_issue.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
這問題的元兇是 &lt;a href=&quot;http://www.oracle.com/technetwork/java/javase/downloads/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Oracle JDK&lt;/a&gt; 使用 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/Swing_%28Java%29&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Java Swing&lt;/a&gt; 時，在 Linux 上並未支援 HiDPI 解析度，導致出現的畫面太小，這 &lt;a href=&quot;http://openjdk.java.net/jeps/263&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;問題&lt;/a&gt; 據說會修正在 JDK 9 上，目前我們只能用一些臨時解 (workround)來處理這狀況，或是將 Vivado 視窗移動到解析度沒那樣好的外接螢幕上也可以。
&lt;/p&gt;

&lt;p&gt;
針對 HiDPI 下，我採用的另外一種解決方案是使用 &lt;a href=&quot;https://github.com/feklee/vncdesk&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;vncdesk&lt;/a&gt; 來協助我們透過 VNC 協定對特定的程式進行視窗的縮放功能，該程式會在背景啟動一個 VNC 伺服器，然後在根據我們的設定啟動我們需要的程式，接著呼叫 VNC Client 並進行畫面縮放來達到我們的要求。
&lt;/p&gt;

&lt;p&gt;
在 Gentoo Linux 上，你可以透過我寫好的 &lt;a href=&quot;https://github.com/coldnew/coldnew-overlay/blob/master/app-misc/vncdesk/vncdesk-1.4.0.ebuild&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ebuild&lt;/a&gt; 來安裝 vncdesk
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ sudo emerge app-misc/vncdesk
&lt;/pre&gt;

&lt;p&gt;
另外要注意到的是，vncdesk 只支援 Python 3.x，因此你也需要將系統的 python 版本切換到 3.x 系列，這邊我將它切換到 Python 3.4 去。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ sudo eselect python list
Available Python interpreters, in order of preference:
  [1]   python2.7
  [2]   python3.4
  [3]   python3.5 (fallback)
coldnew@gentoo ~ $ sudo eselect python set 2
&lt;/pre&gt;

&lt;p&gt;
完成後，接下來我們要建立一些設定檔案，我們首先先建立 &lt;code&gt;~/.vncdesk&lt;/code&gt; 資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ mkdir -p ~/.vncdesk
&lt;/pre&gt;

&lt;p&gt;
假設我們要使用 &lt;code&gt;DISPLAY=:21&lt;/code&gt; 來作為 Vivado 顯示用的位置的話，我們要建立 &lt;code&gt;~/.vncdesk/21&lt;/code&gt; 這樣的資料夾
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ mkdir -p ~/.vncdesk/21
&lt;/pre&gt;

&lt;p&gt;
而在 &lt;code&gt;~/.vncdesk/21&lt;/code&gt; 則要再建立以下兩個檔案
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/vncdesk/21 $ tree .
. &amp;lt;b&amp;gt;
├── settings.ini
└── startup &amp;lt;g&amp;gt;

0 directories, 2 files
&lt;/pre&gt;

&lt;p&gt;
我們先來看 &lt;code&gt;settings.ini&lt;/code&gt; 這個檔案，這是 vncdesk 最主要的設定，裡面包含了你要建立的視窗名稱、大小以及縮放度
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-conf&quot;&gt;[&lt;span style=&quot;color: #fff59d;&quot;&gt;desktop&lt;/span&gt;]
&lt;span style=&quot;color: #aaccff;&quot;&gt;width&lt;/span&gt; = 1280
&lt;span style=&quot;color: #aaccff;&quot;&gt;height&lt;/span&gt; = 800

[&lt;span style=&quot;color: #fff59d;&quot;&gt;window&lt;/span&gt;]
&lt;span style=&quot;color: #aaccff;&quot;&gt;title&lt;/span&gt; = Xilinx Vivado
&lt;span style=&quot;color: #aaccff;&quot;&gt;name&lt;/span&gt; = vivado in vncdesk
&lt;span style=&quot;color: #aaccff;&quot;&gt;class&lt;/span&gt; = FigInVncdesk
&lt;span style=&quot;color: #aaccff;&quot;&gt;scale_factor&lt;/span&gt; = 1.8
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接下來則是我們執行程式用的腳本 &lt;code&gt;startup&lt;/code&gt; ，記得這個檔案需要加上執行權限，在這份檔案中，我們先設定幾個環境變數，接著由於可能會有多視窗的需求，因此啟用 &lt;code&gt;openbox&lt;/code&gt; 1 作為窗口管理程式，最後則是啟動 vivado 這隻程式。
&lt;/p&gt;

&lt;p&gt;
注意到 &lt;code&gt;export SWT_GTK3=0&lt;/code&gt; 這個設定，待會會解釋它到底會有啥影響，總之先照著設定就是了。
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;!/bin/&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;sh&lt;/span&gt;

&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;LC_ALL&lt;/span&gt;=C
&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;SWT_GTK3&lt;/span&gt;=0   &lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Fix annoying error on Xilinx SDK&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Make java application look more nice&lt;/span&gt;
&lt;span style=&quot;color: #aaccff;&quot;&gt;_SILENT_JAVA_OPTIONS&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;-Dawt.useSystemAAFontSettings=on -Dsun.java2d.xrender=true -Dswing.aatext=true&quot;&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;unset&lt;/span&gt; _JAVA_OPTIONS
&lt;span style=&quot;color: #ccaaff;&quot;&gt;alias&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;java&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;java $_SILENT_JAVA_OPTIONS&#39;&lt;/span&gt;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;start window manager&lt;/span&gt;
openbox &amp;amp;

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Source vivado env before launch&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;TARGET_DIR&lt;/span&gt;=/opt/Xilinx/Vivado/2016.1
&lt;span style=&quot;color: #ccaaff;&quot;&gt;source&lt;/span&gt; $&lt;span style=&quot;color: #aaccff;&quot;&gt;TARGET_DIR&lt;/span&gt;/settings64.sh

&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;Launch Vivado&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;cd&lt;/span&gt; /tmp
&lt;span style=&quot;color: #aaffaa;&quot;&gt;exec&lt;/span&gt; $&lt;span style=&quot;color: #aaccff;&quot;&gt;TARGET_DIR&lt;/span&gt;/bin/vivado
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這兩個設定都建立好以後，我們就可以用以下命令去執行畫面有縮放過的 Vivado 程式
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~ $ vncdesk 21
&lt;/pre&gt;

&lt;p&gt;
顯示的畫面會變成這樣，在 HiDPI 的環境下也就清楚多了
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/8d3a2531/vncdesk.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgeccf3dd&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgeccf3dd&quot;&gt;一定要設定 export SWT_GTK3=0&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgeccf3dd&quot;&gt;
&lt;p&gt;
在上面我們說了要設定 &lt;code&gt;SWT_GTK3=0&lt;/code&gt; ，如果不設定的話，很容易出現問題，以我遇到的狀況來講，我在 Xilinx SDK 想要建立 Zynq Boot Image，但是視窗卻不會給我彈出來
&lt;/p&gt;

&lt;iframe width=&quot;420&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/AQtjDvPhMiQ&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;

&lt;p&gt;
如果你設定了 &lt;code&gt;SWT_GTK3=0&lt;/code&gt; 後在啟動 Xilinx SDK，這問題就不見囉 = =|||
&lt;/p&gt;

&lt;iframe width=&quot;420&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/dRtCMgc-bHA&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org348c450&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org348c450&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org348c450&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_2/ug973-vivado-release-notes-install-license.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado Design Suite User Guide&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/8d3a2531/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board 開發記錄: 升級 Digilent 提供的設計檔</title>
      <link>https://coldnew.github.io/49454c4d/</link>
      <guid>https://coldnew.github.io/49454c4d/</guid>
      <pubDate>Sun, 26 Jun 2016 15:31:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://store.digilentinc.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilent&lt;/a&gt; 針對 &lt;a href=&quot;http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo board&lt;/a&gt; 用於 Embedded Linux 的環境上，提供了一個預先定義好接腳的設定檔 (zybo_base_system)， &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_base_system.zip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;早期的版本&lt;/a&gt; 是直接將專案打包起來釋出，後期則採用 git 去進行維護，其專案位於 &lt;a href=&quot;https://github.com/Digilent/ZYBO&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 上。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;div data-theme=&quot;default&quot; data-height=&quot;150&quot; data-width=&quot;400&quot; data-github=&quot;Digilent/ZYBO&quot; class=&quot;github-card&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;
由於 &lt;a href=&quot;http://store.digilentinc.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilent&lt;/a&gt; 提供的 git 版本的 &lt;a href=&quot;http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo board&lt;/a&gt; &lt;a href=&quot;https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;設定檔&lt;/a&gt; 會因為 Xilinx 的 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 開發工具的版本升級而變成版本不匹配的狀況，本文將紀錄如何對該設定檔進行升級並產生我們的專案。
&lt;/p&gt;

&lt;p&gt;
在撰寫本文時，該設定檔 commit id 為 &lt;a href=&quot;https://github.com/Digilent/ZYBO/commit/177c2c97c5cae29a05359479565c2f5256d8d629&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;177c2c&lt;/a&gt; ，使用的是 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 2015.4 版本， 我們要將它升級到 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 2016.1 去。
&lt;/p&gt;

&lt;div id=&quot;outline-container-org7dc2123&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7dc2123&quot;&gt;事前準備&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7dc2123&quot;&gt;
&lt;p&gt;
在進行升級時，你需要安裝好 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 2015.4 以及 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 2016.1 才能按照本文的步驟進行。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc96bab2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc96bab2&quot;&gt;下載設定檔並用 Vivado 2015.4 開啟&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc96bab2&quot;&gt;
&lt;p&gt;
我們首先下載 &lt;a href=&quot;http://store.digilentinc.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilent&lt;/a&gt; 提供的 &lt;a href=&quot;https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo board 設定檔&lt;/a&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;git clone https://github.com/Digilent/ZYBO.git -b vivado-2015.4 63ca49
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接著進入到 &lt;code&gt;ZYBO/Projects/linux_bd/proj&lt;/code&gt; 資料夾去，使用你的 vivado 2015.4 去產生新的專案
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ /opt/Xilinx/Vivado/2015.4/bin/vivado -mode batch -source create_project.tcl
&lt;/pre&gt;

&lt;p&gt;
如果不想用指令，也可以打開 Vivado 圖形界面，選擇 &lt;code&gt;Tools -&amp;gt; Run Tcl Script&lt;/code&gt; 然後再選 &lt;code&gt;create_project.tcl&lt;/code&gt; 這檔案去執行
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/run_tcl_script.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
完成後，你會發現當下目錄多出了一些檔案
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ tree -L 1
. &amp;lt;b&amp;gt;
├── cleanup.cmd
├── cleanup.sh
├── create_project.tcl
├── ip_upgrade.log &amp;lt;g&amp;gt;
├── linux_bd.cache &amp;lt;b&amp;gt;
├── linux_bd.hw &amp;lt;b&amp;gt;
├── linux_bd.ip_user_files &amp;lt;b&amp;gt;
├── linux_bd.sim &amp;lt;b&amp;gt;
├── linux_bd.srcs &amp;lt;b&amp;gt;
├── linux_bd.xpr
├── vivado.jou
└── vivado.log &amp;lt;g&amp;gt;

5 directories, 7 files
&lt;/pre&gt;

&lt;p&gt;
這些 linux_bd.* 檔案就是我們透過 Vivado 2015.4 產生的專案，接下來我們要用 &lt;code&gt;Vivado 2016.1&lt;/code&gt; 打開它去做升級的動作。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgdc498c6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgdc498c6&quot;&gt;升級設定檔&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgdc498c6&quot;&gt;
&lt;p&gt;
接下來我們使用 &lt;code&gt;Vivado 2016.1&lt;/code&gt; 打開我們剛剛用 Vivado 2015.4 所產生的 &lt;code&gt;linux_bd.*&lt;/code&gt; 專案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/prj_upgrade1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
由於原本的專案是透過 Vivado 2015.4 產生的，因此會被詢問要不要升級，這邊點選 &lt;code&gt;Report IP Status&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/prj_upgrade2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
接下來點選 &lt;code&gt;Upgrade Selected&lt;/code&gt; 將這些過時的 IP core 進行升級
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/prj_upgrade3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
沒出錯的話，過一段時間 Vivado 會回報升級完成
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/prj_upgrade4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
升級完成後，我們要產生幾個符合 Vivado 2016.1 的 &lt;code&gt;tcl 腳本&lt;/code&gt; ，這樣以後我們才可以用 Vivado 2016.1 產生我們的新專案
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgacbcea7&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgacbcea7&quot;&gt;產生 tcl 腳本&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgacbcea7&quot;&gt;
&lt;p&gt;
好了，現在我們把原本用於 Vivado 2015.4 的 tcl 腳本所產生的專案升級到 Vivado 2016.1 了，實際上導致我們不能夠直接使用 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 2016.1 來產生專案的原因，在於 &lt;code&gt;src/bd/system.tcl&lt;/code&gt; 這個檔案和 Vivado 的版本有依賴性，因此我們要重新產生新的 &lt;code&gt;system.tc&lt;/code&gt; 去將它替換掉
&lt;/p&gt;

&lt;p&gt;
透過 &lt;code&gt;File -&amp;gt; Export -&amp;gt; Export Block Design&lt;/code&gt; 來將新的 block design 匯出
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/prj_upgrade7.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
將它存放到 &lt;code&gt;ZYBO/Projects/linux_bd/src/bd/system.tcl&lt;/code&gt; 就完成囉~
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge9642f8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge9642f8&quot;&gt;將預設語言設為 Verilog&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge9642f8&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://store.digilentinc.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilent&lt;/a&gt; 針對 &lt;a href=&quot;http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo board&lt;/a&gt; 提供產生專案用的樣板，預設是採用 VHDL 作為這個專案用的硬體描述語言，如果你希望之後這樣建立的專案都是預設使用 Verilog 的話，你可以這樣修改 &lt;code&gt;create_project.tcl&lt;/code&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-diff&quot;&gt;&lt;span style=&quot;color: #dddddd;&quot;&gt;diff --git a/Projects/linux_bd/proj/create_project.tcl b/Projects/linux_bd/proj/create_project.tcl&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;index 825281a..74c726e 100644&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;--- &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;a/Projects/linux_bd/proj/create_project.tcl&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;+++ &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;b/Projects/linux_bd/proj/create_project.tcl&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -39,7 +39,7 @@&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt; set_property &quot;default_lib&quot; &quot;xil_defaultlib&quot; $obj&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt; set_property &quot;part&quot; $part $obj&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt; set_property &quot;board_part&quot; $brd_part $obj&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt; set_property &quot;simulator_language&quot; &quot;Mixed&quot; $obj&lt;/span&gt;
&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;set_property &quot;target_language&quot; &quot;VHDL&quot; $obj&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;set_property &quot;target_language&quot; &quot;Verilog&quot; $obj&lt;/span&gt;

&lt;span style=&quot;color: #dddddd;&quot;&gt; # Create &#39;sources_1&#39; fileset (if not found)&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt; if {[string equal [get_filesets -quiet sources_1] &quot;&quot;]} {&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣一來，透過 &lt;code&gt;create_project.tcl&lt;/code&gt; 建立的專案，不管是 HDL wrapper 或是預設 HDL 都會是 Verilog 囉~
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org3772caf&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org3772caf&quot;&gt;重建新的專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org3772caf&quot;&gt;
&lt;p&gt;
我們剛剛重建了 &lt;code&gt;src/bd/system.tcl&lt;/code&gt; 這個檔案，將其升級到 Vivado 2016.1 版本，現在可以試試重新產生新的專案囉
&lt;/p&gt;

&lt;p&gt;
不過由於我們可能有之前建立好名為 &lt;code&gt;linux_bd.*&lt;/code&gt; 的檔案，因此可以透過 &lt;code&gt;cleanup.sh&lt;/code&gt; 去將這些產生出來的檔案清除
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ sh cleanup.sh
&lt;/pre&gt;

&lt;p&gt;
接下來用 Vivado 2016.1 重新生出新的專案就好囉 ~
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ /opt/Xilinx/Vivado/2016.1/bin/vivado -mode batch -source create_project.tcl
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org97f0822&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org97f0822&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org97f0822&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://xillybus.com/tutorials/vivado-version-control-packaging&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado: Packaging for version control, distribution and repeatability&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[3]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_1/ug835-vivado-tcl-commands.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado Design Suite Tcl Command Reference Guide&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://store.digilentinc.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilent&lt;/a&gt; 針對 &lt;a href=&quot;http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo board&lt;/a&gt; 用於 Embedded Linux 的環境上，提供了一個預先定義好接腳的設定檔 (zybo_base_system)， &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_base_system.zip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;早期的版本&lt;/a&gt; 是直接將專案打包起來釋出，後期則採用 git 去進行維護，其專案位於 &lt;a href=&quot;https://github.com/Digilent/ZYBO&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub&lt;/a&gt; 上。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;div data-theme=&quot;default&quot; data-height=&quot;150&quot; data-width=&quot;400&quot; data-github=&quot;Digilent/ZYBO&quot; class=&quot;github-card&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;//cdn.jsdelivr.net/github-cards/latest/widget.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;
由於 &lt;a href=&quot;http://store.digilentinc.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilent&lt;/a&gt; 提供的 git 版本的 &lt;a href=&quot;http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo board&lt;/a&gt; &lt;a href=&quot;https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;設定檔&lt;/a&gt; 會因為 Xilinx 的 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 開發工具的版本升級而變成版本不匹配的狀況，本文將紀錄如何對該設定檔進行升級並產生我們的專案。
&lt;/p&gt;

&lt;p&gt;
在撰寫本文時，該設定檔 commit id 為 &lt;a href=&quot;https://github.com/Digilent/ZYBO/commit/177c2c97c5cae29a05359479565c2f5256d8d629&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;177c2c&lt;/a&gt; ，使用的是 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 2015.4 版本， 我們要將它升級到 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 2016.1 去。
&lt;/p&gt;

&lt;div id=&quot;outline-container-org7dc2123&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7dc2123&quot;&gt;事前準備&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7dc2123&quot;&gt;
&lt;p&gt;
在進行升級時，你需要安裝好 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 2015.4 以及 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 2016.1 才能按照本文的步驟進行。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc96bab2&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc96bab2&quot;&gt;下載設定檔並用 Vivado 2015.4 開啟&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc96bab2&quot;&gt;
&lt;p&gt;
我們首先下載 &lt;a href=&quot;http://store.digilentinc.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilent&lt;/a&gt; 提供的 &lt;a href=&quot;https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo board 設定檔&lt;/a&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;git clone https://github.com/Digilent/ZYBO.git -b vivado-2015.4 63ca49
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
接著進入到 &lt;code&gt;ZYBO/Projects/linux_bd/proj&lt;/code&gt; 資料夾去，使用你的 vivado 2015.4 去產生新的專案
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ /opt/Xilinx/Vivado/2015.4/bin/vivado -mode batch -source create_project.tcl
&lt;/pre&gt;

&lt;p&gt;
如果不想用指令，也可以打開 Vivado 圖形界面，選擇 &lt;code&gt;Tools -&amp;gt; Run Tcl Script&lt;/code&gt; 然後再選 &lt;code&gt;create_project.tcl&lt;/code&gt; 這檔案去執行
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/run_tcl_script.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
完成後，你會發現當下目錄多出了一些檔案
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ tree -L 1
. &amp;lt;b&amp;gt;
├── cleanup.cmd
├── cleanup.sh
├── create_project.tcl
├── ip_upgrade.log &amp;lt;g&amp;gt;
├── linux_bd.cache &amp;lt;b&amp;gt;
├── linux_bd.hw &amp;lt;b&amp;gt;
├── linux_bd.ip_user_files &amp;lt;b&amp;gt;
├── linux_bd.sim &amp;lt;b&amp;gt;
├── linux_bd.srcs &amp;lt;b&amp;gt;
├── linux_bd.xpr
├── vivado.jou
└── vivado.log &amp;lt;g&amp;gt;

5 directories, 7 files
&lt;/pre&gt;

&lt;p&gt;
這些 linux_bd.* 檔案就是我們透過 Vivado 2015.4 產生的專案，接下來我們要用 &lt;code&gt;Vivado 2016.1&lt;/code&gt; 打開它去做升級的動作。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgdc498c6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgdc498c6&quot;&gt;升級設定檔&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgdc498c6&quot;&gt;
&lt;p&gt;
接下來我們使用 &lt;code&gt;Vivado 2016.1&lt;/code&gt; 打開我們剛剛用 Vivado 2015.4 所產生的 &lt;code&gt;linux_bd.*&lt;/code&gt; 專案
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/prj_upgrade1.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
由於原本的專案是透過 Vivado 2015.4 產生的，因此會被詢問要不要升級，這邊點選 &lt;code&gt;Report IP Status&lt;/code&gt;
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/prj_upgrade2.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
接下來點選 &lt;code&gt;Upgrade Selected&lt;/code&gt; 將這些過時的 IP core 進行升級
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/prj_upgrade3.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
沒出錯的話，過一段時間 Vivado 會回報升級完成
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/prj_upgrade4.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
升級完成後，我們要產生幾個符合 Vivado 2016.1 的 &lt;code&gt;tcl 腳本&lt;/code&gt; ，這樣以後我們才可以用 Vivado 2016.1 產生我們的新專案
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgacbcea7&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgacbcea7&quot;&gt;產生 tcl 腳本&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgacbcea7&quot;&gt;
&lt;p&gt;
好了，現在我們把原本用於 Vivado 2015.4 的 tcl 腳本所產生的專案升級到 Vivado 2016.1 了，實際上導致我們不能夠直接使用 &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado&lt;/a&gt; 2016.1 來產生專案的原因，在於 &lt;code&gt;src/bd/system.tcl&lt;/code&gt; 這個檔案和 Vivado 的版本有依賴性，因此我們要重新產生新的 &lt;code&gt;system.tc&lt;/code&gt; 去將它替換掉
&lt;/p&gt;

&lt;p&gt;
透過 &lt;code&gt;File -&amp;gt; Export -&amp;gt; Export Block Design&lt;/code&gt; 來將新的 block design 匯出
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/49454c4d/prj_upgrade7.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
將它存放到 &lt;code&gt;ZYBO/Projects/linux_bd/src/bd/system.tcl&lt;/code&gt; 就完成囉~
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge9642f8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge9642f8&quot;&gt;將預設語言設為 Verilog&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge9642f8&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;http://store.digilentinc.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Digilent&lt;/a&gt; 針對 &lt;a href=&quot;http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo board&lt;/a&gt; 提供產生專案用的樣板，預設是採用 VHDL 作為這個專案用的硬體描述語言，如果你希望之後這樣建立的專案都是預設使用 Verilog 的話，你可以這樣修改 &lt;code&gt;create_project.tcl&lt;/code&gt;
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-diff&quot;&gt;&lt;span style=&quot;color: #dddddd;&quot;&gt;diff --git a/Projects/linux_bd/proj/create_project.tcl b/Projects/linux_bd/proj/create_project.tcl&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt;index 825281a..74c726e 100644&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;--- &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;a/Projects/linux_bd/proj/create_project.tcl&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;+++ &lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;b/Projects/linux_bd/proj/create_project.tcl&lt;/span&gt;
&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt;@@ -39,7 +39,7 @@&lt;/span&gt;&lt;span style=&quot;color: #aaaaaa; background-color: #202020;&quot;&gt; set_property &quot;default_lib&quot; &quot;xil_defaultlib&quot; $obj&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt; set_property &quot;part&quot; $part $obj&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt; set_property &quot;board_part&quot; $brd_part $obj&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt; set_property &quot;simulator_language&quot; &quot;Mixed&quot; $obj&lt;/span&gt;
&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #ff3333; font-weight: bold;&quot;&gt;set_property &quot;target_language&quot; &quot;VHDL&quot; $obj&lt;/span&gt;
&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #aaffaa; font-weight: bold;&quot;&gt;set_property &quot;target_language&quot; &quot;Verilog&quot; $obj&lt;/span&gt;

&lt;span style=&quot;color: #dddddd;&quot;&gt; # Create &#39;sources_1&#39; fileset (if not found)&lt;/span&gt;
&lt;span style=&quot;color: #dddddd;&quot;&gt; if {[string equal [get_filesets -quiet sources_1] &quot;&quot;]} {&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
這樣一來，透過 &lt;code&gt;create_project.tcl&lt;/code&gt; 建立的專案，不管是 HDL wrapper 或是預設 HDL 都會是 Verilog 囉~
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org3772caf&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org3772caf&quot;&gt;重建新的專案&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org3772caf&quot;&gt;
&lt;p&gt;
我們剛剛重建了 &lt;code&gt;src/bd/system.tcl&lt;/code&gt; 這個檔案，將其升級到 Vivado 2016.1 版本，現在可以試試重新產生新的專案囉
&lt;/p&gt;

&lt;p&gt;
不過由於我們可能有之前建立好名為 &lt;code&gt;linux_bd.*&lt;/code&gt; 的檔案，因此可以透過 &lt;code&gt;cleanup.sh&lt;/code&gt; 去將這些產生出來的檔案清除
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ sh cleanup.sh
&lt;/pre&gt;

&lt;p&gt;
接下來用 Vivado 2016.1 重新生出新的專案就好囉 ~
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ /opt/Xilinx/Vivado/2016.1/bin/vivado -mode batch -source create_project.tcl
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org97f0822&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org97f0822&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org97f0822&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://xillybus.com/tutorials/vivado-version-control-packaging&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado: Packaging for version control, distribution and repeatability&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[3]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_1/ug835-vivado-tcl-commands.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Vivado Design Suite Tcl Command Reference Guide&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/49454c4d/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board 開發記錄: 硬體認識</title>
      <link>https://coldnew.github.io/7004ff00/</link>
      <guid>https://coldnew.github.io/7004ff00/</guid>
      <pubDate>Thu, 23 Jun 2016 16:52:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
為了學習 RISC-V 以及體驗看看 Xilinx 的開發平台，最近我入手了 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; ，這是一塊具有 FPGA 同時又包含了 ARM Cortex-A9 雙核心的開發板。
&lt;/p&gt;

&lt;p&gt;
在我們開始這一切之前，我們需要稍微了解一下這片開發板以及他的週邊等資訊。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
要了解 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 的週邊，首先要看的就是開發商 &lt;a href=&quot;http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;DIGILENT&lt;/a&gt; 所提供的 &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO FPGA Board Reference Manual&lt;/a&gt;。
讓我們來看看一些比較重要的地方吧!
&lt;/p&gt;

&lt;div id=&quot;outline-container-org63381d6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org63381d6&quot;&gt;基本硬體認識&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org63381d6&quot;&gt;
&lt;p&gt;
拿到手的 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 會像下面這個樣子，我們有這些基本的輸入/輸出模組，以及未標示的部份(Pmod)，可以做延伸的功能
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/zybo_a.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
讓我們來看看這些週邊模組吧
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org7142416&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7142416&quot;&gt;電源輸入(5V)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7142416&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 允許三種不同類型的電源輸入模式，分別是 USB、外接電源(J15)、外接電池。我們可以從 &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Reference Manual&lt;/a&gt; 得到電源模組的大致資訊。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/power_cricuit_overview.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
控制電源輸入的位置在 &lt;code&gt;JP7&lt;/code&gt; 的排針座上，我們可以透過切換跳線(Jumper)來選擇我們需要的電源輸入，在週邊使用不多的情況下，我會直接使用 USB (5V) 來作為電流的輸入。
&lt;/p&gt;

&lt;p&gt;
要注意到的是，&lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 僅吃 &lt;code&gt;5V&lt;/code&gt; 電源，因此不論你是用外接電源(J15)或是外接電池，你最好都先確認你的電壓是否為 &lt;code&gt;5V&lt;/code&gt; (或是低於) ，否則你的開發板可能因此燒壞。
&lt;/p&gt;

&lt;p&gt;
插上電源後，透過電源開關 (Power Switch, SW4) 的切換即可完成給電/斷電的動作。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org29829b8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org29829b8&quot;&gt;Zynq SOC&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org29829b8&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 核心是 &lt;a href=&quot;http://www.xilinx.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xilinx&lt;/a&gt; Zynq-7000 系列的 &lt;a href=&quot;http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Z-7010&lt;/a&gt; ARM/FPGA SoC 處理器，這是一種混和了 FPGA 以及 ARM Cortex-A9 處理器的 FPGA 核心。以往的 FPGA 開發板需要用到 CPU 的時候只能夠燒錄用 HDL 語言撰寫的軟核心到開發板上，這種混搭 FPGA/ARM 的開發板則是讓你可以針對通用需求使用 ARM CPU 進行程式的開發，特殊需求則透過 FPGA 進行處理/加速來運作，是一種蠻有趣的架構。
&lt;/p&gt;

&lt;p&gt;
我們可以把 Zynq SoC 分為兩個區塊, 處理系統 (Processing System, PS) 以及 可程式邏輯區塊(Programmable Logic, PL)，像這樣
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/zynq_block.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
處理系統(Processing Syste, PS) 也就是有 ARM Cortex-A9 處理器的部份，可程式邏輯區塊(Programmable Logic, PL) 則是 FPGA 所包含的部份。
&lt;/p&gt;

&lt;p&gt;
在上面的區塊圖中，我們要另外注意到 &lt;code&gt;MIO (Multiplexed I/O)&lt;/code&gt; 以及 &lt;code&gt;EMIO (Extended multiplexed I/O)&lt;/code&gt; ，在 Zynq 7000 系列 SoC 中，我們共有 54 個 MIO 可用，而這些 MIO 所連接的位址是無法在 可程式邏輯區塊 (Programmable Logic, PL) 中看到。
&lt;/p&gt;

&lt;p&gt;
在 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 我們有這幾個地方是連接到 MIO (Multiplexed I/O) 上的
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/mio_pinout.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org08969e2&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org08969e2&quot;&gt;系統啟動流程&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org08969e2&quot;&gt;
&lt;p&gt;
由於 Zynq 7000 系列內建了 ARM CPU，也因此和傳統的 FPGA 開發板相比，系統啟動流程也會不同，整體開機流程可以分為三個階段:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
階段 0
&lt;/p&gt;

&lt;p&gt;
當 Zybo board 電源啟動後，CPU0 會執行內部已經預燒錄的程式 BootROM，這個程式會根據 &lt;code&gt;JP5&lt;/code&gt; 所設定的資訊來更新狀態暫存器(mode register)，接著 BootROM 會透過狀態讚存器(mode register)的資訊從 MicroSD、NOR Flash、JTAG 等位置抓取 Zynq Boot Image，並將包在 Zynq Boot Image 裡面的 &lt;code&gt;第一級啟動開機程式 (First Stage Bootloader, FSBL)&lt;/code&gt; 複製到內部 256KB 的記憶體 (On-Chip Memory, OCM) 去，最後執行 FSBL，進入下一個階段。
&lt;/p&gt;

&lt;p&gt;
如果 BootROM 是因為按下了 RESET 按鈕等狀況而被執行，Zybo board 會選用之前已經存放在狀態暫存器(mode register)的開機狀態，而不是當下的 &lt;code&gt;JP5&lt;/code&gt; 狀態。
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
階段 1
&lt;/p&gt;

&lt;p&gt;
在這階段中, 第一級啟動開機程式 (First Stage Bootloader, FSBL) 初始化了 DDR 記憶體、GPIO 等週邊設定，接下來會載入存放在 Boot Image 內的位元流 (bitstream)，用他來對可程式邏輯區塊 (Programmable Logic, PL) 進行設定。
&lt;/p&gt;

&lt;p&gt;
當可程式邏輯區塊(Programmable Logic, PL)設定完成後，FSBL 會去載入程式(ex: u-boot)並執行它。
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
階段 2
&lt;/p&gt;

&lt;p&gt;
最後的接段即是執行 FSBL 所載入的程式，這些程式可以從簡單的 &quot;Hello World&quot;，到像 u-boot 這樣的第二階段開機程式，用來載入 Linux 或是其他的作業系統。
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf5aba56&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgf5aba56&quot;&gt;更改開機模式&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgf5aba56&quot;&gt;
&lt;p&gt;
我們可以透過切換 &lt;code&gt;JP5&lt;/code&gt; 的跳線(Jumper)來決定我們要透過哪種方式去載入第一級啟動開機程式 (First Stage Bootloader, FSBL)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/zybo_config_pins.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga73afeb&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orga73afeb&quot;&gt;MicroSD 啟動&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orga73afeb&quot;&gt;
&lt;p&gt;
當使用者將 MicroSD 插入到 &lt;code&gt;J4&lt;/code&gt; 的 SD 卡槽，並設定好 &lt;code&gt;JP5&lt;/code&gt; 的跳線的話，我們可以透過 MicroSD 來進行開機的動作。
&lt;/p&gt;

&lt;p&gt;
若你希望透過 MicroSD 進行開機，你需要先設定好你的 SD 卡:
&lt;/p&gt;

&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;透過電腦格式化 MicroSD 卡成 &lt;code&gt;FAT32&lt;/code&gt; 檔案格式&lt;/li&gt;
&lt;li&gt;複製從 Xilinx SDK 製作出來的 Zynq Boot Image 到 MicroSD 卡上&lt;/li&gt;
&lt;li&gt;將 Zynq Boot Image 命名為 &lt;code&gt;BOOT.bin&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;將 MicroSD 卡從電腦移除，並插入到 Zybo Board 的 J4 SD 卡槽上&lt;/li&gt;
&lt;li&gt;接上電源，並設定好 JP7 (Power Source Select)&lt;/li&gt;
&lt;li&gt;將 &lt;code&gt;JP5&lt;/code&gt; 的跳線 (Jumper) 調整到 MicroSD 模式 (板上標示為 SD 的那個)&lt;/li&gt;
&lt;li&gt;啟動電源。接下來 Zybo Board 就會從 MicroSD 卡啟動。&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orged72cbc&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orged72cbc&quot;&gt;QSPI 啟動&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orged72cbc&quot;&gt;
&lt;p&gt;
在 Zybo board 上有一顆 128-Mbit Quad-SPI (QSPI) 的 NOR Flash，我們可以透過 Xilinx ISE 和 Vivado 等工具去將 Zynq Boot Image 下載到 QSPI Flash 上。
&lt;/p&gt;

&lt;p&gt;
當下載完成後，照這樣的步驟即可透過 QSPI 啟動:
&lt;/p&gt;

&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;接上電源，並設定好 JP7 (Power Source Select)&lt;/li&gt;
&lt;li&gt;將 &lt;code&gt;JP5&lt;/code&gt; 的跳線 (Jumper) 調整到 QSPI 模式 (板上標示為 QSPI 的那個)&lt;/li&gt;
&lt;li&gt;啟動電源。接下來 Zybo Board 就會從 QSPI 卡啟動。&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org74266ae&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;org74266ae&quot;&gt;JTAG 啟動&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-org74266ae&quot;&gt;
&lt;p&gt;
當你將 &lt;code&gt;JP5&lt;/code&gt; 設定為 JTAG 啟動模式，Zynq 內的 Cortex-A9 處理器會等到電腦端的 Xilinx 工具載入了要執行的程式之後，再執行預執行的程式，或是啟用一步一步(step-by-step)的執行模式來方便我們除錯。
&lt;/p&gt;

&lt;p&gt;
除此之外，我們也可以透過 iMPACT 或是 Vivado Hardware Server 透過 JTAG 來設定可程式邏輯區塊 (Programmable Logic, PL)。
&lt;/p&gt;

&lt;p&gt;
Zybo Board 預設是開機啟動 Cascaded JTAG 模式，在這種模式下 處理器系統 (Processing System, PS) 和 可程式邏輯區塊 (Programmable Logic, PL) 可以透過同一個 JTAG 去進行控制。如果你將 &lt;code&gt;JP6&lt;/code&gt; 短路，則可以讓 JTAG 僅看得到 可程式邏輯區塊 (Programmable Logic, PL)，在這種狀況下，使用者可以透過 EMIO (Extended multiplexed I/O) 將 PJTAG 拉出，讓外部的設備可以和 處理器系統 (Processing System, PS) 進行溝通。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgcfd72b0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgcfd72b0&quot;&gt;SPI Flash&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgcfd72b0&quot;&gt;
&lt;p&gt;
Zybo Board 內建了 4-bit SPI (QSPI) NOR Flash，硬件型號為 &lt;a href=&quot;http://www.cypress.com/file/177966/download&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Spansion S25FL128S&lt;/a&gt;。
&lt;/p&gt;

&lt;p&gt;
假設 &lt;code&gt;JP5&lt;/code&gt; 設定為 NOR Flash 開機，則我們可以透過這顆 NOR Flash 來初始化處理器系統(Processing System, PS)以及可程式邏輯區塊(Programmable Logic, PL)。除此之外，當開機完成後，我們可以使用 Spansion
檔案系統(&lt;a href=&quot;http://www.cypress.com/software-and-drivers-spansion-flash-memory&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Spansion Flash File System&lt;/a&gt;, FFS) 來對檔案進行讀寫的處理。
&lt;/p&gt;



&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/spi_circuit.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
從電路圖我們可以看到 SPI Flash 是直接連到 Zynq 處理器上的 Quad-I/O SPI interface。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-org3942e09&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org3942e09&quot;&gt;DDR 記憶體&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org3942e09&quot;&gt;
&lt;p&gt;
Zybo Board 使用的是 &lt;a href=&quot;https://www.micron.com/~/media/documents/products/data-sheet/dram/ddr3/2gb_ddr3_sdram.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Micron MT41J128M16JT-125&lt;/a&gt; 或是 &lt;a href=&quot;https://www.micron.com/~/media/documents/products/data-sheet/dram/ddr3/2gb_1_35v_ddr3l.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MT41K128M16JT-125&lt;/a&gt; 這兩種 DDR3 記憶體元件，在 Zybo Board 上我們共有 512MB 的記憶體空間可以使用。
&lt;/p&gt;

&lt;p&gt;
根據 &lt;a href=&quot;http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC Technical Reference Manual&lt;/a&gt;，DDR3 記憶體是直接連接到處理器系統 (Processing System, PS)。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org87b1831&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org87b1831&quot;&gt;USB UART 接口&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org87b1831&quot;&gt;
&lt;p&gt;
Zybo Board 並未將 UART 序列埠拉出，取而代之的它採用了 &lt;a href=&quot;http://www.ftdichip.com/Support/Documents/DataSheets/ICs/DS_FT2232H.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FTDI FT2232HQ&lt;/a&gt; 這款 USB 轉 UART 的 IC 讓你的電腦可以和 Zybo Board 進行溝通。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/usb-uart-bridge.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你是 Linux 使用者，在安裝完 Vivado 後，你會需要手動安裝 udev 設定好讓 Linux 可以偵測到這個 USB 轉 UART 設備(共兩組，/dev/ttyUSB0, /dev/ttyUSB1)，假設你的 vivado 安裝在 &lt;code&gt;/opt/Xilinx/Vivado/2016.1&lt;/code&gt; 的話，我們可以透過以下程式來安裝 udev 設定。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
/opt/Xilinx/Vivado/2016.1/data/xicom/cable_drivers/lin64/install_script/install_drivers/install_digilent.sh
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge86c77d&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge86c77d&quot;&gt;MicroSD 插槽&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge86c77d&quot;&gt;
&lt;p&gt;
在 Zybo Board 的背面，我們可以看到 Micro SD 插槽(J4)，根據 &lt;a href=&quot;http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC Technical Reference Manual&lt;/a&gt; ，Zynq 的 SDIO 控制器僅支援 1-bit 或是 4-bit 傳輸模式 (Host Modes)，不支援 SPI 模式。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/microsd_circuit.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
而 Micro SD 使用到的 MIO (Multiplexed I/O) 資訊如下:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/microsd_pinout.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc625ec5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc625ec5&quot;&gt;USB OTG&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc625ec5&quot;&gt;
&lt;p&gt;
Zybo Board 提供了一組 &lt;a href=&quot;https://zh.wikipedia.org/wiki/USB_On-The-Go&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;USB OTG&lt;/a&gt; 支援，在這個界面中使用了 Microchip 的 &lt;a href=&quot;http://ww1.microchip.com/downloads/en/DeviceDoc/00001792E.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;USB3320&lt;/a&gt; 這顆 IC 來作為端口物理層 (Port Physical Layer, PHY)，要注意到的是，你不可以 &lt;code&gt;同時&lt;/code&gt; 將 USB 主機 (HOST) 以及 USB 設備 (Device) 接到 USB OTG 端口上。
&lt;/p&gt;

&lt;p&gt;
(也就是不要同時接上設備到 &lt;code&gt;J9&lt;/code&gt; 以及 &lt;code&gt;J10&lt;/code&gt;)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/usb_otg_circuit.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
而在 USB OTG 的功能上，我們則是用掉了 &lt;code&gt;MIO 28 ~ 39&lt;/code&gt; 的位置。
&lt;/p&gt;


&lt;p&gt;
另外，由於 USB 2.0 的規格是 USB 主機最多可以提供 500mA 的電流，當你設定為 USB 主機的模式時，在 &lt;code&gt;J11&lt;/code&gt; 的電源端 &lt;code&gt;必須&lt;/code&gt; 改用外接電源或是電池輸入，避免電流不夠的情況發生。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga676695&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga676695&quot;&gt;Ethernet PHY&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga676695&quot;&gt;
&lt;p&gt;
Zybo Board 使用 &lt;a href=&quot;http://download3.dvd-driver.cz/realtek/datasheets/pdf/rtl8211e%28g%29-vb%28vl%29-cg_datasheet_1.6.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Realtek RTL8211E-VL&lt;/a&gt; PHY 來實現 10/100/1000 網路傳輸的功能。具體使用到的 MIO 以及 EMIO 接腳資訊如下:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/ethernet_phy_overview.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
我們可以透過在 RJ45 附近的 LED 來觀察流量 (LD7) 以及連線狀態 (LD6) 的資訊
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/ethernet_phy_status.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
網卡的 MAC 位址則是存放在 Micrichip &lt;a href=&quot;http://ww1.microchip.com/downloads/en/DeviceDoc/22124B.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;24AA02E48&lt;/a&gt; 這顆 EEPROM 上面，Zynq 處理器透過 EMIO 上的 I²C 接口來和 EEPROM 進行溝通。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/ethernet_macaddr.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc9953f1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc9953f1&quot;&gt;HDMI Source/Sink&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc9953f1&quot;&gt;
&lt;p&gt;
Zybo Board 的 HDMI 接口並未透過外部 IC 去驅動，因此我們必須透過可程式邏輯(Programmable Logic, PL) 去實現影片編碼 (Encoding)與解碼(Decoding)的功能。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/hdmi_circuit.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
由於 Zybo Board 的 HDMI 接口支援 HDMI 來源裝置(HDMI Source) 以及 HDMI 目標裝置 (HDMI Sink) 的功能，我們也須注意訊號的方向變化。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/hdmi_roles.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
根據 &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO FPGA Board Reference Manual&lt;/a&gt; 可知 Zyboard Board 的 HDMI 至少支援到 720p (1280x720) 的解析度。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd101bd1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgd101bd1&quot;&gt;VGA&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgd101bd1&quot;&gt;
&lt;p&gt;
Zybo Board 的 VGA 輸出也是沒有透過外部 IC 將數位訊號轉換為類比訊號，取而代之的，它採用了 &lt;a href=&quot;https://en.wikipedia.org/wiki/Resistor_ladder#R.E2.80.932R_resistor_ladder_network_.28digital_to_analog_conversion.2C_or_DAC.29&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;R–2R resistor ladder&lt;/a&gt; 這種分壓的方式將數位訊號變成了 VGA 用的類比訊號。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/vga_circuit.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0070a39&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0070a39&quot;&gt;時脈源 (Clock Sources)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0070a39&quot;&gt;
&lt;p&gt;
ZYBO board 提供了 50MHZ 的時脈到 Zynq 處理器的 &lt;code&gt;PS_CLK&lt;/code&gt; 接腳，基本連接資訊如下:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/clock_source.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
要注意到的一點是，由於 Ethernet PHY 會接收 50HMZ 時脈輸入，並輸出 125HMZ 到 Zynq 處理器上，當 Ethernet PHY 重置(reset)的時候，CLK125 的輸出會被取消。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org2e70b6c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org2e70b6c&quot;&gt;基本輸入/輸出 (I/O)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org2e70b6c&quot;&gt;
&lt;p&gt;
Zybo board 板上有一些預先定義好的 IO, 比如指撥開關 (Switch)、LED 燈、無段按鈕等。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/basic_io.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org14dc0ec&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org14dc0ec&quot;&gt;聲音 (Audio)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org14dc0ec&quot;&gt;
&lt;p&gt;
Zybo Board 上有三組聲音相關的 IO，分別是耳機孔輸出(Headphone Out)、麥克風輸入(Microphone In)、音源轉錄功能(Line In)，這些 IO 會連接到 Ananlog Device 的 &lt;a href=&quot;http://www.analog.com/media/en/technical-documentation/data-sheets/SSM2603.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SSM2603&lt;/a&gt; 音頻解碼器上。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/audio_an.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
&lt;a href=&quot;http://www.analog.com/media/en/technical-documentation/data-sheets/SSM2603.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SSM2603&lt;/a&gt; 則是透過 I²C 接口來將資料傳送給 Zynq 處理器去。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/audio_di.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org83eeecb&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org83eeecb&quot;&gt;Pmod 接腳&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org83eeecb&quot;&gt;
&lt;p&gt;
在 Zybo Board 的周遭，共有 6 個 2x6 母排座，用來將多餘的 GPIO 拉出。每個 Pmod 提供了兩個 3.3 VCC 電源、兩個 GND 訊號以及 8 個 IO 可以用。
在 Pmod 上的 VCC 以及 GND 最多可以提供到 1A 的電流(但要記得外接電源)。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/pmod_dia.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
不同的 Pmod 用途則可能不同，詳情請參見下表:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/pmod_pin.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga4707ca&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga4707ca&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga4707ca&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO FPGA Board Reference Manual&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://electronicdesign.com/fpgas/principles-fpgas&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Principles of FPGAs | FPGAs content from Electronic Design&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[3]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC Technical Reference Manual&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[4]&lt;/code&gt; &lt;a href=&quot;http://www.ioe.nchu.edu.tw/Pic/CourseItem/4468_20_Zynq_Architecture.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xilinx - Zynq Architecture&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
為了學習 RISC-V 以及體驗看看 Xilinx 的開發平台，最近我入手了 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; ，這是一塊具有 FPGA 同時又包含了 ARM Cortex-A9 雙核心的開發板。
&lt;/p&gt;

&lt;p&gt;
在我們開始這一切之前，我們需要稍微了解一下這片開發板以及他的週邊等資訊。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;p&gt;
要了解 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 的週邊，首先要看的就是開發商 &lt;a href=&quot;http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;DIGILENT&lt;/a&gt; 所提供的 &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO FPGA Board Reference Manual&lt;/a&gt;。
讓我們來看看一些比較重要的地方吧!
&lt;/p&gt;

&lt;div id=&quot;outline-container-org63381d6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org63381d6&quot;&gt;基本硬體認識&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org63381d6&quot;&gt;
&lt;p&gt;
拿到手的 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 會像下面這個樣子，我們有這些基本的輸入/輸出模組，以及未標示的部份(Pmod)，可以做延伸的功能
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/zybo_a.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
讓我們來看看這些週邊模組吧
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org7142416&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7142416&quot;&gt;電源輸入(5V)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7142416&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 允許三種不同類型的電源輸入模式，分別是 USB、外接電源(J15)、外接電池。我們可以從 &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Reference Manual&lt;/a&gt; 得到電源模組的大致資訊。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/power_cricuit_overview.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
控制電源輸入的位置在 &lt;code&gt;JP7&lt;/code&gt; 的排針座上，我們可以透過切換跳線(Jumper)來選擇我們需要的電源輸入，在週邊使用不多的情況下，我會直接使用 USB (5V) 來作為電流的輸入。
&lt;/p&gt;

&lt;p&gt;
要注意到的是，&lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 僅吃 &lt;code&gt;5V&lt;/code&gt; 電源，因此不論你是用外接電源(J15)或是外接電池，你最好都先確認你的電壓是否為 &lt;code&gt;5V&lt;/code&gt; (或是低於) ，否則你的開發板可能因此燒壞。
&lt;/p&gt;

&lt;p&gt;
插上電源後，透過電源開關 (Power Switch, SW4) 的切換即可完成給電/斷電的動作。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org29829b8&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org29829b8&quot;&gt;Zynq SOC&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org29829b8&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 核心是 &lt;a href=&quot;http://www.xilinx.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xilinx&lt;/a&gt; Zynq-7000 系列的 &lt;a href=&quot;http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Z-7010&lt;/a&gt; ARM/FPGA SoC 處理器，這是一種混和了 FPGA 以及 ARM Cortex-A9 處理器的 FPGA 核心。以往的 FPGA 開發板需要用到 CPU 的時候只能夠燒錄用 HDL 語言撰寫的軟核心到開發板上，這種混搭 FPGA/ARM 的開發板則是讓你可以針對通用需求使用 ARM CPU 進行程式的開發，特殊需求則透過 FPGA 進行處理/加速來運作，是一種蠻有趣的架構。
&lt;/p&gt;

&lt;p&gt;
我們可以把 Zynq SoC 分為兩個區塊, 處理系統 (Processing System, PS) 以及 可程式邏輯區塊(Programmable Logic, PL)，像這樣
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/zynq_block.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
處理系統(Processing Syste, PS) 也就是有 ARM Cortex-A9 處理器的部份，可程式邏輯區塊(Programmable Logic, PL) 則是 FPGA 所包含的部份。
&lt;/p&gt;

&lt;p&gt;
在上面的區塊圖中，我們要另外注意到 &lt;code&gt;MIO (Multiplexed I/O)&lt;/code&gt; 以及 &lt;code&gt;EMIO (Extended multiplexed I/O)&lt;/code&gt; ，在 Zynq 7000 系列 SoC 中，我們共有 54 個 MIO 可用，而這些 MIO 所連接的位址是無法在 可程式邏輯區塊 (Programmable Logic, PL) 中看到。
&lt;/p&gt;

&lt;p&gt;
在 &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zybo Board&lt;/a&gt; 我們有這幾個地方是連接到 MIO (Multiplexed I/O) 上的
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/mio_pinout.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org08969e2&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;org08969e2&quot;&gt;系統啟動流程&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-org08969e2&quot;&gt;
&lt;p&gt;
由於 Zynq 7000 系列內建了 ARM CPU，也因此和傳統的 FPGA 開發板相比，系統啟動流程也會不同，整體開機流程可以分為三個階段:
&lt;/p&gt;

&lt;ul class=&quot;org-ul&quot;&gt;
&lt;li&gt;&lt;p&gt;
階段 0
&lt;/p&gt;

&lt;p&gt;
當 Zybo board 電源啟動後，CPU0 會執行內部已經預燒錄的程式 BootROM，這個程式會根據 &lt;code&gt;JP5&lt;/code&gt; 所設定的資訊來更新狀態暫存器(mode register)，接著 BootROM 會透過狀態讚存器(mode register)的資訊從 MicroSD、NOR Flash、JTAG 等位置抓取 Zynq Boot Image，並將包在 Zynq Boot Image 裡面的 &lt;code&gt;第一級啟動開機程式 (First Stage Bootloader, FSBL)&lt;/code&gt; 複製到內部 256KB 的記憶體 (On-Chip Memory, OCM) 去，最後執行 FSBL，進入下一個階段。
&lt;/p&gt;

&lt;p&gt;
如果 BootROM 是因為按下了 RESET 按鈕等狀況而被執行，Zybo board 會選用之前已經存放在狀態暫存器(mode register)的開機狀態，而不是當下的 &lt;code&gt;JP5&lt;/code&gt; 狀態。
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
階段 1
&lt;/p&gt;

&lt;p&gt;
在這階段中, 第一級啟動開機程式 (First Stage Bootloader, FSBL) 初始化了 DDR 記憶體、GPIO 等週邊設定，接下來會載入存放在 Boot Image 內的位元流 (bitstream)，用他來對可程式邏輯區塊 (Programmable Logic, PL) 進行設定。
&lt;/p&gt;

&lt;p&gt;
當可程式邏輯區塊(Programmable Logic, PL)設定完成後，FSBL 會去載入程式(ex: u-boot)並執行它。
&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;
階段 2
&lt;/p&gt;

&lt;p&gt;
最後的接段即是執行 FSBL 所載入的程式，這些程式可以從簡單的 &quot;Hello World&quot;，到像 u-boot 這樣的第二階段開機程式，用來載入 Linux 或是其他的作業系統。
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgf5aba56&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgf5aba56&quot;&gt;更改開機模式&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgf5aba56&quot;&gt;
&lt;p&gt;
我們可以透過切換 &lt;code&gt;JP5&lt;/code&gt; 的跳線(Jumper)來決定我們要透過哪種方式去載入第一級啟動開機程式 (First Stage Bootloader, FSBL)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/zybo_config_pins.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga73afeb&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orga73afeb&quot;&gt;MicroSD 啟動&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orga73afeb&quot;&gt;
&lt;p&gt;
當使用者將 MicroSD 插入到 &lt;code&gt;J4&lt;/code&gt; 的 SD 卡槽，並設定好 &lt;code&gt;JP5&lt;/code&gt; 的跳線的話，我們可以透過 MicroSD 來進行開機的動作。
&lt;/p&gt;

&lt;p&gt;
若你希望透過 MicroSD 進行開機，你需要先設定好你的 SD 卡:
&lt;/p&gt;

&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;透過電腦格式化 MicroSD 卡成 &lt;code&gt;FAT32&lt;/code&gt; 檔案格式&lt;/li&gt;
&lt;li&gt;複製從 Xilinx SDK 製作出來的 Zynq Boot Image 到 MicroSD 卡上&lt;/li&gt;
&lt;li&gt;將 Zynq Boot Image 命名為 &lt;code&gt;BOOT.bin&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;將 MicroSD 卡從電腦移除，並插入到 Zybo Board 的 J4 SD 卡槽上&lt;/li&gt;
&lt;li&gt;接上電源，並設定好 JP7 (Power Source Select)&lt;/li&gt;
&lt;li&gt;將 &lt;code&gt;JP5&lt;/code&gt; 的跳線 (Jumper) 調整到 MicroSD 模式 (板上標示為 SD 的那個)&lt;/li&gt;
&lt;li&gt;啟動電源。接下來 Zybo Board 就會從 MicroSD 卡啟動。&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orged72cbc&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;orged72cbc&quot;&gt;QSPI 啟動&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-orged72cbc&quot;&gt;
&lt;p&gt;
在 Zybo board 上有一顆 128-Mbit Quad-SPI (QSPI) 的 NOR Flash，我們可以透過 Xilinx ISE 和 Vivado 等工具去將 Zynq Boot Image 下載到 QSPI Flash 上。
&lt;/p&gt;

&lt;p&gt;
當下載完成後，照這樣的步驟即可透過 QSPI 啟動:
&lt;/p&gt;

&lt;ol class=&quot;org-ol&quot;&gt;
&lt;li&gt;接上電源，並設定好 JP7 (Power Source Select)&lt;/li&gt;
&lt;li&gt;將 &lt;code&gt;JP5&lt;/code&gt; 的跳線 (Jumper) 調整到 QSPI 模式 (板上標示為 QSPI 的那個)&lt;/li&gt;
&lt;li&gt;啟動電源。接下來 Zybo Board 就會從 QSPI 卡啟動。&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org74266ae&quot; class=&quot;outline-4&quot;&gt;
&lt;h4 id=&quot;org74266ae&quot;&gt;JTAG 啟動&lt;/h4&gt;
&lt;div class=&quot;outline-text-4&quot; id=&quot;text-org74266ae&quot;&gt;
&lt;p&gt;
當你將 &lt;code&gt;JP5&lt;/code&gt; 設定為 JTAG 啟動模式，Zynq 內的 Cortex-A9 處理器會等到電腦端的 Xilinx 工具載入了要執行的程式之後，再執行預執行的程式，或是啟用一步一步(step-by-step)的執行模式來方便我們除錯。
&lt;/p&gt;

&lt;p&gt;
除此之外，我們也可以透過 iMPACT 或是 Vivado Hardware Server 透過 JTAG 來設定可程式邏輯區塊 (Programmable Logic, PL)。
&lt;/p&gt;

&lt;p&gt;
Zybo Board 預設是開機啟動 Cascaded JTAG 模式，在這種模式下 處理器系統 (Processing System, PS) 和 可程式邏輯區塊 (Programmable Logic, PL) 可以透過同一個 JTAG 去進行控制。如果你將 &lt;code&gt;JP6&lt;/code&gt; 短路，則可以讓 JTAG 僅看得到 可程式邏輯區塊 (Programmable Logic, PL)，在這種狀況下，使用者可以透過 EMIO (Extended multiplexed I/O) 將 PJTAG 拉出，讓外部的設備可以和 處理器系統 (Processing System, PS) 進行溝通。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgcfd72b0&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgcfd72b0&quot;&gt;SPI Flash&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgcfd72b0&quot;&gt;
&lt;p&gt;
Zybo Board 內建了 4-bit SPI (QSPI) NOR Flash，硬件型號為 &lt;a href=&quot;http://www.cypress.com/file/177966/download&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Spansion S25FL128S&lt;/a&gt;。
&lt;/p&gt;

&lt;p&gt;
假設 &lt;code&gt;JP5&lt;/code&gt; 設定為 NOR Flash 開機，則我們可以透過這顆 NOR Flash 來初始化處理器系統(Processing System, PS)以及可程式邏輯區塊(Programmable Logic, PL)。除此之外，當開機完成後，我們可以使用 Spansion
檔案系統(&lt;a href=&quot;http://www.cypress.com/software-and-drivers-spansion-flash-memory&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Spansion Flash File System&lt;/a&gt;, FFS) 來對檔案進行讀寫的處理。
&lt;/p&gt;



&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/spi_circuit.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
從電路圖我們可以看到 SPI Flash 是直接連到 Zynq 處理器上的 Quad-I/O SPI interface。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;outline-container-org3942e09&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org3942e09&quot;&gt;DDR 記憶體&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org3942e09&quot;&gt;
&lt;p&gt;
Zybo Board 使用的是 &lt;a href=&quot;https://www.micron.com/~/media/documents/products/data-sheet/dram/ddr3/2gb_ddr3_sdram.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Micron MT41J128M16JT-125&lt;/a&gt; 或是 &lt;a href=&quot;https://www.micron.com/~/media/documents/products/data-sheet/dram/ddr3/2gb_1_35v_ddr3l.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MT41K128M16JT-125&lt;/a&gt; 這兩種 DDR3 記憶體元件，在 Zybo Board 上我們共有 512MB 的記憶體空間可以使用。
&lt;/p&gt;

&lt;p&gt;
根據 &lt;a href=&quot;http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC Technical Reference Manual&lt;/a&gt;，DDR3 記憶體是直接連接到處理器系統 (Processing System, PS)。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org87b1831&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org87b1831&quot;&gt;USB UART 接口&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org87b1831&quot;&gt;
&lt;p&gt;
Zybo Board 並未將 UART 序列埠拉出，取而代之的它採用了 &lt;a href=&quot;http://www.ftdichip.com/Support/Documents/DataSheets/ICs/DS_FT2232H.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FTDI FT2232HQ&lt;/a&gt; 這款 USB 轉 UART 的 IC 讓你的電腦可以和 Zybo Board 進行溝通。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/usb-uart-bridge.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
如果你是 Linux 使用者，在安裝完 Vivado 後，你會需要手動安裝 udev 設定好讓 Linux 可以偵測到這個 USB 轉 UART 設備(共兩組，/dev/ttyUSB0, /dev/ttyUSB1)，假設你的 vivado 安裝在 &lt;code&gt;/opt/Xilinx/Vivado/2016.1&lt;/code&gt; 的話，我們可以透過以下程式來安裝 udev 設定。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
/opt/Xilinx/Vivado/2016.1/data/xicom/cable_drivers/lin64/install_script/install_drivers/install_digilent.sh
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orge86c77d&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge86c77d&quot;&gt;MicroSD 插槽&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge86c77d&quot;&gt;
&lt;p&gt;
在 Zybo Board 的背面，我們可以看到 Micro SD 插槽(J4)，根據 &lt;a href=&quot;http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC Technical Reference Manual&lt;/a&gt; ，Zynq 的 SDIO 控制器僅支援 1-bit 或是 4-bit 傳輸模式 (Host Modes)，不支援 SPI 模式。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/microsd_circuit.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
而 Micro SD 使用到的 MIO (Multiplexed I/O) 資訊如下:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/microsd_pinout.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc625ec5&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc625ec5&quot;&gt;USB OTG&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc625ec5&quot;&gt;
&lt;p&gt;
Zybo Board 提供了一組 &lt;a href=&quot;https://zh.wikipedia.org/wiki/USB_On-The-Go&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;USB OTG&lt;/a&gt; 支援，在這個界面中使用了 Microchip 的 &lt;a href=&quot;http://ww1.microchip.com/downloads/en/DeviceDoc/00001792E.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;USB3320&lt;/a&gt; 這顆 IC 來作為端口物理層 (Port Physical Layer, PHY)，要注意到的是，你不可以 &lt;code&gt;同時&lt;/code&gt; 將 USB 主機 (HOST) 以及 USB 設備 (Device) 接到 USB OTG 端口上。
&lt;/p&gt;

&lt;p&gt;
(也就是不要同時接上設備到 &lt;code&gt;J9&lt;/code&gt; 以及 &lt;code&gt;J10&lt;/code&gt;)
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/usb_otg_circuit.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
而在 USB OTG 的功能上，我們則是用掉了 &lt;code&gt;MIO 28 ~ 39&lt;/code&gt; 的位置。
&lt;/p&gt;


&lt;p&gt;
另外，由於 USB 2.0 的規格是 USB 主機最多可以提供 500mA 的電流，當你設定為 USB 主機的模式時，在 &lt;code&gt;J11&lt;/code&gt; 的電源端 &lt;code&gt;必須&lt;/code&gt; 改用外接電源或是電池輸入，避免電流不夠的情況發生。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga676695&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga676695&quot;&gt;Ethernet PHY&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga676695&quot;&gt;
&lt;p&gt;
Zybo Board 使用 &lt;a href=&quot;http://download3.dvd-driver.cz/realtek/datasheets/pdf/rtl8211e%28g%29-vb%28vl%29-cg_datasheet_1.6.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Realtek RTL8211E-VL&lt;/a&gt; PHY 來實現 10/100/1000 網路傳輸的功能。具體使用到的 MIO 以及 EMIO 接腳資訊如下:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/ethernet_phy_overview.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
我們可以透過在 RJ45 附近的 LED 來觀察流量 (LD7) 以及連線狀態 (LD6) 的資訊
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/ethernet_phy_status.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
網卡的 MAC 位址則是存放在 Micrichip &lt;a href=&quot;http://ww1.microchip.com/downloads/en/DeviceDoc/22124B.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;24AA02E48&lt;/a&gt; 這顆 EEPROM 上面，Zynq 處理器透過 EMIO 上的 I²C 接口來和 EEPROM 進行溝通。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/ethernet_macaddr.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc9953f1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc9953f1&quot;&gt;HDMI Source/Sink&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc9953f1&quot;&gt;
&lt;p&gt;
Zybo Board 的 HDMI 接口並未透過外部 IC 去驅動，因此我們必須透過可程式邏輯(Programmable Logic, PL) 去實現影片編碼 (Encoding)與解碼(Decoding)的功能。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/hdmi_circuit.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
由於 Zybo Board 的 HDMI 接口支援 HDMI 來源裝置(HDMI Source) 以及 HDMI 目標裝置 (HDMI Sink) 的功能，我們也須注意訊號的方向變化。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/hdmi_roles.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
根據 &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO FPGA Board Reference Manual&lt;/a&gt; 可知 Zyboard Board 的 HDMI 至少支援到 720p (1280x720) 的解析度。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgd101bd1&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgd101bd1&quot;&gt;VGA&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgd101bd1&quot;&gt;
&lt;p&gt;
Zybo Board 的 VGA 輸出也是沒有透過外部 IC 將數位訊號轉換為類比訊號，取而代之的，它採用了 &lt;a href=&quot;https://en.wikipedia.org/wiki/Resistor_ladder#R.E2.80.932R_resistor_ladder_network_.28digital_to_analog_conversion.2C_or_DAC.29&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;R–2R resistor ladder&lt;/a&gt; 這種分壓的方式將數位訊號變成了 VGA 用的類比訊號。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/vga_circuit.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org0070a39&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org0070a39&quot;&gt;時脈源 (Clock Sources)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org0070a39&quot;&gt;
&lt;p&gt;
ZYBO board 提供了 50MHZ 的時脈到 Zynq 處理器的 &lt;code&gt;PS_CLK&lt;/code&gt; 接腳，基本連接資訊如下:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/clock_source.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
要注意到的一點是，由於 Ethernet PHY 會接收 50HMZ 時脈輸入，並輸出 125HMZ 到 Zynq 處理器上，當 Ethernet PHY 重置(reset)的時候，CLK125 的輸出會被取消。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org2e70b6c&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org2e70b6c&quot;&gt;基本輸入/輸出 (I/O)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org2e70b6c&quot;&gt;
&lt;p&gt;
Zybo board 板上有一些預先定義好的 IO, 比如指撥開關 (Switch)、LED 燈、無段按鈕等。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/basic_io.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org14dc0ec&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org14dc0ec&quot;&gt;聲音 (Audio)&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org14dc0ec&quot;&gt;
&lt;p&gt;
Zybo Board 上有三組聲音相關的 IO，分別是耳機孔輸出(Headphone Out)、麥克風輸入(Microphone In)、音源轉錄功能(Line In)，這些 IO 會連接到 Ananlog Device 的 &lt;a href=&quot;http://www.analog.com/media/en/technical-documentation/data-sheets/SSM2603.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SSM2603&lt;/a&gt; 音頻解碼器上。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/audio_an.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
&lt;a href=&quot;http://www.analog.com/media/en/technical-documentation/data-sheets/SSM2603.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SSM2603&lt;/a&gt; 則是透過 I²C 接口來將資料傳送給 Zynq 處理器去。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/audio_di.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org83eeecb&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org83eeecb&quot;&gt;Pmod 接腳&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org83eeecb&quot;&gt;
&lt;p&gt;
在 Zybo Board 的周遭，共有 6 個 2x6 母排座，用來將多餘的 GPIO 拉出。每個 Pmod 提供了兩個 3.3 VCC 電源、兩個 GND 訊號以及 8 個 IO 可以用。
在 Pmod 上的 VCC 以及 GND 最多可以提供到 1A 的電流(但要記得外接電源)。
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/pmod_dia.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
不同的 Pmod 用途則可能不同，詳情請參見下表:
&lt;/p&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/7004ff00/pmod_pin.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga4707ca&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga4707ca&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga4707ca&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ZYBO FPGA Board Reference Manual&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://electronicdesign.com/fpgas/principles-fpgas&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Principles of FPGAs | FPGAs content from Electronic Design&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[3]&lt;/code&gt; &lt;a href=&quot;http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zynq-7000 All Programmable SoC Technical Reference Manual&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[4]&lt;/code&gt; &lt;a href=&quot;http://www.ioe.nchu.edu.tw/Pic/CourseItem/4468_20_Zynq_Architecture.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xilinx - Zynq Architecture&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/7004ff00/#disqus_thread</comments>
    </item>
    
    <item>
      <title>clojure/clojurescript 與 left-pad</title>
      <link>https://coldnew.github.io/7c811780/</link>
      <guid>https://coldnew.github.io/7c811780/</guid>
      <pubDate>Sat, 26 Mar 2016 16:07:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
最近鬧得沸沸揚揚的事情，大概就是 &lt;a href=&quot;https://github.com/azer&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Azer Koçulu&lt;/a&gt; 在 npm 上&lt;a href=&quot;https://medium.com/@azerbike/i-ve-just-liberated-my-modules-9045c06be67c#.eww19oprb&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;下架 left-pad&lt;/a&gt;這件事，導致許許多多依賴他的 Node.js 專案 &lt;a href=&quot;https://github.com/azer/left-pad/issues/4&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;不能使用&lt;/a&gt;。
&lt;/p&gt;

&lt;p&gt;
就讓我們趁這個機會，看一下我們在 clojure/clojurescript 下到底有沒有需要這個函式庫，或是是否已經有內建可替代的函式可以處理這個功能。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;div id=&quot;outline-container-orgbbae2d7&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgbbae2d7&quot;&gt;leftpad 做了哪些事?&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgbbae2d7&quot;&gt;
&lt;p&gt;
在我們開始前，讓我們來看看 &lt;a href=&quot;https://github.com/azer/left-pad&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;left-pad&lt;/a&gt; 這個函式庫到底多好用，為什麼一堆套件都依賴他。實際上 &lt;a href=&quot;https://github.com/azer/left-pad&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;left-pad&lt;/a&gt; 只有短短的幾行，內容如下:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-javascript&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;leftpad&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;str&lt;/span&gt;, &lt;span style=&quot;color: #aaccff;&quot;&gt;len&lt;/span&gt;, &lt;span style=&quot;color: #aaccff;&quot;&gt;ch&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    str = String&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;str&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

    &lt;span style=&quot;color: #aaffaa;&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;i&lt;/span&gt; = -1;

    &lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;!ch &amp;amp;&amp;amp; ch !== 0&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; ch = &lt;span style=&quot;color: #aadddd;&quot;&gt;&#39; &#39;&lt;/span&gt;;

    len = len - str.length;

    &lt;span style=&quot;color: #aaffaa;&quot;&gt;while&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;++i &amp;lt; len&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        str = ch + str;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;

    &lt;span style=&quot;color: #aaffaa;&quot;&gt;return&lt;/span&gt; str;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而他的功能也很單純，就是將輸入的東西依據設定，進行 padding 的動作
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-javascript&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;leftpad&lt;/span&gt; = require&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;left-pad&#39;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

leftpad&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;foo&#39;&lt;/span&gt;, 5&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;  foo&quot;&lt;/span&gt;

leftpad&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;foobar&#39;&lt;/span&gt;, 6&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;foobar&quot;&lt;/span&gt;

leftpad&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;1, 2, 0&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;01&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb0a8f90&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb0a8f90&quot;&gt;如何在 clojure 上實作&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb0a8f90&quot;&gt;
&lt;p&gt;
那我們在 clojure 下要怎樣實作 leftpad 這函式的功能呢？實際上我們使用 &lt;a href=&quot;https://clojuredocs.org/clojure.core/format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.core/format&lt;/a&gt; 搭配一些字串的替代就可以辦到 (註: 參考自 &lt;a href=&quot;http://beginnersbook.com/2014/07/java-left-padding-a-string-with-spaces-and-zeros/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;java – Left padding a String with Spaces and Zeros&lt;/a&gt; 一文)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;leftpad&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;If S is shorter than LEN, pad it with CH on the left.&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;s len&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;leftpad s len &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;s len ch&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
   &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;format &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;str &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;%&quot;&lt;/span&gt; len &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;s&quot;&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;str s&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;
       &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.string&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;replace #&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd; font-weight: bold;&quot;&gt;\s&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;str ch&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;leftpad 1 2 0&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;01&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
當然像這樣用字串查找替代的方式很容易打死自己，此外，&lt;a href=&quot;https://clojuredocs.org/clojure.core/format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.core/format&lt;/a&gt; 因為 &lt;a href=&quot;http://dev.clojure.org/jira/browse/CLJS-324&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CLJS-324 ISSUE&lt;/a&gt; 的關係，目前是無法在 clojurescript 上使用的，因此我們應該考慮看看 clojure/clojurescript 都可以共用的 &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org7ce26ab&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7ce26ab&quot;&gt;如何在 clojurescript 上實作&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7ce26ab&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 是移植自 common lisp 的 &lt;a href=&quot;http://www.cs.cmu.edu/afs/cs.cmu.edu/project/ai-repository/ai/html/cltl/clm/node200.html#SECTION002633000000000000000%29&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;format&lt;/a&gt; 函式，是一種非常強大的字串格式化方式。具體範例在 &lt;a href=&quot;http://www.gigamonkeys.com/book/a-few-format-recipes.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Praticle Common Lisp&lt;/a&gt; 一書內文有提到，我們在這邊只注重如何透過 &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 進行 padding:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~5,&#39;qd&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;hi&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;qqqhi&quot;&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~6,&#39;0d&quot;&lt;/span&gt; 1&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;000001&quot;&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~7d&quot;&lt;/span&gt; 1&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;      1&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
了解了 &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 在 padding 功能上的使用，我們就可以透過它來製作 clojure/clojurescript 皆能使用的 &lt;code&gt;leftpad&lt;/code&gt; 函式:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;ns&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;coldnew.left-pad&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:require&lt;/span&gt; #?&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:clj&lt;/span&gt;  &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.pprint&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;cl-format&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;
               &lt;span style=&quot;color: #ccaaff;&quot;&gt;:cljs&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;cljs.pprint&lt;/span&gt;    &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;cl-format&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;leftpad&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;If S is shorter than LEN, pad it with CH on the left.&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;s len&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;leftpad s len &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;s len ch&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
   &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;str &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~&quot;&lt;/span&gt; len &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;,&#39;&quot;&lt;/span&gt; ch &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;d&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;str s&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgad8fb47&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgad8fb47&quot;&gt;後記&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgad8fb47&quot;&gt;
&lt;p&gt;
本文只是我看到了 &lt;a href=&quot;http://www.haneycodes.net/npm-left-pad-have-we-forgotten-how-to-program/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NPM &amp;amp; left-pad: Have We Forgotten How To Program?&lt;/a&gt; 這篇文章後，來確認一下我到底會不會寫程式之用，文內實作的 clojure/clojurescript 版本你可以在 &lt;a href=&quot;https://github.com/coldnew/left-pad.clj&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;coldnew/left-pad.clj&lt;/a&gt; 這個專案看到。
&lt;/p&gt;

&lt;p&gt;
如果你想看看 emacs-lisp 下要怎樣實作 leftpad 函式，則可以在 &lt;a href=&quot;https://github.com/coldnew/left-pad.el&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;coldnew/left-pad.el&lt;/a&gt; 看到我實作的範例。
&lt;/p&gt;

&lt;p&gt;
實際上 leftpad 的事件還衍生了另外一個問題: &lt;code&gt;套件是否可以這麼容易被下架?&lt;/code&gt;
&lt;/p&gt;

&lt;p&gt;
在 Clojure 的世界中，我們會把我們的專案放置到 &lt;a href=&quot;http://clojars.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clojars&lt;/a&gt; 去，而在 &lt;a href=&quot;http://clojars.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clojars&lt;/a&gt; 則是這樣規定 &lt;a href=&quot;https://github.com/clojars/clojars-web/wiki/About#how-do-i-delete-a-jar&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;How do I delete a jar?&lt;/a&gt;
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
Deletion of entire projects or particular versions is discouraged as you will break anyone&#39;s build that depends on the project or version. There is also a cost associated with deletion, as it requires an admin&#39;s time. If you&#39;re sure nobody is using your jar or absolutely must remove it open an issue against the Clojars GitHub project. If you need it done privately contact the server caretakers. Before doing so, push a new revision with &quot;Delete me&quot; in the description in order to prove you&#39;re the owner of the project.
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;p&gt;
&lt;a href=&quot;http://clojars.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clojars&lt;/a&gt; 的維護者是不太贊同開發者移除自己的套件的，我曾經要求 clojar 幫我移除一個以前誤上傳的套件 (請見 &lt;a href=&quot;https://github.com/clojars/clojars-web/issues/391&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;issue/391&lt;/a&gt;)，也是花了好一段時間這個套件才真的被刪除，因此在 Clojure 世界中我們應該不太需要擔心有使用者下架套件這件事 :S。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga9b894a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga9b894a&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga9b894a&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;http://www.haneycodes.net/npm-left-pad-have-we-forgotten-how-to-program/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NPM &amp;amp; left-pad: Have We Forgotten How To Program?&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://www.gigamonkeys.com/book/a-few-format-recipes.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Praticle Common Lisp - A Few FORMAT Recipes&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
最近鬧得沸沸揚揚的事情，大概就是 &lt;a href=&quot;https://github.com/azer&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Azer Koçulu&lt;/a&gt; 在 npm 上&lt;a href=&quot;https://medium.com/@azerbike/i-ve-just-liberated-my-modules-9045c06be67c#.eww19oprb&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;下架 left-pad&lt;/a&gt;這件事，導致許許多多依賴他的 Node.js 專案 &lt;a href=&quot;https://github.com/azer/left-pad/issues/4&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;不能使用&lt;/a&gt;。
&lt;/p&gt;

&lt;p&gt;
就讓我們趁這個機會，看一下我們在 clojure/clojurescript 下到底有沒有需要這個函式庫，或是是否已經有內建可替代的函式可以處理這個功能。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;div id=&quot;outline-container-orgbbae2d7&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgbbae2d7&quot;&gt;leftpad 做了哪些事?&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgbbae2d7&quot;&gt;
&lt;p&gt;
在我們開始前，讓我們來看看 &lt;a href=&quot;https://github.com/azer/left-pad&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;left-pad&lt;/a&gt; 這個函式庫到底多好用，為什麼一堆套件都依賴他。實際上 &lt;a href=&quot;https://github.com/azer/left-pad&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;left-pad&lt;/a&gt; 只有短短的幾行，內容如下:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-javascript&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;leftpad&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;str&lt;/span&gt;, &lt;span style=&quot;color: #aaccff;&quot;&gt;len&lt;/span&gt;, &lt;span style=&quot;color: #aaccff;&quot;&gt;ch&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;
    str = String&lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;str&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;;

    &lt;span style=&quot;color: #aaffaa;&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;i&lt;/span&gt; = -1;

    &lt;span style=&quot;color: #aaffaa;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;!ch &amp;amp;&amp;amp; ch !== 0&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; ch = &lt;span style=&quot;color: #aadddd;&quot;&gt;&#39; &#39;&lt;/span&gt;;

    len = len - str.length;

    &lt;span style=&quot;color: #aaffaa;&quot;&gt;while&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;++i &amp;lt; len&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #81d4fa;&quot;&gt;{&lt;/span&gt;
        str = ch + str;
    &lt;span style=&quot;color: #81d4fa;&quot;&gt;}&lt;/span&gt;

    &lt;span style=&quot;color: #aaffaa;&quot;&gt;return&lt;/span&gt; str;
&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
而他的功能也很單純，就是將輸入的東西依據設定，進行 padding 的動作
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-javascript&quot;&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;leftpad&lt;/span&gt; = require&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;left-pad&#39;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

leftpad&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;foo&#39;&lt;/span&gt;, 5&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;  foo&quot;&lt;/span&gt;

leftpad&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;foobar&#39;&lt;/span&gt;, 6&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;foobar&quot;&lt;/span&gt;

leftpad&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;1, 2, 0&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;01&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb0a8f90&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgb0a8f90&quot;&gt;如何在 clojure 上實作&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgb0a8f90&quot;&gt;
&lt;p&gt;
那我們在 clojure 下要怎樣實作 leftpad 這函式的功能呢？實際上我們使用 &lt;a href=&quot;https://clojuredocs.org/clojure.core/format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.core/format&lt;/a&gt; 搭配一些字串的替代就可以辦到 (註: 參考自 &lt;a href=&quot;http://beginnersbook.com/2014/07/java-left-padding-a-string-with-spaces-and-zeros/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;java – Left padding a String with Spaces and Zeros&lt;/a&gt; 一文)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;leftpad&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;If S is shorter than LEN, pad it with CH on the left.&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;s len&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;leftpad s len &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;s len ch&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
   &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;format &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;str &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;%&quot;&lt;/span&gt; len &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;s&quot;&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;str s&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;
       &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.string&lt;/span&gt;&lt;span style=&quot;color: #c6cccc; background-color: #202020;&quot;&gt;/&lt;/span&gt;replace #&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd; font-weight: bold;&quot;&gt;\s&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;(&lt;/span&gt;str ch&lt;span style=&quot;color: #ccaaff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;leftpad 1 2 0&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;01&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
當然像這樣用字串查找替代的方式很容易打死自己，此外，&lt;a href=&quot;https://clojuredocs.org/clojure.core/format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;clojure.core/format&lt;/a&gt; 因為 &lt;a href=&quot;http://dev.clojure.org/jira/browse/CLJS-324&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CLJS-324 ISSUE&lt;/a&gt; 的關係，目前是無法在 clojurescript 上使用的，因此我們應該考慮看看 clojure/clojurescript 都可以共用的 &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org7ce26ab&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org7ce26ab&quot;&gt;如何在 clojurescript 上實作&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org7ce26ab&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 是移植自 common lisp 的 &lt;a href=&quot;http://www.cs.cmu.edu/afs/cs.cmu.edu/project/ai-repository/ai/html/cltl/clm/node200.html#SECTION002633000000000000000%29&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;format&lt;/a&gt; 函式，是一種非常強大的字串格式化方式。具體範例在 &lt;a href=&quot;http://www.gigamonkeys.com/book/a-few-format-recipes.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Praticle Common Lisp&lt;/a&gt; 一書內文有提到，我們在這邊只注重如何透過 &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 進行 padding:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~5,&#39;qd&quot;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;hi&quot;&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;qqqhi&quot;&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~6,&#39;0d&quot;&lt;/span&gt; 1&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;000001&quot;&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~7d&quot;&lt;/span&gt; 1&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;;; &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;=&amp;gt; &quot;      1&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
了解了 &lt;a href=&quot;https://clojuredocs.org/clojure.pprint/cl-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cl-format&lt;/a&gt; 在 padding 功能上的使用，我們就可以透過它來製作 clojure/clojurescript 皆能使用的 &lt;code&gt;leftpad&lt;/code&gt; 函式:
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-clojure&quot;&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;ns&lt;/span&gt; &lt;span style=&quot;color: #fff59d;&quot;&gt;coldnew.left-pad&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:require&lt;/span&gt; #?&lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ccaaff;&quot;&gt;:clj&lt;/span&gt;  &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;clojure.pprint&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;cl-format&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;
               &lt;span style=&quot;color: #ccaaff;&quot;&gt;:cljs&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #fff59d;&quot;&gt;cljs.pprint&lt;/span&gt;    &lt;span style=&quot;color: #ccaaff;&quot;&gt;:refer&lt;/span&gt; &lt;span style=&quot;color: #ccaaff;&quot;&gt;[&lt;/span&gt;cl-format&lt;span style=&quot;color: #ccaaff;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;

&lt;span style=&quot;color: #aadddd;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaffaa;&quot;&gt;defn&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;leftpad&lt;/span&gt;
  &lt;span style=&quot;color: #97abc6; font-style: italic;&quot;&gt;&quot;If S is shorter than LEN, pad it with CH on the left.&quot;&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;s len&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;leftpad s len &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;
  &lt;span style=&quot;color: #81d4fa;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;[&lt;/span&gt;s len ch&lt;span style=&quot;color: #aaccff;&quot;&gt;]&lt;/span&gt;
   &lt;span style=&quot;color: #aaccff;&quot;&gt;(&lt;/span&gt;cl-format &lt;span style=&quot;color: #ccaaff;&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;str &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;~&quot;&lt;/span&gt; len &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;,&#39;&quot;&lt;/span&gt; ch &lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;d&quot;&lt;/span&gt;&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #aaeecc;&quot;&gt;(&lt;/span&gt;str s&lt;span style=&quot;color: #aaeecc;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #81d4fa;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgad8fb47&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgad8fb47&quot;&gt;後記&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgad8fb47&quot;&gt;
&lt;p&gt;
本文只是我看到了 &lt;a href=&quot;http://www.haneycodes.net/npm-left-pad-have-we-forgotten-how-to-program/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NPM &amp;amp; left-pad: Have We Forgotten How To Program?&lt;/a&gt; 這篇文章後，來確認一下我到底會不會寫程式之用，文內實作的 clojure/clojurescript 版本你可以在 &lt;a href=&quot;https://github.com/coldnew/left-pad.clj&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;coldnew/left-pad.clj&lt;/a&gt; 這個專案看到。
&lt;/p&gt;

&lt;p&gt;
如果你想看看 emacs-lisp 下要怎樣實作 leftpad 函式，則可以在 &lt;a href=&quot;https://github.com/coldnew/left-pad.el&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;coldnew/left-pad.el&lt;/a&gt; 看到我實作的範例。
&lt;/p&gt;

&lt;p&gt;
實際上 leftpad 的事件還衍生了另外一個問題: &lt;code&gt;套件是否可以這麼容易被下架?&lt;/code&gt;
&lt;/p&gt;

&lt;p&gt;
在 Clojure 的世界中，我們會把我們的專案放置到 &lt;a href=&quot;http://clojars.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clojars&lt;/a&gt; 去，而在 &lt;a href=&quot;http://clojars.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clojars&lt;/a&gt; 則是這樣規定 &lt;a href=&quot;https://github.com/clojars/clojars-web/wiki/About#how-do-i-delete-a-jar&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;How do I delete a jar?&lt;/a&gt;
&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;
Deletion of entire projects or particular versions is discouraged as you will break anyone&#39;s build that depends on the project or version. There is also a cost associated with deletion, as it requires an admin&#39;s time. If you&#39;re sure nobody is using your jar or absolutely must remove it open an issue against the Clojars GitHub project. If you need it done privately contact the server caretakers. Before doing so, push a new revision with &quot;Delete me&quot; in the description in order to prove you&#39;re the owner of the project.
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;br&gt;

&lt;p&gt;
&lt;a href=&quot;http://clojars.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Clojars&lt;/a&gt; 的維護者是不太贊同開發者移除自己的套件的，我曾經要求 clojar 幫我移除一個以前誤上傳的套件 (請見 &lt;a href=&quot;https://github.com/clojars/clojars-web/issues/391&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;issue/391&lt;/a&gt;)，也是花了好一段時間這個套件才真的被刪除，因此在 Clojure 世界中我們應該不太需要擔心有使用者下架套件這件事 :S。
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orga9b894a&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orga9b894a&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orga9b894a&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;http://www.haneycodes.net/npm-left-pad-have-we-forgotten-how-to-program/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NPM &amp;amp; left-pad: Have We Forgotten How To Program?&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://www.gigamonkeys.com/book/a-few-format-recipes.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Praticle Common Lisp - A Few FORMAT Recipes&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/7c811780/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Zephyr RTOS 開發記錄: Mac OSX 下 SDK 編譯</title>
      <link>https://coldnew.github.io/70ccebe8/</link>
      <guid>https://coldnew.github.io/70ccebe8/</guid>
      <pubDate>Mon, 29 Feb 2016 03:14:00 GMT</pubDate>
      <description>
         &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/blog/2016/02/21_zephyr/&quot;&gt;Zephyr RTOS 開發記錄: 基本環境建立&lt;/a&gt; 一文中提到了我們如何安裝 &lt;a href=&quot;https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr SDK&lt;/a&gt; 到 Linux 系統來進行開發，那如果我想要在 Mac OSX 上面開發要怎麼辦呢？
&lt;/p&gt;

&lt;p&gt;
由於 &lt;a href=&quot;https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr SDK&lt;/a&gt; 目前僅提供 Linux 的版本，因此在 Mac OSX 中我們必須自己透過 &lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt; 去編譯我們自己的 SDK。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;div id=&quot;outline-container-orge29c4b6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge29c4b6&quot;&gt;安裝依賴的相關套件&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge29c4b6&quot;&gt;
&lt;p&gt;
第一步要做的，當然就是安裝相關套件啦，這點我們直接透過 &lt;a href=&quot;http://brew.sh/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;homebrew&lt;/a&gt; 來安裝
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ brew install gettext qemu help2man mpfr gmp coreutils wget
&lt;/pre&gt;

&lt;p&gt;
接下來我們要安裝 GNU 的 grep 命令來替代系統內建的 grep 命令
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ brew tap homebrew/dupes
coldnew@MacOSX ~ $ brew install grep --default-names
&lt;/pre&gt;

&lt;p&gt;
接著，安裝我們需要用的程式: &lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt;
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ brew install crosstool-ng
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org396e373&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org396e373&quot;&gt;建立編譯環境&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org396e373&quot;&gt;
&lt;p&gt;
安裝好 &lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt; 後，我們需要建立一個 &lt;code&gt;Case Sensitive&lt;/code&gt; 的 HFS+ 硬碟來讓 MacOSX 可以順利編譯，以下為我建立這顆硬碟所用的命令 (佔 10G 的硬碟空間)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;hdiutil create -volname CrossToolNG -type SPARSE &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
        -fs &lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;Case-sensitive Journaled HFS+&#39;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
        -size 10g CrossToolNG.sparseimage
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
完成後，打開 &lt;code&gt;CrossToolNG.sparseimage&lt;/code&gt; 這個映像檔，他會被掛載到 &lt;code&gt;/Volumes/CrossToolNG&lt;/code&gt; 去
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ open CrossToolNG.sparseimage
&lt;/pre&gt;

&lt;p&gt;
接著我們就切換到 &lt;code&gt;/Volumes/CrossToolNG&lt;/code&gt; 來準備進行我們的編譯，順便建立一個 &lt;code&gt;src&lt;/code&gt; 資料夾讓 &lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt; 存放他下載的原始碼
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ cd /Volumes/CrossToolNG &amp;amp;&amp;amp; mkdir src
&lt;/pre&gt;

&lt;p&gt;
我們先複製 &lt;a href=&quot;https://www.zephyrproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr&lt;/a&gt; 裡面提供的設定檔到當前目錄
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX /Volumes/CrossToolNG $ cp ${ZEPHYR_BASE}/scripts/cross_compiler/x86.config .config
&lt;/pre&gt;

&lt;p&gt;
如果你有什麼設定要修正的話，可以使用 &lt;code&gt;ct-ng menuconfig&lt;/code&gt; 來進行修改
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX /Volumes/CrossToolNG $ ct-ng menuconfig
&lt;/pre&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/70ccebe8/menuconfig-osx.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
另外，在進行編譯前要確認以下幾個設定是否和你編譯目錄 (/Volumes/CrossToolNG) 一致
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_LOCAL_TARBALLS_DIR&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;/Volumes/CrossToolNG/src&quot;&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;CT_SAVE_TARBALLS is not set&lt;/span&gt;
&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_WORK_DIR&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;${CT_TOP_DIR}/.build&quot;&lt;/span&gt;
&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_PREFIX_DIR&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;/Volumes/CrossToolNG/x-tools/${CT_TARGET}&quot;&lt;/span&gt;
&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_INSTALL_DIR&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;${CT_PREFIX_DIR}&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
都確認沒問題後，就開始我們的編譯吧 gogogo ~
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX /Volumes/CrossToolNG $ ct-ng build
&lt;/pre&gt;

&lt;p&gt;
接著你可以去泡杯咖啡或出去走走，編譯工具鍊 (toolchain) 很花時間的
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgecd4d4e&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgecd4d4e&quot;&gt;設定編譯環境&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgecd4d4e&quot;&gt;
&lt;p&gt;
完成編譯我們要的工具鍊 (toolchain) 後，我們可以在 &lt;code&gt;/Volumes/CrossToolNG&lt;/code&gt; 看到以下的資料夾，其中 &lt;code&gt;x-tools&lt;/code&gt; 就是我們編譯出來的結果
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX /Volumes/CrossToolNG $ tree -L 1.
. &amp;lt;b&amp;gt;
├── build.log &amp;lt;g&amp;gt;
├── config -&amp;gt; /usr/local/Cellar/crosstool-ng/1.22.0/lib/crosstool-ng-1.22.0/config &amp;lt;lb&amp;gt;
├── config.gen &amp;lt;b&amp;gt;
├── src &amp;lt;b&amp;gt;
└── x-tools &amp;lt;b&amp;gt;

4 directories, 1 file
&lt;/pre&gt;

&lt;p&gt;
最後，在你的 &lt;code&gt;~/.zephyrrc&lt;/code&gt; 設定這些環境變數就可以去嘗試編譯你的 &lt;a href=&quot;https://www.zephyrproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr kernel&lt;/a&gt; 看看囉 ~
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@MacOSX ~ $ vim ~/.zephyrrc

&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;XTOOLS_TOOLCHAIN_PATH&lt;/span&gt;=/Volumes/CrossToolNG/x-tools
&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;ZEPHYR_SDK_INSTALL_DIR&lt;/span&gt;=$&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;XTOOLS_TOOLCHAIN_PATH&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;ZEPHYR_GCC_VARIANT&lt;/span&gt;=xtools
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc19f781&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc19f781&quot;&gt;可能會遇到的錯誤&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc19f781&quot;&gt;
&lt;p&gt;
在 Mac OSX 下編譯非 Apple 官方的東西常常會出現一堆奇怪的錯誤，有時是因為 XCode 的改動，有時是因為你透過 &lt;a href=&quot;http://brew.sh/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;homebrew&lt;/a&gt; 安裝了其他命令和 Mac OSX 內建的有衝突。
&lt;/p&gt;

&lt;p&gt;
下面紀錄我在這次編譯遇到的錯誤:
&lt;/p&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb2ef69a&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgb2ef69a&quot;&gt;stat: cannot read file system information for &#39;%Lp&#39;&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgb2ef69a&quot;&gt;
&lt;p&gt;
如果你遇到了這個問題，哪很有可能是因為你的系統同時也裝了 &lt;a href=&quot;http://www.gnu.org/software/coreutils/coreutils.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GNU coreutils&lt;/a&gt; 導致 &lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt; 調用的命令是 GNU 的 &lt;code&gt;stat&lt;/code&gt; 命令，而不是系統內建的 stat 命令。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
[INFO ]  Performing some trivial sanity checks
[INFO ]  Build started 20160229.010627
[INFO ]  Building environment variables
[EXTRA]  Preparing working directories
[00:01] / stat: cannot read file system information for &#39;%Lp&#39;: No such file or directory
[ERROR]
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  Build failed in step &#39;(top-level)&#39;
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  Error happened in: CT_DoForceRmdir[scripts/functions@460]
[ERROR]  &amp;gt;&amp;gt;        called from: main[scripts/crosstool-NG.sh@238]
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  For more info on this error, look at the file: &#39;build.log&#39;
[ERROR]  &amp;gt;&amp;gt;  There is a list of known issues, some with workarounds, in:
[ERROR]  &amp;gt;&amp;gt;      &#39;/usr/local/Cellar/crosstool-ng/1.22.0/share/doc/crosstool-ng/crosstool-ng-1.22.0/B - Known issues.txt&#39;
[ERROR]
[ERROR]  (elapsed: 0:00.70)
[00:01] / make: *** [build] Error 1
&lt;/pre&gt;

&lt;p&gt;
我們可以透過 &lt;code&gt;which&lt;/code&gt; 命令去檢查是否真的用到  &lt;a href=&quot;http://www.gnu.org/software/coreutils/coreutils.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GNU coreutils&lt;/a&gt; 的 &lt;code&gt;stat&lt;/code&gt; 命令
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ which stat
/usr/local/opt/coreutils/libexec/gnubin/stat
&lt;/pre&gt;

&lt;p&gt;
我自己由於不常用 &lt;i&gt;stat&lt;/i&gt; 命令，所以選擇移除已經編譯好的 stat 連結，改用系統內建的 &lt;i&gt;stat&lt;/i&gt;
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ rm /usr/local/opt/coreutils/libexec/gnubin/stat
&lt;/pre&gt;

&lt;p&gt;
&lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt; 要找的 &lt;i&gt;stat&lt;/i&gt; 則是在 &lt;code&gt;/usr/bin&lt;/code&gt; 下
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ which stat
/usr/bin/stat
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc3ad37f&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgc3ad37f&quot;&gt;ld: library not found for -lcrt0.o&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgc3ad37f&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://www.zephyrproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr&lt;/a&gt; 提供的 &lt;code&gt;.config&lt;/code&gt; 有打開靜態連結 (static link) 相關的設定，於是你會遇到這樣的狀況，解法參考 &lt;a href=&quot;https://github.com/crosstool-ng/crosstool-ng/issues/31&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;issue #31&lt;/a&gt; 移除 static link 相關設定。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
[INFO ]  Performing some trivial sanity checks
[INFO ]  Build started 20160229.011000
[INFO ]  Building environment variables
[EXTRA]  Preparing working directories
[ERROR]    clang: error: linker command failed with exit code 1 (use -v to see invocation)
[ERROR]
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  Build failed in step &#39;Checking that gcc can compile a trivial statically linked program (CT_WANTS_STATIC_LINK)&#39;
[ERROR]  &amp;gt;&amp;gt;        called in step &#39;(top-level)&#39;
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  Error happened in: CT_DoExecLog[scripts/functions@216]
[ERROR]  &amp;gt;&amp;gt;        called from: main[scripts/crosstool-NG.sh@554]
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  For more info on this error, look at the file: &#39;build.log&#39;
[ERROR]  &amp;gt;&amp;gt;  There is a list of known issues, some with workarounds, in:
[ERROR]  &amp;gt;&amp;gt;      &#39;/usr/local/Cellar/crosstool-ng/1.22.0/share/doc/crosstool-ng/crosstool-ng-1.22.0/B - Known issues.txt&#39;
[ERROR]
[ERROR]  (elapsed: 0:03.48)
[00:05] / make: *** [build] Error 1
&lt;/pre&gt;

&lt;p&gt;
我自己是將 &lt;code&gt;.config&lt;/code&gt; 裡面這兩個靜態連結 (static link) 相關的函式庫設定為取消後就可以正常編譯囉~
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_WANTS_STATIC_LINK&lt;/span&gt;=n
&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_CC_GCC_STATIC_LIBSTDCXX&lt;/span&gt;=n
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org818c9bc&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org818c9bc&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org818c9bc&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;https://www.zephyrproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr Project Website&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://linuxgizmos.com/zephyr-a-tiny-open-source-iot-rtos/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Meet Linux&#39;s little brother: Zephyr, a tiny open-source IoT RTOS&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
      <content:encoded><![CDATA[&lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
在 &lt;a href=&quot;http://coldnew.github.io/blog/2016/02/21_zephyr/&quot;&gt;Zephyr RTOS 開發記錄: 基本環境建立&lt;/a&gt; 一文中提到了我們如何安裝 &lt;a href=&quot;https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr SDK&lt;/a&gt; 到 Linux 系統來進行開發，那如果我想要在 Mac OSX 上面開發要怎麼辦呢？
&lt;/p&gt;

&lt;p&gt;
由於 &lt;a href=&quot;https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr SDK&lt;/a&gt; 目前僅提供 Linux 的版本，因此在 Mac OSX 中我們必須自己透過 &lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt; 去編譯我們自己的 SDK。
&lt;/p&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

&lt;div id=&quot;outline-container-orge29c4b6&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orge29c4b6&quot;&gt;安裝依賴的相關套件&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orge29c4b6&quot;&gt;
&lt;p&gt;
第一步要做的，當然就是安裝相關套件啦，這點我們直接透過 &lt;a href=&quot;http://brew.sh/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;homebrew&lt;/a&gt; 來安裝
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ brew install gettext qemu help2man mpfr gmp coreutils wget
&lt;/pre&gt;

&lt;p&gt;
接下來我們要安裝 GNU 的 grep 命令來替代系統內建的 grep 命令
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ brew tap homebrew/dupes
coldnew@MacOSX ~ $ brew install grep --default-names
&lt;/pre&gt;

&lt;p&gt;
接著，安裝我們需要用的程式: &lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt;
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ brew install crosstool-ng
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org396e373&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org396e373&quot;&gt;建立編譯環境&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org396e373&quot;&gt;
&lt;p&gt;
安裝好 &lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt; 後，我們需要建立一個 &lt;code&gt;Case Sensitive&lt;/code&gt; 的 HFS+ 硬碟來讓 MacOSX 可以順利編譯，以下為我建立這顆硬碟所用的命令 (佔 10G 的硬碟空間)
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;hdiutil create -volname CrossToolNG -type SPARSE &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
        -fs &lt;span style=&quot;color: #aadddd;&quot;&gt;&#39;Case-sensitive Journaled HFS+&#39;&lt;/span&gt; &lt;span style=&quot;color: #aadddd;&quot;&gt;\&lt;/span&gt;
        -size 10g CrossToolNG.sparseimage
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
完成後，打開 &lt;code&gt;CrossToolNG.sparseimage&lt;/code&gt; 這個映像檔，他會被掛載到 &lt;code&gt;/Volumes/CrossToolNG&lt;/code&gt; 去
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ open CrossToolNG.sparseimage
&lt;/pre&gt;

&lt;p&gt;
接著我們就切換到 &lt;code&gt;/Volumes/CrossToolNG&lt;/code&gt; 來準備進行我們的編譯，順便建立一個 &lt;code&gt;src&lt;/code&gt; 資料夾讓 &lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt; 存放他下載的原始碼
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ cd /Volumes/CrossToolNG &amp;amp;&amp;amp; mkdir src
&lt;/pre&gt;

&lt;p&gt;
我們先複製 &lt;a href=&quot;https://www.zephyrproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr&lt;/a&gt; 裡面提供的設定檔到當前目錄
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX /Volumes/CrossToolNG $ cp ${ZEPHYR_BASE}/scripts/cross_compiler/x86.config .config
&lt;/pre&gt;

&lt;p&gt;
如果你有什麼設定要修正的話，可以使用 &lt;code&gt;ct-ng menuconfig&lt;/code&gt; 來進行修改
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX /Volumes/CrossToolNG $ ct-ng menuconfig
&lt;/pre&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://coldnew.github.io/70ccebe8/menuconfig-osx.png&quot;&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
另外，在進行編譯前要確認以下幾個設定是否和你編譯目錄 (/Volumes/CrossToolNG) 一致
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_LOCAL_TARBALLS_DIR&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;/Volumes/CrossToolNG/src&quot;&lt;/span&gt;
&lt;span style=&quot;color: #5f5f5f; font-style: italic;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color: #9ac; font-style: italic;&quot;&gt;CT_SAVE_TARBALLS is not set&lt;/span&gt;
&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_WORK_DIR&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;${CT_TOP_DIR}/.build&quot;&lt;/span&gt;
&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_PREFIX_DIR&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;/Volumes/CrossToolNG/x-tools/${CT_TARGET}&quot;&lt;/span&gt;
&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_INSTALL_DIR&lt;/span&gt;=&lt;span style=&quot;color: #aadddd;&quot;&gt;&quot;${CT_PREFIX_DIR}&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
都確認沒問題後，就開始我們的編譯吧 gogogo ~
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX /Volumes/CrossToolNG $ ct-ng build
&lt;/pre&gt;

&lt;p&gt;
接著你可以去泡杯咖啡或出去走走，編譯工具鍊 (toolchain) 很花時間的
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgecd4d4e&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgecd4d4e&quot;&gt;設定編譯環境&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgecd4d4e&quot;&gt;
&lt;p&gt;
完成編譯我們要的工具鍊 (toolchain) 後，我們可以在 &lt;code&gt;/Volumes/CrossToolNG&lt;/code&gt; 看到以下的資料夾，其中 &lt;code&gt;x-tools&lt;/code&gt; 就是我們編譯出來的結果
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX /Volumes/CrossToolNG $ tree -L 1.
. &amp;lt;b&amp;gt;
├── build.log &amp;lt;g&amp;gt;
├── config -&amp;gt; /usr/local/Cellar/crosstool-ng/1.22.0/lib/crosstool-ng-1.22.0/config &amp;lt;lb&amp;gt;
├── config.gen &amp;lt;b&amp;gt;
├── src &amp;lt;b&amp;gt;
└── x-tools &amp;lt;b&amp;gt;

4 directories, 1 file
&lt;/pre&gt;

&lt;p&gt;
最後，在你的 &lt;code&gt;~/.zephyrrc&lt;/code&gt; 設定這些環境變數就可以去嘗試編譯你的 &lt;a href=&quot;https://www.zephyrproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr kernel&lt;/a&gt; 看看囉 ~
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;coldnew@MacOSX ~ $ vim ~/.zephyrrc

&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;XTOOLS_TOOLCHAIN_PATH&lt;/span&gt;=/Volumes/CrossToolNG/x-tools
&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;ZEPHYR_SDK_INSTALL_DIR&lt;/span&gt;=$&lt;span style=&quot;color: #aadddd;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;XTOOLS_TOOLCHAIN_PATH&lt;/span&gt;&lt;span style=&quot;color: #aadddd;&quot;&gt;}&lt;/span&gt;
&lt;span style=&quot;color: #ccaaff;&quot;&gt;export&lt;/span&gt; &lt;span style=&quot;color: #aaccff;&quot;&gt;ZEPHYR_GCC_VARIANT&lt;/span&gt;=xtools
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc19f781&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;orgc19f781&quot;&gt;可能會遇到的錯誤&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-orgc19f781&quot;&gt;
&lt;p&gt;
在 Mac OSX 下編譯非 Apple 官方的東西常常會出現一堆奇怪的錯誤，有時是因為 XCode 的改動，有時是因為你透過 &lt;a href=&quot;http://brew.sh/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;homebrew&lt;/a&gt; 安裝了其他命令和 Mac OSX 內建的有衝突。
&lt;/p&gt;

&lt;p&gt;
下面紀錄我在這次編譯遇到的錯誤:
&lt;/p&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgb2ef69a&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgb2ef69a&quot;&gt;stat: cannot read file system information for &#39;%Lp&#39;&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgb2ef69a&quot;&gt;
&lt;p&gt;
如果你遇到了這個問題，哪很有可能是因為你的系統同時也裝了 &lt;a href=&quot;http://www.gnu.org/software/coreutils/coreutils.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GNU coreutils&lt;/a&gt; 導致 &lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt; 調用的命令是 GNU 的 &lt;code&gt;stat&lt;/code&gt; 命令，而不是系統內建的 stat 命令。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
[INFO ]  Performing some trivial sanity checks
[INFO ]  Build started 20160229.010627
[INFO ]  Building environment variables
[EXTRA]  Preparing working directories
[00:01] / stat: cannot read file system information for &#39;%Lp&#39;: No such file or directory
[ERROR]
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  Build failed in step &#39;(top-level)&#39;
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  Error happened in: CT_DoForceRmdir[scripts/functions@460]
[ERROR]  &amp;gt;&amp;gt;        called from: main[scripts/crosstool-NG.sh@238]
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  For more info on this error, look at the file: &#39;build.log&#39;
[ERROR]  &amp;gt;&amp;gt;  There is a list of known issues, some with workarounds, in:
[ERROR]  &amp;gt;&amp;gt;      &#39;/usr/local/Cellar/crosstool-ng/1.22.0/share/doc/crosstool-ng/crosstool-ng-1.22.0/B - Known issues.txt&#39;
[ERROR]
[ERROR]  (elapsed: 0:00.70)
[00:01] / make: *** [build] Error 1
&lt;/pre&gt;

&lt;p&gt;
我們可以透過 &lt;code&gt;which&lt;/code&gt; 命令去檢查是否真的用到  &lt;a href=&quot;http://www.gnu.org/software/coreutils/coreutils.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GNU coreutils&lt;/a&gt; 的 &lt;code&gt;stat&lt;/code&gt; 命令
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ which stat
/usr/local/opt/coreutils/libexec/gnubin/stat
&lt;/pre&gt;

&lt;p&gt;
我自己由於不常用 &lt;i&gt;stat&lt;/i&gt; 命令，所以選擇移除已經編譯好的 stat 連結，改用系統內建的 &lt;i&gt;stat&lt;/i&gt;
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ rm /usr/local/opt/coreutils/libexec/gnubin/stat
&lt;/pre&gt;

&lt;p&gt;
&lt;a href=&quot;http://crosstool-ng.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;crosstool-ng&lt;/a&gt; 要找的 &lt;i&gt;stat&lt;/i&gt; 則是在 &lt;code&gt;/usr/bin&lt;/code&gt; 下
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
coldnew@MacOSX ~ $ which stat
/usr/bin/stat
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-orgc3ad37f&quot; class=&quot;outline-3&quot;&gt;
&lt;h3 id=&quot;orgc3ad37f&quot;&gt;ld: library not found for -lcrt0.o&lt;/h3&gt;
&lt;div class=&quot;outline-text-3&quot; id=&quot;text-orgc3ad37f&quot;&gt;
&lt;p&gt;
&lt;a href=&quot;https://www.zephyrproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr&lt;/a&gt; 提供的 &lt;code&gt;.config&lt;/code&gt; 有打開靜態連結 (static link) 相關的設定，於是你會遇到這樣的狀況，解法參考 &lt;a href=&quot;https://github.com/crosstool-ng/crosstool-ng/issues/31&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;issue #31&lt;/a&gt; 移除 static link 相關設定。
&lt;/p&gt;

&lt;pre class=&quot;example&quot;&gt;
[INFO ]  Performing some trivial sanity checks
[INFO ]  Build started 20160229.011000
[INFO ]  Building environment variables
[EXTRA]  Preparing working directories
[ERROR]    clang: error: linker command failed with exit code 1 (use -v to see invocation)
[ERROR]
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  Build failed in step &#39;Checking that gcc can compile a trivial statically linked program (CT_WANTS_STATIC_LINK)&#39;
[ERROR]  &amp;gt;&amp;gt;        called in step &#39;(top-level)&#39;
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  Error happened in: CT_DoExecLog[scripts/functions@216]
[ERROR]  &amp;gt;&amp;gt;        called from: main[scripts/crosstool-NG.sh@554]
[ERROR]  &amp;gt;&amp;gt;
[ERROR]  &amp;gt;&amp;gt;  For more info on this error, look at the file: &#39;build.log&#39;
[ERROR]  &amp;gt;&amp;gt;  There is a list of known issues, some with workarounds, in:
[ERROR]  &amp;gt;&amp;gt;      &#39;/usr/local/Cellar/crosstool-ng/1.22.0/share/doc/crosstool-ng/crosstool-ng-1.22.0/B - Known issues.txt&#39;
[ERROR]
[ERROR]  (elapsed: 0:03.48)
[00:05] / make: *** [build] Error 1
&lt;/pre&gt;

&lt;p&gt;
我自己是將 &lt;code&gt;.config&lt;/code&gt; 裡面這兩個靜態連結 (static link) 相關的函式庫設定為取消後就可以正常編譯囉~
&lt;/p&gt;

&lt;div class=&quot;org-src-container&quot;&gt;
&lt;pre class=&quot;src src-sh&quot;&gt;&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_WANTS_STATIC_LINK&lt;/span&gt;=n
&lt;span style=&quot;color: #aaccff;&quot;&gt;CT_CC_GCC_STATIC_LIBSTDCXX&lt;/span&gt;=n
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;outline-container-org818c9bc&quot; class=&quot;outline-2&quot;&gt;
&lt;h2 id=&quot;org818c9bc&quot;&gt;延伸閱讀&lt;/h2&gt;
&lt;div class=&quot;outline-text-2&quot; id=&quot;text-org818c9bc&quot;&gt;
&lt;p&gt;
&lt;code&gt;[1]&lt;/code&gt; &lt;a href=&quot;https://www.zephyrproject.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Zephyr Project Website&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;code&gt;[2]&lt;/code&gt; &lt;a href=&quot;http://linuxgizmos.com/zephyr-a-tiny-open-source-iot-rtos/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Meet Linux&#39;s little brother: Zephyr, a tiny open-source IoT RTOS&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
]]></content:encoded>
      <comments>https://coldnew.github.io/70ccebe8/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
