<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>coldnew&amp;#39;s blog</title>
    <link>https://coldnew.github.io/</link>
    <atom:link href="/rss.xml" rel="self" type="application/rss+xml"/>
    
    <description></description>
    <pubDate>Sun, 23 Apr 2017 12:27:00 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>å°‡ Orange Pi Zero æ”¹é€ æˆ AirPlay éŸ³é »æ’­æ”¾å™¨</title>
      <link>https://coldnew.github.io/d48bba9e/</link>
      <guid>https://coldnew.github.io/d48bba9e/</guid>
      <pubDate>Sun, 23 Apr 2017 12:27:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
æœ€è¿‘çªç„¶åˆæƒ³è‡ªå·±æ¶è¨­å€‹ç°¡å–®çš„ AirPlay æ’­æ”¾å™¨ï¼Œå¥½é€é wifi é ç«¯æ’­æ”¾æˆ‘çš„ iPhone æˆ–æ˜¯ MacBook ä¸Šé¢çš„éŸ³æ¨‚ã€‚
&lt;/p&gt;

&lt;p&gt;
å‰›å¥½æ‰‹é‚Šçš„å–®æ¿é›»è…¦éƒ½å·²ç¶“æœ‰å„è‡ªçš„ç”¨é€”ï¼Œæ–¼æ˜¯ä¾¿ä¾†æ‰¾ä¸€ç‰‡æ–°çš„æ¿å­ï¼Œæœ€å¾Œé–å®šäº† &lt;a href=&quot;http://www.orangepi.org/orangepizero/&quot;&gt;Orange Pi Zero&lt;/a&gt; é€™ç‰‡é–‹ç™¼æ¿ (æˆ‘é¸çš„æ˜¯è¨˜æ†¶é«”ç‚º 256 MB çš„ç‰ˆæœ¬)ã€‚
&lt;/p&gt;

&lt;p&gt;
æœƒé¸é€™ç‰‡çš„åŸå› ï¼Œä¸»è¦æ˜¯åŒ…å«é‹è²»å¾Œä»–æœ€ä¾¿å®œ(å¤§ç´„ NT 362 å…ƒ)ï¼Œå‰©ä¸‹è¦è‡ªå·±æº–å‚™çš„å‰‡æ˜¯: USB é›»æºã€USB æ‰‹æ©Ÿå……é›»ç·šã€8GB MicroSD å¡ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>æœ€è¿‘çªç„¶åˆæƒ³è‡ªå·±æ¶è¨­å€‹ç°¡å–®çš„ AirPlay æ’­æ”¾å™¨ï¼Œå¥½é€é wifi é ç«¯æ’­æ”¾æˆ‘çš„ iPhone æˆ–æ˜¯ MacBook ä¸Šé¢çš„éŸ³æ¨‚ã€‚</p><p>å‰›å¥½æ‰‹é‚Šçš„å–®æ¿é›»è…¦éƒ½å·²ç¶“æœ‰å„è‡ªçš„ç”¨é€”ï¼Œæ–¼æ˜¯ä¾¿ä¾†æ‰¾ä¸€ç‰‡æ–°çš„æ¿å­ï¼Œæœ€å¾Œé–å®šäº† <a href="http://www.orangepi.org/orangepizero/" target="_blank" rel="external">Orange Pi Zero</a> é€™ç‰‡é–‹ç™¼æ¿ (æˆ‘é¸çš„æ˜¯è¨˜æ†¶é«”ç‚º 256 MB çš„ç‰ˆæœ¬)ã€‚</p><p>æœƒé¸é€™ç‰‡çš„åŸå› ï¼Œä¸»è¦æ˜¯åŒ…å«é‹è²»å¾Œä»–æœ€ä¾¿å®œ(å¤§ç´„ NT 362 å…ƒ)ï¼Œå‰©ä¸‹è¦è‡ªå·±æº–å‚™çš„å‰‡æ˜¯: USB é›»æºã€USB æ‰‹æ©Ÿå……é›»ç·šã€8GB MicroSD å¡ã€‚</p><a id="more"></a><p>é€™é‚Šå°±ä¾†ç´€éŒ„ä¸€ä¸‹æˆ‘æ€æ¨£é€²è¡Œè¨­å®šçš„ã€‚</p><div id="outline-container-org51a6fd3" class="outline-2"><h2 id="org51a6fd3">ä¸‹è¼‰ Image</h2><div class="outline-text-2" id="text-org51a6fd3"><p>é¦–å…ˆé€£ç·šåˆ° <a href="http://www.orangepi.org/downloadresources/" target="_blank" rel="external"><a href="http://www.orangepi.org/downloadresources/" target="_blank" rel="external">http://www.orangepi.org/downloadresources/</a></a> ï¼Œå–å¾—ä½ è¦ç”¨çš„ Imageã€‚ç”±æ–¼æˆ‘åªæ˜¯è¦ç”¨æ–¼æ–‡å­—ä»‹é¢ï¼Œå› æ­¤é¸æ“‡ <code>Debian Server</code> ã€‚</p><div class="figure"><p><img src="a4.png"></p></div><p>ä¸‹è¼‰å¥½ Image ä¸¦è§£å£“ç¸®å¾Œï¼Œå¯ä»¥ç›´æ¥é€é <code>dd</code> å‘½ä»¤å°‡å…¶ç‡’éŒ„åˆ° SD å¡ (å‡è¨­ SD å¡è¨­å‚™ç‚º: /dev/sdc )</p><pre class="example">coldnew@gentoo ~ $ sudo dd if=debian_server_For_OrangePizero_v0_9_2.img of=/dev/sdc bs=1m</pre></div></div><div id="outline-container-org45f6f55" class="outline-2"><h2 id="org45f6f55">é€£æ¥ UART</h2><div class="outline-text-2" id="text-org45f6f55"><p>å°‡ SD å¡æ’ä¸Šå¾Œï¼Œæˆ‘æœƒå…ˆé€é USB è½‰ TTL çš„è½‰æ¥ç·šä¾†ç™»å…¥çµ‚ç«¯ä»‹é¢</p><p>å¾ <a href="http://linux-sunxi.org/Xunlong_Orange_Pi_Zero" target="_blank" rel="external">Xunlong Orange Pi Zero</a> ä¸Šé¢å¯ä»¥çœ‹åˆ° Orange Pi Zero çš„è…³ä½æ˜¯é€™æ¨£å®šç¾©çš„:</p><div class="figure"><p><img src="a6.jpg"></p></div><p>å› æ­¤æˆ‘å€‘æ¥ç·šçš„æ™‚å€™ï¼Œè¦æŠŠ USB è½‰ TTL ç·šä¸Šé¢çš„ TX æ¥åˆ° Orange Pi Zero çš„ RX, TTL ç·šä¸Šé¢çš„ RX æ¥åˆ° Orange Pi Zero çš„ TX:</p><div class="figure"><p><img src="a5.jpg"></p></div><p>å¦‚æœæ¥ä¸Šå»å¾Œï¼Œé–‹æ©Ÿæ²’ä»»ä½•è¨Šæ¯çš„è©±ï¼Œå¯ä»¥è©¦è‘—æŠŠ TX å’Œ RX ç·šå°èª¿ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯æ¥éŒ¯äº†ã€‚</p></div></div><div id="outline-container-org0e5a62e" class="outline-2"><h2 id="org0e5a62e">é è¨­å¸³è™Ÿå¯†ç¢¼</h2><div class="outline-text-2" id="text-org0e5a62e"><p><a href="http://www.orangepi.org/orangepizero/" target="_blank" rel="external">Orange Pi Zero</a> é è¨­çš„å¸³è™Ÿå¯†ç¢¼æ˜¯é€™æ¨£çš„:</p><ul class="org-ul"><li>å¸³è™Ÿ: root</li><li>å¯†ç¢¼: orangepi</li></ul><p>ä¸è¦è¼¸å…¥éŒ¯èª¤é€²å¯ä»¥é€²å»å•¦</p><pre class="example">Debian GNU/Linux 8 OrangePizero ttyS0OrangePizero login: rootPassword:</pre></div></div><div id="outline-container-orgdaca503" class="outline-2"><h2 id="orgdaca503">æ“´å……æª”æ¡ˆç³»çµ±å¤§å°</h2><div class="outline-text-2" id="text-orgdaca503"><p>é€²å…¥åˆ°ç³»çµ±çš„ç¬¬ä¸€æ­¥ï¼Œç•¶ç„¶å°±æ˜¯æ“´å…… SD å¡çš„ç©ºé–“äº†</p><pre class="example">root@OrangePizero:~# fs_resizeDisk /dev/mmcblk0: 7.4 GiB, 7969177600 bytes, 15564800 sectors/dev/mmcblk0p1       40960  172031  131072   64M  b W95 FAT32/dev/mmcblk0p2      172032 2113536 1941505  948M 83 LinuxMax block: 15563776Part end: 2113536Part start: 172032WARNING: Do you want to resize "/dev/mmcblk0p2" (y/N)?  yPARTITION RESIZED.*********************************************Rootfs Extended. Please REBOOT to take effect*********************************************</pre><p>å¥½äº†å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥ä¾†é€²è¡Œç¶²è·¯è¨­å®šï¼Œä½ ä¹Ÿå¯ä»¥å…ˆæ¥ä¸Šç¶²è·¯ç·šï¼Œç„¶å¾Œæ›´æ–°å¥—ä»¶ã€‚</p></div></div><div id="outline-container-org0e341ae" class="outline-2"><h2 id="org0e341ae">è¨­å®š wifi</h2><div class="outline-text-2" id="text-org0e341ae"><p>æˆ‘è‡ªå·±å°æ–¼ wifi çš„è¨­å®šï¼Œä¸€ç›´éƒ½æ˜¯ç¿’æ…£ä½¿ç”¨ <a href="https://zh.wikipedia.org/zh-tw/NetworkManager" target="_blank" rel="external">NetworkManager</a> ä¾†é€²è¡Œçš„ã€‚å› æ­¤åœ¨é€™é‚Šå…ˆå•Ÿå‹• NetworkManager:</p><pre class="example">root@OrangePizero:~# systemctl start NetworkManagerroot@OrangePizero:~# systemctl enable NetworkManager</pre><p>å¦å¤–ï¼Œç”±æ–¼ <a href="http://www.orangepi.org/orangepizero/" target="_blank" rel="external">Orange Pi Zero</a> æœ‰å…©å€‹ wifi è¨­å‚™ï¼Œä¸€å€‹æ˜¯ p2p0ï¼Œå¦å¤–ä¸€å€‹æ˜¯ wlan1</p><pre class="example">root@OrangePizero:~# nmcli devDEVICE   TYPE      STATE      CONNECTIONeth0     ethernet  connected  eth0p2p0     wifi      unmanaged  --gre0     gre       unmanaged  --lo       loopback  unmanaged  --wlan1    wifi      unmanaged  --ip6tnl0  unknown   unmanaged  --sit0     unknown   unmanaged  --tunl0    unknown   unmanaged  --</pre><p>ç”±æ–¼ NetworkManager é è¨­æœƒå…ˆå»æŠ“ p2p0 (æŒ‰ç…§å­—æ¯æ’åˆ—)ï¼Œå› æ­¤æˆ‘æœƒè¨­å®šæˆè®“ NetworkManager å¿½ç•¥ p2p0 é€™å€‹è¨­å‚™ï¼Œé¿å…è¨­å®š wifi è®Šå¾—éº»ç…©ã€‚</p><p>ç·¨è¼¯  <code>/etc/NetworkManager/NetworkManager.conf</code> ï¼ŒåŠ å…¥ä»¥ä¸‹è³‡è¨Š:</p><div class="org-src-container"><pre class="src src-conf">[<span style="color: #fff59d;">main</span>]<span style="color: #aaccff;">plugins</span>=ifupdown,keyfile[<span style="color: #fff59d;">ifupdown</span>]<span style="color: #aaccff;">managed</span>=true[<span style="color: #fff59d;">keyfile</span>]<span style="color: #aaccff;">unmanaged-devices</span>=interface-name:p2p0</pre></div><p>å¥½äº†å¾Œï¼Œé‡æ–°å•Ÿå‹• NetworkManager</p><pre class="example">root@OrangePizero:~# systemctl restart NetworkManager</pre><p>é€™æ¨£æˆ‘å€‘å°±å¯ä»¥åˆ—å‡ºæˆ‘å€‘å¯ä»¥é€£ç·šçš„ç„¡ç·šç¶²è·¯:</p><pre class="example">root@OrangePizero:~# nmcli dev wifi list*  SSID        MODE   CHAN  RATE       SIGNAL  BARS  SECURITY   Edgar       Infra  10    54 Mbit/s  100     â–‚â–„â–†â–ˆ  WPA1 WPA2   AUSTIN&amp;FAY  Infra  6     54 Mbit/s  45      â–‚â–„__  WPA1 WPA2   75226490    Infra  1     54 Mbit/s  35      â–‚â–„__  WPA2   2.4aaaaaaa  Infra  4     54 Mbit/s  34      â–‚â–„__  WPA1 WPA2   RT-N16      Infra  6     54 Mbit/s  29      â–‚___  WPA2   a89565282   Infra  1     54 Mbit/s  25      â–‚___  WPA1 WPA2   dlink       Infra  11    54 Mbit/s  20      â–‚___  WPA1 WPA2   mat         Infra  3     54 Mbit/s  22      â–‚___  WPA1</pre><p>å‡è¨­æˆ‘å€‘è¦é€£æ¥çš„ ESSID ç‚º Edgarï¼Œå‰‡æ¥ä¸‹ä¾†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é€²è¡Œé€£æ¥ </p><pre class="example">root@OrangePizero:~# nmtui-connect Edgar</pre><p>ä½ æœƒçœ‹åˆ°å‡ºç¾ä¸€å€‹è¼¸å…¥å¯†ç¢¼çš„è¦–çª—ï¼Œè¼¸å…¥é€²å»å¾Œæ‡‰è©²å°±å¯ä»¥æ­£å¸¸é€£ä¸Šç¶²è·¯äº†</p><div class="figure"><p><img src="a1.png"></p></div><p>å¦‚æœä½ æƒ³è¦ä¸€å€‹æŒ‡ä»¤å°±å®Œæˆé€™å€‹å‹•ä½œï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ (æ›¿æ› &lt;essid&gt; å’Œ &lt;password&gt;)</p><pre class="example">root@OrangePizero:~# nmcli dev wifi connect &lt;essid&gt; password &lt;password&gt;</pre><p>é€™æ¨£æˆ‘å€‘å°±å®Œæˆç„¡ç·šç¶²è·¯çš„é€£æ¥ã€‚</p></div></div><div id="outline-container-orgc79f487" class="outline-2"><h2 id="orgc79f487">è¨­å®š avahi-daemon</h2><div class="outline-text-2" id="text-orgc79f487"><p>ç‚ºäº†è®“ Apple è¨­å‚™å¯ä»¥é€é <a href="https://en.wikipedia.org/wiki/Zero-configuration_networking" target="_blank" rel="external">Zeroconf</a> å”å®šæ‰¾åˆ°åŒä¸€ç¶²åŸŸä¸‹çš„è¨­å‚™ï¼Œæˆ‘å€‘å¿…é ˆå•Ÿç”¨ <a href="https://en.wikipedia.org/wiki/Avahi_(software)" target="_blank" rel="external">Avahi</a>ã€‚</p><p>é€™é‚Šå•Ÿç”¨ avahi ä¸¦å°‡å…¶åŠ å…¥é–‹æ©Ÿå•Ÿå‹•é …ç›®å»ã€‚</p><pre class="example">root@OrangePizero:~# systemctl start avahi-daemonroot@OrangePizero:~# systemctl enable avahi-daemon</pre></div></div><div id="outline-container-orge179e57" class="outline-2"><h2 id="orge179e57">ç·¨è­¯ä¸¦å®‰è£ shairport-sync</h2><div class="outline-text-2" id="text-orge179e57"><p>é¦–å…ˆï¼Œæˆ‘å€‘è¦å®‰è£ä¸€äº›è»Ÿé«”ä¾†å¹«åŠ©æˆ‘å€‘ç·¨è­¯ä¸¦å®‰è£ Shairportã€‚</p><div class="org-src-container"><pre class="src src-sh">root@OrangePizero:~# apt-get install build-essential git autoconf libtool <span style="color: #aadddd;">\</span>    libdaemon-dev libasound2-dev libpopt-dev libconfig-dev <span style="color: #aadddd;">\</span>    avahi-daemon libavahi-client-dev <span style="color: #aadddd;">\</span>    libssl-dev</pre></div><p>è©²è£çš„è»Ÿé«”éƒ½è£å®Œä»¥å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥ä¸‹è¼‰æœ€æ–°çš„ shairport-sync ç¨‹å¼ç¢¼ä¸¦å®‰è£åˆ°ç³»çµ±å…§ã€‚</p><div class="org-src-container"><pre class="src src-sh">git clone https://github.com/mikebrady/shairport-sync.git<span style="color: #ccaaff;">cd</span> shairport-sync &amp;&amp; autoreconf -i -f</pre></div><p>æ¥ä¸‹ä¾†å°±æ˜¯ä¾ç…§ <a href="https://github.com/mikebrady/shairport-sync" target="_blank" rel="external">shairport-sync</a> çš„ README é€²è¡Œè¨­ç½®ï¼Œæˆ‘æ˜¯è¨­å®šäº†é€™äº›åƒæ•¸</p><div class="org-src-container"><pre class="src src-sh">./configure <span style="color: #aadddd;">\</span>    --with-alsa --with-stdout --with-pipe --with-avahi <span style="color: #aadddd;">\</span>    --with-ssl=openssl --with-metadata --with-systemd</pre></div><p>æ¥ä¸‹ä¾†å°‡æ•´å€‹ç¨‹å¼å®‰è£åˆ°ç³»çµ±ä¸­</p><pre class="example">root@OrangePizero:~/shairport-sync# make install</pre><p>å› ç‚ºåœ¨å‰é¢çš„åƒæ•¸æˆ‘æ˜¯è¨­å®šç‚ºçµ¦ <i>systemd</i> çš„ä½¿ç”¨è€…ä½¿ç”¨ï¼Œå› æ­¤éœ€è¦å¢åŠ ä½¿ç”¨è€…èˆ‡ç¾¤çµ„</p><pre class="example">root@OrangePizero:~# groupadd -r shairport-syncroot@OrangePizero:~# useradd -r -M -g shairport-sync -s /usr/bin/nologin -G audio shairport-sync</pre><p>æ¥è‘—åŠ å…¥åˆ° <i>systemd</i> é–‹æ©Ÿè¨­å®šä¸­ï¼Œä¸¦å•Ÿç”¨ shairport-sync æœå‹™</p><pre class="example">root@OrangePizero:~# systemctl enable shairport-syncroot@OrangePizero:~# systemctl start shairport-sync</pre><p>å®Œæˆå¾Œï¼Œä¾†è¨­å®šè¼¸å‡ºè¨­å‚™ï¼Œé€™é‚Šæˆ‘æ¡ç”¨çš„æ˜¯ USB DACã€‚</p></div></div><div id="outline-container-org3e53415" class="outline-2"><h2 id="org3e53415">è¨­å®š USB DAC</h2><div class="outline-text-2" id="text-org3e53415"><p>æˆ‘è‡ªå·±æ’­æ”¾éŸ³æ¨‚çš„æ™‚å€™ï¼Œéƒ½æ˜¯é€é USB DAC ä¾†é€²è¡Œæ’­æ”¾çš„ (é€™æ¨£éŸ³è³ªè¼ƒå¥½)ï¼Œå› æ­¤è¦å¤šé€²è¡Œä¸€äº›æ­¥é©Ÿï¼Œè®“ <a href="http://www.orangepi.org/orangepizero/" target="_blank" rel="external">Orange Pi Zero</a> å¯ä»¥é€é USB éŸ³æ•ˆå¡è¼¸å‡ºã€‚</p></div><div id="outline-container-orga55348b" class="outline-3"><h3 id="orga55348b">è¼‰å…¥éœ€è¦çš„é©…å‹•</h3><div class="outline-text-3" id="text-orga55348b"><p>æ­£å¸¸ä¾†è¬›ï¼Œæˆ‘å€‘åªè¦è¼‰å…¥äº† <code>snd_usb_audio</code> é€™å€‹é©…å‹•ï¼Œå°±å¯ä»¥è®“ ALSA è­˜åˆ¥ USB éŸ³æ•ˆå¡ã€‚</p><p>ä¸é&#x2026;&#x2026;</p><pre class="example">root@OrangePizero:/lib/modules# modprobe snd_usb_audiomodprobe: ERROR: ../libkmod/libkmod.c:557 kmod_search_moddep() could not open moddep file '/lib/modules/3.4.39/modules.dep.bin'</pre><p>å¥½å§ï¼Œæœ‰æ±è¥¿å¾ç¼ºï¼Œæ”¹ç”¨ <code>insmod</code> çš„æ–¹å¼ä¾†è¼‰å…¥ã€‚æˆ‘å€‘åœ¨ <code>/etc/rc.local</code> åŠ ä¸Šé€™äº›æ±è¥¿</p><div class="org-src-container"><pre class="src src-sh">insmod /lib/modules/3.4.39_zero/snd-usbmidi-lib.koinsmod /lib/modules/3.4.39_zero/snd-hwdep.koinsmod /lib/modules/3.4.39_zero/snd-usb-audio.ko</pre></div><p>é€™æ¨£é‡é–‹æ©Ÿå¾Œï¼Œä½ å¯ä»¥é€é <code>lsmod</code> ç¢ºèªéœ€è¦ç”¨åˆ°çš„é©…å‹•æ˜¯å¦æœ‰çœŸçš„è¢«è¼‰å…¥:</p><pre class="example">root@OrangePizero:~# lsmodModule                  Size  Used bysnd_usb_audio          79205  2snd_hwdep               5337  1 snd_usb_audiosnd_usbmidi_lib        17391  1 snd_usb_audioxradio_wlan           230792  0</pre><p>å¦‚æœä¸Šé¢åˆ—å‡ºçš„æ¨¡çµ„æœ‰ç¼ºçš„è©±ï¼Œå¯ä»¥é€éä»¥ä¸‹å‘½ä»¤æª¢æŸ¥æ˜¯å¦ <code>/etc/rc.local</code> æœ‰å“ªå€‹åœ°æ–¹å‡ºéŒ¯</p><pre class="example">root@OrangePizero:~# systemctl status rc-localâ— rc-local.service - /etc/rc.local Compatibility   Loaded: loaded (/lib/systemd/system/rc-local.service; static)   Active: active (exited) since Thu 1970-01-01 00:38:08 UTC; 47 years 3 months agoJan 01 00:38:07 OrangePizero systemd[1]: Starting /etc/rc.local Compatibility...Jan 01 00:38:08 OrangePizero systemd[1]: Started /etc/rc.local Compatibility.</pre><p>ç¢ºèªè©²è¢«è¼‰å…¥çš„é©…å‹•æœ‰æ­£å¸¸è¼‰å…¥å¾Œï¼Œæˆ‘å€‘ä¾†æŒ‡å®š ALSA é è¨­å¾—è¼¸å‡ºè¨­å‚™ã€‚</p></div></div><div id="outline-container-orgfe2abdd" class="outline-3"><h3 id="orgfe2abdd">æŒ‡å®š ALSA è¼¸å‡ºè¨­å‚™</h3><div class="outline-text-3" id="text-orgfe2abdd"><p>é‚£æˆ‘å€‘è¦æ€æ¨£è®“ ALSA çŸ¥é“æˆ‘å€‘æŒ‡å®šçš„ USB DAC çš„è¼¸å‡ºä½ç½®å‘¢?</p><p>é¦–å…ˆå…ˆåˆ—å‡ºå¯ä»¥ä½¿ç”¨çš„éŸ³æ•ˆå¡è³‡è¨Š:</p><pre class="example">root@OrangePizero:~# cat /proc/asound/cards0 [audiocodec     ]: audiocodec - audiocodec                     audiocodec1 [sndhdmi        ]: sndhdmi - sndhdmi                     sndhdmi2 [Set            ]: USB-Audio - C-Media USB Headphone Set                     C-Media USB Headphone Set at usb-sunxi-ohci-1, full speed</pre><p>æ‰¾åˆ°ç·¨è™Ÿæ˜¯ <code>2</code> å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥ç·¨è¼¯ <code>/etc/asound.conf</code> æŒ‡å®šé è¨­çš„ alsa è¨­å‚™ï¼š</p><pre class="example">defaults.pcm.card 2defaults.ctl.card 2</pre><p>é€™æ¨£å­æ’­æ”¾çš„æ™‚å€™ï¼ŒALSA å°±æœƒé¸ç”¨ <code>USB-Audio - C-Media USB Headphone Set</code> é€™å€‹è¨­å‚™é€²è¡Œæ’­æ”¾ã€‚</p></div></div></div><div id="outline-container-org6d5da5c" class="outline-2"><h2 id="org6d5da5c">åœ¨ macOS ä¸‹é€é AirPlay æ’­æ”¾</h2><div class="outline-text-2" id="text-org6d5da5c"><p>æ‰€æœ‰è¨­å®šå®Œæˆå¾Œï¼Œåªè¦ä½ çš„ macOS å’Œä½ çš„ AirPlay è¨­å‚™åœ¨åŒä¸€å€‹ç¶²åŸŸï¼Œä½ å°±å¯ä»¥é€™æ¨£æ‰¾åˆ°ä»–:</p><div class="figure"><p><img src="a2.png" width="40%"></p></div><p>æˆ–æ˜¯é€é iTunes é¸æ“‡è¨­å‚™:</p><div class="figure"><p><img src="a3.png" width="40%"></p></div><p>è©¦è©¦çœ‹ï¼Œæ’­æ”¾è²éŸ³çš„æ™‚å€™ï¼Œè²éŸ³æ˜¯ä¸æ˜¯é€éé€£æ¥åœ¨ Orange Pi ä¸Šé¢çš„ USB DAC é€å‡ºä¾†çš„ :)</p></div></div><div id="outline-container-orgcd66977" class="outline-2"><h2 id="orgcd66977">åƒè€ƒè³‡æ–™</h2><div class="outline-text-2" id="text-orgcd66977"><ul class="org-ul"><li><a href="http://linux-sunxi.org/Xunlong_Orange_Pi_Zero" target="_blank" rel="external">Xunlong Orange Pi Zero - linux-sunxi.org</a></li><li><a href="https://wiki.archlinux.org/index.php/NetworkManager#nmcli" target="_blank" rel="external">NetworkManager - ArchWiki</a></li><li><a href="http://coldnew.github.io/blog/2015/11-12_shairport-sync/">ä½¿ç”¨ shairport-sync åœ¨ Raspberry Pi ä¸Šä¸Šå»ºç«‹ AirPlay éŸ³æ¨‚æ’­æ”¾å™¨</a></li><li><a href="http://piboards.com/2017/02/13/orange-pi-as-time-machine-server/" target="_blank" rel="external">Orange Pi as Time Machine Server | Pi Boards</a></li><li><a href="https://www.linuxbabe.com/linux-server/how-to-enable-etcrc-local-with-systemd" target="_blank" rel="external">How to Enable /etc/rc.local with Systemd</a></li></ul></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/d48bba9e/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Clasp: Common Lisp using LLVM and C++ for Molecular Metaprogramming ç­†è¨˜</title>
      <link>https://coldnew.github.io/aacb8a72/</link>
      <guid>https://coldnew.github.io/aacb8a72/</guid>
      <pubDate>Thu, 06 Oct 2016 16:13:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
ç‚ºäº†äº†è§£  &lt;a href=&quot;https://github.com/drmeister/clasp&quot;&gt;Clasp&lt;/a&gt; é€™å€‹å¯ä»¥æŠŠ Common Lisp ç·¨è­¯åˆ° LLVM ä¸Šçš„ç·¨è­¯å™¨æ˜¯å¦‚ä½•å¯¦ä½œçš„ï¼Œæ–¼æ˜¯æ‰¾ä¾†é€™å ´æ¼”è¬›ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>ç‚ºäº†äº†è§£  <a href="https://github.com/drmeister/clasp" target="_blank" rel="external">Clasp</a> é€™å€‹å¯ä»¥æŠŠ Common Lisp ç·¨è­¯åˆ° LLVM ä¸Šçš„ç·¨è­¯å™¨æ˜¯å¦‚ä½•å¯¦ä½œçš„ï¼Œæ–¼æ˜¯æ‰¾ä¾†é€™å ´æ¼”è¬›ã€‚</p><a id="more"></a><iframe width="560" height="315" src="https://www.youtube.com/embed/8X69_42Mj-g" frameborder="0" allowfullscreen></iframe><br><p>è¬›è€…é€™å ´çš„æŠ•å½±ç‰‡æˆ‘æ²’æ‰¾åˆ°ï¼Œåˆ°æ˜¯æœ‰æ‰¾åˆ°åˆ¥å ´æ¬¡çš„: <a href="https://usercontent.irccloud-cdn.com/file/4QyNmxAz/els.pdf" target="_blank" rel="external">æŠ•å½±ç‰‡ä¸‹è¼‰</a></p><br><p>å…ˆç°¡å–®è¬›äº›å¿ƒå¾—ï¼Œé€™å ´æ¼”è¬›æ˜¯ Google é‚€è«‹ <a href="https://github.com/drmeister/clasp" target="_blank" rel="external">Clasp</a> çš„ä½œè€… <a href="https://chem.cst.temple.edu/schafmeister.html" target="_blank" rel="external">Christian Schafmeister</a> å»é€²è¡Œçš„æ¼”è¬›ï¼Œè¬›è€…ç‚ºä¸€åŒ–å­¸æ•™æˆã€‚é€™å ´æ¼”è¬›å‰›é–‹é ­è¬›äº†å¤§ç´„ 20 å¤šåˆ†é˜çš„åŒ–å­¸ï¼Œè€Œè¬›è€…ç‚ºäº†è§£æ±º Molecular (åˆ†å­ç”Ÿç‰©å­¸) çš„å•é¡Œï¼Œæ±ºå®šé€é Common Lisp çš„ metaprogramming çš„èƒ½åŠ›ä¾†ææ˜‡æ•´é«”è¨ˆç®—ç¨‹å¼çš„é–‹ç™¼ä»¥åŠè¨ˆç®—èƒ½åŠ›ï¼Œå› æ­¤å¯¦ä½œäº†ä¸€å€‹å¯ä»¥å°‡ Common Lisp ç·¨è­¯åˆ° LLVM ä¸Šçš„ç·¨è­¯å™¨ã€‚</p><p>ç›®å‰ Clojure æ²’æœ‰å¯¦ä½œç·¨è­¯åˆ° LLVM çš„å…¶ä¸­ä¸€å€‹åŸå› æ˜¯ç¼ºå°‘äº†åˆé©çš„ GC (Garbage Collector)ï¼Œå› æ­¤å¦‚æœæˆ‘å€‘æƒ³è¦è‡ªè¡Œå¯¦ä½œ Clojure -&gt; LLVM ç·¨è­¯å™¨çš„è©±ï¼Œå°±ä¸€å®šéœ€è¦è‡ªè¡Œå¯¦ç¾é«˜æ•ˆèƒ½çš„ GC æ‰è¡Œã€‚</p><p>è®“æˆ‘å€‘å›åˆ°æ¼”è¬›ï¼Œè¬›è€…éœ€è¦å¯¦ä½œçš„æ±è¥¿éœ€è¦ç”¨åˆ°å¾ˆå¤š C++ å‡½å¼åº«ï¼Œä½†æ˜¯å¯« C++ å¾ˆéº»ç…©ï¼Œå› æ­¤ä»–æƒ³ç”¨æ›´é«˜éšçš„èªè¨€: Common Lisp ä¾†å¯¦ç¾è‡ªå·±çš„ç¨‹å¼ï¼Œçµæœä¸å°å¿ƒå¯¦ä½œäº†ä¸€å€‹ Common Lisp ç·¨è­¯å™¨:  <a href="https://github.com/drmeister/clasp" target="_blank" rel="external">Clasp</a></p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/a1.png"></p></div><p>è€Œ <a href="https://github.com/drmeister/clasp" target="_blank" rel="external">Clasp</a> æ˜¯ä»¥ C++ å¯¦ä½œçš„ï¼Œä¸¦æœƒæŠŠ Common Lisp ç¨‹å¼ç¢¼è½‰æˆ LLVM IR</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/a2.png"></p></div><p>æ¥ä¸‹ä¾†è¬›è€…è§£é‡‹äº†ä¸€ä¸‹å®ƒåˆ°åº•è¦ç”¨é€™å¥—å·¥å…·åšä»€éº¼ï¼Œé€™é‚Šå°±å»çœ‹å½±ç‰‡å§ (ç°¡å–®ä¾†èªªæ˜¯è§£æ±ºæ•¸å­¸è¨ˆç®—)ã€‚</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/a3.png"></p></div><p>å¦å¤–ä¸€å€‹è¬›è€…æƒ³åšçš„ï¼Œå°±æ˜¯é€é C++ å¯« Common Lisp æ¨¡çµ„ï¼Œä¸¦ä¸”åœ¨ Common Lisp è£¡é¢è¼‰å…¥å®ƒ</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/a4.png"></p></div><p>æ‰€ä»¥ç‚ºä½•æœƒé¸ç”¨ Common Lisp å‘¢? ç•¶ç„¶æ˜¯å› ç‚º LISP å¾ˆå¥½ç”¨é˜¿ï¼Œåªæ˜¯é‚£äº›ä¸æœƒç”¨çš„äººä¸€ç›´å«Œ LISP æ‹¬è™Ÿå¤ªå¤š~</p><p>(ç„¶å¾Œé€™ç¾¤äººå±…ç„¶å¯ä»¥å¯«çš„ä¸‹ Javascriptï¼Œä¹Ÿå¯è¬‚ä¸–ç•Œå¥‡è§€äº†~)</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/a5.png"></p></div><p>ç•¶ç„¶ï¼Œæ‡‚ LISP çš„äººéƒ½çŸ¥é“ä½¿ç”¨ Common Lisp çš„å…¶ä¸­ä¸€å€‹ç†ç”±ä¸€å®šæ˜¯å› ç‚º LISP çš„ Macro å¤ªå¥½ç”¨äº†!!</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/a6.png"></p></div><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/a7.png"></p></div><p>å› æ­¤è¬›è€…é¸ç”¨äº† Common Lisp ä¾†é€²è¡Œé–‹ç™¼ï¼Œå¯æ˜¯é€™æ¨£å­ C++ çš„å‡½å¼åº«è¦æ€éº¼è¾¦å‘¢ï¼Ÿç¸½ä¸èƒ½é‡å¯«å§?åŸæœ¬çš„ Common Lisp ç¼ºä¹äº†å¾ˆæ–¹ä¾¿å’Œ C++ é€²è¡Œèª¿ç”¨çš„æ¥å£</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/a8.png"></p></div><p>å…¶å¯¦ Common Lisp æ˜¯æœ‰ FFI (foreign FUnction Interface)æ¥å£çš„ï¼Œå¯ä»¥ç›´æ¥è¼‰å…¥ç”¨ C å¯«çš„å‡½å¼åº«ï¼Œä¸é FFI ç”¨æ–¼ C++ å°±æœƒæœ‰å…¶ä»–å•é¡Œï¼Œæ¯”å¦‚æˆ‘å€‘éœ€è¦åœ¨å¯«ä¸€å€‹ wrapper å»åŒ… C++ çš„ classã€‚</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/a9.png"></p></div><p>è€Œå¯¦éš›ä¸Šï¼Œåœ¨ç›®å‰çš„ Common Lisp ä¸Šçš„ç¢ºéœ€è¦é€é C èªè¨€å»åŒ…ä¸€å±¤ï¼Œè®“ Common Lisp å¯ä»¥ä½¿ç”¨ C++ å‡½å¼åº«</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/b.png"></p></div><p>ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œè¬›è€…æƒ³åˆ°äº†æ˜¯ä¸æ˜¯å¯ä»¥é€é C++ template ä¾†è™•ç†é€™ä¸€å¡Š</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/b1.png"></p></div><p>äº‹å¯¦ä¸Šåœ¨è¬›è€…æ—©æœŸæ’°å¯«çš„å‡½å¼åº«ä¸­ï¼ŒBoost.Python é€™å€‹æ¨¡çµ„å°±ç”¨åˆ°äº†é€™æ¨£çš„æ¦‚å¿µï¼Œé€é C++ template åšå€‹ hook è®“ Python ç¨‹å¼å¯ä»¥å‘¼å« C++ å‡½å¼åº«</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/b2.png"></p></div><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/b3.png"></p></div><p>å› æ­¤ï¼Œè¬›è€…å°±åšäº† <a href="https://github.com/drmeister/clasp" target="_blank" rel="external">Clasp</a> é€™å€‹ Common Lisp ç·¨è­¯å™¨å•¦ï¼Œè£¡é¢æœ‰äº›ç¨‹å¼ç¢¼æ˜¯å¾ Embedded Common Lisp é‚£é‚Š A ä¾†çš„å‘¦~</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/b4.png"></p></div><p>ç„¶å¾Œé€™æ™‚å€™è¬›è€…è¬›äº†è®“æˆ‘ Orz çš„ä¸€å¥è©±&#x2026;..</p><br><blockquote><p>I did not use the compiler because I don't understand it, I wrote a new one.</p><p>I wrote a compiler, I never wrote compiler before.</p></blockquote><br><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/b5.png"></p></div><p>æ‰€ä»¥ <a href="https://github.com/drmeister/clasp" target="_blank" rel="external">Clasp</a> åˆ°åº•æœ‰å“ªäº›ç‰¹åˆ¥çš„å‘¢?</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/b6.png"></p></div><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/b7.png"></p></div><p>æ‰€ä»¥çš„ç¢º  <a href="https://github.com/drmeister/clasp" target="_blank" rel="external">Clasp</a> æœ‰å¯¦ä½œ GC (Garbage Collector)ï¼Œä¸¦ä¸”æœ‰å…©ç¨®å¯¦ä½œï¼Œä¹Ÿå°±æ˜¯èªªå¦‚æœæˆ‘æƒ³åš Clojure -&gt; LLVMï¼Œæˆ‘ä¹Ÿéœ€è¦è‡ªè¡Œå¯¦ä½œé€™äº› GC æ‰è¡Œã€‚</p><p>è€Œé€™å€‹ç·¨è­¯å™¨é‚„æœ‰ä¸€å€‹ pointer è¿½è¹¤å™¨ï¼Œå¯ä»¥è¿½è¹¤æŒ‡æ¨™çš„ä½¿ç”¨ä¸¦ä¸”å‘ŠçŸ¥ GCã€‚</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/c.png"></p></div><p>é‚£è¦æ€æ¨£åœ¨ Clasp è£¡é¢ä½¿ç”¨ C++ å‡½å¼åº«å‘¢? å°±é€™æ¨£ ~</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/c1.png"></p></div><p>è¤‡é›œä¸€é»çš„ç¯„ä¾‹å‰‡æ˜¯é€™æ¨£:</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/c2.png"></p></div><p>ç·¨è­¯æˆå‹•æ…‹å‡½å¼å¾Œï¼Œå°±å¯ä»¥åœ¨ Clasp è£¡é¢é€™æ¨£çš„è¼‰å…¥</p><div class="figure"><p><img src="Clasp-Common-Lisp-using-LLVM-and-C++-for-Molecular-Metaprogramming-ç­†è¨˜/c3.png"></p></div><p>ä»‹ç´¹å®Œ Clasp å¾Œï¼Œå°±æ˜¯ QA å›‰ï¼Œæœ‰èˆˆè¶£è‡ªå·±å»çœ‹ QA ~</p><p>å¦‚æœä½ è½å®Œé€™å€‹æ¼”è¬›å¾Œï¼Œå°æ–¼é€™å€‹ Common Lisp å¯¦ä½œæœ‰èˆˆè¶£ï¼Œå¯ä»¥å» GitHub ä¸‹è¼‰çœ‹çœ‹:</p><div class="github-card" data-github="drmeister/clasp" data-width="400" data-height="" data-theme="default"></div><script src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script>]]></content:encoded>
      
      <comments>https://coldnew.github.io/aacb8a72/#disqus_thread</comments>
    </item>
    
    <item>
      <title>ClojuTRE 2016 æ¼”è¬›ç­†è¨˜</title>
      <link>https://coldnew.github.io/fec9a5ee/</link>
      <guid>https://coldnew.github.io/fec9a5ee/</guid>
      <pubDate>Sun, 02 Oct 2016 18:13:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
è¶è‘—å‡æ—¥ä¾†è¶•ä¸€ä¸‹é€²åº¦ï¼Œæ–¼æ˜¯æŠŠæˆ‘çœ‹éçš„ &lt;a href=&quot;http://clojutre.org/2016/&quot;&gt;ClojuTRE 2016&lt;/a&gt; å¿ƒå¾—/ç­†è¨˜ç´€éŒ„åœ¨é€™é‚Šã€‚
&lt;/p&gt;

&lt;p&gt;
å—¯&amp;#x2026;&amp;#x2026;å…¶å¯¦ ClojuTRE 2016 æ¯ä¸€å ´æ¼”è¬›æˆ‘éƒ½çœ‹å®Œäº†&amp;#x2026;..
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>è¶è‘—å‡æ—¥ä¾†è¶•ä¸€ä¸‹é€²åº¦ï¼Œæ–¼æ˜¯æŠŠæˆ‘çœ‹éçš„ <a href="http://clojutre.org/2016/" target="_blank" rel="external">ClojuTRE 2016</a> å¿ƒå¾—/ç­†è¨˜ç´€éŒ„åœ¨é€™é‚Šã€‚</p><p>å—¯&#x2026;&#x2026;å…¶å¯¦ ClojuTRE 2016 æ¯ä¸€å ´æ¼”è¬›æˆ‘éƒ½çœ‹å®Œäº†&#x2026;..</p><a id="more"></a><p>ç•¶ç„¶ï¼Œæˆ‘ä¸¦ä¸æ˜¯æ¯ä¸€å ´éƒ½è½çš„æ‡‚ï¼Œæ–¼æ˜¯é€™ç­†è¨˜åªèƒ½åƒ…ä¾›åƒè€ƒï¼Œè«‹å‹¿ç›¡ä¿¡ orz&#x2026;</p><p>æœ‰äº›æ¼”è¬›çœŸçš„å¾ˆé›£ç•«é‡é»ï¼Œé‚„æ˜¯æŒ‘è‡ªå·±æœ‰èˆˆè¶£çš„çœ‹å§!!</p><div id="outline-container-org40dc66d" class="outline-2"><h2 id="org40dc66d">Using Clojure to provide computerized psychotherapy</h2><div class="outline-text-2" id="text-org40dc66d"><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Ze3Acb42f3o?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT" frameborder="0" allowfullscreen></iframe><br><p>è¬›è€…æŠ•å½±ç‰‡: <a href="http://clojutre.org/2016/slides/Using-Clojure-to-provide-computerized-psychotherapy.pdf" target="_blank" rel="external">ä¸‹è¼‰é€£çµ</a></p><p>é€™å ´æ¼”è¬›åœ¨è¬› Clojure ç”¨æ–¼å¿ƒç†æ²»ç™‚ (psychotherapy) ä¸Šï¼Œä¸€é–‹å§‹è¬›è€…æå‡ºäº†å•é¡Œ:</p><div class="figure"><p><img src="a1.png"></p></div><p>å°æ–¼é€™äº›å•é¡Œï¼Œæˆ‘å€‘å¯ä»¥æœ‰ä¸€äº›è§£æ³•:</p><div class="figure"><p><img src="a2.png"></p></div><p>è€Œæ›´å¤šçš„å•é¡Œï¼Œå‰‡æ˜¯æ²’æœ‰è¶³å¤ çš„äººæ‰‹åœ¨å¿ƒè£¡æ²»ç™‚ä¸Šï¼Œå› æ­¤è¬›è€…æåˆ°äº†å¯ä»¥é€éé›»è…¦ä¾†å”åŠ©ï¼Œé»å­ä¾†è‡ªæ–¼ treatment manuals</p><div class="figure"><p><img src="a3.png"></p></div><p>è€Œ ç¶²è·¯èªçŸ¥è¡Œç‚ºæ²»ç™‚ (iCBT, internet-based Cognitive behavior therapy) å‰‡å¤§éƒ¨åˆ†æä¾›äº†å¦‚ä¸Šé¢çš„é‚£æ¨£çš„è‡ªæˆ‘æ²»ç™‚(sel-help)è³‡è¨Šï¼Œé€™ç¨®æ–¹å¼æ¸›å°‘äº†ä¸€äº›å•é¡Œï¼Œæ¯”å¦‚æ²»ç™‚å¸«(therapist)å’Œç—…æ‚£ä¹‹é–“çš„è·é›¢</p><p>ç„¶å¾Œå¾Œé¢è¬›è€…ç¹¼çºŒè¬›äº†ä¸€äº›å•é¡Œï¼Œè§£æ³•ä¸€æ˜¯ç”¨ Clojure å¯«äº†äº›ç¶²é ç¨‹å¼&#x2026;.(å—¯ï¼Œçœ‹å½±ç‰‡å§) ï¼Œè€Œé€™ç¶²é ç¨‹å¼é€é <a href="http://www.luminusweb.net" target="_blank" rel="external">Luminus framework</a> è£½ä½œï¼Œå€¼å¾—ä¸€æçš„æ˜¯è¬›è€…ç¬¬ä¸€å€‹å­¸çš„ç¨‹å¼èªè¨€å°±æ˜¯ Clojureã€‚</p><div class="figure"><p><img src="a4.png"></p></div></div></div><div id="outline-container-orgeff3537" class="outline-2"><h2 id="orgeff3537">The Universe As A Value</h2><div class="outline-text-2" id="text-orgeff3537"><br><iframe width="560" height="315" src="https://www.youtube.com/embed/odPAkEO2uPQ?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT" frameborder="0" allowfullscreen></iframe><br><p>æŠ•å½±ç‰‡: <a href="https://juxt.pro/talks/clojutre-2016.html#/sec-title-slide" target="_blank" rel="external">ä¸‹è¼‰é€£çµ</a></p><p>é€™å ´æ¼”è¬›ç¬¬ä¸€æ¬¡è½çš„æ™‚å€™æˆ‘å‚»çœ¼äº†ï¼Œæ–¼æ˜¯å°±å†è½äº†ç¬¬äºŒæ¬¡ã€‚</p><p>è¬›è€…ä¸€é–‹å§‹å…ˆç¨å¾®è¬›äº†äº›é—œæ–¼å®‡å®™ (Universe) çš„äº‹æƒ…ï¼Œç„¶å¾Œå°å‘æ„›å› æ–¯å¦çš„ç›¸å°è«–ï¼Œæˆ‘å€‘å¯ä»¥å‡è¨­æœ‰ä¸€å€‹è§€å¯Ÿè€…å¦‚ä¸‹</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">observer</span> <span style="color: #81d4fa;">(</span>atom <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:universe</span> u <span style="color: #ccaaff;">:time</span> t<span style="color: #aaccff;">}</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>è€Œæ„›å› æ–¯å¦èªªéï¼Œæ™‚é–“å’Œè§€å¯Ÿè€…æ˜¯ç›¸å°çš„ (time is relative to observer)ï¼Œå…©å€‹ä¸åŒçš„è§€å¯Ÿè€…æœƒçœ‹åˆ°ä¸åŒçš„å®‡å®™ (Universe)ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œæœ‰è¨±å¤šä¸åŒçš„å®‡å®™(Universe)å­˜åœ¨ã€‚</p><div class="figure"><p><img src="p1.png"></p></div><p>æˆ‘å€‘å¯ä»¥å®šç¾© <code>ğ•Œ</code> é€™å€‹ç¬¦è™Ÿç‚ºæ‰€æœ‰å¯èƒ½å¯ä»¥è§€å¯Ÿåˆ°çš„å®‡å®™ç©ºé–“(ğ•Œ is the set of all possible observable universes)ï¼Œå› æ­¤ï¼Œæˆ‘å€‘å°±å¯ä»¥å®šç¾© Clojure ç¨‹å¼ç”¨ä¾†é¸æ“‡ä¸‹ä¸€å€‹ Universeã€‚</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">next-u</span>  <span style="color: #97abc6; font-style: italic;">"Given an observed universe u, return a possible 'next' universe."</span>  <span style="color: #81d4fa;">[</span>u t<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span>rand-nth <span style="color: #aaccff;">(</span>filter #<span style="color: #aaeecc;">(</span>consistent? <span style="color: #aaccff;">%</span> u t<span style="color: #aaeecc;">)</span> &#120140;<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>è€Œä¸‹ä¸€å€‹ç¨‹å¼ç¢¼ï¼Œå‰‡æ˜¯è®“ä¸€å€‹è§€å¯Ÿè€… (observer) åˆ‡æ›åˆ°å¦å¤–ä¸€çµ„ Universe å»</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">switch-universe!</span>  <span style="color: #97abc6; font-style: italic;">"Put the given observer in another universe"</span>  <span style="color: #81d4fa;">[</span>observer<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span>swap!   <span style="color: #aaccff;">(</span><span style="color: #aaffaa;">fn</span> <span style="color: #aaeecc;">[</span><span style="color: #ccaaff;">{</span><span style="color: #ccaaff;">:keys</span> <span style="color: #fff59d;">[</span>universe time<span style="color: #fff59d;">]</span><span style="color: #ccaaff;">}</span><span style="color: #aaeecc;">]</span>     <span style="color: #aaeecc;">{</span><span style="color: #ccaaff;">:universe</span> <span style="color: #ccaaff;">(</span>next-u universe time<span style="color: #ccaaff;">)</span>      <span style="color: #ccaaff;">:time</span> <span style="color: #ccaaff;">(</span>inc time<span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">}</span><span style="color: #aaccff;">)</span>   observer<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>è€Œæˆ‘å€‘å¯ä»¥é€™æ¨£åŸ·è¡Œæˆ‘å€‘çš„è§€å¯Ÿè€…:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">run-observer</span>  <span style="color: #97abc6; font-style: italic;">"Run the observer, giving them the impression of passing time"</span>  <span style="color: #81d4fa;">[</span>observer<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">dorun</span> <span style="color: #aaccff;">(</span>iterate switch-universe! observer<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>æ¥ä¸‹ä¾†æ¥åˆ°äº† <a href="http://toutestquantique.fr/en/pump-probe/" target="_blank" rel="external">Pump-probe technique</a> ï¼Œå—¯&#x2026;æˆ‘ä¸çŸ¥é“ä»–åœ¨è¬›å•¥ (æ‘€è‡‰)&#x2026;.æ‰€ä»¥åªå¥½ç§€ä¸€ä¸‹ä»–æ¥ä¸‹ä¾†çš„æŠ•å½±ç‰‡:</p><div class="figure"><p><img src="p2.png"></p></div><p>æ¥ä¸‹ä¾†è©±é‹’ä¸€è½‰ï¼Œçªç„¶è®Šæˆèªª&#x2026;åœ¨ ClojureScript ä¸­ï¼Œç„¡è«–æ˜¯ Om æˆ–æ˜¯ Reagent, æˆ‘å€‘éƒ½æœ‰ä¸€å€‹åœ°æ–¹å®šç¾© app state (universe)</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">The app 'universe'</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">app-state</span>  <span style="color: #81d4fa;">(</span>atom   <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:drawer</span> <span style="color: #aaeecc;">{</span><span style="color: #ccaaff;">:items</span> <span style="color: #ccaaff;">[</span><span style="color: #fff59d;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"ear-plugs"</span><span style="color: #fff59d;">}</span><span style="color: #ccaaff;">]</span><span style="color: #aaeecc;">}</span>    shopping    <span style="color: #aaeecc;">{</span><span style="color: #ccaaff;">:items</span>     <span style="color: #ccaaff;">[</span><span style="color: #fff59d;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"Coffee"</span> <span style="color: #ccaaff;">:quantity</span> 2<span style="color: #fff59d;">}</span>      <span style="color: #fff59d;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"Milk"</span> <span style="color: #ccaaff;">:quantity</span> 2<span style="color: #fff59d;">}</span>      <span style="color: #fff59d;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"Bird seed"</span> <span style="color: #ccaaff;">:quantity</span> <span style="color: #ccaaff;">:lots</span><span style="color: #fff59d;">}</span><span style="color: #ccaaff;">]</span><span style="color: #aaeecc;">}</span><span style="color: #aaccff;">}</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>æ¥è‘—æˆ‘å€‘å°±å¯ä»¥ç”¨ <a href="https://clojuredocs.org/clojure.core/deref" target="_blank" rel="external">deref</a> å»æŸ¥çœ‹æˆ‘å€‘çš„ Universe (app state)</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>deref app-state<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">or</span>@app-state</pre></div><p>è€Œåœ¨é€™ç¨®ç‹€æ³ä¸‹ï¼Œæˆ‘å€‘æ»¿è¶³äº†ä»¥ä¸‹å…©ç¨®è¦ç¯„:</p><ul class="org-ul"><li><p>Consistency</p><p>In the render phase, the value we render is constant</p></li><li><p>Concurrency</p><p>We can take our time, nobody is waiting for us!</p></li></ul><p>é€™ç¨® app-state çš„å½¢å¼å’Œç‰©ä»¶å°å‘ (Object Orientation) æ˜¯ä¸åŒçš„ï¼Œæˆ‘å€‘çŸ¥é“ç‰©ä»¶å°å‘æ˜¯é€™æ¨£çš„:</p><blockquote><p>Object Orientation: Lots of changing state, scatered around.</p></blockquote><br><p>è¬›è€…èˆ‰ <a href="https://juxt.pro/" target="_blank" rel="external">https://juxt.pro/</a> ç‚ºä¾‹ï¼Œé€™å€‹ç¶²ç«™æœ‰å¾ˆå¤š state è¦å»è™•ç†ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥åšä¸€å€‹ record å»å¼„é€™äº› state</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defrecord</span> <span style="color: #fff59d;">AppState</span> <span style="color: #81d4fa;">[</span>data-sources<span style="color: #81d4fa;">]</span>  <span style="color: #fff59d;">clojure.lang.IDeref</span>  <span style="color: #81d4fa;">(</span>deref <span style="color: #aaccff;">[</span>this<span style="color: #aaccff;">]</span>    <span style="color: #aaccff;">(</span><span style="color: #fff59d;">skup</span><span style="color: #c6cccc; background-color: #202020;">/</span>refresh! this<span style="color: #aaccff;">)</span>    <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">Return the 'universe as a value'</span>    <span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">Skippy McSkipface: https://github.com/juxt/skip</span></pre></div><p>æ¥ä¸‹ä¾†æˆ‘å€‘å°±å¯ä»¥å°é€™äº› state é€²è¡Œ derefernece çš„å‹•ä½œ</p><div class="figure"><p><img src="p3.png"></p></div><p>é‚£è¦æ€æ¨£ææ˜‡ referesh çš„æ•ˆèƒ½å‘¢?æˆ‘å€‘å¯ä»¥é€éé€™äº›æ”¯æ´ time-travel çš„å·¥å…·ä¾†é€²è¡Œ:</p><div class="figure"><p><img src="p4.png"></p></div><p>è€Œåœ¨é–‹ç™¼ç’°å¢ƒï¼Œå‰‡å¯ä»¥é€é background watchers ä¾†å°è³‡æ–™é€²è¡Œæ›´æ–°çš„å‹•ä½œ</p><div class="figure"><p><img src="p5.png"></p></div><p>è€Œé€™æ¨£åšï¼Œè¬›è€…æå‡ºäº†ä¸€å€‹çµæœ:</p><div class="figure"><p><img src="p6.png"></p></div><p>å—¯&#x2026;æˆ‘å¿…é ˆæ‰¿èªæˆ‘è½äº†å…©æ¬¡é‚„æ˜¯è½ä¸å¤ªæ‡‚ = =</p><p>æœ€å¾Œè¬›è€…å°æ¯”äº†ä¸€ä¸‹ C å’Œ Lisp:</p><blockquote><p>It seems to me that there have been two really clean, consistent models of programming so far:the C model and the Lisp model.</p><p>&#x2013; Paul Graham</p></blockquote><br><blockquote><p>"You're not constructing it like making a tone of source code and compiling it periodically, you're constructing it the way you construct a city: build some of it, it's running all the time, so it's kind of like a live programming language."</p><p>&#x2013; Dick Gabriel On Lisp, Software Engineering Radio Episode 84</p></blockquote></div></div><div id="outline-container-org1473321" class="outline-2"><h2 id="org1473321">Native mobile apps with ClojureScript</h2><div class="outline-text-2" id="text-org1473321"><br><iframe width="" height="315" src="https://www.youtube.com/embed/6IYm34nDL64?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT" frameborder="0" allowfullscreen></iframe><br><p>çµ‚æ–¼æœ‰çœ‹åˆ°ä¸€å ´åœ¨è¬› react-native ä½œç”¨æ–¼ ClojureScript ä¸Šçš„æ¼”è¬›ï¼ï¼ é€™ä¹‹å‰æˆ‘æœ‰ç¨å¾®ç©éï¼Œä½†æ²’èªçœŸå¯«é€™æ¨£çš„ç¨‹å¼ã€‚</p><p>é—œæ–¼ ClojureScript ä½œç”¨åœ¨ react-native ä¸Šçš„è³‡æ–™ï¼Œå¯ä»¥åˆ° <a href="http://cljsrn.org/" target="_blank" rel="external">http://cljsrn.org/</a> å»æ‰¾ï¼Œæˆ–æ˜¯ <a href="http://clojurians.net/" target="_blank" rel="external">Clojurians</a> çš„ Slack <code>#cljsrn</code> é »é“ã€‚</p><p>é€™å ´æ¼”è¬›å…ˆå¾ react-native é–‹å§‹ä»‹ç´¹ï¼Œèªªæ˜å®ƒå’Œ Cordova/HTML5 çš„ä¸åŒ:</p><div class="figure"><p><img src="cljsrn1.png"></p></div><p>æ¥ä¸‹ä¾†å‰‡æ˜¯ä»¥é–‹ç™¼è€…çš„è§€é»ä¾†çœ‹ react-nativeï¼Œä¸€å€‹åŸºæœ¬çš„ react-native ç¨‹å¼é•·é€™æ¨£:</p><div class="org-src-container"><pre class="src src-js-jsx"><span style="color: #aaffaa;">import</span> React, <span style="color: #aadddd;">{</span> Component <span style="color: #aadddd;">}</span> from <span style="color: #aadddd;">'react'</span>;<span style="color: #aaffaa;">import</span> <span style="color: #aadddd;">{</span> Text, View <span style="color: #aadddd;">}</span> from <span style="color: #aadddd;">'react-native'</span>;<span style="color: #aaffaa;">class</span> WhyReactNativeIsSoGreat <span style="color: #aaffaa;">extends</span> Component <span style="color: #aadddd;">{</span>    render<span style="color: #81d4fa;">()</span> <span style="color: #81d4fa;">{</span>        <span style="color: #aaffaa;">return</span> <span style="color: #aaccff;">(</span>            &lt;View&gt;              &lt;Text&gt;                If you like React on the web, yoou<span style="color: #aadddd;">'ll like React Native.</span><span style="color: #aadddd;">              &lt;/Text&gt;</span><span style="color: #aadddd;">              &lt;Text&gt;</span><span style="color: #aadddd;">                You just use native components like '</span>View<span style="color: #aadddd;">' and '</span>Text<span style="color: #aadddd;">',</span><span style="color: #aadddd;">                instead of web components like '</span>div<span style="color: #aadddd;">' and '</span>span<span style="color: #aadddd;">'.</span><span style="color: #aadddd;">              &lt;/Text&gt;</span><span style="color: #aadddd;">            &lt;/View&gt;</span><span style="color: #aadddd;">        );</span><span style="color: #aadddd;">    }</span><span style="color: #aadddd;">}</span></pre></div><p>è€Œ ClojureScript çš„ç›¸å°æ‡‰æ”¹å¯«å‰‡æ˜¯:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">ns</span> <span style="color: #fff59d;">rn-example.core</span>  <span style="color: #81d4fa;">(</span><span style="color: #ccaaff;">:require</span> <span style="color: #aaccff;">[</span><span style="color: #fff59d;">reagent.core</span> <span style="color: #ccaaff;">:as</span> r<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">react-native</span>  <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">js</span><span style="color: #c6cccc; background-color: #202020;">/</span>require   <span style="color: #aadddd;">"react-native/Libraries/react-native/react-native.js"</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">view</span> <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">r</span><span style="color: #c6cccc; background-color: #202020;">/</span>adapt-react-class <span style="color: #aaccff;">(</span>.-View react-native<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">text</span> <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">r</span><span style="color: #c6cccc; background-color: #202020;">/</span>adapt-react-class <span style="color: #aaccff;">(</span>.-Text react-native<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">why-react-native-is-so-great</span> <span style="color: #81d4fa;">[]</span>  <span style="color: #81d4fa;">[</span>view   <span style="color: #aaccff;">[</span>text <span style="color: #aadddd;">"If you like React on the web, you'll like React Nateive"</span><span style="color: #aaccff;">]</span>   <span style="color: #aaccff;">[</span>text <span style="color: #aadddd;">"You just use native components like 'View' and 'Text'</span><span style="color: #aadddd;">instead of web components like 'div' and 'span'."</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span></pre></div><p>ç”±ä¸Šé¢ç¯„ä¾‹å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†ä¸€é–‹å§‹è¼‰å…¥ä¸€äº› javascript å‡½å¼åº«éœ€è¦æ¯”è¼ƒéª¯é«’çš„æ‰‹æ®µå¤–ï¼Œå‰©ä¸‹çš„å°±å¾ˆç´”ç²¹æ˜¯ Clojure çš„è³‡æ–™çµæ§‹çš„è™•ç†ã€‚</p><p>è€Œåœ¨ ClojureScript ä¸Šé¢ï¼Œç›®å‰æœ‰å…©å€‹ build tools é‡å° ClojureScript åœ¨ react-native ä¸Šçš„:</p><div class="row "><div class="col-md-6 "><div class="github-card" data-github="mjmeintjes/boot-react-native" data-width="400" data-height="" data-theme="default"></div></div><div class="col-md-6"><div class="github-card" data-github="drapanjanas/re-natal" data-width="400" data-height="" data-theme="default"></div></div> </div><p>è¬›è€…æ˜¯é€™æ¨£è©•è«–é€™å…©å¥—å·¥å…·çš„:</p><ul class="org-ul"><li><p>boot-react-native</p><p>Uses boot, works closer to the RN packager but is slower and inferior out of the box experience (persornal experience)</p></li><li><p>re-natal</p><p>Uses leinigen, runtime errors are not traceable, templates for re-frame, om.next and rum</p></li></ul><p>è€Œæœ€å¸¸ç”¨çš„å‰ç«¯æ¡†æ¶å‰‡æ˜¯åŸºæ–¼ reagent çš„ <a href="https://github.com/Day8/re-frame" target="_blank" rel="external">re-frame</a> ã€‚</p><p>æ¸¬è©¦æ–¹é¢ï¼Œå‰‡æ˜¯éœ€è¦é€é <code>react-native-mock</code> å»å° ract-native çµ„ä»¶é€²è¡Œæ¸¬è©¦ï¼Œåœ–ç‰‡å’Œå‡½å¼åº«å‰‡æ˜¯é€é <code>mockery</code> ä¾†é€²è¡Œæ¸¬è©¦ã€‚</p><p>è‡³æ–¼æ•ˆèƒ½çš„æ¯”è¼ƒï¼Œå°±ç›´æ¥çœ‹æŠ•å½±ç‰‡å§ï¼š</p><div class="figure"><p><img src="cljsrn2.png"></p></div></div></div><div id="outline-container-orge0d8389" class="outline-2"><h2 id="orge0d8389">Isomorphic web apps with Rum</h2><div class="outline-text-2" id="text-orge0d8389"><br><iframe width="560" height="315" src="https://www.youtube.com/embed/2fLx4fu9VV8?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT" frameborder="0" allowfullscreen></iframe><br><p>æœ¬å ´æ¬¡ç‚º <a href="https://github.com/tonsky/rum" target="_blank" rel="external">rum</a> é€™å€‹ ClojureScript å°æ–¼ React.js çš„å°è£çš„ä½œè€…çš„æ¼”è¬›ï¼Œè¬›è€… <a href="https://github.com/tonsky" target="_blank" rel="external">tonsky</a> åŒæ™‚ä¹Ÿæ˜¯è¨±å¤šçŸ¥å Clojure/Script å‡½å¼åº«å°ˆæ¡ˆçš„ç¶­è­·è€…ã€‚</p><div class="github-card" data-github="tonsky/rum" data-width="400" data-height="" data-theme="default"></div><p><a href="https://github.com/tonsky" target="_blank" rel="external">tonsky</a> ä¸€é–‹å§‹ä»‹ç´¹å¹¾ç¨®ä¸åŒåœ¨ ClojureScript ä¸Šå°æ–¼ React.js çš„å°è£å‡½å¼åº«ï¼Œç„¶å¾Œä»‹ç´¹è‡ªå·±è¨­è¨ˆ  <a href="https://github.com/tonsky/rum" target="_blank" rel="external">rum</a>  çš„å¹¾å€‹å‹•æ©Ÿï¼Œå…¶ä¸­ä¸€å€‹æ˜¯æ›´å¥½çš„èˆ‡ <a href="https://github.com/tonsky/datascript" target="_blank" rel="external">datascript</a> æˆ–æ˜¯å…¶ä»–è³‡æ–™å„²å­˜å‡½å¼åº«ç›¸å®¹ã€‚</p><p>æ‰€ä»¥åŸºæœ¬çš„ rum ç¨‹å¼é•·æ€æ¨£å‘¢?</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #fff59d;">rum</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #aaffaa;">defc</span> <span style="color: #aaccff;">label</span> <span style="color: #81d4fa;">[</span>text class<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">[</span><span style="color: #ccaaff;">:div.lbl</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:class</span> class<span style="color: #aaccff;">}</span> text<span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">rum</span><span style="color: #c6cccc; background-color: #202020;">/</span>mount <span style="color: #81d4fa;">(</span>label <span style="color: #aadddd;">"Hello"</span> <span style="color: #aadddd;">"header"</span><span style="color: #81d4fa;">)</span>           <span style="color: #fff59d;">js</span><span style="color: #c6cccc; background-color: #202020;">/</span>document.body<span style="color: #aadddd;">)</span></pre></div><p>åŒ…å« state çš„è¤‡é›œé»çš„ç¯„ä¾‹å‰‡æ˜¯:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">mixin</span>  <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:will-mount</span>   <span style="color: #aaccff;">(</span><span style="color: #aaffaa;">fn</span> <span style="color: #aaeecc;">[</span>state<span style="color: #aaeecc;">]</span>     <span style="color: #aaeecc;">(</span>assoc state <span style="color: #ccaaff;">:key</span> <span style="color: #ccaaff;">(</span>atom <span style="color: #ccaaff;">nil</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">rum</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #aaffaa;">defc</span> <span style="color: #aaccff;">label</span> &lt; mixin <span style="color: #81d4fa;">[</span>text class<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaccff;">[</span><span style="color: #ccaaff;">:div.label</span> <span style="color: #aaeecc;">{</span><span style="color: #ccaaff;">:class</span> class<span style="color: #aaeecc;">}</span> text<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>è€Œ rum ä¹Ÿæ”¯æ´ serveri-side æ¸²æŸ“ (<a href="https://anmonteiro.com/2016/09/om-next-server-side-rendering/" target="_blank" rel="external">Om.Next ä¹Ÿæ”¯æ´å›‰~</a>)ï¼Œé‹ä½œçš„æµç¨‹æ˜¯é€™æ¨£:</p><div class="figure"><p><img src="rum1.png"></p></div><p>é‚£ç”¨ rum æœ‰ä»€éº¼å¥½è™•å‘¢ï¼Ÿè¬›è€…æå‡ºäº†ä»¥ä¸‹å¹¾é»:</p><ul class="org-ul"><li>Complex single-page apps with fine control</li><li>Custom/mixed state models</li><li>Server-side rendering and templating</li></ul><p>è€Œç”¨ rum çš„å£è™•å‰‡æ˜¯:</p><ul class="org-ul"><li>Doesn't teach you how to write apps</li></ul></div></div><div id="outline-container-orgdde0a1f" class="outline-2"><h2 id="orgdde0a1f">The Story of Sir Owl Lisp</h2><div class="outline-text-2" id="text-orgdde0a1f"><br><iframe width="560" height="315" src="https://www.youtube.com/embed/utOVF0U7Zd8?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT" frameborder="0" allowfullscreen></iframe><br><p><a href="https://en.wikipedia.org/wiki/Owl_Lisp" target="_blank" rel="external">Owl Lisp</a> æ˜¯ä¸€å€‹ç´”å‡½æ•¸å¼çš„ Scheme å¯¦ç¾ï¼Œè¬›è€…ç‚º <a href="https://github.com/aoh/owl-lisp" target="_blank" rel="external">owl-lisp</a> ä½œè€…ï¼Œæ­¤ä¸€å°ˆæ¡ˆä½œç‚ºå¯µç‰©å°ˆæ¡ˆ (pet project, é–’æš‡æ™‚åšçš„å¥½ç©å°ˆæ¡ˆæˆ–æ˜¯æ®ºæ™‚é–“ç”¨) å¾ 2011 å¹´é–‹å§‹è‡ªä»Šã€‚</p><p>é€™å ´æ¼”è¬›å‰é¢åŸºæœ¬ä¸Šåœ¨è¬›å¤ï¼ŒåŒ…å«äº†ä¸€äº›åœ–éˆæ©Ÿã€lambda æ¼”ç®—æ³•ä»¥åŠ LISP èªè¨€çš„æ•…äº‹ï¼Œå¾Œé¢é–‹å§‹ä»‹ç´¹  <a href="https://github.com/aoh/owl-lisp" target="_blank" rel="external">owl-lisp</a> ï¼Œé€™æ˜¯ä¸€å€‹ä¾ç…§ R7RS æ¨™æº–çš„ Scheme èªè¨€ã€‚</p><div class="github-card" data-github="aoh/owl-lisp" data-width="400" data-height="" data-theme="default"></div></div></div><div id="outline-container-org5136d83" class="outline-2"><h2 id="org5136d83">Doing data science with Clojure: the good, the bad, the ugly</h2><div class="outline-text-2" id="text-org5136d83"><br><iframe width="560" height="315" src="https://www.youtube.com/embed/xtmggfGD3RQ?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT" frameborder="0" allowfullscreen></iframe><br><p>æŠ•å½±ç‰‡é€£çµ: <a href="https://www.slideshare.net/mobile/simonbelak/doing-data-science-with-clojure-65886938" target="_blank" rel="external">ç·šä¸Šçœ‹</a></p><blockquote><p>Easy things should be easy and hard things should be possible.</p><p>&#x2013; L. Wall</p></blockquote><br><p>è€å¯¦èªªæˆ‘è½ä¸å¤ªæ‡‚è¬›è€…åœ¨è¬›ä»€éº¼&#x2026;.. Orz&#x2026;</p><p>ä¸éè¬›è€…æåˆ°ä¸€å€‹ä»–å¯«çš„å‡½å¼åº«:</p><div class="github-card" data-github="sbelak/huri" data-width="400" data-height="" data-theme="default"></div><p>ç„¶å¾Œ&#x2026;æˆ‘é‚„æ˜¯è½ä¸æ‡‚ï¼Œæ‰€ä»¥åªå¥½æŠŠä»– quote çš„åè¨€ç§€ä¸€ä¸‹äº† orz&#x2026;</p><blockquote><p>This is possibly Clojure's most important property: the syntax expresses the code's semantic layers. An experienced reader of Clojure can skip over most of the code and have a lossless understanding of its highlevel intent.</p><p>&#x2013; Z.Tellman, Elements of Clojure</p></blockquote><br><p>æ¥ä¸‹ä¾†è¬›è€…ç¨å¾®æåˆ°äº† <a href="http://clojure.org/about/spec" target="_blank" rel="external">clojure.spec</a> é€™å€‹é è¨ˆè¦åœ¨ Clojure 1.9 åŠ å…¥çš„å‡½å¼åº«ï¼Œå¯ä»¥æ¸›å°‘æŸ¥æ‰¾å•é¡Œçš„æ™‚é–“ï¼Œä»¥åŠ <a href="http://gorilla-repl.org" target="_blank" rel="external">gorilla-repl</a> é€™ç¨®é¡ä¼¼ ipython notebook çš„å·¥å…·ã€‚</p><p>åœ¨å¾Œé¢ï¼Œè¬›è€…çµ‚æ–¼è¬›åˆ°å‰é¢ä»–èªªçš„å‡½å¼åº« <a href="https://github.com/sbelak/huri" target="_blank" rel="external">huri</a>ï¼Œ ä½ å¯ä»¥é€éä»–åœ¨  <a href="http://gorilla-repl.org" target="_blank" rel="external">gorilla-repl</a> ä¸Šç•«åœ–ã€‚</p></div></div><div id="outline-container-orga7511ce" class="outline-2"><h2 id="orga7511ce">Interactive Clojure code snippets in any web page with KLIPSE</h2><div class="outline-text-2" id="text-orga7511ce"><br><iframe width="560" height="315" src="https://www.youtube.com/embed/33mTFjPIN10?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT" frameborder="0" allowfullscreen></iframe><br><p>æŠ•å½±ç‰‡é€£çµ: <a href="http://slides.klipse.tech/klipse-clojutre-2016/" target="_blank" rel="external">ç·šä¸Šçœ‹</a></p><p><a href="http://app.klipse.tech" target="_blank" rel="external">klipse</a> æ˜¯ä¸€å€‹å®Œå…¨é‹ä½œåœ¨ç€è¦½å™¨ä¸Šçš„ cljs REPLï¼Œå¯ä»¥å‹•æ…‹çš„é©—è­‰ ClojureScript çš„é‹ä½œï¼Œè©²ä½œè€…åŒæ™‚ä¹Ÿå¯«äº†ä¸å°‘é—œæ–¼ ClojureScript é‹ä½œçš„æ–‡ç« ã€‚</p><p>æœ¬æ¬¡æ¼”è¬›é™¤äº†èªªåˆ° ClojoureScript çš„éƒ¨ä»½ï¼Œä¹Ÿæåˆ° klipse å¯ä»¥åŸ·è¡Œ ruby, python ç¨‹å¼ç¢¼ï¼Œæˆ‘çŒœä»–å¤§æ¦‚æœ‰å¯¦ç¾ä¸€å€‹ç°¡å–®çš„è§£é‡‹å™¨æ‰å°ï¼Œé‚„æ²’å»çœ‹é€™éƒ¨ä»½çš„ç¨‹å¼ç¢¼ã€‚</p><div class="github-card" data-github="viebel/klipse" data-width="400" data-height="" data-theme="default"></div></div></div><div id="outline-container-org34650f3" class="outline-2"><h2 id="org34650f3">Distributed transducers</h2><div class="outline-text-2" id="text-org34650f3"><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_9jdb5TOShk?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT" frameborder="0" allowfullscreen></iframe><br><p>æŠ•å½±ç‰‡é€£çµ: <a href="https://github.com/mhjort/distributed-transducers-poc/releases/download/v1.0/Distributed.Transducers.pdf" target="_blank" rel="external">é»æˆ‘ä¸‹è¼‰</a></p><p>æœ¬ç¯‡è¬›è¿°è¬›è€…å¯¦ä½œåˆ†ä½ˆå¼ç‰ˆçš„ fold å‡½å¼ï¼Œä¸¦é€é AWS lambda ä¾†åŠ é€Ÿé‹ä½œã€‚</p><p>è¬›è€…æä¾›äº†ä¸€å€‹æŸ¥æ‰¾é¡ä¼¼è©çš„å‡½å¼ä¾†æè¿°æ•´å€‹è¦è§£æ±ºå•é¡Œçš„ç‹€æ³:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">similar-words-1</span> <span style="color: #81d4fa;">[</span>word words min-distance<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">-&gt;&gt;</span> words       <span style="color: #aaccff;">(</span>map <span style="color: #aaeecc;">(</span>partial levensthein-distance word<span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>       <span style="color: #aaccff;">(</span>filter <span style="color: #aaeecc;">(</span><span style="color: #aaffaa;">fn</span> <span style="color: #ccaaff;">[</span><span style="color: #fff59d;">[</span>d _<span style="color: #fff59d;">]</span><span style="color: #ccaaff;">]</span> <span style="color: #ccaaff;">(</span>&lt;= d min-distance<span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>       <span style="color: #aaccff;">(</span>reduce group-by-distance <span style="color: #aaeecc;">{}</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span>similar-words-1 <span style="color: #aadddd;">"word"</span> <span style="color: #81d4fa;">[</span><span style="color: #aadddd;">"sword"</span> <span style="color: #aadddd;">"lord"</span> <span style="color: #aadddd;">"card"</span> <span style="color: #aadddd;">"cat"</span><span style="color: #81d4fa;">]</span> 2<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; {1 #{"sword" "lord"}, 2 #{"card"}}</span></pre></div><p>ç•¶ç„¶æˆ‘å€‘å¯ä»¥æŠŠé€™æ¨£çš„ç¨‹å¼æ”¹ç”¨ transducer æ”¹å¯«ï¼Œä¾†ææ˜‡ç¨‹å¼çš„æ•ˆèƒ½</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">similar-words-2</span> <span style="color: #81d4fa;">[</span>word words min-distance<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span>transduce <span style="color: #aaccff;">(</span>comp <span style="color: #aaeecc;">(</span>map <span style="color: #ccaaff;">(</span>partial levensthein-distance word<span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span>                <span style="color: #aaeecc;">(</span>filter <span style="color: #ccaaff;">(</span><span style="color: #aaffaa;">fn</span> <span style="color: #fff59d;">[</span><span style="color: #ff8888;">[</span>d _<span style="color: #ff8888;">]</span><span style="color: #fff59d;">]</span> <span style="color: #fff59d;">(</span>&lt;= d min-distance<span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>             group-by-distance             words<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>ä½†æ˜¯é€™æ¨£çš„ç¨‹å¼ç„¡æ³•ä¸¦è¡Œé‹ç®—ï¼Œå› æ­¤æˆ‘å€‘å†ç”¨ fold ä¾†æ”¹å¯«</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">similar-words-3</span> <span style="color: #81d4fa;">[</span>word words min-distance<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">r</span><span style="color: #c6cccc; background-color: #202020;">/</span>fold <span style="color: #aaccff;">(</span>partial merge-with concat<span style="color: #aaccff;">)</span>          group-by-distance          <span style="color: #aaccff;">(</span><span style="color: #fff59d;">r</span><span style="color: #c6cccc; background-color: #202020;">/</span>folder words                    <span style="color: #aaeecc;">(</span>comp <span style="color: #ccaaff;">(</span>map <span style="color: #fff59d;">(</span>partial levensthein-distance word<span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span>                       <span style="color: #ccaaff;">(</span>filter <span style="color: #fff59d;">(</span><span style="color: #aaffaa;">fn</span> <span style="color: #ff8888;">[</span><span style="color: #795548;">[</span>d _<span style="color: #795548;">]</span><span style="color: #ff8888;">]</span> <span style="color: #ff8888;">(</span>&lt;= d min-distance<span style="color: #ff8888;">)</span><span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>ä¸éæœ‰ä¸€å€‹å•é¡Œï¼Œfold æœƒåŒæ™‚åŸ·è¡Œå…©å€‹å‡½å¼ï¼Œä¸€å€‹ç”¨ä¾†åŸ·è¡Œ reduceï¼Œç¨±ç‚º <code>reducing function</code> ï¼Œå¦å¤–ä¸€å€‹å‰‡æ˜¯ç”¨ä¾†åˆä½µçµæœï¼Œç¨±ç‚º <code>combining function</code> ï¼Œè€Œ <code>reducing function</code> æœƒä¸¦è¡Œçš„åŸ·è¡Œã€‚(<a href="https://adambard.com/blog/clojure-reducers-for-mortals/" target="_blank" rel="external">åƒè€ƒè³‡æ–™</a>)</p><blockquote><p>fold uses two functions: a "reducing" function, which it calls as a regular reduce across segments of the input collection, and a "combining" function, which combines the results of these reductions.</p></blockquote><p>å› æ­¤æˆ‘å€‘å¯ä»¥å†æŠŠé€™å€‹ç¨‹å¼æ”¹å¯«</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">similar-words-4</span> <span style="color: #81d4fa;">[</span>word words min-distance<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">r</span><span style="color: #c6cccc; background-color: #202020;">/</span>fold <span style="color: #aaccff;">(</span>partial merge-with concat<span style="color: #aaccff;">)</span>          <span style="color: #aaccff;">(</span><span style="color: #aaeecc;">(</span>comp <span style="color: #ccaaff;">(</span>map <span style="color: #fff59d;">(</span>partial levensthein-distance word<span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span>              <span style="color: #ccaaff;">(</span>filter <span style="color: #fff59d;">(</span><span style="color: #aaffaa;">fn</span> <span style="color: #ff8888;">[</span><span style="color: #795548;">[</span>d _<span style="color: #795548;">]</span><span style="color: #ff8888;">]</span> <span style="color: #ff8888;">(</span>&lt;= d min-distance<span style="color: #ff8888;">)</span><span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span> group-by-distance<span style="color: #aaccff;">)</span>          words<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>é€™æ¨£æ”¹å¯«å¾Œï¼Œæ•ˆæœå¥½å¤šäº†ï¼Œä½†æ˜¯é‚„æœ‰æœ€å¾Œä¸€å€‹å•é¡Œ: ä¸¦è¡ŒåŒ–çš„ fold åªèƒ½é‹ä½œåœ¨ non-lazy sequence ä¸Šï¼Œæ–¼æ˜¯å†åŠ ä¸€äº›æ‰‹è…³ã€‚</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">similar-words-5</span> <span style="color: #81d4fa;">[</span>word words min-distance<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">r</span><span style="color: #c6cccc; background-color: #202020;">/</span>fold <span style="color: #aaccff;">(</span>partial merge-with concat<span style="color: #aaccff;">)</span>          <span style="color: #aaccff;">(</span><span style="color: #aaeecc;">(</span>comp <span style="color: #ccaaff;">(</span>map <span style="color: #fff59d;">(</span>partial levensthein-distance word<span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span>              <span style="color: #ccaaff;">(</span>filter <span style="color: #fff59d;">(</span><span style="color: #aaffaa;">fn</span> <span style="color: #ff8888;">[</span><span style="color: #795548;">[</span>d _<span style="color: #795548;">]</span><span style="color: #ff8888;">]</span> <span style="color: #ff8888;">(</span>&lt;= d min-distance<span style="color: #ff8888;">)</span><span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span> group-by-distance<span style="color: #aaccff;">)</span>          <span style="color: #aaccff;">(</span>vec words<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>è·‘å‡ºä¾†çš„çµæœå¦‚ä¸‹ï¼Œåœ¨è¬›è€…çš„ HP zBook ç­†é›» (i7 é›™æ ¸)ä¸ŠåŸ·è¡Œçš„çµæœæ˜¯é€™æ¨£çš„</p><ul class="org-ul"><li>ä¸€èˆ¬ç‰ˆæœ¬:  ~175 s</li><li>Transducer: ~170 s</li><li>Parallel fold: ~108 s</li></ul><p>åšå®Œé€™äº›æ¸¬è©¦å¾Œï¼Œè¬›è€…æƒ³åˆ°äº†ï¼Œæ˜¯å¦åˆ†ä½ˆå¼çš„ fold å¯ä»¥æä¾›æ›´å¥½çš„æ•ˆèƒ½?</p><p>è¬›è€…é¸ç”¨äº† AWS Lambda ä»¥åŠ Amazon SQS ä¾†é€²è¡Œé€™å€‹æ¸¬è©¦ï¼Œæ•´é«”çš„æ¶æ§‹æ˜¯é€™å€‹æ¨£å­çš„:</p><div class="figure"><p><img src="ar1.png"></p></div><p>æ¥ä¸‹ä¾†ä½ è¦åœ¨ä½ çš„ project.clj åŠ å…¥ä»¥ä¸‹é€™äº›è¨­å®š</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #ccaaff;">:plugins</span> <span style="color: #aadddd;">[</span><span style="color: #81d4fa;">[</span>lein-clj-lambda <span style="color: #aadddd;">"0.5.1"</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">]</span><span style="color: #ccaaff;">:lambda</span> <span style="color: #aadddd;">{</span><span style="color: #aadddd;">"demo"</span> <span style="color: #81d4fa;">[</span><span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:handler</span> <span style="color: #aadddd;">"distributed-transducers-poc.LambdaFn"</span>                  <span style="color: #ccaaff;">:memory-size</span> 1536                  <span style="color: #ccaaff;">:timeout</span> 300                  <span style="color: #ccaaff;">:function-name</span> <span style="color: #aadddd;">"distributed-transducers-poc"</span>                  <span style="color: #ccaaff;">:region</span> <span style="color: #aadddd;">"eu-west-1"</span>                  <span style="color: #ccaaff;">:policy-statements</span> <span style="color: #aaeecc;">[</span><span style="color: #ccaaff;">{</span><span style="color: #ccaaff;">:Effect</span> <span style="color: #aadddd;">"Allow"</span>                                       <span style="color: #ccaaff;">:Action</span> <span style="color: #fff59d;">[</span><span style="color: #aadddd;">"sqs:*"</span><span style="color: #fff59d;">]</span>                                       <span style="color: #ccaaff;">:Resource</span> <span style="color: #fff59d;">[</span><span style="color: #aadddd;">"arn:aws:sqs:eu-west-1:*"</span><span style="color: #fff59d;">]</span><span style="color: #ccaaff;">}</span><span style="color: #aaeecc;">]</span>                  <span style="color: #ccaaff;">:s3</span> <span style="color: #aaeecc;">{</span><span style="color: #ccaaff;">:bucket</span> <span style="color: #aadddd;">"mhjort-distributed-transducers-poc"</span>                       <span style="color: #ccaaff;">:object-key</span> <span style="color: #aadddd;">"lambda.jar"</span><span style="color: #aaeecc;">}</span><span style="color: #aaccff;">}</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">}</span></pre></div><p>ç„¶å¾Œä½¿ç”¨ä¸‹é¢å‘½ä»¤é€²è¡Œ deploy</p><pre class="example">lein lambda install demo</pre><p>è¬›è€…çµ¦å‡ºäº†ç¯„ä¾‹ï¼Œç¤ºç¯„ç”¨ fold ä»¥åŠ dfold åŸ·è¡Œç¨‹å¼çš„ç‹€æ³</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">ns</span> <span style="color: #fff59d;">distributed-transducers-poc.demo</span>  <span style="color: #81d4fa;">(</span><span style="color: #ccaaff;">:require</span> <span style="color: #aaccff;">[</span><span style="color: #fff59d;">distributed-transducers-ppc.rc</span> <span style="color: #ccaaff;">:refer</span> <span style="color: #aaeecc;">[</span>dfold<span style="color: #aaeecc;">]</span><span style="color: #aaccff;">]</span>            <span style="color: #aaccff;">[</span><span style="color: #fff59d;">clojure.core.reducers</span> <span style="color: #ccaaff;">:as</span> r<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">r</span><span style="color: #c6cccc; background-color: #202020;">/</span>fold + <span style="color: #81d4fa;">(</span><span style="color: #aaccff;">(</span>map inc<span style="color: #aaccff;">)</span> +<span style="color: #81d4fa;">)</span> <span style="color: #81d4fa;">(</span>range 100000<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span>dfold + <span style="color: #81d4fa;">(</span><span style="color: #aaccff;">(</span>map inc<span style="color: #aaccff;">)</span> +<span style="color: #81d4fa;">)</span> <span style="color: #81d4fa;">(</span>range 100000<span style="color: #81d4fa;">)</span> 2<span style="color: #aadddd;">)</span> <span style="color: #9ac; font-style: italic;">; &lt;= 2 is how many instance you run</span></pre></div><p>é‚£&#x2026; å“ªäº›è³‡æ–™æœƒè¢«é€åˆ° SQS å‘¢?</p><ul class="org-ul"><li>è¦è¢«åŸ·è¡Œçš„æ±è¥¿ (Chunk of items to be processed)</li><li>Reduct function</li></ul><p>è€Œåœ¨æœ€å¾Œï¼Œä½¿ç”¨åˆ†ä½ˆå¼ fold çš„ç¨‹å¼æœƒè®Šæˆé€™æ¨£</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">similar-words-6</span> <span style="color: #81d4fa;">[</span>word words min-distance<span style="color: #81d4fa;">]</span>    <span style="color: #81d4fa;">(</span>dfold <span style="color: #aaccff;">(</span>partial merge-with concat<span style="color: #aaccff;">)</span>           <span style="color: #aaccff;">(</span><span style="color: #aaeecc;">(</span>comp <span style="color: #ccaaff;">(</span>map <span style="color: #fff59d;">(</span>partial levensthein-distance word<span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span>               <span style="color: #ccaaff;">(</span>filter <span style="color: #fff59d;">(</span><span style="color: #aaffaa;">fn</span> <span style="color: #ff8888;">[</span><span style="color: #795548;">[</span>d _<span style="color: #795548;">]</span><span style="color: #ff8888;">]</span> <span style="color: #ff8888;">(</span>&lt;= d min-distance<span style="color: #ff8888;">)</span><span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span> group-by-distance<span style="color: #aaccff;">)</span>           <span style="color: #aaccff;">(</span>vec words<span style="color: #aaccff;">)</span>           10<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>è€Œæœ€å¾Œæ•´é«”æ¸¬è©¦çµæœå‰‡æ˜¯:</p><ul class="org-ul"><li>ç­†é›» (ä¸€èˆ¬): ~175 s</li><li>ç­†é›» (transducer): ~170 s</li><li>ç­†é›» (parallel fold): ~108 s</li><li>AWS Lambda (10 nodes, cost 0.01 $): ~40 s</li><li>AWS Lambda (20 nodes, cost 0.02 $): ~28 s</li></ul></div></div><div id="outline-container-orgf767c8f" class="outline-2"><h2 id="orgf767c8f">Introduction to clojure.spec - Arne Brasseur</h2><div class="outline-text-2" id="text-orgf767c8f"><br><iframe width="560" height="315" src="https://www.youtube.com/embed/-MeOPF94LhI?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT" frameborder="0" allowfullscreen></iframe><br><blockquote><p>è¬›è€…ç‚º <a href="https://lambdaisland.com" target="_blank" rel="external">LambdaIsland</a> çš„ç¶­è­·è€…ï¼Œè©²ç¶²ç«™æä¾›äº†ä¸€ç³»åˆ—çš„ Clojure/ClojureScript æ•™å­¸ï¼Œè‹¥æœ‰èˆˆè¶£çš„è©±å¯ä»¥ä»˜è²»è¨‚é–±ã€‚</p></blockquote><br><p><a href="http://clojure.org/about/spec" target="_blank" rel="external">clojure.spec</a> æ˜¯ Clojure é è¨ˆåœ¨ 1.9 ç‰ˆåŠ å…¥çš„æ–°åŠŸèƒ½ï¼Œå°æ–¼ Clojure é€™ç¨®å‹•æ…‹å‹åˆ¥èªè¨€è€Œè¨€ï¼Œé›–ç„¶å®¹æ˜“é–‹ç™¼ï¼Œä½†æ˜¯ä¸€æ—¦ä½ å‚³é€çµ¦å‡½å¼çš„å‹åˆ¥ä¸å°ï¼Œå°±å¾ˆå¯èƒ½é€ æˆé™¤éŒ¯ä¸æ˜“ã€‚</p><p>åœ¨ <a href="http://clojure.org/about/spec" target="_blank" rel="external">clojure.spec</a> å‡ºç¾ä¹‹å‰ï¼Œæ¯”è¼ƒæœ‰åçš„å‹åˆ¥æª¢æŸ¥æ˜¯ <a href="https://github.com/clojure/core.typed" target="_blank" rel="external">core.typed</a> ä»¥åŠ <a href="https://github.com/plumatic/schema" target="_blank" rel="external">schema</a> ï¼Œè€Œ <a href="http://clojure.org/about/spec" target="_blank" rel="external">clojure.spec</a> å°‡æœƒæˆç‚º buildin åœ¨ Clojure çš„ä¸€éƒ¨åˆ†å‡½å¼ã€‚</p><p><a href="http://clojure.org/about/spec" target="_blank" rel="external">clojure.spec</a> çš„åŠ å…¥ä¸¦ä¸æœƒå°è‡´ç¨‹å¼åŸ·è¡Œè®Šæ…¢ï¼Œç”¨åˆ°ä»–çš„æ™‚é–“åªæœ‰åœ¨é–‹ç™¼æ™‚ä½¿ç”¨ REPL ä»¥åŠç·¨è­¯çš„æ™‚å€™ï¼Œæ‰€ä»¥åˆ°åº•è¦æ€æ¨£ç”¨å‘¢ï¼Ÿ</p><p>å¦‚æœä½ æ˜¯ leinigen çš„ç”¨æˆ¶ï¼Œæ›´æ”¹ä½ çš„ <code>project.clj</code> æˆå¦‚ä¸‹</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defperoject</span> <span style="color: #aaccff;">myproject</span> <span style="color: #aadddd;">"0.1.0-SNAPAHOT"</span>  <span style="color: #ccaaff;">:dependencies</span> <span style="color: #81d4fa;">[</span><span style="color: #aaccff;">[</span><span style="color: #fff59d;">org.clojure</span><span style="color: #c6cccc; background-color: #202020;">/</span>clojure <span style="color: #aadddd;">"1.9.0-alpha13"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span></pre></div><p>boot çš„ç”¨æˆ¶å‰‡æ˜¯åœ¨ä½ çš„ <code>build.boot</code> åŠ å…¥</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>set-env! <span style="color: #ccaaff;">:dependencies</span> '<span style="color: #81d4fa;">[</span><span style="color: #aaccff;">[</span><span style="color: #fff59d;">org.clojure</span><span style="color: #c6cccc; background-color: #202020;">/</span>clojure <span style="color: #aadddd;">"1.9.0-alpha13"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span></pre></div><p>æ–¼æ˜¯è®“æˆ‘å€‘é–‹å§‹ä½¿ç”¨ <a href="http://clojure.org/about/spec" target="_blank" rel="external">clojure.spec</a> å§! è¬›è€…å‡è¨­ç¾åœ¨æœ‰ä¸€å€‹æ©Ÿå™¨äººä¸»å»š (Robot Chef) æ­£åœ¨å¼„ä¸€ä»½èœå–® (recipes)ï¼Œè€Œé€™ä»½èœå–®å…§å®¹æ˜¯é€™æ¨£çš„:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">tomato-sauce-recipe</span>  <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">ingredients</span> <span style="color: #aaccff;">[</span>250 <span style="color: #ccaaff;">:g</span> <span style="color: #aadddd;">"peeled tomatoes"</span>                          3 <span style="color: #ccaaff;">:clove</span> <span style="color: #aadddd;">"garlic"</span>                          5 <span style="color: #ccaaff;">:g</span> <span style="color: #aadddd;">"pepper"</span><span style="color: #aaccff;">]</span>   <span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">steps</span> <span style="color: #aaccff;">[</span><span style="color: #aadddd;">"heat a pan"</span>                    <span style="color: #aadddd;">"throw everything in"</span>                    <span style="color: #aadddd;">"stir"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span></pre></div><p>åƒé€™ç¨®é€é / (slash) çµ„æˆçš„ keyword (é—œéµå­—)ï¼Œæˆ‘å€‘ç¨±å‘¼ç‚º namespace keyword</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #ccaaff;">:</span><span style="color: #fff59d;">grettings</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">kittos</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; </span><span style="color: #9ac; font-style: italic;">:grettings/kittos</span></pre></div><p>ç‚ºä½•è¦ç”¨ namespace keyword å‘¢ï¼Ÿä¸€å€‹åŸå› æ˜¯å¯ä»¥é¿å…åˆ°åç¨±è¡çªï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥æŠŠæ‰€æœ‰çš„ keyword åˆä½µåœ¨åŒä¸€å€‹ map ä¸­</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">{</span><span style="color: #ccaaff;">:</span><span style="color: #fff59d;">http</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">method</span> <span style="color: #ccaaff;">:get</span> <span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">method</span> <span style="color: #ccaaff;">:stir</span><span style="color: #aadddd;">}</span></pre></div><p>å¯¦éš›ä¸Šåœ¨ Clojure ä¸­ï¼Œè®Šæ•¸ä¹Ÿæ˜¯åŒ…å«åœ¨ namespace ä¸­çš„</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">ns</span> <span style="color: #fff59d;">robochef.core</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">ingredents</span> <span style="color: #81d4fa;">{</span>,,,<span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef.core</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">ingredients</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; </span><span style="color: #9ac; font-style: italic;">:robochef.core/ingredients</span><span style="color: #ccaaff;">::ingredients</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; </span><span style="color: #9ac; font-style: italic;">:robochef.core/ingredients</span></pre></div><p>ä¹Ÿå› æ­¤ï¼Œåœ¨ä¸€å€‹ map ä¸­ä½¿ç”¨ namespace ä½œç‚º prefix æ˜¯å¾ˆå¸¸è¦‹çš„</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">{</span><span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">recipe-name</span> <span style="color: #aadddd;">"..."</span> <span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">ingredients</span> <span style="color: #81d4fa;">[</span>,,,<span style="color: #81d4fa;">]</span> <span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">steps</span> <span style="color: #81d4fa;">[</span>,,,<span style="color: #81d4fa;">]</span> <span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">cooking-time</span> 30<span style="color: #aadddd;">}</span></pre></div><p>è€Œåœ¨ Clojure 1.9 ä¸­ï¼Œå°‡æœƒæœ‰æ–°çš„èªæ³•å¯ä»¥æŠŠä¸Šé¢çš„æ±è¥¿è®Šæˆé€™æ¨£</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">recipe</span> #<span style="color: #ccaaff;">:robochef</span><span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:recipes-name</span> <span style="color: #aadddd;">""</span>                       <span style="color: #ccaaff;">:ingredients</span> <span style="color: #aaccff;">[</span>,,,<span style="color: #aaccff;">]</span>                       <span style="color: #ccaaff;">:steps</span> <span style="color: #aaccff;">[</span>,,,<span style="color: #aaccff;">]</span>                       <span style="color: #ccaaff;">:cooking-time</span> 30<span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">let</span> <span style="color: #81d4fa;">[</span><span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">keys</span> <span style="color: #aaeecc;">[</span>steps serves<span style="color: #aaeecc;">]</span><span style="color: #aaccff;">}</span> recipe<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">doseq</span> <span style="color: #aaccff;">[</span>s steps<span style="color: #aaccff;">]</span>    ,,,<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>åœ¨äº†è§£é€™äº›å‰ç½®è¨Šæ¯å¾Œï¼Œæˆ‘å€‘çµ‚æ–¼å¯ä»¥ä¾†åˆ° <a href="http://clojure.org/about/spec" target="_blank" rel="external">clojure.spec</a> äº†ï¼Œé¦–å…ˆæˆ‘å€‘æŠŠ <a href="http://clojure.org/about/spec" target="_blank" rel="external">clojure.spec</a> çš„å‘½åç©ºé–“(namespace) æŒ‡å®šç‚º <code>s</code> ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘åŠ å…¥ä»¥ä¸‹é€™äº› specï¼Œé€™æœƒå°‡é€™äº› spec åŠ å…¥åˆ°å…¨åŸŸå» (global registry)</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">ns</span> <span style="color: #fff59d;">robochef.core</span>  <span style="color: #81d4fa;">(</span><span style="color: #ccaaff;">:require</span> <span style="color: #aaccff;">[</span><span style="color: #fff59d;">clojure.spec</span> <span style="color: #ccaaff;">:as</span> s<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">keep in mind </span><span style="color: #9ac; font-style: italic;">::recipe</span><span style="color: #9ac; font-style: italic;"> == </span><span style="color: #9ac; font-style: italic;">:robochef.core/recipe</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">::recipe</span> <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>keys <span style="color: #ccaaff;">:req</span> <span style="color: #aaccff;">[</span><span style="color: #ccaaff;">::ingredients</span><span style="color: #aaccff;">]</span>                        <span style="color: #ccaaff;">:opt</span> <span style="color: #aaccff;">[</span><span style="color: #ccaaff;">::steps</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">::ingredients</span> <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>* <span style="color: #aaccff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>cat <span style="color: #ccaaff;">:amount</span> number?                                 <span style="color: #ccaaff;">:unit</span> keyword?                                 <span style="color: #ccaaff;">:name</span> string?<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">::steps</span> ,,,<span style="color: #aadddd;">)</span></pre></div><p>å¥½äº†å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥é€™æ¨£å»é©—è­‰ï¼Œç¬¦åˆ spec çš„ç‹€æ³æ˜¯é€™æ¨£çš„</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>valid? <span style="color: #ccaaff;">::robochef/ingredients</span> <span style="color: #81d4fa;">[</span>5 <span style="color: #ccaaff;">:g</span> <span style="color: #aadddd;">"tea"</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; true</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>conform <span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">ingredients</span> <span style="color: #81d4fa;">[</span>5 <span style="color: #ccaaff;">:g</span> <span style="color: #aadddd;">"tea"</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">[{</span><span style="color: #9ac; font-style: italic;">:amount</span><span style="color: #9ac; font-style: italic;"> 5, </span><span style="color: #9ac; font-style: italic;">:unit</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:g</span><span style="color: #9ac; font-style: italic;">, </span><span style="color: #9ac; font-style: italic;">:name</span><span style="color: #9ac; font-style: italic;"> "tea"}]</span></pre></div><p>é‚£éŒ¯èª¤çš„æƒ…æ³å‘¢? æˆ‘å€‘å¯ä»¥é€é <code>clojure.spec/explain</code> ä¾†å¹«æˆ‘å€‘æ‰¾å‡ºç‹€æ³</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>valid? <span style="color: #ccaaff;">::robochef/ingredients</span> <span style="color: #81d4fa;">[</span><span style="color: #aadddd;">"10"</span> <span style="color: #ccaaff;">:g</span> <span style="color: #aadddd;">"tea"</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; false</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>conform <span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">ingredients</span> <span style="color: #81d4fa;">[</span><span style="color: #aadddd;">"10"</span> <span style="color: #ccaaff;">:g</span> <span style="color: #aadddd;">"tea"</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; </span><span style="color: #9ac; font-style: italic;">:clojure.spec/invalid</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>explain <span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">ingredients</span> <span style="color: #81d4fa;">[</span><span style="color: #aadddd;">"10"</span> <span style="color: #ccaaff;">:g</span> <span style="color: #aadddd;">"tea"</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">In: [0] val: "10" fails spec:</span><span style="color: #5f5f5f; font-style: italic;">;;   </span><span style="color: #9ac; font-style: italic;">:robochef/ingredients</span><span style="color: #9ac; font-style: italic;"> at: [</span><span style="color: #9ac; font-style: italic;">:amount</span><span style="color: #9ac; font-style: italic;">] predicate: number?</span></pre></div><p>æˆ‘å€‘ä¹Ÿå¯ä»¥ç”¨ generator å»ç”¢ç”Ÿç¬¦åˆæ•¸é‡ä¸¦å¯ä»¥é€šéæ¸¬è©¦çš„çµæœ</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>exercise <span style="color: #ccaaff;">:</span><span style="color: #fff59d;">robochef</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">ingredients</span> 2<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">([() []]</span><span style="color: #5f5f5f; font-style: italic;">;;  </span><span style="color: #9ac; font-style: italic;">[(0 </span><span style="color: #9ac; font-style: italic;">:Hi</span><span style="color: #9ac; font-style: italic;"> "0") [{</span><span style="color: #9ac; font-style: italic;">:amount</span><span style="color: #9ac; font-style: italic;"> 0, </span><span style="color: #9ac; font-style: italic;">:unit</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:Hi</span><span style="color: #9ac; font-style: italic;">, </span><span style="color: #9ac; font-style: italic;">:name</span><span style="color: #9ac; font-style: italic;"> "0"}]])</span></pre></div><p>æ›´å¤šçš„å…§å®¹æˆ‘é‚„åœ¨æ¶ˆåŒ–ä¸­ï¼Œå°±è«‹çœ‹å½±ç‰‡å§ ~</p><p>å¾Œé¢æ¼”è¬›å‰‡ç¨å¾®æåˆ°ä¸€ä¸‹ <a href="https://github.com/clojure/test.check" target="_blank" rel="external">test.check</a> é€™å€‹æ¸¬è©¦ç”¨çš„å‡½å¼åº«ã€‚</p><div class="github-card" data-github="clojure/test.check" data-width="400" data-height="" data-theme="default"></div></div></div><div id="outline-container-org91f25d5" class="outline-2"><h2 id="org91f25d5">Clojure of Things</h2><div class="outline-text-2" id="text-org91f25d5"><br><iframe width="560" height="315" src="https://www.youtube.com/embed/FUV_5Hwi5FU?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT" frameborder="0" allowfullscreen></iframe><br><p>è¬›è€…æåŠè‡ªå·±çš„ç¶“é©—ï¼Œå¦‚ä½•ç”¨ Clojure åœ¨ç›®å‰ç«ç´…çš„ IoT (Internet of things) ä¸Šï¼Œä¸¦ä½¿ç”¨äº† <a href="http://pibrella.com" target="_blank" rel="external">pibrella</a> é€™å€‹ Raspberry Pi çš„æ“´å……æ¿é€²è¡Œå±•ç¤ºï¼Œé€é Clojure REPL å‹•æ…‹çš„æ§åˆ¶ pibrella çš„ I/Oã€‚</p><p>ä½œè€…ä½¿ç”¨çš„å‡½å¼åº«ç›®å‰æˆ‘æ²’åœ¨ç¶²è·¯ä¸Šæ‰¾åˆ°ï¼Œä½†æ˜¯æˆ‘çŒœä»–æ˜¯ç”¨ <a href="https://github.com/Pi4J/pi4j" target="_blank" rel="external">pi4j</a> ä¾†ä½œç‚º Clojure æ§åˆ¶ Raspberry pi çš„å‡½å¼åº«ã€‚</p><div class="github-card" data-github="Pi4J/pi4j" data-width="400" data-height="" data-theme="default"></div><script src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script></div></div><div id="outline-container-orgab917e9" class="outline-2"><h2 id="orgab917e9">The Next Five Years of ClojureScript</h2><div class="outline-text-2" id="text-orgab917e9"><br><iframe width="560" height="315" src="https://www.youtube.com/embed/mty0RwkPmE8?list=PLetHPRQvX4a_jQjvn54Q-d1WYZ52nDfnT" frameborder="0" allowfullscreen></iframe><br><p>é€™å ´æ˜¯ç›®å‰ ClojureScript ä¸»è¦ç¶­è­·è€… David Nolen ç’°é¡§äº†éå»å¹¾å¹´ ClojureScript é–‹å§‹é–‹ç™¼çš„ç‹€æ³ï¼Œä»¥åŠæœªä¾†çš„æƒ…æ³ã€‚</p><p>åœ¨é€™å ´æ¼”è¬›å¾ŒåŠæ®µä¹ŸæåŠåˆ°å¦‚ä½•åƒèˆ‡ ClojureScript æ¨å»£/é–‹ç™¼ç­‰è­°é¡Œï¼Œä¹Ÿæœ‰äººæå• David Nolen å°æ–¼ WebAssembly çš„çœ‹æ³•ç­‰ç­‰ã€‚</p><p>é€™å ´æ¼”è¬›æˆ‘è¦ºçš„è »ä¸éŒ¯çš„ï¼Œå¾ˆå–œæ­¡é€™ç¨®æœ‰è¬›æ•…äº‹é¢¨æ ¼çš„æ¼”è¬›ã€‚</p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/fec9a5ee/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Unknown perls from the Clojure standard library ç­†è¨˜</title>
      <link>https://coldnew.github.io/eea89759/</link>
      <guid>https://coldnew.github.io/eea89759/</guid>
      <pubDate>Tue, 27 Sep 2016 10:58:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
çœ‹å®Œ &lt;a href=&quot;http://clojutre.org/2015/&quot;&gt;ClojuTRE 2015&lt;/a&gt; çš„ &lt;a href=&quot;https://www.youtube.com/watch?v=QI9Fc5TT87A&quot;&gt;Unknown pearls from the Clojure standard library - Renzo Borgatti&lt;/a&gt; æ¼”è¬›å¾Œï¼Œä¾†ç´€éŒ„å€‹ç­†è¨˜ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>çœ‹å®Œ <a href="http://clojutre.org/2015/" target="_blank" rel="external">ClojuTRE 2015</a> çš„ <a href="https://www.youtube.com/watch?v=QI9Fc5TT87A" target="_blank" rel="external">Unknown pearls from the Clojure standard library - Renzo Borgatti</a> æ¼”è¬›å¾Œï¼Œä¾†ç´€éŒ„å€‹ç­†è¨˜ã€‚</p><a id="more"></a><iframe width="560" height="315" src="https://www.youtube.com/embed/QI9Fc5TT87A" frameborder="0" allowfullscreen></iframe><p>é€™å ´æ¼”è¬›ä»‹ç´¹äº†ä¸€äº›åœ¨ clojure.core è£¡é¢çš„å‡½å¼ï¼Œé€™äº›å‡½å¼å¹³å¸¸å¯èƒ½ä¸å¤ªæœ‰æ©Ÿæœƒç”¨åˆ°ï¼Œä½†æ˜¯å¯ä»¥å”åŠ©æˆ‘å€‘é™¤éŒ¯ç¨‹å¼çš„å•é¡Œã€‚</p><p>æŠ•å½±ç‰‡: <a href="https://github.com/reborg/clojuTRE-2015/raw/master/slides/renzo-borgatti-stdlib.pdf" target="_blank" rel="external">ä¸‹è¼‰é€£çµ</a></p><div id="outline-container-org74d6cd8" class="outline-2"><h2 id="org74d6cd8">destructure</h2><div class="outline-text-2" id="text-org74d6cd8"><p><a href="http://clojure.org/guides/destructuring" target="_blank" rel="external">destructure</a> (è§£æ§‹) åœ¨ Clojure è£¡é¢æ˜¯å€‹éå¸¸å¯¦ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘å€‘å°è³‡æ–™ç›´æ¥æŒ‡æ´¾è®Šæ•¸å»ä»£æ›¿å®ƒï¼Œå¦‚ä¸‹:</p><div class="row "><div class="col-md-6 "><p><b>No destructuring</b></p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">let</span> <span style="color: #81d4fa;">[</span>data <span style="color: #aaccff;">[</span>1 2 3<span style="color: #aaccff;">]</span>      a <span style="color: #aaccff;">(</span>nth data 0<span style="color: #aaccff;">)</span>      b <span style="color: #aaccff;">(</span>nth data 1<span style="color: #aaccff;">)</span>      c <span style="color: #aaccff;">(</span>nth data 2<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span>println <span style="color: #aadddd;">"a:"</span> a <span style="color: #aadddd;">"b:"</span> b <span style="color: #aadddd;">"c:"</span> c<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; a: 1 b: 2 c: 3</span></pre></div></div><div class="col-md-6"><p><b>With destructuring</b></p><div class="org-src-container"><pre class="src src-clojure"> <span style="color: #aadddd;">(</span><span style="color: #aaffaa;">let</span> <span style="color: #81d4fa;">[</span><span style="color: #aaccff;">[</span>a b c<span style="color: #aaccff;">]</span> <span style="color: #aaccff;">[</span>1 2 3<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">]</span>   <span style="color: #81d4fa;">(</span>println <span style="color: #aadddd;">"a:"</span> a <span style="color: #aadddd;">"b:"</span> b <span style="color: #aadddd;">"c:"</span> c<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span> <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; a: 1 b: 2 c: 3</span> &#65279; &#65279; &#65279;</pre></div></div> </div><p>æˆ‘å€‘å¯ä»¥é€é <a href="https://clojuredocs.org/clojure.core/destructure" target="_blank" rel="external">destructure</a> å»è§€å¯Ÿä¸€å€‹æ±è¥¿æ˜¯å¦‚ä½•è¢«è§£æ§‹çš„ï¼Œé€™é‚Šæ˜¯æŠ•å½±ç‰‡çµ¦çš„ç¯„ä¾‹:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>destructure '<span style="color: #81d4fa;">[</span><span style="color: #aaccff;">[</span>x y &amp; others<span style="color: #aaccff;">]</span> v<span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; [v2 v</span><span style="color: #5f5f5f; font-style: italic;">;;     </span><span style="color: #9ac; font-style: italic;">x (nth v2 0 nil)</span><span style="color: #5f5f5f; font-style: italic;">;;     </span><span style="color: #9ac; font-style: italic;">y (nth v2 1 nil)</span><span style="color: #5f5f5f; font-style: italic;">;;     </span><span style="color: #9ac; font-style: italic;">others (nthnext v2 2)]</span></pre></div><p>ç•¶ç„¶æŠ•å½±ç‰‡çµ¦çš„æ˜¯æ•´ç†å¾Œçš„çµæœï¼Œå¯¦éš›ä¸Šæˆ‘åŸ·è¡Œå¾—åˆ°çš„çµæœæ˜¯é€™æ¨£çš„</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">[</span>vec__23596 v seq__23597 <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">clojure.core</span><span style="color: #c6cccc; background-color: #202020;">/</span>seq vec__23596<span style="color: #81d4fa;">)</span> first__23598 <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">clojure.core</span><span style="color: #c6cccc; background-color: #202020;">/</span>first seq__23597<span style="color: #81d4fa;">)</span> seq__23597 <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">clojure.core</span><span style="color: #c6cccc; background-color: #202020;">/</span>next seq__23597<span style="color: #81d4fa;">)</span> x first__23598 first__23598 <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">clojure.core</span><span style="color: #c6cccc; background-color: #202020;">/</span>first seq__23597<span style="color: #81d4fa;">)</span> seq__23597 <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">clojure.core</span><span style="color: #c6cccc; background-color: #202020;">/</span>next seq__23597<span style="color: #81d4fa;">)</span> y first__23598 others seq__23597<span style="color: #aadddd;">]</span></pre></div></div></div><div id="outline-container-org1134f68" class="outline-2"><h2 id="org1134f68">reductions</h2><div class="outline-text-2" id="text-org1134f68"><p>æˆ‘å€‘åœ¨ Clojure ä¸­å¾ˆå¸¸ç”¨ <a href="http://clojuredocs.org/clojure.core/reduce" target="_blank" rel="external">reduce</a> å»å°‡ä¸€å€‹å‡½æ•¸ä½œç”¨åˆ° list ä¸Šçš„æ¯å…©å€‹å…ƒç´ ä¸Šï¼Œç„¶å¾Œè¿”å›æœ€å¾Œçš„çµæœï¼Œæœ€å¸¸è¦‹çš„ç°¡å–®å‡½æ•¸å°±æ˜¯ä¸€å€‹ list çš„å…ƒç´ å…¨éƒ¨ç›¸åŠ </p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>reduce + <span style="color: #81d4fa;">(</span>range 10<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; 45</span></pre></div><p>è€Œ <a href="http://clojuredocs.org/clojure.core/reduce" target="_blank" rel="external">reduce</a> çš„é‹ä½œéç¨‹ï¼Œå‰‡å¯ä»¥é€é <a href="https://clojuredocs.org/clojure.core/reductions" target="_blank" rel="external">reductions</a> ä¾†å”åŠ©æˆ‘å€‘é€²è¡ŒæŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°é€™é‚Šæœ€å¾Œå¾—åˆ°çš„ <code>45</code> å°±æ˜¯æˆ‘å€‘æƒ³è¦çš„çµæœã€‚</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>reductions + <span style="color: #81d4fa;">(</span>range 10<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;  (0 1 3 6 10 15 21 28 36 45)</span></pre></div></div></div><div id="outline-container-org1591709" class="outline-2"><h2 id="org1591709">test</h2><div class="outline-text-2" id="text-org1591709"><p>åœ¨ Clojure ä¸­ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ <a href="http://clojure.org/reference/metadata" target="_blank" rel="external">metadata</a> ä¸­è¨­å®šå¥½å°ä¸€å€‹å‡½æ•¸çš„æ¸¬è©¦æ–¹å¼ï¼Œç„¶å¾Œå‘¼å« <a href="https://clojuredocs.org/clojure.core/test" target="_blank" rel="external">test</a> å°è©²å‡½æ•¸é€²è¡Œæ¸¬è©¦ï¼Œé€™é …åŠŸèƒ½å¾ˆé©åˆç”¨åœ¨å°å‡½å¼çš„ä¸€äº› assertion æ¸¬è©¦ä¸Šã€‚</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">add+</span>  <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:test</span> #<span style="color: #aaccff;">(</span><span style="color: #aaffaa;">do</span>            <span style="color: #aaeecc;">(</span>assert <span style="color: #ccaaff;">(</span>= <span style="color: #fff59d;">(</span>add+ 2 3<span style="color: #fff59d;">)</span> 5<span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span>            <span style="color: #aaeecc;">(</span>assert <span style="color: #ccaaff;">(</span>= <span style="color: #fff59d;">(</span>add+ 4 4<span style="color: #fff59d;">)</span> 8<span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">}</span>  <span style="color: #81d4fa;">[</span>x y<span style="color: #81d4fa;">]</span> <span style="color: #81d4fa;">(</span>+ x y<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span>test #'add+<span style="color: #aadddd;">)</span> <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">&lt;= trigger</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; </span><span style="color: #9ac; font-style: italic;">:ok</span></pre></div><p>ä½ ä¹Ÿå¯ä»¥é€é <a href="https://clojuredocs.org/clojure.core/meta" target="_blank" rel="external">meta</a> å»æŸ¥çœ‹ä½ é€™å€‹å‡½å¼çš„ metadata æˆ–æ˜¯æ¸¬è©¦ç”¨çš„å‡½å¼è³‡è¨Š</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>meta #'addd+<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;</span><span style="color: #aadddd;">{</span><span style="color: #ccaaff;">:arglists</span> <span style="color: #81d4fa;">(</span><span style="color: #aaccff;">[</span>x y<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span>, <span style="color: #ccaaff;">:test</span> #function<span style="color: #81d4fa;">[</span><span style="color: #fff59d;">hello.core</span><span style="color: #c6cccc; background-color: #202020;">/</span>fn--23678<span style="color: #81d4fa;">]</span>, <span style="color: #ccaaff;">:line</span> 350, <span style="color: #ccaaff;">:column</span> 4, <span style="color: #ccaaff;">:file</span> <span style="color: #aadddd;">"/home/coldnew/Workspace/hello/src/hello/cpre.clj"</span>, <span style="color: #ccaaff;">:name</span> add+, <span style="color: #ccaaff;">:ns</span> #namespace<span style="color: #81d4fa;">[</span><span style="color: #fff59d;">hello.core</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">}</span></pre></div></div></div><div id="outline-container-org9e56d42" class="outline-2"><h2 id="org9e56d42">clojure.pprint/cl-format</h2><div class="outline-text-2" id="text-org9e56d42"><p><a href="https://clojuredocs.org/clojure.pprint/cl-format" target="_blank" rel="external">clojure.pprint/cl-format</a> æ˜¯ Clojure ç§»æ¤ Common Lisp çš„ format å‡½å¼ï¼Œå°æ–¼åŒæ™‚å¯« Clojure å’Œ ClojureScript çš„é–‹ç™¼è€…è€Œè¨€ï¼Œ <a href="https://clojuredocs.org/clojure.pprint/cl-format" target="_blank" rel="external">cl-format</a> å¯ä»¥åŒæ™‚ç”¨æ–¼ Clojure å’Œ ClojureScript ä¸Šï¼Œæ–¹ä¾¿äº†ä¸å°‘ã€‚</p><p>(è¨»:  <a href="http://dev.clojure.org/jira/browse/CLJS-324" target="_blank" rel="external">CLJS-324 ISSUE</a> å°šæœªè¢«è§£æ±ºå‰ï¼ŒClojure çš„ <a href="https://clojuredocs.org/clojure.core/format" target="_blank" rel="external">format</a> æ˜¯ç„¡æ³•ç”¨æ–¼ ClojureScript ä¸Šçš„)</p><p>å¦‚æœè¦æ›´å¤šé—œæ–¼ <a href="https://clojuredocs.org/clojure.pprint/cl-format" target="_blank" rel="external">cl-format</a> çš„ä½¿ç”¨ï¼Œå¯ä»¥çœ‹çœ‹  <a href="http://www.gigamonkeys.com/book/a-few-format-recipes.html" target="_blank" rel="external">Praticle Common Lisp</a> ä¸€æ›¸ï¼Œæˆ‘åœ¨ <a href="http://coldnew.github.io/blog/2016/03-27_leftpad/">clojure/clojurescript èˆ‡ left-pad</a> ä¸€æ–‡äº¦æœ‰æåˆ°å¦‚ä½•é€é <a href="https://clojuredocs.org/clojure.pprint/cl-format" target="_blank" rel="external">cl-format</a> å¯¦ä½œ Clojure/ClojureScript çš†å¯ä»¥ç”¨çš„ leftpad å‡½å¼ã€‚</p><p>æŠ•å½±ç‰‡ä¸Šçµ¦çš„ç¯„ä¾‹å‰‡æ˜¯é€™æ¨£:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #fff59d;">clojure.pprint</span><span style="color: #c6cccc; background-color: #202020;">/</span>cl-format <span style="color: #ccaaff;">nil</span> <span style="color: #aadddd;">"~</span><span style="color: #aadddd;">:r</span><span style="color: #aadddd;">"</span> 1234<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; one thousand, two hundred thirty-fourth</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">clojure.pprint</span><span style="color: #c6cccc; background-color: #202020;">/</span>cl-format <span style="color: #ccaaff;">nil</span> <span style="color: #aadddd;">"~@r"</span> 1234<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; MCCXXXIV</span></pre></div></div></div><div id="outline-container-org94ae714" class="outline-2"><h2 id="org94ae714">clojure.java.browse/browse-url</h2><div class="outline-text-2" id="text-org94ae714"><p><a href="https://clojuredocs.org/clojure.java.browse/browse-url" target="_blank" rel="external">clojure.java.browse/browse-url</a> æœƒå‘¼å«ç³»çµ±é è¨­çš„ç€è¦½å™¨ï¼Œé–‹å•Ÿä½ æ‰€æŒ‡å®šçš„ç¶²é ã€‚</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #fff59d;">clojure.java.browse</span><span style="color: #c6cccc; background-color: #202020;">/</span>browse-url <span style="color: #aadddd;">"http://localhost:3000"</span><span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-org6ff7d76" class="outline-2"><h2 id="org6ff7d76">clojure.java.javadoc/javadoc</h2><div class="outline-text-2" id="text-org6ff7d76"><p>Clojure ç•¢ç«Ÿæ˜¯ JVM ä¸Šçš„èªè¨€ï¼Œæœ‰æ™‚å€™æˆ‘å€‘éœ€è¦æŸ¥çœ‹ä¸€äº› javadocï¼Œæˆ–æ˜¯æŸ¥çœ‹ Clojure å…§éƒ¨çš„ Java å¯¦ç¾ï¼Œå¯ä»¥é€é <a href="https://clojuredocs.org/clojure.java.javadoc/javadoc" target="_blank" rel="external">clojure.java.javadoc/javadoc</a> ä¾†æŸ¥çœ‹</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #fff59d;">clojure.java.javadoc</span><span style="color: #c6cccc; background-color: #202020;">/</span>javadoc <span style="color: #81d4fa;">(</span>list* 1 <span style="color: #aaccff;">[]</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; open clojure.lang.Cons Javadoc</span></pre></div></div></div><div id="outline-container-org26117ee" class="outline-2"><h2 id="org26117ee">clojure.reflect/reflect</h2><div class="outline-text-2" id="text-org26117ee"><p>è€å¯¦èªªæˆ‘çœ‹äº†é‚„æ˜¯ä¸çŸ¥é“é€™æ˜¯ä»€éº¼ï¼Œä¹Ÿè¨±æ˜¯å’Œ Java çš„ <a href="http://stackoverflow.com/questions/37628/what-is-reflection-and-why-is-it-useful" target="_blank" rel="external">reflection</a> æœ‰é—œï¼Œä¸éæˆ‘å€‘é‚„æ˜¯å¯ä»¥åœ¨ <a href="https://clojuredocs.org/clojure.reflect/reflect" target="_blank" rel="external">clojure.reflect/reflect</a> çš„æ–‡æª”ä¸­çœ‹å‡ºä¸€äº›æ±è¥¿</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>require '<span style="color: #81d4fa;">[</span><span style="color: #fff59d;">clojure.reflect</span> <span style="color: #ccaaff;">:refer</span> <span style="color: #aaccff;">[</span>reflect<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span>require '<span style="color: #81d4fa;">[</span><span style="color: #fff59d;">clojure.pprint</span> <span style="color: #ccaaff;">:refer</span> <span style="color: #aaccff;">[</span>print-table<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">Here we have a simple function that prints the</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">important bits of the class definition in a table.</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">-&gt;&gt;</span> <span style="color: #fff59d;">String</span>     reflect     <span style="color: #ccaaff;">:members</span>     print-table<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|                    </span><span style="color: #9ac; font-style: italic;">:name</span><span style="color: #9ac; font-style: italic;"> |           </span><span style="color: #9ac; font-style: italic;">:return-type</span><span style="color: #9ac; font-style: italic;"> | </span><span style="color: #9ac; font-style: italic;">:declaring-class</span><span style="color: #9ac; font-style: italic;"> |                                       </span><span style="color: #9ac; font-style: italic;">:parameter-types</span><span style="color: #9ac; font-style: italic;"> |                       </span><span style="color: #9ac; font-style: italic;">:exception-types</span><span style="color: #9ac; font-style: italic;"> |                        </span><span style="color: #9ac; font-style: italic;">:flags</span><span style="color: #9ac; font-style: italic;"> |</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|--------------------------+------------------------+------------------+--------------------------------------------------------+----------------------------------------+-------------------------------|</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|               replaceAll |       java.lang.String | java.lang.String |                    [java.lang.String java.lang.String] |                                     [] |                    #{</span><span style="color: #9ac; font-style: italic;">:public</span><span style="color: #9ac; font-style: italic;">} |</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|   CASE_INSENSITIVE_ORDER |                        | java.lang.String |                                                        |                                        |     #{</span><span style="color: #9ac; font-style: italic;">:public</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:static</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:final</span><span style="color: #9ac; font-style: italic;">} |</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|                  indexOf |                    int | java.lang.String |                    [char&lt;&gt; int int char&lt;&gt; int int int] |                                     [] |                    #{</span><span style="color: #9ac; font-style: italic;">:static</span><span style="color: #9ac; font-style: italic;">} |</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|           codePointCount |                    int | java.lang.String |                                              [int int] |                                     [] |                    #{</span><span style="color: #9ac; font-style: italic;">:public</span><span style="color: #9ac; font-style: italic;">} |</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|                 getChars |                   void | java.lang.String |                                   [int int char&lt;&gt; int] |                                     [] |                    #{</span><span style="color: #9ac; font-style: italic;">:public</span><span style="color: #9ac; font-style: italic;">} |</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|            regionMatches |                boolean | java.lang.String |                         [int java.lang.String int int] |                                     [] |                    #{</span><span style="color: #9ac; font-style: italic;">:public</span><span style="color: #9ac; font-style: italic;">} |</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|                  isEmpty |                boolean | java.lang.String |                                                     [] |                                     [] |                    #{</span><span style="color: #9ac; font-style: italic;">:public</span><span style="color: #9ac; font-style: italic;">} |</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|              codePointAt |                    int | java.lang.String |                                                  [int] |                                     [] |                    #{</span><span style="color: #9ac; font-style: italic;">:public</span><span style="color: #9ac; font-style: italic;">} |</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|              lastIndexOf |                    int | java.lang.String |                                     [java.lang.String] |                                     [] |                    #{</span><span style="color: #9ac; font-style: italic;">:public</span><span style="color: #9ac; font-style: italic;">} |</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">|               startsWith |                boolean | java.lang.String |                                 [java.lang.String int] |                                     [] |                    #{</span><span style="color: #9ac; font-style: italic;">:public</span><span style="color: #9ac; font-style: italic;">} |</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">...etc</span></pre></div><p>è¬›è€…åœ¨æŠ•å½±ç‰‡ä¸­çµ¦çš„ç¯„ä¾‹å‰‡æ˜¯é€™å€‹: (æ³¨æ„åˆ°çµæœæ˜¯ç¯€éŒ„å‘¦~)</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>require '<span style="color: #81d4fa;">[</span><span style="color: #fff59d;">clojure.reflect</span> <span style="color: #ccaaff;">:refer</span> <span style="color: #aaccff;">[</span>reflect<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span>println <span style="color: #81d4fa;">(</span>with-out-str <span style="color: #aaccff;">(</span><span style="color: #fff59d;">clojure.pprint</span><span style="color: #c6cccc; background-color: #202020;">/</span>write <span style="color: #aaeecc;">(</span>reflect <span style="color: #ccaaff;">:a</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">extract from a typical output:</span><span style="color: #aadddd;">{</span><span style="color: #ccaaff;">:name</span> invoke, <span style="color: #ccaaff;">:return-type</span> <span style="color: #fff59d;">java.lang.Object</span>, <span style="color: #ccaaff;">:declaring-class</span> <span style="color: #fff59d;">clojure.lang.Keyword</span>, <span style="color: #ccaaff;">:parameter-types</span> <span style="color: #81d4fa;">[</span><span style="color: #fff59d;">java.lang.Object</span> <span style="color: #fff59d;">java.lang.Object</span><span style="color: #81d4fa;">]</span>, <span style="color: #ccaaff;">:exception-types</span> <span style="color: #81d4fa;">[]</span>, <span style="color: #ccaaff;">:flags</span> #<span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:public</span> <span style="color: #ccaaff;">:final</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">}</span></pre></div></div></div><div id="outline-container-orgc6f37fb" class="outline-2"><h2 id="orgc6f37fb">clojure.inspector/inspect-tree</h2><div class="outline-text-2" id="text-orgc6f37fb"><p>æˆ‘å€‘åœ¨è™•ç†ä¸€äº›æ¨¹ç‹€è³‡æ–™æ™‚(ex: JSON æ ¼å¼)ï¼Œæœ‰å€‹åœ–ç¤ºåŒ–çš„å·¥å…·å¯ä»¥æ–¹ä¾¿ç€è¦½æ‰€æœ‰è³‡è¨Šï¼Œé€™é‚Šå¯ä»¥é€é <a href="https://clojuredocs.org/clojure.inspector/inspect-tree" target="_blank" rel="external">clojure.inspector/inspect-tree</a> ä¾†æŸ¥çœ‹</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>require '<span style="color: #81d4fa;">[</span><span style="color: #fff59d;">clojure.inspector</span> <span style="color: #ccaaff;">:as</span> i<span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">m</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> <span style="color: #aadddd;">"a"</span>        <span style="color: #ccaaff;">:b</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:c</span> <span style="color: #aadddd;">"c"</span>            <span style="color: #ccaaff;">:d</span> <span style="color: #aaeecc;">[</span>1 2 3<span style="color: #aaeecc;">]</span>            <span style="color: #ccaaff;">:e</span> <span style="color: #aaeecc;">{</span><span style="color: #ccaaff;">:f</span> <span style="color: #aadddd;">"f"</span>                <span style="color: #ccaaff;">:g</span> <span style="color: #aadddd;">"g"</span>                <span style="color: #ccaaff;">:h</span> <span style="color: #aadddd;">"h"</span><span style="color: #aaeecc;">}</span><span style="color: #aaccff;">}</span>        <span style="color: #ccaaff;">:i</span> <span style="color: #aaccff;">[</span>1 2 3<span style="color: #aaccff;">]</span>        <span style="color: #ccaaff;">:l</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:m</span> <span style="color: #aadddd;">"m"</span>            <span style="color: #ccaaff;">:n</span> <span style="color: #aadddd;">"n"</span><span style="color: #aaccff;">}</span>        <span style="color: #ccaaff;">:o</span> <span style="color: #aaccff;">[</span><span style="color: #aaeecc;">{</span><span style="color: #ccaaff;">:p</span> <span style="color: #aadddd;">"p"</span> <span style="color: #ccaaff;">:q</span> <span style="color: #aadddd;">"q"</span><span style="color: #aaeecc;">}</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">i</span><span style="color: #c6cccc; background-color: #202020;">/</span>inspect-tree m<span style="color: #aadddd;">)</span></pre></div><p>é€™æ¨£å‘¼å«ï¼Œæœƒå¾—åˆ°å¦‚ä¸‹çš„è¦–çª—</p><div class="figure"><p><img src="inspect-tree.png"></p></div></div></div><div id="outline-container-org7fed263" class="outline-2"><h2 id="org7fed263">clojure.lang.PersistentQueue</h2><div class="outline-text-2" id="text-org7fed263"><p><a href="https://github.com/clojure/clojure/blob/master/src/jvm/clojure/lang/PersistentQueue.java" target="_blank" rel="external">clojure.lang.persistentQueue</a> æ˜¯ Clojure ä¸‹ä¸¦æœªå¯«åœ¨ doc ä¸Šé¢çš„ Queue å¯¦ç¾ (java) ï¼Œæˆ‘å€‘å¯ä»¥ç”¨å®ƒä¾†å¯¦ä½œæˆ‘å€‘éœ€è¦çš„ queue (ä½‡åˆ—) åŠŸèƒ½</p><p>åŸºæœ¬ä¸Šï¼Œä½ æœ‰ä»¥ä¸‹å¹¾ç¨®æ–¹æ³•å¯ä»¥å°ä½ çš„ PersistentQueue é€²è¡Œè™•ç†</p><ul class="org-ul"><li><p>peek</p><p>å–å¾— queue æœ€é ‚ç«¯çš„è³‡æ–™(head)</p></li><li><p>pop</p><p>å›å‚³ä¸åŒ…å«æœ€é ‚ç«¯è³‡æ–™(head)çš„ä¸€å€‹æ–°çš„ PersistentQueue</p></li><li><p>conj</p><p>å°‡è³‡æ–™åŠ å…¥åˆ° queue çš„å°¾å·´</p></li><li><p>empty?</p><p>æª¢æ¸¬ queue æ˜¯å¦ç‚ºç©ºçš„</p></li><li><p>seq</p><p>å°‡ queue çš„è³‡æ–™è®Šæˆåºåˆ— (sequence)</p></li></ul><p>æŠ•å½±ç‰‡ä¸Šï¼Œè¬›è€…æ˜¯èˆ‰é€™ç¯„ä¾‹:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">e</span> <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">clojure.lang.PersistentQueue</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">EMPTY</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">buf</span> <span style="color: #81d4fa;">(</span>reduce conj e <span style="color: #aaccff;">(</span>range 10<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span>peek buf<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; 0</span><span style="color: #aadddd;">(</span>peek <span style="color: #81d4fa;">(</span>pop buf<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; 1</span><span style="color: #aadddd;">(</span>peek <span style="color: #81d4fa;">(</span>pop <span style="color: #aaccff;">(</span>pop buf<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; 2</span></pre></div><p>è€Œ <a href="http://stackoverflow.com/questions/3136453/immutable-queue-in-clojure" target="_blank" rel="external">StackOverflow</a> å‰‡æ˜¯æœ‰äººèˆ‰å‡ºäº†å¦‚ä½•é€é  <a href="https://github.com/clojure/clojure/blob/master/src/jvm/clojure/lang/PersistentQueue.java" target="_blank" rel="external">clojure.lang.persistentQueue</a> å¯¦ç¾è‡ªå·±çš„ queue å‡½å¼</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">queue</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaccff;">[]</span> <span style="color: #fff59d;">clojure.lang.PersistentQueue</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">EMPTY</span><span style="color: #81d4fa;">)</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaccff;">[</span>coll<span style="color: #aaccff;">]</span> <span style="color: #aaccff;">(</span>reduce conj <span style="color: #fff59d;">clojure.lang.PersistentQueue</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">EMPTY</span> coll<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defmethod</span> <span style="color: #aaccff;">print-method</span> <span style="color: #fff59d;">clojure.lang.PersistentQueue</span>  <span style="color: #81d4fa;">[</span>q ^<span style="color: #fff59d;">java.io.Writer</span> w<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #ff8888;">.write</span> w <span style="color: #aadddd;">"#queue "</span><span style="color: #81d4fa;">)</span>  <span style="color: #81d4fa;">(</span>print-method <span style="color: #aaccff;">(</span>sequence q<span style="color: #aaccff;">)</span> w<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span>comment  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">let</span> <span style="color: #aaccff;">[</span><span style="color: #ccaaff;">*data-readers*</span> <span style="color: #aaeecc;">{</span>'queue #'queue<span style="color: #aaeecc;">}</span><span style="color: #aaccff;">]</span>    <span style="color: #aaccff;">(</span>read-string <span style="color: #aaeecc;">(</span>pr-str <span style="color: #ccaaff;">(</span>queue <span style="color: #fff59d;">[</span>1 2 3<span style="color: #fff59d;">]</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-orgbc1ebad" class="outline-2"><h2 id="orgbc1ebad">fnil</h2><div class="outline-text-2" id="text-orgbc1ebad"><p>æˆ‘å€‘åœ¨ç”¨ Clojure è™•ç†æ±è¥¿çš„æ™‚å€™ï¼Œæœ‰æ™‚å€™å¯èƒ½æ˜¯è³‡æ–™æœ¬èº«å°±æ˜¯ nil çš„æƒ…æ³ï¼Œé€™ç¨®ç‹€æ³ä¸‹å° nil é€²è¡Œè™•ç†å¯èƒ½å°±æœƒå°è‡´ Exception çš„ç‹€æ³ç™¼ç”Ÿ</p><p>åœ¨å‚³çµ±çš„ LISP ä¸­ï¼Œå¸¸ä»¥ <code>or</code> ä½œç‚ºä¸€å€‹ä¿è­·ï¼Œä¸€æ—¦é‡åˆ° nil çš„æƒ…æ³ï¼Œå‰‡å›å‚³é è¨­å€¼</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">or</span> <span style="color: #ccaaff;">nil</span> 10<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; 10</span></pre></div><p><a href="https://clojuredocs.org/clojure.core/fnil" target="_blank" rel="external">fnil</a> å‰‡æ˜¯ç”¨ä¾†æ›¿ä½ çš„å‡½å¼å¤šåŠ ä¸€å±¤ä¿è­·ï¼Œè®“å‡½å¼é‡åˆ° nil çš„ç‹€æ³å¯ä»¥é¿å…ä¸€äº› Exception çš„ç™¼ç”Ÿ</p><p>è¬›è€…åœ¨æŠ•å½±ç‰‡ä¸Šæä¾›çš„ç¯„ä¾‹æ˜¯é€™æ¨£çš„:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">m</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:host</span> <span style="color: #aadddd;">"127.0.0.1"</span> <span style="color: #ccaaff;">:port</span> <span style="color: #ccaaff;">nil</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span>update m <span style="color: #ccaaff;">:port</span> <span style="color: #81d4fa;">(</span>fnil #<span style="color: #aaccff;">(</span><span style="color: #fff59d;">Integer</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ff8888;">parseInt</span> <span style="color: #aaccff;">%</span><span style="color: #aaccff;">)</span> <span style="color: #aadddd;">"80"</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; {</span><span style="color: #9ac; font-style: italic;">:host</span><span style="color: #9ac; font-style: italic;"> "127.0.0.1", </span><span style="color: #9ac; font-style: italic;">:port</span><span style="color: #9ac; font-style: italic;"> 80}</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">m</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:host</span> <span style="color: #aadddd;">"127.0.0.1"</span> <span style="color: #ccaaff;">:port</span> <span style="color: #aadddd;">"8008"</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span>update m <span style="color: #ccaaff;">:port</span> <span style="color: #81d4fa;">(</span>fnil #<span style="color: #aaccff;">(</span><span style="color: #fff59d;">Integer</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ff8888;">parseInt</span> <span style="color: #aaccff;">%</span><span style="color: #aaccff;">)</span> <span style="color: #aadddd;">"80"</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; {</span><span style="color: #9ac; font-style: italic;">:host</span><span style="color: #9ac; font-style: italic;"> "127.0.0.1", </span><span style="color: #9ac; font-style: italic;">:port</span><span style="color: #9ac; font-style: italic;"> 8008}</span></pre></div><p>ä¸éæˆ‘å€‘ä¹Ÿå¯ä»¥å°‡å…¶æ‹†é–‹ä¾†çœ‹ï¼Œé€™æ¨£æœƒæ›´å¥½ç†è§£</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #fff59d;">Integer</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ff8888;">parseInt</span> <span style="color: #aadddd;">"10"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; 10</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">Integer</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ff8888;">parseInt</span> <span style="color: #ccaaff;">nil</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;  Unhandled java.lang.NumberFormatException</span><span style="color: #aadddd;">(</span><span style="color: #81d4fa;">(</span>fnil #<span style="color: #aaccff;">(</span><span style="color: #fff59d;">Integer</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ff8888;">parseInt</span> <span style="color: #aaccff;">%</span><span style="color: #aaccff;">)</span> 80<span style="color: #81d4fa;">)</span> <span style="color: #aadddd;">"1000"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; 1000</span></pre></div></div></div><div id="outline-container-orgd6acee4" class="outline-2"><h2 id="orgd6acee4">counted?</h2><div class="outline-text-2" id="text-orgd6acee4"><p><a href="https://clojuredocs.org/clojure.core/counted_q" target="_blank" rel="external">counted?</a> æ˜¯ O(1) çš„æ“ä½œï¼Œç”¨ä¾†æŸ¥çœ‹ç›®æ¨™æ˜¯å¦å…·æœ‰å¯¦ä½œ <a href="https://clojuredocs.org/clojure.core/count" target="_blank" rel="external">count</a> å‡½å¼</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>counted? <span style="color: #81d4fa;">[</span><span style="color: #ccaaff;">:a</span> <span style="color: #ccaaff;">:b</span> <span style="color: #ccaaff;">:c</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; true</span><span style="color: #aadddd;">(</span>counted? '<span style="color: #81d4fa;">(</span><span style="color: #ccaaff;">:a</span> <span style="color: #ccaaff;">:b</span> <span style="color: #ccaaff;">:c</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; true</span><span style="color: #aadddd;">(</span>counted? <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> 1 <span style="color: #ccaaff;">:b</span> 2 <span style="color: #ccaaff;">:c</span> 3<span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; true</span><span style="color: #aadddd;">(</span>counted? #<span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> <span style="color: #ccaaff;">:b</span> <span style="color: #ccaaff;">:c</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; true</span><span style="color: #aadddd;">(</span>counted? <span style="color: #aadddd;">"asdf"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; false</span><span style="color: #aadddd;">(</span>counted? <span style="color: #81d4fa;">(</span>into-array <span style="color: #fff59d;">Integer</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ccaaff;">TYPE</span> <span style="color: #aaccff;">[</span>1 2 3<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; false</span></pre></div></div></div><div id="outline-container-orgbcd4af6" class="outline-2"><h2 id="orgbcd4af6">reversible?</h2><div class="outline-text-2" id="text-orgbcd4af6"><p>[[<a href="https://clojuredocs.org/clojure.core/reversible_q%5D%5Breversibl%5B%5Bfile" target="_blank" rel="external">https://clojuredocs.org/clojure.core/reversible_q][reversibl[[file</a>:][]]] ä¹Ÿæ˜¯ O(1) çš„æ“ä½œï¼Œç”¨ä¾†æŸ¥çœ‹ç›®æ¨™æ˜¯å¦æœ‰å¯¦ä½œ <a href="https://clojuredocs.org/clojure.core/reversible_q" target="_blank" rel="external">reversible</a> å‡½å¼</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>reversible? <span style="color: #81d4fa;">[]</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;  true</span><span style="color: #aadddd;">(</span>reversible? <span style="color: #81d4fa;">(</span>sorted-map<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;  true</span><span style="color: #aadddd;">(</span>reversible? <span style="color: #81d4fa;">(</span>sorted-set<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;  true</span><span style="color: #aadddd;">(</span>reversible? '<span style="color: #81d4fa;">()</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;  false</span><span style="color: #aadddd;">(</span>reversible? <span style="color: #81d4fa;">{}</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;  false</span><span style="color: #aadddd;">(</span>reversible? #<span style="color: #81d4fa;">{}</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;  false</span></pre></div></div></div><div id="outline-container-org2f6312a" class="outline-2"><h2 id="org2f6312a">vector-of</h2><div class="outline-text-2" id="text-org2f6312a"><p><a href="https://clojuredocs.org/clojure.core/vector-of" target="_blank" rel="external">vector-of</a> æœƒæ ¹æ“šä½ æä¾›çš„é¡å‹ (permitive type) ä¾†å°‡åƒæ•¸è½‰æ›æˆç›¸å°æ‡‰å‹åˆ¥çš„å‘é‡ (vector)</p><p>å¯ä»¥ä½¿ç”¨çš„é¡å‹æœ‰ <code>:int</code> , <code>:long</code> , <code>:float</code> , <code>:double</code> , <code>:byte</code> , <code>:short</code> , <code>:char</code> , <code>:boolean</code></p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>conj <span style="color: #81d4fa;">(</span>vector-of <span style="color: #ccaaff;">:int</span><span style="color: #81d4fa;">)</span> 1 2 3<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; [1 2 3]  ; &lt;-- note, these are unboxed internally</span><span style="color: #aadddd;">(</span>vector-of <span style="color: #ccaaff;">:int</span> 1 2 3<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; [1 2 3]  ; same here</span><span style="color: #aadddd;">(</span>vector-of <span style="color: #ccaaff;">:float</span> 1 2 3<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; [1.0 2.0 3.0]</span><span style="color: #aadddd;">(</span>type <span style="color: #81d4fa;">(</span>conj <span style="color: #aaccff;">(</span>vector-of <span style="color: #ccaaff;">:int</span><span style="color: #aaccff;">)</span> 1 2 3<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; clojure.core.Vec</span><span style="color: #aadddd;">(</span>type <span style="color: #81d4fa;">(</span>conj <span style="color: #aaccff;">(</span>vector-of <span style="color: #ccaaff;">:float</span><span style="color: #aaccff;">)</span> 1 2 3<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; clojure.core.Vec</span></pre></div></div></div><div id="outline-container-orgb04eda2" class="outline-2"><h2 id="orgb04eda2">clojure.set/rename-keys</h2><div class="outline-text-2" id="text-orgb04eda2"><p><a href="https://clojuredocs.org/clojure.set/rename-keys" target="_blank" rel="external">clojure.set/rename-keys</a> å¯ä»¥ç”¨ä¾†æ”¹è®Šç›®å‰ç¾æœ‰çš„ hash-map çš„é—œéµå­— (keyword) åç¨±</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>require '<span style="color: #fff59d;">clojure.set</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">clojure.set</span><span style="color: #c6cccc; background-color: #202020;">/</span>rename-keys <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> 1, <span style="color: #ccaaff;">:b</span> 2<span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> <span style="color: #ccaaff;">:new-a</span>, <span style="color: #ccaaff;">:b</span> <span style="color: #ccaaff;">:new-b</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; {</span><span style="color: #9ac; font-style: italic;">:new-a</span><span style="color: #9ac; font-style: italic;"> 1, </span><span style="color: #9ac; font-style: italic;">:new-b</span><span style="color: #9ac; font-style: italic;"> 2}</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">cloure.set</span><span style="color: #c6cccc; background-color: #202020;">/</span>rename-keys <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> 1<span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:b</span> <span style="color: #ccaaff;">:new-b</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; {</span><span style="color: #9ac; font-style: italic;">:a</span><span style="color: #9ac; font-style: italic;"> 1}</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">You need to be careful about key collisions.  You probably shouldn't</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">depend on the exact behavior.</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">clojure.set</span><span style="color: #c6cccc; background-color: #202020;">/</span>rename-keys <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> 1 <span style="color: #ccaaff;">:b</span> 2<span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> <span style="color: #ccaaff;">:b</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; {</span><span style="color: #9ac; font-style: italic;">:b</span><span style="color: #9ac; font-style: italic;"> 1}</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">clojure.set</span><span style="color: #c6cccc; background-color: #202020;">/</span>rename-keys  <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> 1 <span style="color: #ccaaff;">:b</span> 2<span style="color: #81d4fa;">}</span>  <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> <span style="color: #ccaaff;">:b</span> <span style="color: #ccaaff;">:b</span> <span style="color: #ccaaff;">:a</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; {</span><span style="color: #9ac; font-style: italic;">:a</span><span style="color: #9ac; font-style: italic;"> 1}</span></pre></div></div></div><div id="outline-container-orga1ec355" class="outline-2"><h2 id="orga1ec355">clojure.data/diff</h2><div class="outline-text-2" id="text-orga1ec355"><p><a href="https://clojuredocs.org/clojure.data/diff" target="_blank" rel="external">clojure.data/diff</a> ç”¨ä¾†å°å…©å€‹åºåˆ—(sequence)é€²è¡Œæ¯”è¼ƒï¼Œä¸¦å›å‚³æ¯”è¼ƒçš„çµæœ</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>require '<span style="color: #fff59d;">clojure.data</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">clojure.data</span><span style="color: #c6cccc; background-color: #202020;">/</span>diff <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> 1 <span style="color: #ccaaff;">:b</span> 2<span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:a</span> 3 <span style="color: #ccaaff;">:b</span> 2 <span style="color: #ccaaff;">:c</span> 3<span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; ({</span><span style="color: #9ac; font-style: italic;">:a</span><span style="color: #9ac; font-style: italic;"> 1} {</span><span style="color: #9ac; font-style: italic;">:a</span><span style="color: #9ac; font-style: italic;"> 3, </span><span style="color: #9ac; font-style: italic;">:c</span><span style="color: #9ac; font-style: italic;"> 3} {</span><span style="color: #9ac; font-style: italic;">:b</span><span style="color: #9ac; font-style: italic;"> 2})</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">clojure.data</span><span style="color: #c6cccc; background-color: #202020;">/</span>diff <span style="color: #81d4fa;">[</span>1 2 3<span style="color: #81d4fa;">]</span> <span style="color: #81d4fa;">[</span>5 9 3 2 3 7<span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; [[1 2] [5 9 nil 2 3 7] [nil nil 3]]</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">clojure.data</span><span style="color: #c6cccc; background-color: #202020;">/</span>diff <span style="color: #81d4fa;">(</span>set <span style="color: #aaccff;">[</span>1 2 3<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span> <span style="color: #81d4fa;">(</span>set <span style="color: #aaccff;">[</span>5 9 3 2 3 7<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; [#{1}  #{7 9 5}        #{3 2}]</span></pre></div></div></div><div id="outline-container-org83a69d9" class="outline-2"><h2 id="org83a69d9">munge</h2><div class="outline-text-2" id="text-org83a69d9"><p><a href="https://clojuredocs.org/clojure.core/munge" target="_blank" rel="external">munge</a> é€™å€‹å‡½å¼ä¸¦æœªæœ‰æ–‡æª”ï¼Œå› æ­¤åªèƒ½å¯¦éš›çœ‹çœ‹ç”¨é€”äº†</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">foo</span> <span style="color: #81d4fa;">[]</span> <span style="color: #81d4fa;">(</span>println <span style="color: #aadddd;">"foo"</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;  #'user/foo</span>foo<span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; #&lt;user$foo user$foo@a0dc71&gt;</span><span style="color: #aadddd;">(</span>munge foo<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; "user_DOLLARSIGN_foo_CIRCA_a0dc71"</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">doseq</span> <span style="color: #81d4fa;">[</span>c <span style="color: #aaccff;">(</span>remove #<span style="color: #aaeecc;">(</span><span style="color: #fff59d;">Character</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ff8888;">isLetterOrDigit</span> <span style="color: #aaccff;">%</span><span style="color: #aaeecc;">)</span> <span style="color: #aaeecc;">(</span>map char <span style="color: #ccaaff;">(</span>range 32 127<span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span>println c <span style="color: #aadddd;">"-&gt;"</span> <span style="color: #aaccff;">(</span>munge c<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">Prints:</span><span style="color: #5f5f5f; font-style: italic;">;;   </span><span style="color: #9ac; font-style: italic;">-&gt;</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">! -&gt; _BANG_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">" -&gt; _DOUBLEQUOTE_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;"># -&gt; _SHARP_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">$ -&gt; $</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">% -&gt; _PERCENT_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">&amp; -&gt; _AMPERSAND_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">' -&gt; _SINGLEQUOTE_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">( -&gt; (</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">) -&gt; )</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">* -&gt; _STAR_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">+ -&gt; _PLUS_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">, -&gt; ,</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">- -&gt; _</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">. -&gt; .</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">/ -&gt; _SLASH_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">: -&gt; _COLON_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">; -&gt; ;</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">&lt; -&gt; _LT_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">= -&gt; _EQ_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">&gt; -&gt; _GT_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">? -&gt; _QMARK_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">@ -&gt; _CIRCA_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">[ -&gt; _LBRACK_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">\ -&gt; _BSLASH_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">] -&gt; _RBRACK_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">^ -&gt; _CARET_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">_ -&gt; _</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">` -&gt; `</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">{ -&gt; _LBRACE_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">| -&gt; _BAR_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">} -&gt; _RBRACE_</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">~ -&gt; _TILDE_</span></pre></div></div></div><div id="outline-container-org29060d9" class="outline-2"><h2 id="org29060d9">gensym</h2><div class="outline-text-2" id="text-org29060d9"><p><a href="https://clojuredocs.org/clojure.core/gensym" target="_blank" rel="external">gensym</a> æœƒç”¢ç”Ÿä¸è¡çªåç¨±çš„ symbolï¼Œé€™å€‹æ‡‰è©²æ˜¯åœ¨ macro å¯¦ç¾æ™‚ï¼ŒClojure æ‰€ä½¿ç”¨åˆ°çš„å‡½å¼</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>gensym <span style="color: #aadddd;">"foo"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; foo2020</span><span style="color: #aadddd;">(</span>gensym <span style="color: #aadddd;">"foo"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; foo2027</span></pre></div></div></div><div id="outline-container-orgbc0fdab" class="outline-2"><h2 id="orgbc0fdab">seque</h2><div class="outline-text-2" id="text-orgbc0fdab"><p><a href="https://clojuredocs.org/clojure.core/seque" target="_blank" rel="external">seque</a> æ˜¯ä¸€ç¨® <code>é˜»å¡éšŠåˆ—(Linked Blocking Queue, LBQ)</code> çš„å¯¦ä½œï¼Œé€™ç¨®å¯¦ç¾æ˜¯ç·šç¨‹å®‰å…¨(thread safe)çš„ï¼Œå¯ä»¥ç¢ºä¿è³‡æ–™å…ˆé€²å…ˆå‡º(first in first out, FIFO) çš„ç‹€æ³ã€‚</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">let</span> <span style="color: #81d4fa;">[</span>start <span style="color: #aaccff;">(</span><span style="color: #fff59d;">System</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ff8888;">nanoTime</span><span style="color: #aaccff;">)</span>      q <span style="color: #aaccff;">(</span>seque         <span style="color: #aaeecc;">(</span>iterate          #<span style="color: #ccaaff;">(</span><span style="color: #aaffaa;">do</span> <span style="color: #fff59d;">(</span><span style="color: #fff59d;">Thread</span><span style="color: #c6cccc; background-color: #202020;">/</span>sleep 400<span style="color: #fff59d;">)</span> <span style="color: #fff59d;">(</span>inc <span style="color: #aaccff;">%</span><span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span>          0<span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span>println <span style="color: #aadddd;">"sleep five seconds..."</span><span style="color: #81d4fa;">)</span>  <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">Thread</span><span style="color: #c6cccc; background-color: #202020;">/</span>sleep 5000<span style="color: #81d4fa;">)</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">doseq</span> <span style="color: #aaccff;">[</span>i <span style="color: #aaeecc;">(</span>take 20 q<span style="color: #aaeecc;">)</span><span style="color: #aaccff;">]</span>    <span style="color: #aaccff;">(</span>println <span style="color: #aaeecc;">(</span>int <span style="color: #ccaaff;">(</span>/ <span style="color: #fff59d;">(</span>- <span style="color: #ff8888;">(</span><span style="color: #fff59d;">System</span><span style="color: #c6cccc; background-color: #202020;">/</span><span style="color: #ff8888;">nanoTime</span><span style="color: #ff8888;">)</span> start<span style="color: #fff59d;">)</span> 1e7<span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span>             <span style="color: #aadddd;">":"</span> i<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">The iterate form returns a lazy seq that delays nearly a half-second</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">before returning each subsequent item.  Here seque starts a thread</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">generating the lazy seq.</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">The body of the let allows the seque thread to get ahead by five seconds</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">before it begins consuming the seq using doseq.  The doseq prints a</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">timestamp and the value from the seq when it becomes available.  The</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">first 11 or so are available almost instantly, until the consuming</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">doseq catches up with the producing iterate, at which point the consumer</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">blocks for 400ms before each item can be printed.</span><span style="color: #5f5f5f; font-style: italic;">;;</span><span style="color: #9ac; font-style: italic;">sleep five seconds...</span>500 : 0500 : 1500 : 2500 : 3500 : 4500 : 5500 : 6500 : 7500 : 8500 : 9500 : 10500 : 11520 : 12<span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">......</span></pre></div></div></div><div id="outline-container-orgd2cc687" class="outline-2"><h2 id="orgd2cc687">clojure.zip/zippers</h2><div class="outline-text-2" id="text-orgd2cc687"><p>clojure.zip æ˜¯ç”¨ä¾†è™•ç†æ¨¹ç‹€çµæ§‹ç”¨å‡½å¼åº«ï¼Œé€™ç¯‡æ–‡ç« æœ‰å¾ˆå¥½çš„è§£é‡‹: <a href="http://blog.lambdaliu.com/posts-output/2016-04-05-understand-clojure-zipper-with-picture/" target="_blank" rel="external">(Î»x.Liu)Blog=Hacking: Understand clojure.zip with picture</a></p><p><a href="https://clojuredocs.org/clojure.zip/zipper" target="_blank" rel="external">clojure.zip/zipper</a> å‰‡æ˜¯ç”¨ä¾†å°‡è³‡æ–™åŒ…è£èµ·ä¾†ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥é€é clojure.zip ä¾†è™•ç†é€™äº›æ¨¹ç‹€è³‡æ–™</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">zp</span> <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">clojure.zip</span><span style="color: #c6cccc; background-color: #202020;">/</span>zipper vector? seq <span style="color: #aaccff;">(</span><span style="color: #aaffaa;">fn</span> <span style="color: #aaeecc;">[</span>_ c<span style="color: #aaeecc;">]</span> c<span style="color: #aaccff;">)</span>                            <span style="color: #aaccff;">[</span><span style="color: #aaeecc;">[</span>1 2 3<span style="color: #aaeecc;">]</span> <span style="color: #aaeecc;">[</span><span style="color: #ccaaff;">:a</span> <span style="color: #ccaaff;">:b</span><span style="color: #aaeecc;">]</span> 2 3 <span style="color: #aaeecc;">[</span>40 50 60<span style="color: #aaeecc;">]</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; [[[1 2 3] [</span><span style="color: #9ac; font-style: italic;">:a</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:b</span><span style="color: #9ac; font-style: italic;">] 2 3 [40 50 60]] nil]</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">clojure.zip</span><span style="color: #c6cccc; background-color: #202020;">/</span>down zp<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;</span><span style="color: #aadddd;">[</span><span style="color: #81d4fa;">[</span>1 2 3<span style="color: #81d4fa;">]</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:l</span> <span style="color: #aaccff;">[]</span>,  <span style="color: #ccaaff;">:pnodes</span> <span style="color: #aaccff;">[</span><span style="color: #aaeecc;">[</span><span style="color: #ccaaff;">[</span>1 2 3<span style="color: #ccaaff;">]</span> <span style="color: #ccaaff;">[</span><span style="color: #ccaaff;">:a</span> <span style="color: #ccaaff;">:b</span><span style="color: #ccaaff;">]</span> 2 3 <span style="color: #ccaaff;">[</span>40 50 60<span style="color: #ccaaff;">]</span><span style="color: #aaeecc;">]</span><span style="color: #aaccff;">]</span>,  <span style="color: #ccaaff;">:ppath</span> <span style="color: #ccaaff;">nil</span>,  <span style="color: #ccaaff;">:r</span> <span style="color: #aaccff;">(</span><span style="color: #aaeecc;">[</span><span style="color: #ccaaff;">:a</span> <span style="color: #ccaaff;">:b</span><span style="color: #aaeecc;">]</span> 2 3 <span style="color: #aaeecc;">[</span>40 50 60<span style="color: #aaeecc;">]</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">-&gt;</span> zp    <span style="color: #fff59d;">clojure.zip</span><span style="color: #c6cccc; background-color: #202020;">/</span>down    first<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;</span><span style="color: #aadddd;">[</span>1 2 3<span style="color: #aadddd;">]</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">-&gt;</span> zp    <span style="color: #fff59d;">clojure.zip</span><span style="color: #c6cccc; background-color: #202020;">/</span>down    <span style="color: #fff59d;">clojure.zip</span><span style="color: #c6cccc; background-color: #202020;">/</span>right<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;</span><span style="color: #aadddd;">[</span><span style="color: #81d4fa;">[</span><span style="color: #ccaaff;">:a</span> <span style="color: #ccaaff;">:b</span><span style="color: #81d4fa;">]</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:l</span> <span style="color: #aaccff;">[</span><span style="color: #aaeecc;">[</span>1 2 3<span style="color: #aaeecc;">]</span><span style="color: #aaccff;">]</span>,  <span style="color: #ccaaff;">:pnodes</span> <span style="color: #aaccff;">[</span><span style="color: #aaeecc;">[</span><span style="color: #ccaaff;">[</span>1 2 3<span style="color: #ccaaff;">]</span> <span style="color: #ccaaff;">[</span><span style="color: #ccaaff;">:a</span> <span style="color: #ccaaff;">:b</span><span style="color: #ccaaff;">]</span> 2 3 <span style="color: #ccaaff;">[</span>40 50 60<span style="color: #ccaaff;">]</span><span style="color: #aaeecc;">]</span><span style="color: #aaccff;">]</span>,  <span style="color: #ccaaff;">:ppath</span> <span style="color: #ccaaff;">nil</span>,  <span style="color: #ccaaff;">:r</span> <span style="color: #aaccff;">(</span>2 3 <span style="color: #aaeecc;">[</span>40 50 60<span style="color: #aaeecc;">]</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span></pre></div></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/eea89759/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board é–‹ç™¼è¨˜éŒ„: ä½¿ç”¨ Yocto å»ºç«‹ç³»çµ±</title>
      <link>https://coldnew.github.io/c3e8558e/</link>
      <guid>https://coldnew.github.io/c3e8558e/</guid>
      <pubDate>Sun, 11 Sep 2016 13:47:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
åœ¨ &lt;a href=&quot;http://coldnew.github.io/zybo-board/zynq_linux_simple/&quot;&gt;zybo board é–‹ç™¼è¨˜éŒ„: åŸ·è¡Œ Linux ä½œæ¥­ç³»çµ±&lt;/a&gt; ä¸€æ–‡ä¸­ï¼Œæˆ‘å€‘æåˆ°äº†å¦‚ä½•è‡ªè¡Œç·¨è­¯ u-bootã€Linux kernelã€busybox ä¾†è®“ Zybo Board å¯ä»¥é–‹æ©Ÿé€²åˆ° SD å¡ä¸Šçš„ Linux ç³»çµ±ã€‚é€™ä¸€æ¬¡ï¼Œæˆ‘å€‘è¦ä¾†è«‡è«‡æ€æ¨£ä½¿ç”¨ &lt;a href=&quot;https://www.yoctoproject.org/&quot;&gt;Yocto Project&lt;/a&gt; ä¾†å»ºç«‹ Zybo board çš„ Linux ç³»çµ±ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>åœ¨ <a href="http://coldnew.github.io/zybo-board/zynq_linux_simple/">zybo board é–‹ç™¼è¨˜éŒ„: åŸ·è¡Œ Linux ä½œæ¥­ç³»çµ±</a> ä¸€æ–‡ä¸­ï¼Œæˆ‘å€‘æåˆ°äº†å¦‚ä½•è‡ªè¡Œç·¨è­¯ u-bootã€Linux kernelã€busybox ä¾†è®“ Zybo Board å¯ä»¥é–‹æ©Ÿé€²åˆ° SD å¡ä¸Šçš„ Linux ç³»çµ±ã€‚é€™ä¸€æ¬¡ï¼Œæˆ‘å€‘è¦ä¾†è«‡è«‡æ€æ¨£ä½¿ç”¨ <a href="https://www.yoctoproject.org/" target="_blank" rel="external">Yocto Project</a> ä¾†å»ºç«‹ Zybo board çš„ Linux ç³»çµ±ã€‚</p><a id="more"></a><p><a href="https://www.yoctoproject.org/" target="_blank" rel="external">Yocto Project</a> æ˜¯è¿‘å¹´ä¾†å„å¤§ SoC å•†ä»¥åŠé–‹ç™¼æ¿å•†çš†åƒèˆ‡çš„ Linux ç³»çµ±æ§‹ä»¶å·¥å…·ï¼Œé€é Yocto Project çš„å”åŠ©ï¼Œä½¿ç”¨è€…å¯ä»¥é‡å°è‡ªå·±çš„éœ€æ±‚æ§‹ä»¶æƒ³è¦çš„æ˜ åƒæª”(image)æˆ–æ˜¯ Root File Systemï¼Œå’Œ Yocto é¡ä¼¼åŠŸèƒ½çš„å·¥å…·å‰‡æ˜¯ <a href="https://buildroot.org/" target="_blank" rel="external">buildroot</a> ã€‚</p><p>æœ¬æ–‡å°‡ä»¥ <a href="http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Zybo Board</a> ä½œç‚ºç›®æ¨™é–‹ç™¼æ¿ï¼Œç¤ºç¯„å¦‚ä½•ä½¿ç”¨ Yocto ä¾†æ§‹ä»¶ä»–çš„ç³»çµ±ã€‚</p><div id="outline-container-org4f4e750" class="outline-2"><h2 id="org4f4e750">é å…ˆæº–å‚™</h2><div class="outline-text-2" id="text-org4f4e750"><p>æ ¹æ“šä½ ä½¿ç”¨çš„ Linux ç™¼è¡Œæ¿çš„ä¸åŒï¼Œä½ éœ€è¦å®‰è£ä¸€äº›å¥—ä»¶ï¼Œé€™é‚Šåˆ—å‡ºä¸€äº›ç™¼è¡Œæ¿çš„è³‡è¨Šï¼Œè©³ç´°è«‹åƒè€ƒ <a href="http://www.yoctoproject.org/docs/2.0/ref-manual/ref-manual.html#intro-requirements" target="_blank" rel="external">Yocto Project Reference Manual</a></p><ul class="org-ul"><li><p>Debian/Ubuntu</p><div class="org-src-container"><pre class="src src-sh">coldnew@debian ~ $ sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib build-essential chrpath socat</pre></div></li><li><p>Fedora</p><div class="org-src-container"><pre class="src src-sh">coldnew@fedora ~ $ sudo dnf install gawk make wget tar bzip2 gzip python unzip perl patch diffutils diffstat git cpp gcc gcc-c++ glibc-devel texinfo chrpath ccache perl-Data-Dumper perl-Text-ParseWords perl-Thread-Queue socat findutils which</pre></div></li><li><p>Gentoo</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~ $ emerge -v dev-vcs/git dev-util/diffstat app-arch/unzip sys-apps/texinfo app-admin/chrpath media-libs/libsdl2 sys-apps/iproute2 x11-terms/xterm net-nds/rpcbind</pre></div><p>å¦‚æœä½ å’Œæˆ‘ä¸€æ¨£ï¼Œä½¿ç”¨ Gentoo Linux çš„è©±ï¼Œåœ¨ Gentoo Linux ä¸‹è¦ç¢ºèªä½ ä½¿ç”¨çš„æ˜¯ Python 2.7</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~ $ eselect python set python2.7eselect python listAvailable Python interpreters:  <span style="color: #aadddd;">[</span>1<span style="color: #aadddd;">]</span>   python2.7 *  <span style="color: #aadddd;">[</span>2<span style="color: #aadddd;">]</span>   python3.2  <span style="color: #aadddd;">[</span>3<span style="color: #aadddd;">]</span>   python3.3pythonPython 2.7.5 <span style="color: #aadddd;">(</span>default, Oct 19 2013, 22:52:27<span style="color: #aadddd;">)</span></pre></div></li></ul></div></div><div id="outline-container-org707d160" class="outline-2"><h2 id="org707d160">æ ¼å¼åŒ– MicroSD å¡</h2><div class="outline-text-2" id="text-org707d160"><p>åœ¨é€™æ¬¡çš„é–‹ç™¼ä¸­ï¼Œæˆ‘å€‘è¦è¨­å®š MicroSD å¡ç‰‡æˆå…©å€‹åˆ†å€ï¼Œç¬¬ä¸€å€‹æ˜¯ <code>fat32</code> æ ¼å¼ï¼Œç¬¬äºŒå€‹å‰‡ä½¿ç”¨ <code>ext4</code> æ ¼å¼ï¼Œè‹¥ä¸æœƒä½¿ç”¨ <code>fdisk</code> å‘½ä»¤çš„è©±ï¼Œå¯ä»¥é€é <code>gparted</code> ä¾†é€²è¡Œæ ¼å¼åŒ–ï¼Œä»¥ä¸‹æ˜¯æˆ‘æ ¼å¼åŒ–å¡ç‰‡çš„ç¯„ä¾‹ (8GB å¡ç‰‡)ã€‚</p><div class="figure"><p><img src="format.png"></p></div></div></div><div id="outline-container-org4c81733" class="outline-2"><h2 id="org4c81733">ä¸‹è¼‰ Poky</h2><div class="outline-text-2" id="text-org4c81733"><p>åœ¨é–‹å§‹ç”¨ <a href="https://www.yoctoproject.org/" target="_blank" rel="external">Yocto Project</a> ä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦ä¸‹è¼‰ Poky, Poky æ˜¯ Yocto çš„æ§‹ä»¶ç³»çµ±ï¼ŒåŸºæœ¬ä¸Šæˆ‘å€‘æœƒç”¨åˆ°çš„æ±è¥¿éƒ½æœƒåœ¨ poky è³‡æ–™å¤¾å…§</p><p>æ³¨æ„åˆ°æˆ‘å€‘é€™é‚Šåˆ‡æ›åˆ° <code>krogoth</code> é€™å€‹åˆ†æ”¯ï¼ŒYocto è£¡é¢ä¸åŒçš„åˆ†æ”¯(branch) ä»£è¡¨äº†ä¸åŒç‰ˆæœ¬ã€‚</p><pre class="example">coldnew@gentoo ~ $ git clone git://git.yoctoproject.org/poky -b krogoth</pre><p>å¥½äº†å¾Œï¼Œé€²å…¥åˆ° poky è³‡æ–™å¤¾</p><pre class="example">coldnew@gentoo ~/poky $ cd poky</pre></div></div><div id="outline-container-org3e906b2" class="outline-2"><h2 id="org3e906b2">ä¸‹è¼‰ meta-xilinx</h2><div class="outline-text-2" id="text-org3e906b2"><p>Yocto å°æ–¼ä¸åŒçš„ SoC å» å•†ï¼Œæœƒæœ‰æä¾›ä¸åŒçš„ layer ä¾†å°ç‰¹å®šçš„é–‹æºç¨‹å¼åŠ ä¸Šåˆé©çš„ patchï¼Œæˆ–æ˜¯æ·»åŠ ä¸åŒ SoC å» å„è‡ªéœ€è¦çš„éŸŒé«”(firmware)ï¼Œä»¥åŠå„é–‹ç™¼æ¿ç‰¹å®šçš„è¨­å®šã€‚åœ¨ Xilinx å¹³å°ä¸Šï¼Œæˆ‘å€‘éœ€è¦ä¸‹è¼‰ <code>meta-xilinx</code> ï¼Œæˆ‘å€‘éœ€è¦çš„ kernel ä»¥åŠ Zybo board çš„è¨­å®šè³‡è¨Šéƒ½åœ¨è£¡é¢ã€‚</p><p>é€™é‚Šä¸€æ¨£åˆ‡æ›åˆ° <code>krogoth</code> é€™å€‹åˆ†æ”¯(branch)</p><pre class="example">coldnew@gentoo ~/poky $ git clone git://github.com/Xilinx/meta-xilinx -b krogoth</pre></div></div><div id="outline-container-orgac95813" class="outline-2"><h2 id="orgac95813">åˆ‡æ›åˆ°ç·¨è­¯ç”¨ç›®éŒ„</h2><div class="outline-text-2" id="text-orgac95813"><p>æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘å°‡é€é <code>source</code> æŒ‡ä»¤æš«æ™‚ä¿®æ”¹ç•¶å‰ shell çš„ç’°å¢ƒè®Šæ•¸ï¼Œä¸¦åˆ‡æ›åˆ° <code>build</code> è³‡æ–™å¤¾</p><pre class="example">coldnew@gentoo ~/poky $ source oe-init-build-env buildYou had no conf/local.conf file. This configuration file has therefore beencreated for you with some default values. You may wish to edit it to, forexample, select a different MACHINE (target hardware). See conf/local.conffor more information as common configuration options are commented.You had no conf/bblayers.conf file. This configuration file has therefore beencreated for you with some default values. To add additional metadata layersinto your configuration please add entries to conf/bblayers.conf.The Yocto Project has extensive documentation about OE including a referencemanual which can be found at:    http://yoctoproject.org/documentationFor more information about OpenEmbedded see their website:    http://www.openembedded.org/### Shell environment set up for builds. ###You can now run 'bitbake &lt;target&gt;'Common targets are:    core-image-minimal    core-image-sato    meta-toolchain    meta-ide-supportYou can also run generated qemu images with a command like 'runqemu qemux86'</pre><p>é è¨­çš„ç›®æ¨™æ©Ÿå™¨æ˜¯ <code>qemux86</code> å› æ­¤æˆ‘å€‘éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œä¸éå…ˆçœ‹ä¸€ä¸‹ç•¶å‰ç›®éŒ„çµæ§‹</p><pre class="example">coldnew@gentoo ~/poky/build $ tree  .. &lt;b&gt;â””â”€â”€ conf &lt;b&gt;    â”œâ”€â”€ bblayers.conf    â”œâ”€â”€ local.conf    â””â”€â”€ templateconf.cfg1 directory, 3 files</pre><p>æˆ‘å€‘é¦–å…ˆè¦ä¿®æ”¹ <code>conf/bblayers.conf</code> ï¼Œåœ¨ä¸Šé¢æ·»åŠ æˆ‘å€‘å‰›å‰›ä¸‹è¼‰çš„ <code>meta-xilinx</code> ï¼Œä¿®æ”¹å®Œæœƒåƒé€™æ¨£</p><div class="org-src-container"><pre class="src src-sh"><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">POKY_BBLAYERS_CONF_VERSION is increased each time build/conf/bblayers.conf</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">changes incompatibly</span>POKY_BBLAYERS_CONF_VERSION = <span style="color: #aadddd;">"2"</span>BBPATH = <span style="color: #aadddd;">"${TOPDIR}"</span>BBFILES ?= <span style="color: #aadddd;">""</span>BBLAYERS ?= <span style="color: #aadddd;">" \</span><span style="color: #aadddd;">  /home/coldnew/poky/meta \</span><span style="color: #aadddd;">  /home/coldnew/poky/meta-poky \</span><span style="color: #aadddd;">  /home/coldnew/poky/meta-yocto-bsp \</span><span style="color: #aadddd;">  /home/coldnew/poky/meta-xilinx \</span><span style="color: #aadddd;">  "</span></pre></div><p>æ¥ä¸‹ä¾†ï¼Œä¿®æ”¹ <code>conf/local.conf</code> ï¼Œé€™ä»½æª”æ¡ˆå¯ä»¥ç”¨ä¾†è¨­å®šè¦ç·¨è­¯çš„ç›®æ¨™æ©Ÿå™¨ï¼Œåœ¨é€™é‚Šï¼Œæˆ‘å€‘å°‡ç›®æ¨™æ©Ÿå™¨æ”¹æˆ <code>zybo-linux-bd-zynq7</code></p><div class="org-src-container"><pre class="src src-sh">MACHINE ??= <span style="color: #aadddd;">"zybo-linux-bd-zynq7"</span></pre></div><p>éƒ½æ”¹å¥½äº†å¾Œï¼Œå°±å¯ä»¥é–‹å§‹æº–å‚™ç·¨è­¯äº†</p></div></div><div id="outline-container-org5bae90e" class="outline-2"><h2 id="org5bae90e">ç·¨è­¯ core-image-minimal</h2><div class="outline-text-2" id="text-org5bae90e"><p>Yocto ä¸‹æœ‰è¨±å¤šé è¨­çš„ image å¯ä»¥é€²è¡Œç·¨è­¯ï¼Œå…¶ä¸­æœ€åŸºæœ¬çš„ image å°±æ˜¯ <code>core-image-minimal</code> äº†ï¼Œè£¡é¢åªæœƒåŒ…å«ä¸€äº›å¹¾æœ¬çš„çµ„ä»¶è€Œå·²ï¼Œæˆ‘å€‘å¯ä»¥é€éä»–ä¾†ç¢ºèªæˆ‘å€‘ç·¨è­¯å‡ºä¾†çš„ rootfs æ˜¯å¦èƒ½ç”¨ã€‚</p><pre class="example">coldnew@gentoo ~/poky/build $ bitbake core-image-minimalParsing recipes: 100% |#######################################################################################################################| Time: 00:01:03Parsing of 883 .bb files complete (0 cached, 883 parsed). 1313 targets, 71 skipped, 0 masked, 0 errors.NOTE: Resolving any missing task queue dependenciesBuild Configuration:BB_VERSION        = "1.30.0"BUILD_SYS         = "x86_64-linux"NATIVELSBSTRING   = "Gentoo-2.3"TARGET_SYS        = "arm-poky-linux-gnueabi"MACHINE           = "zybo-linux-bd-zynq7"DISTRO            = "poky"DISTRO_VERSION    = "2.1.1"TUNE_FEATURES     = "arm armv7a vfp thumb neon       callconvention-hard       cortexa9"TARGET_FPU        = "hard"metameta-pokymeta-yocto-bsp    = "krogoth:aad7166704021d82ad3a5ec468552f8f10360d41"meta-xilinx       = "krogoth:dcd1c218f943c3657b138cb05012c90c65f32a35"NOTE: Fetching uninative binary shim from http://downloads.yoctoproject.org/releases/uninative/1.0.1/x86_64-nativesdk-libc.tar.bz2;sha256sum=acf1e44a0ac2e855e81da6426197d36358bf7b4e88e552ef933128498c8910f8NOTE: Preparing RunQueueNOTE: Executing SetScene TasksNOTE: Executing RunQueue TasksCurrently 4 running tasks (78 of 2127):0: gcc-source-5.3.0-5.3.0-r0 do_unpack (pid 10582)1: m4-native-1.4.17-r0 do_configure (pid 14097)2: binutils-cross-arm-2.26-r0 do_unpack (pid 14533)3: glibc-initial-2.23-r0 do_fetch (pid 15428)</pre><p>æ¥ä¸‹ä¾†å› ç‚ºé€™æ˜¯ç¬¬ä¸€æ¬¡ç·¨è­¯ï¼ŒYocto éœ€è¦ä¸‹è¼‰åŸå§‹ç¢¼ä»¥åŠé€²è¡Œç·¨è­¯ï¼ŒæœƒèŠ±å¾ˆå¤šæ™‚é–“ï¼Œæ‰€ä»¥é€™æ™‚å€™å¯ä»¥å»ç¡å€‹è¦ºæˆ–æ˜¯çœ‹çœ‹æ›¸ç­‰å®ƒç·¨è­¯å®Œæˆï¼Œç¬¬äºŒæ¬¡ç·¨è­¯å¾Œæœƒå› ç‚ºæœ‰å¿«å–æ©Ÿåˆ¶ (cache)ï¼Œå°±ä¸é ˆè¦èŠ±é€™æ¨£å¤šçš„æ™‚é–“ä¾†é€²è¡Œç·¨è­¯å›‰~</p><p>ç·¨è­¯å¥½äº†ä»¥å¾Œï¼Œæˆ‘å€‘åˆ‡å…¥åˆ° <code>tmp/deploy/images/zybo-linux-bd-zynq7/</code> è³‡æ–™å¤¾ï¼Œè£¡é¢æœ‰çš„å°±æ˜¯æˆ‘å€‘éœ€è¦çš„æª”æ¡ˆ</p><pre class="example">coldnew@gentoo ~/poky/build $ ls tmp/deploy/images/zybo-linux-bd-zynq7/bitstream                                                                    modules--4.4-xilinx+git0+89cc643aff-r0-zybo-linux-bd-zynq7-20160910030958.tgzbitstream-+gitAUTOINC+63ca49fe02-r0.bit                                      modules-zybo-linux-bd-zynq7.tgzboot.bin                                                                     README_-_DO_NOT_DELETE_FILES_IN_THIS_DIRECTORY.txtboot.bin-zybo-linux-bd-zynq7                                                 u-boot-dtb.imgboot.bin-zybo-linux-bd-zynq7-v2016.03+gitAUTOINC+df61a74e68-r0               u-boot.elfcore-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.cpio            u-boot-zybo-linux-bd-zynq7.elfcore-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.cpio.gz.u-boot  u-boot-zybo-linux-bd-zynq7.imgcore-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.manifest        u-boot-zybo-linux-bd-zynq7-v2016.03+gitAUTOINC+df61a74e68-r0.elfcore-image-minimal-zybo-linux-bd-zynq7-20160910030958.rootfs.tar.gz          u-boot-zybo-linux-bd-zynq7-v2016.03+gitAUTOINC+df61a74e68-r0.imgcore-image-minimal-zybo-linux-bd-zynq7.cpio                                  uImagecore-image-minimal-zybo-linux-bd-zynq7.cpio.gz.u-boot                        uImage--4.4-xilinx+git0+89cc643aff-r0-zybo-linux-bd-zynq7-20160910030958.bincore-image-minimal-zybo-linux-bd-zynq7.manifest                              uImage-zybo-linux-bd-zynq7.bincore-image-minimal-zybo-linux-bd-zynq7.tar.gz                                zybo-linux-bd-zynq7.dtbdownload.bit</pre><p>æˆ‘å€‘å°‡ä»¥ä¸‹é€™äº›æª”æ¡ˆè¤‡è£½åˆ° SD å¡çš„ç¬¬ä¸€å€‹åˆ†å€</p><pre class="example">bitstream  boot.bin  u-boot-dtb.img  uImage  zybo-linux-bd-zynq7.dtb</pre><p>æ¥ä¸‹ä¾†ï¼Œåœ¨ SD å¡çš„ç¬¬ä¸€å€‹åˆ†å‰²å€ (fat32) å»ºç«‹ <code>uEnv.txt</code> æª”æ¡ˆï¼Œç”¨ä¾†å‘Šè¨´ u-boot é–‹æ©Ÿçš„æ–¹å¼</p><div class="org-src-container"><pre class="src src-sh"><span style="color: #aaccff;">kernel_image</span>=uImage<span style="color: #aaccff;">devicetree_image</span>=zybo-linux-bd-zynq7.dtb<span style="color: #aaccff;">bootargs</span>=<span style="color: #aaccff;">root</span>=/dev/mmcblk0p2 rw rootwait<span style="color: #aaccff;">uenvcmd</span>=fatload mmc 0 0x3000000 $<span style="color: #aadddd;">{</span><span style="color: #aaccff;">kernel_image</span><span style="color: #aadddd;">}</span> &amp;&amp; fatload mmc 0 0x2A00000 $<span style="color: #aadddd;">{</span><span style="color: #aaccff;">devicetree_image</span><span style="color: #aadddd;">}</span> &amp;&amp; bootm 0x3000000 - 0x2A00000</pre></div><p>å¥½äº†å¾Œï¼Œå°‡ <code>core-image-minimal-zybo-linux-bd-zynq7.tar.gz</code> è§£å£“ç¸®åˆ° SD å¡çš„ç¬¬äºŒå€‹åˆ†å‰²å€</p><pre class="example">coldnew@gentoo /tmp/sdc2 $ sudo tar xvf ~/poky/build/tmp/deploy/images/zybo-linux-bd-zynq7/core-image-minimal-zybo-linux-bd-zynq7.tar.gz</pre><p>å¦‚æœä½ éœ€è¦ kernel modules çš„è©±ï¼Œå°‡ <code>modules-zybo-linux-bd-zynq7.tgz</code> è§£å£“åˆ° SD å¡çš„ç¬¬äºŒå€‹åˆ†å‰²å€</p><pre class="example">coldnew@gentoo /tmp/sdc2 $ sudo tar xvf ~/poky/build/tmp/deploy/images/zybo-linux-bd-zynq7/modules-zybo-linux-bd-zynq7.tgz</pre><p>è‡³æ­¤ï¼Œæˆ‘å€‘ SD å¡é–‹æ©Ÿçš„æº–å‚™å·²ç¶“å®Œæˆ!!</p></div></div><div id="outline-container-org1169ad2" class="outline-2"><h2 id="org1169ad2">æ¸¬è©¦é–‹æ©Ÿèˆ‡çµæœ</h2><div class="outline-text-2" id="text-org1169ad2"><p>æ˜¯æ™‚å€™ä¾†æ¸¬è©¦çµæœäº†ï¼Œè¦æ³¨æ„åˆ°ä½ çš„ Zybo Board çš„ <code>JP5</code> è¦è¨­å®šæˆä¸‹é¢é€™æ¨£ï¼Œé€™æ¨£çµ¦é›»æ™‚ï¼ŒZynq æ‰æœƒè®€å– SD å¡ä¸Šé¢çš„ u-boot ä¸¦å°‡ä½å…ƒæµ (bitstream) ç‡’éŒ„åˆ° FPGA ä¸­ã€‚</p><div class="figure"><p><img src="sdboot.png"></p></div><p>æ’å…¥å‰›å‰›å»ºç«‹å¥½çš„ SD å¡ï¼Œä¸¦æä¾›é›»æºå¾Œï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨å¯ä»¥æ¥æ”¶ UART ç›¸é—œçš„ç¨‹å¼ï¼Œå¦‚ gtktermã€teratermã€screenã€emacs ç­‰ï¼Œå•Ÿå‹•å®ƒä¸¦é–‹å•Ÿ <code>/dev/ttyUSB1</code> å¾Œï¼Œè¨­å®š baudrate ç‚º <code>115200</code> ï¼Œå°±å¯ä»¥çœ‹åˆ°é–‹æ©Ÿä¸¦é€²å…¥åˆ° rootfs å›‰ã€‚</p><div class="figure"><p><img src="console.png"></p></div></div></div><div id="outline-container-orgc5cf1f6" class="outline-2"><h2 id="orgc5cf1f6">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-orgc5cf1f6"><p><code>[1]</code> <a href="https://github.com/Xilinx/meta-xilinx/blob/master/README.booting.md" target="_blank" rel="external">Booting meta-xilinx boards</a></p><p><code>[2]</code> <a href="http://www.yoctoproject.org/docs/2.0/ref-manual/ref-manual.html" target="_blank" rel="external">Yocto Project Reference Manual</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/c3e8558e/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board é–‹ç™¼è¨˜éŒ„: åŸ·è¡Œ Linux ä½œæ¥­ç³»çµ±</title>
      <link>https://coldnew.github.io/d9dfdd56/</link>
      <guid>https://coldnew.github.io/d9dfdd56/</guid>
      <pubDate>Sun, 17 Jul 2016 11:45:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
åœ¨ &lt;a href=&quot;http://coldnew.github.io/zybo-board/zynq_led_flash/&quot;&gt;zybo board é–‹ç™¼è¨˜éŒ„: Zynq èˆ‡ LED é–ƒçˆæ§åˆ¶&lt;/a&gt; ä¸€æ–‡ä¸­æˆ‘å€‘è«‡åˆ°äº†å¦‚ä½•é€é C èªè¨€æ’°å¯«ç¨ç«‹çš„ç¨‹å¼ï¼Œè®“å®ƒæ§åˆ¶ Zynq çš„è™•ç†å™¨ç³»çµ± (Processing System, PS) å»é–ƒçˆ LED çš„äº®æš—ã€‚æ—¢ç„¶ Zynq çš„è™•ç†å™¨ç³»çµ± (Processing System, PS) ä½¿ç”¨çš„æ˜¯ ARM Cortex-A9 çš„è™•ç†å™¨ï¼Œé‚£ç•¶ç„¶ä¹Ÿå¯ä»¥è®“æˆ‘å€‘è·‘ Linux åœ¨ Zybo Board ä¸Šã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>åœ¨ <a href="http://coldnew.github.io/zybo-board/zynq_led_flash/">zybo board é–‹ç™¼è¨˜éŒ„: Zynq èˆ‡ LED é–ƒçˆæ§åˆ¶</a> ä¸€æ–‡ä¸­æˆ‘å€‘è«‡åˆ°äº†å¦‚ä½•é€é C èªè¨€æ’°å¯«ç¨ç«‹çš„ç¨‹å¼ï¼Œè®“å®ƒæ§åˆ¶ Zynq çš„è™•ç†å™¨ç³»çµ± (Processing System, PS) å»é–ƒçˆ LED çš„äº®æš—ã€‚æ—¢ç„¶ Zynq çš„è™•ç†å™¨ç³»çµ± (Processing System, PS) ä½¿ç”¨çš„æ˜¯ ARM Cortex-A9 çš„è™•ç†å™¨ï¼Œé‚£ç•¶ç„¶ä¹Ÿå¯ä»¥è®“æˆ‘å€‘è·‘ Linux åœ¨ Zybo Board ä¸Šã€‚</p><a id="more"></a><p>æœ¬æ–‡å°‡ç°¡è¿°å¦‚ä½•è‡ªè¡Œç·¨è­¯ u-boot ä»¥åŠ Linux Kernelï¼Œä¸¦æ­é… Busybox è£½ä½œç°¡å–®çš„ RootFS åŸ·è¡Œæ–¼ Zybo Board ä¸Šã€‚</p><div id="outline-container-org851c71a" class="outline-2"><h2 id="org851c71a">é–‹ç™¼ç›®æ¨™</h2><div class="outline-text-2" id="text-org851c71a"><p>åœ¨é€™æ¬¡çš„é–‹ç™¼ä¸­ï¼Œæˆ‘å€‘è¦ç·¨è­¯ u-bootã€Linuxï¼Œä¸¦ä½¿ç”¨ Busybox è£½ä½œç°¡å–®çš„ Rootfs å¾Œï¼Œé€éè£½ä½œ SD å¡ä¾†è®“ Zybo Board é€é SD å¡é–‹æ©Ÿã€‚</p><p>è¦æ³¨æ„åˆ°çš„æ˜¯ï¼Œç”±æ–¼æˆ‘å€‘è¦é€é SD å¡é–‹æ©Ÿé€²å…¥åˆ° Linux ç³»çµ±ï¼Œå› æ­¤æˆ‘å€‘è¦é€é <code>JP5</code> å»æ›´æ”¹é–‹æ©Ÿæ¨¡å¼ã€‚</p><div class="figure"><p><img src="zybo_config_pins.png"></p></div></div></div><div id="outline-container-org949ea4b" class="outline-2"><h2 id="org949ea4b">äº†è§£é–‹æ©Ÿæµç¨‹</h2><div class="outline-text-2" id="text-org949ea4b"><p>æ—¢ç„¶æˆ‘å€‘è¦è®“ Zybo board åŸ·è¡Œ Linux ç³»çµ±ï¼Œå°±è¦å…ˆä¾†äº†è§£ä¸€ä¸‹é–‹æ©Ÿæµç¨‹ï¼Œæ‰çŸ¥é“æˆ‘å€‘å¤§æ¦‚éœ€è¦æº–å‚™å“ªäº›æ±è¥¿ã€‚å¾  <a href="http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_1/ug1165-zynq-embedded-design-tutorial.pdf" target="_blank" rel="external">Zynq-7000 All Programmable SoC: Embedded Design Tutorial - A Hands-On Guide to Effective Embedded System Design (UG1165)</a> å¯ä»¥çœ‹åˆ° Zynq-7000 åŸ·è¡Œ Linux ç³»çµ±çš„é–‹æ©Ÿæµç¨‹åœ–ã€‚</p><div class="figure"><p><img src="bootp.png"></p></div><p>ä¹Ÿå°±æ˜¯èªªï¼Œç•¶é–‹å§‹æä¾›é›»æºçµ¦ Zynq è™•ç†å™¨ç³»çµ± (Processing System, PS) ä¸¦å®Œæˆé‡ç½®(reset) å¾Œï¼ŒZynq å…§å»ºçš„ Boot ROM æœƒå»è¼‰å…¥ <code>ç¬¬ä¸€éšæ®µé–‹æ©Ÿç¨‹å¼ (First Stage Boot Loader, FSBL)</code> ï¼Œæ¥è‘—è¼‰å…¥ <code>ä½å…ƒæµ (bitstream)</code> å»åˆå§‹åŒ–æ•´å€‹ <code>å¯ç¨‹å¼é‚è¼¯(Programmable Logic, PL)</code> ã€‚ å®Œæˆå¾Œï¼Œæ¥ä¸‹ä¾†å°±æ˜¯é€é U-Boot å»è¼‰å…¥ Linux Kernelã€Device Tree ä»¥åŠ Root File Systemã€‚</p><p>äº†è§£äº†é€™å€‹ï¼Œæˆ‘å€‘å°±çŸ¥é“æˆ‘å€‘å¤§æ¦‚è¦æº–å‚™å“ªäº›æ±è¥¿äº†ã€‚</p></div></div><div id="outline-container-orga4e8bd5" class="outline-2"><h2 id="orga4e8bd5">è¨­å®šå¥½ç’°å¢ƒ</h2><div class="outline-text-2" id="text-orga4e8bd5"><p>åœ¨å®‰è£ç© Vivado èˆ‡ Xilinx SDK å¾Œï¼Œå¯¦éš›ä¸ŠåŒ…å« Zynq åœ¨ç”¨çš„ ARM toolchain äº¦åŒæ™‚è¢«å®‰è£åˆ°ç³»çµ±ä¸­ï¼Œæˆ‘å€‘åªè¦ä½¿ç”¨ <code>source</code> å‘½ä»¤å³å¯è®“ç•¶å‰çš„ç’°å¢ƒçŸ¥é“ xilinx-arm toolchain çš„è·¯å¾‘ã€‚é€™é‚Šä»¥ Viavdo 2016.2 ä½œç‚ºç¯„ä¾‹ã€‚</p><pre class="example">coldnew@gentoo ~ $ source /opt/Xilinx/Vivado/2016.2/settings64.sh</pre><p>é€™æ¨£å°±å¯ä»¥ç²å¾— arm-xilinx-* toolchain çš„å‘½ä»¤ï¼Œå¯¦éš›ä¸Šæœ‰å“ªäº›å‘¢? è¼¸å…¥å€‹ arm-xilinx- æŒ‰ä¸‹ TAB çœ‹çœ‹</p><pre class="example">coldnew@gentoo ~ $ arm-xilinx-arm-xilinx-eabi-addr2line            arm-xilinx-eabi-gcc-4.9.2            arm-xilinx-eabi-objcopyarm-xilinx-linux-gnueabi-ar          arm-xilinx-linux-gnueabi-gcc-ar      arm-xilinx-linux-gnueabi-objdumparm-xilinx-eabi-ar                   arm-xilinx-eabi-gcc-ar               arm-xilinx-eabi-objdumparm-xilinx-linux-gnueabi-as          arm-xilinx-linux-gnueabi-gcc-nm      arm-xilinx-linux-gnueabi-ranlibarm-xilinx-eabi-as                   arm-xilinx-eabi-gcc-nm               arm-xilinx-eabi-ranlibarm-xilinx-linux-gnueabi-c++         arm-xilinx-linux-gnueabi-gcc-ranlib  arm-xilinx-linux-gnueabi-readelfarm-xilinx-eabi-c++                  arm-xilinx-eabi-gcc-ranlib           arm-xilinx-eabi-readelfarm-xilinx-linux-gnueabi-c++filt     arm-xilinx-linux-gnueabi-gcov        arm-xilinx-linux-gnueabi-sizearm-xilinx-eabi-c++filt              arm-xilinx-eabi-gcov                 arm-xilinx-eabi-sizearm-xilinx-linux-gnueabi-cpp         arm-xilinx-linux-gnueabi-gdb         arm-xilinx-linux-gnueabi-spritearm-xilinx-eabi-cpp                  arm-xilinx-eabi-gdb                  arm-xilinx-eabi-spritearm-xilinx-linux-gnueabi-elfedit     arm-xilinx-linux-gnueabi-gprof       arm-xilinx-linux-gnueabi-stringsarm-xilinx-eabi-elfedit              arm-xilinx-eabi-gprof                arm-xilinx-eabi-stringsarm-xilinx-linux-gnueabi-g++         arm-xilinx-linux-gnueabi-ld          arm-xilinx-linux-gnueabi-striparm-xilinx-eabi-g++                  arm-xilinx-eabi-ld                   arm-xilinx-eabi-striparm-xilinx-linux-gnueabi-gcc         arm-xilinx-linux-gnueabi-nmarm-xilinx-eabi-gcc                  arm-xilinx-eabi-nm                   arm-xilinx-linux-gnueabi-addr2linearm-xilinx-linux-gnueabi-gcc-4.9.2   arm-xilinx-linux-gnueabi-objcopy</pre><p>å¦‚æœä½ ç³»çµ±ä¸Šå·²ç¶“æœ‰å…¶ä»–çš„ ARM toolchain çš„è©±ï¼Œå¯ä»¥è€ƒæ…®è·³éé€™ä¸€æ­¥é©Ÿï¼Œæ¥ä¸‹ä¾†è¦æ ¼å¼åŒ– Micro SD å¡ã€‚</p></div></div><div id="outline-container-org50cea4e" class="outline-2"><h2 id="org50cea4e">æ ¼å¼åŒ– MicroSD å¡</h2><div class="outline-text-2" id="text-org50cea4e"><p>åœ¨é€™æ¬¡çš„é–‹ç™¼ä¸­ï¼Œæˆ‘å€‘è¦è¨­å®š MicroSD å¡ç‰‡æˆå…©å€‹åˆ†å€ï¼Œç¬¬ä¸€å€‹æ˜¯ <code>fat32</code> æ ¼å¼ï¼Œç¬¬äºŒå€‹å‰‡ä½¿ç”¨ <code>ext4</code> æ ¼å¼ï¼Œè‹¥ä¸æœƒä½¿ç”¨ <code>fdisk</code> å‘½ä»¤çš„è©±ï¼Œå¯ä»¥é€é <code>gparted</code> ä¾†é€²è¡Œæ ¼å¼åŒ–ï¼Œä»¥ä¸‹æ˜¯æˆ‘æ ¼å¼åŒ–å¡ç‰‡çš„ç¯„ä¾‹ (8GB å¡ç‰‡)ã€‚</p><div class="figure"><p><img src="format.png"></p></div><p>(å¯¦éš›ä¸Šåœ¨æœ¬æ–‡çš„ç¯„ä¾‹ä¸­ï¼Œåªæœƒç”¨åˆ°ç¬¬ä¸€å€‹åˆ†å€ï¼Œç¬¬äºŒå€‹åˆ†å€æ˜¯ç‚ºäº†å¾€å¾Œæ–‡ç« è¦é–‹æ©Ÿåˆ°å¤§ä¸€é»çš„ rootfs æº–å‚™çš„ã€‚)</p></div></div><div id="outline-container-org1a181fa" class="outline-2"><h2 id="org1a181fa">ç·¨è­¯ u-boot</h2><div class="outline-text-2" id="text-org1a181fa"><p>æˆ‘å€‘é¦–å…ˆå» <a href="https://github.com/DigilentInc/u-boot-Digilent-Dev" target="_blank" rel="external">GitHub</a> ä¸‹è¼‰ DigilentInc åŠ å…¥ zybo board å¾Œçš„ u-boot ç‰ˆæœ¬ï¼Œè¦æ³¨æ„é€™é‚Šè¦é¸æ“‡ <code>master-next</code> åˆ†æ”¯ã€‚</p><div class="org-src-container"><pre class="src src-sh">git clone https://github.com/DigilentInc/u-boot-Digilent-Dev.git -b master-next</pre></div><p>å®Œæˆå¾Œé€²å…¥åˆ°è©²è³‡æ–™å¤¾</p><pre class="example">coldnew@gentoo ~ $ cd u-boot-Digilent-Dev</pre><p>ç·¨è­¯ u-bootï¼Œè¨˜å¾—æŒ‡æ´¾ç·¨è­¯ç›®æ¨™ç‚º <code>zynq_zybo_config</code></p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/u-boot-Digilent-Dev $ <span style="color: #aaccff;">CROSS_COMPILE</span>=arm-xilinx-linux-gnueabi- make zynq_zybo_configcoldnew@gentoo ~/u-boot-Digilent-Dev $ <span style="color: #aaccff;">CROSS_COMPILE</span>=arm-xilinx-linux-gnueabi- make</pre></div><p>ç·¨è­¯å®Œæˆå¾Œï¼Œæ³¨æ„ä¸€ä¸‹ <code>u-boot</code> é€™å€‹æª”æ¡ˆï¼Œä»–å°±æ˜¯æˆ‘å€‘ç­‰ç­‰è¦ç”¨åˆ°çš„ u-boot åŸ·è¡Œæª”ï¼Œä¸éç”±æ–¼ Xilinx Tool è¦æ‰¾æœ‰ .elf å‰¯æª”åçš„æª”æ¡ˆï¼Œå› æ­¤æˆ‘å€‘æŠŠå®ƒè¤‡è£½æˆ <code>u-boot.elf</code> ã€‚</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/u-boot-Digilent-Dev $ cp u-boot u-boot.elf</pre></div></div></div><div id="outline-container-org1487b06" class="outline-2"><h2 id="org1487b06">ç·¨è­¯ Linux kernel</h2><div class="outline-text-2" id="text-org1487b06"><p>ç·¨è­¯å¥½ u-boot å¾Œï¼Œæ¥ä¸‹ä¾†å°±æ˜¯ç·¨è­¯ Linux Kernel äº†ï¼Œæˆ‘å€‘ä¸€æ¨£é¸æ“‡ DigilentInc åŠ å…¥ zybo board å¾Œçš„ Linux Kernel ç‰ˆæœ¬ï¼Œè¨˜å¾—è¦é¸ <code>master-next</code> åˆ†æ”¯ã€‚</p><div class="org-src-container"><pre class="src src-sh">git clone https://github.com/DigilentInc/Linux-Digilent-Dev.git -b master-next</pre></div><p>æ¥è‘—ï¼Œç•¶ç„¶å°±æ˜¯ç·¨è­¯äº†ï¼Œä¸éåœ¨é€™ä¹‹å‰è«‹å…ˆç¢ºå®šä½ æœ‰è£ <code>u-boot-tools</code> é€™å¥—ä»¶ï¼Œæˆ‘å€‘éœ€è¦è£¡é¢çš„ mkimage æŒ‡ä»¤ï¼ŒGentoo Linux å¯ä»¥ç›´æ¥ç”¨ä»¥ä¸‹å‘½ä»¤ä¾†å®‰è£ã€‚</p><pre class="example">coldnew@gentoo ~ $ sudo emerge dev-embedded/u-boot-tools</pre><p>å®Œæˆå¾Œé€²å…¥ Linux Kernel è³‡æ–™å¤¾</p><pre class="example">coldnew@gentoo ~ $ cd Linux-Digilent-Dev</pre><p>ç·¨è­¯æˆ‘å€‘éœ€è¦çš„ <code>uImage</code> æ–‡ä»¶ï¼Œè¨˜å¾—è¦æŒ‡å®š config ç‚º <code>xilinx_zynq_defconfig</code> ä»¥åŠè¨­å®š <code>UIMAGE_LOADADDR</code> ç‚º <code>0x8000</code> ã€‚</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/Linux-Digilent-Dev $ <span style="color: #aaccff;">ARCH</span>=arm <span style="color: #aaccff;">CROSS_COMPILE</span>=arm-xilinx-linux-gnueabi- make xilinx_zynq_defconfigcoldnew@gentoo ~/Linux-Digilent-Dev $ <span style="color: #aaccff;">ARCH</span>=arm <span style="color: #aaccff;">CROSS_COMPILE</span>=arm-xilinx-linux-gnueabi- makecoldnew@gentoo ~/Linux-Digilent-Dev $ <span style="color: #aaccff;">ARCH</span>=arm <span style="color: #aaccff;">CROSS_COMPILE</span>=arm-xilinx-linux-gnueabi- make <span style="color: #aaccff;">UIMAGE_LOADADDR</span>=0x8000 uImagecoldnew@gentoo ~/Linux-Digilent-Dev $ <span style="color: #aaccff;">ARCH</span>=arm <span style="color: #aaccff;">CROSS_COMPILE</span>=arm-xilinx-linux-gnueabi- make zynq-zybo.dtb</pre></div><p>ç·¨è­¯å®Œå¾Œï¼Œæˆ‘å€‘æœƒéœ€è¦ <code>arch/arm/boot/uImage</code> ä»¥åŠ <code>arch/arm/boot/dts/zynq-zybo.dtb</code> é€™å…©å€‹æª”æ¡ˆï¼Œå¾Œè€…å°±æ˜¯ device tree ç·¨è­¯å‡ºä¾†çš„è³‡æ–™æª”ã€‚</p><p>ç”±æ–¼æ”¾å…¥åˆ° SD å¡ä¸Šçš„ device tree æª”æ¡ˆåç¨±ç‚º <code>devicetree.dtb</code> ï¼Œå› æ­¤é€™é‚Šå°‡ <code>zynq-zybo.dtb</code> æ”¹ä¸€ä¸‹åã€‚</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/Linux-Digilent-Dev $ cp arch/arm/boot/dts/zynq-zybo.dtb devicetree.dtb</pre></div><p>å¦‚æœä½ æƒ³æ‰‹å‹•ä¿®æ”¹ Device Tree ä¸¦å†é‡æ–°ç·¨è­¯çš„è©±ï¼Œä¹Ÿå¯ä»¥é€™æ¨£å»ç”¢ç”Ÿæˆ‘å€‘è¦çš„ <code>devicetree.dtb</code> ã€‚</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/Linux-Digilent-Dev $ ./scripts/dtc/dtc -I dts -O dtb -o devicetree.dtb arch/arm/boot/dts/zynq-zybo.dts</pre></div></div></div><div id="outline-container-org4fc88c9" class="outline-2"><h2 id="org4fc88c9">ç·¨è­¯ BusyBox</h2><div class="outline-text-2" id="text-org4fc88c9"><p><a href="http://www.busybox.net/" target="_blank" rel="external">Busybox</a> æ˜¯ä¸€å€‹éå¸¸æœ‰è¶£çš„ç¨‹å¼ï¼Œèˆ‰å‡¡æˆ‘å€‘åœ¨ Linux ä¸‹æœ€å¸¸ç”¨çš„å‘½ä»¤å¦‚ lsã€cd ç­‰åˆ° sedã€vi ä»–éƒ½å…·æœ‰ç›¸å°æ‡‰çš„ç°¡å–®å¯¦ç¾ï¼Œæ­¤å¤–ï¼Œé€™äº›å‘½ä»¤å¯¦éš›ä¸Šéƒ½åªæ˜¯ä¸€å€‹è»Ÿé€£çµ (symlink) é€£çµåˆ°åç‚º busybox çš„åŸ·è¡Œæª”ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œå¦‚æœæˆ‘å€‘å°‡ busybox é€²è¡Œéœæ…‹ç·¨è­¯ (static link)ï¼Œå‰‡è£½ä½œå‡ºä¾†çš„ç³»çµ±æ•´é«”å¤§å°å¤§ç´„ç‚º 2 MB (kernel) + 1.4 MB (busybox)ï¼Œè€Œé€™å€‹ç³»çµ±å»åˆå¯ä»¥å…·æœ‰è¨±å¤š UN*X ä¸‹çš„å¸¸ç”¨å‘½ä»¤ï¼Œä¹Ÿå› æ­¤ busybox å¾ˆå¸¸ç”¨æ–¼ç©ºé–“æœ‰é™çš„ç³»çµ±ã€‚</p><p>æˆ‘å€‘åœ¨é€™å€‹é–‹ç™¼éç¨‹ä¸­ï¼Œç”±æ–¼åªæ˜¯é©—è­‰åŸ·è¡Œ Linux ç³»çµ±çš„åŠŸèƒ½ï¼Œå› æ­¤é¸ç”¨ Busybox ä¾†ä½œç‚ºæˆ‘å€‘çš„ rootfsã€‚</p><p>é¦–å…ˆå…ˆä¸‹è¼‰ Busybox çš„åŸå§‹ç¢¼ï¼Œé€™è£¡é¸ç”¨ <code>1_25_stable</code> é€™å€‹ç©©å®šåˆ†æ”¯</p><div class="org-src-container"><pre class="src src-sh">git clone git://git.busybox.net/busybox -b 1_25_stable</pre></div><p>é€²è¡Œæˆ‘å€‘è‡ªå·±çš„è¨­å®š</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/busybox $ <span style="color: #aaccff;">ARCH</span>=arm <span style="color: #aaccff;">CROSS_COMPILE</span>=arm-xilinx-linux-gnueabi- make menuconfig</pre></div><p>åœ¨é€²è¡Œè¨­å®šæ™‚æœ‰ä»¥ä¸‹å¹¾é»è¦ç¢ºå¯¦æ³¨æ„ï¼Œæˆ‘å€‘è¦å°‡ busybox ç·¨è­¯ç‚ºéœæ…‹é€£çµï¼Œä¸¦ä¸”å¢åŠ  <code>init</code> åŠŸèƒ½ï¼Œä¸»è¦è¨­å®šå¦‚ä¸‹:</p><pre class="example">Busybox Settings  ---&gt;        Build Options  ---&gt;               [*] Build BusyBox as a static binary (no shared libs)Init Utilities  ---&gt;        [*] initLogin/Password Management Utilities  ---&gt;        [*] gettyShells  ---&gt;        [*] ash</pre><p>è¨­å®šå®Œæˆå¾Œé–‹å§‹é€²è¡Œç·¨è­¯</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/busybox $ <span style="color: #aaccff;">ARCH</span>=arm <span style="color: #aaccff;">CROSS_COMPILE</span>=arm-xilinx-linux-gnueabi- make</pre></div><p>ç·¨è­¯å®Œæˆå¾Œé€é <code>make install</code> å‘½ä»¤ï¼Œæœƒå°‡ç·¨è­¯å‡ºä¾†çš„ busybox èˆ‡è»Ÿé€£çµ(symlink)ç”¢ç”Ÿåœ¨ <code>_install</code> è³‡æ–™å¤¾å…§</p><div class="org-src-container"><pre class="src src-sh">coldnew@Rosia ~/busybox $ <span style="color: #aaccff;">ARCH</span>=arm <span style="color: #aaccff;">CROSS_COMPILE</span>=arm-xilinx-linux-gnueabi- make install</pre></div><p>å»ºç«‹ä¸€äº›ç¼ºå°‘çš„è³‡æ–™å¤¾ (/devã€/sys &#x2026;etc)</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/busybox $ cd _install &amp;&amp; mkdir -p proc sys dev etc/init.d root</pre></div><p>å»ºç«‹ <code>etc/init.d/rcS</code> ä½œç‚ºå•Ÿå‹•è…³æœ¬ï¼Œä¸¦æ·»åŠ ä»¥ä¸‹å…§å®¹</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/busybox/_install $ vim etc/init.d/rcS<span style="color: #5f5f5f; font-style: italic;">#</span><span style="color: #9ac; font-style: italic;">!/bin/sh</span>mount -t proc none /procmount -t sysfs none /sys/sbin/mdev -s</pre></div><p>å°‡ <code>etc/init.d/rcS</code> åŠ å…¥å¯åŸ·è¡Œæ¬Šé™</p><pre class="example">coldnew@gentoo ~/busybox/_install $ chmod +x etc/init.d/rcS</pre><p>å»ºç«‹ <code>etc/inittab</code> ï¼Œé€™æœƒè®“æˆ‘å€‘å¯ä»¥é€é UART ç™»å…¥ zybo board</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/busybox/_install $ vim etc/inittab<span style="color: #5f5f5f; font-style: italic;">#</span><span style="color: #9ac; font-style: italic;">!/bin/sh</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">Init script</span>::sysinit:/etc/init.d/rcS<span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">Start shell on the serial ports</span>::respawn:/sbin/getty -L ttyPS0 115200 vt100<span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">What to do when restarting the init process</span>::restart:/sbin/init<span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">What to do before rebooting</span>::shutdown:/bin/umount -a -r</pre></div><p>è¨­å®šé è¨­çš„ <code>/etc/passwd</code> æª”æ¡ˆï¼Œæˆ‘å€‘è¦è®“ root ç”¨æˆ¶ç™»å…¥æ™‚ä¸ç”¨è¼¸å…¥å¯†ç¢¼</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/busybox/_install $ vim etc/passwdroot::0:0:root:/root:/bin/sh</pre></div><p>å»ºç«‹ <code>/init</code> ä¸¦è»Ÿé€£çµåˆ° <code>/sbin/init</code> ï¼Œé¿å… Linux Kernel é–‹æ©Ÿæ™‚æ‰¾ä¸åˆ° rootfs çš„ initã€‚</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~/busybox/_install $ ln -s /sbin/init init</pre></div><p>æ¥ä¸‹ä¾†ï¼Œç”±æ–¼é€™æ¬¡æˆ‘å€‘åªæ˜¯è¦é–‹æ©Ÿåˆ° ramdisk ä¸Šçš„ rootfs, å› æ­¤å°‡ busybox åšå‡ºçš„ rootfs æ‰“åŒ…æˆ cpio æ ¼å¼ã€‚</p><pre class="example">coldnew@gentoo ~/busybox/_install $ find . | sudo cpio -H newc -o | gzip -9 &gt; ../uramdisk.cpio.gz</pre><p>å†é€é <code>mkimage</code> å°‡é€™å€‹ <code>uramdisk.cpio.gz</code> æª”æ¡ˆè½‰æˆ uboot ç”¨çš„ <code>uramdisk.image.gz</code></p><pre class="example">coldnew@gentoo ~/busybox/_install $  mkimage -A arm -T ramdisk -C gzip -d ../uramdisk.cpio.gz ../uramdisk.image.gzImage Name:Created:      Sun Jul 17 19:02:08 2016Image Type:   ARM Linux RAMDisk Image (gzip compressed)Data Size:    1042106 Bytes = 1017.68 kB = 0.99 MBLoad Address: 00000000Entry Point:  00000000</pre><p>åœ¨é€™é‚Šçš„é€™å€‹ <code>uramdisk.image.gz</code> å°±æ˜¯æˆ‘å€‘é–‹æ©Ÿæœƒé€²å…¥åˆ°çš„ rootfsï¼Œä¹Ÿæ˜¯æˆ‘å€‘ç­‰ç­‰è¦æ”¾åˆ° SD å¡ç¬¬ä¸€å€‹ç£å€çš„æª”æ¡ˆã€‚</p></div></div><div id="outline-container-orgcca6e02" class="outline-2"><h2 id="orgcca6e02">ç·¨è­¯ä½å…ƒæµ (bitstream)</h2><div class="outline-text-2" id="text-orgcca6e02"><p>åœ¨ <a href="https://coldnew.github.io/zybo-board/linux_bd/">zybo board é–‹ç™¼è¨˜éŒ„: å‡ç´š Digilent æä¾›çš„è¨­è¨ˆæª”</a> ä¸€æ–‡ä¸­ï¼Œæˆ‘å€‘æåˆ°äº†æ€æ¨£å‡ç´š <a href="http://store.digilentinc.com/" target="_blank" rel="external">Digilent</a> æä¾›çš„é å…ˆå®šç¾©å¥½æ¥è…³çš„è¨­å®šæª” (zybo_base_system) ï¼Œé€™æ¬¡çš„å°ˆæ¡ˆï¼Œæˆ‘å€‘å°±ç›´æ¥ç”¨é€™å€‹è¨­å®šæª”æ¡ˆä¾†é€²è¡Œ Linux é–‹æ©Ÿçš„å‹•ä½œã€‚</p><p>é¦–å…ˆä½ å¿…é ˆæ ¹æ“šè©²ç¯‡æ–‡ç« ï¼Œå°‡ä½ çš„ Zybo board è¨­å®šæª”æ¡ˆå‡ç´šåˆ°ä½ ç”¨çš„ Vivado ç‰ˆæœ¬ï¼Œå®Œæˆå¾Œæˆ‘å€‘é‡æ–°å»ºç«‹ä¸€å€‹ä¹¾æ·¨çš„å°ˆæ¡ˆã€‚</p><p>å…ˆä¾†æŠŠå…ˆå‰ç”Ÿæˆçš„èˆŠå°ˆæ¡ˆæ¸…æ‰:</p><pre class="example">coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ sh cleanup.sh</pre><p>æ¥ä¸‹ä¾†ç”¨ Vivado 2016.2 é‡æ–°ç”Ÿå‡ºæ–°çš„å°ˆæ¡ˆ ~</p><pre class="example">coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ /opt/Xilinx/Vivado/2016.2/bin/vivado -mode batch -source create_project.tcl</pre><p>å®Œæˆå¾Œï¼Œæœƒçœ‹åˆ° <code>ZYBO/Projects/linux_bd/proj</code> ç›®éŒ„è®Šæˆé€™æ¨£:</p><pre class="example">coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ tree -L 1. &lt;b&gt;â”œâ”€â”€ cleanup.cmdâ”œâ”€â”€ cleanup.shâ”œâ”€â”€ create_project.tclâ”œâ”€â”€ ip_upgrade.log &lt;g&gt;â”œâ”€â”€ linux_bd.cache &lt;b&gt;â”œâ”€â”€ linux_bd.hw &lt;b&gt;â”œâ”€â”€ linux_bd.ip_user_files &lt;b&gt;â”œâ”€â”€ linux_bd.sim &lt;b&gt;â”œâ”€â”€ linux_bd.srcs &lt;b&gt;â”œâ”€â”€ linux_bd.xprâ”œâ”€â”€ vivado.jouâ””â”€â”€ vivado.log &lt;g&gt;5 directories, 7 files</pre><p>æˆ‘å€‘ä½¿ç”¨ Vivado æ‰“é–‹ <code>linux_bd.xpr</code> é€™å€‹å°ˆæ¡ˆã€‚</p><div class="figure"><p><img src="oprj.png"></p></div><p>å¦‚æœä½ æœ‰èˆˆè¶£çœ‹ä»–ç”Ÿå‡ºä¾†çš„ Block Design æ˜¯æ€æ¨£çš„ï¼Œä¹Ÿå¯ä»¥åˆ‡åˆ° Block Design é‚£é çœ‹çœ‹</p><div class="figure"><p><img src="linux_bd.png"></p></div><p>æˆ‘å€‘ç›´æ¥é»é¸ <code>Program and Debug -&gt; Generate Bitstream</code> ç”¢ç”Ÿæˆ‘å€‘è¦çš„ä½å…ƒæµ (bitstream)</p><div class="figure"><p><img src="ge.png"></p></div></div></div><div id="outline-container-org1f80839" class="outline-2"><h2 id="org1f80839">å»ºç«‹ FSBL</h2><div class="outline-text-2" id="text-org1f80839"><p>åˆ°æ­¤ï¼Œæˆ‘å€‘é™¤äº† <code>ç¬¬ä¸€éšæ®µé–‹æ©Ÿç¨‹å¼ (First Stage Boot Loader, FSBL)</code> å¤–ï¼Œå…¶ä»–çš„ç¨‹å¼éƒ½å·²ç¶“ç·¨è­¯å‡ºåŸ·è¡Œæª”äº†ï¼Œè®“æˆ‘å€‘ä¾†è™•ç† FSBL å§ã€‚</p><p>é¦–å…ˆé»é¸ <code>File -&gt; Export -&gt; Export hardware</code></p><div class="figure"><p><img src="e1.png"></p></div><p>è¨˜å¾—è¦å‹¾é¸ <code>Include bitstream</code></p><div class="figure"><p><img src="e2.png"></p></div><p>å®Œæˆå¾Œï¼ŒåŸ·è¡Œ Xilinx SDK</p><div class="figure"><p><img src="e3.png"></p></div><p>é€é <code>File -&gt; New -&gt; Application Project</code> å»å»ºç«‹æˆ‘å€‘çš„æ–°å°ˆæ¡ˆ</p><div class="figure"><p><img src="ax1.png"></p></div><p>è¨­å®šé€™å€‹å°ˆæ¡ˆç‚º <code>standalone</code> çš„å°ˆæ¡ˆ</p><div class="figure"><p><img src="ax2.png"></p></div><p>é¸æ“‡æ¨£æ¿ç‚º <code>Zynq FSBL</code></p><div class="figure"><p><img src="ax3.png"></p></div><p>é¸æ“‡æˆ‘å€‘å‰›å‰›å»ºç«‹çš„ <code>FSBL</code> å°ˆæ¡ˆï¼ŒæŒ‰ä¸‹å³éµé¸æ“‡ <code>Build Project</code> é€²è¡Œç·¨è­¯</p><div class="figure"><p><img src="ax4.png"></p></div></div></div><div id="outline-container-org66dd658" class="outline-2"><h2 id="org66dd658">å»ºç«‹ BOOT.bin</h2><div class="outline-text-2" id="text-org66dd658"><p>ç·¨è­¯å®Œ FSBL å¾Œï¼Œé¸æ“‡ <code>Xilinx Tools -&gt; Create Boot Image</code> å»å»ºç«‹æˆ‘å€‘çš„ BOOT.bin</p><div class="figure"><p><img src="ax5.png"></p></div><p>åœ¨ <code>Boot image partitions</code> é‚£é‚Šï¼ŒåŠ å…¥æˆ‘å€‘çš„ bitstream ä»¥åŠ u-boot æª”æ¡ˆï¼Œè¨˜å¾—è¦æŒ‰ç…§é †åºåŠ å…¥ã€‚</p><p>å®Œæˆå¾Œï¼Œé»é¸ <code>Create Image</code> å°±æœƒç”¢ç”Ÿæˆ‘å€‘è¦çš„ <code>BOOT.bin</code> åˆ°æŒ‡å®šè·¯å¾‘ã€‚</p><div class="figure"><p><img src="ax6.png"></p></div><p>åœ¨é€™å€‹æ­¥é©Ÿä¸­ï¼Œå¦‚æœä½ æ˜¯æŒ‡ä»¤æ§çš„è©±ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åœ¨ç”¢ç”Ÿ FSBL.elf å¾Œï¼Œå»ºç«‹ä¸€å€‹åç‚º <code>boot.bif</code> çš„æª”æ¡ˆï¼Œå…¶å…§å®¹å¦‚ä¸‹</p><div class="org-src-container"><pre class="src src-c"><span style="color: #5f5f5f; font-style: italic;">//</span><span style="color: #9ac; font-style: italic;">arch = zynq; split = false; format = BIN</span><span style="color: #ccaaff;">the_ROM_image</span>:<span style="color: #aadddd;">{</span>    <span style="color: #81d4fa;">[</span>bootloader<span style="color: #81d4fa;">]</span>/path/to/fsbl-build/fsbl.elf    /path/to/linux_bd/linux_bd.sdk/linux_bd_wrapper.bit    /path/to/u-boot/u-boot.elf<span style="color: #aadddd;">}</span></pre></div><p>æ¥ä¸‹ä¾†é€é <code>bootgen</code> é€™å€‹å‘½ä»¤å»ç”¢ç”Ÿ <code>BOOT.bin</code></p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~ $ bootgen -image boot.bif -w on -o i BOOT.bin</pre></div></div></div><div id="outline-container-org009d11f" class="outline-2"><h2 id="org009d11f">å°‡æª”æ¡ˆè¤‡è£½åˆ° Micro SD å¡</h2><div class="outline-text-2" id="text-org009d11f"><p>å¥½äº†ï¼Œæˆ‘å€‘å·²ç¶“å®Œæˆäº†æ‰€æœ‰æº–å‚™å‹•ä½œï¼Œæ˜¯æ™‚å€™å°‡æª”æ¡ˆæ”¾åˆ° Micro SD å¡ä¸¦çœ‹çœ‹çµæœäº†ï¼Œåœ¨æœ¬æ–‡ä¸­æˆ‘å€‘æœƒå°‡ä»¥ä¸‹å¹¾å€‹æª”æ¡ˆæ”¾åˆ° <code>ç¬¬ä¸€å€‹åˆ†å‰²å€ (fat32)</code> ã€‚</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo /tmp/sdc1 $ tree -L 1<span style="color: #ccaaff;">.</span>&#9500;&#9472;&#9472; BOOT.bin&#9500;&#9472;&#9472; devicetree.dtb&#9500;&#9472;&#9472; uImage&#9492;&#9472;&#9472; uramdisk.image.gz0 directories, 4 files</pre></div><p>ä¹Ÿå°±æ˜¯èªªæˆ‘å€‘çš„ SD å¡æœ‰çš„æ±è¥¿ï¼Œè¦åƒ <a href="http://www.zynqbook.com/" target="_blank" rel="external">The Zynq Book</a> p.439 é€™å¼µåœ–é‚£æ¨£</p><div class="figure"><p><img src="f2.png"></p></div></div></div><div id="outline-container-orgf4e4e2e" class="outline-2"><h2 id="orgf4e4e2e">æ¸¬è©¦é–‹æ©Ÿèˆ‡çµæœ</h2><div class="outline-text-2" id="text-orgf4e4e2e"><p>æ˜¯æ™‚å€™ä¾†æ¸¬è©¦çµæœäº†ï¼Œè¦æ³¨æ„åˆ°ä½ çš„ Zybo Board çš„ <code>JP5</code> è¦è¨­å®šæˆä¸‹é¢é€™æ¨£ï¼Œé€™æ¨£çµ¦é›»æ™‚ï¼ŒZynq æ‰æœƒè®€å– SD å¡ä¸Šé¢çš„ u-boot ä¸¦å°‡ä½å…ƒæµ (bitstream) ç‡’éŒ„åˆ° FPGA ä¸­ã€‚</p><div class="figure"><p><img src="sdboot.png"></p></div><p>æ’å…¥å‰›å‰›å»ºç«‹å¥½çš„ SD å¡ï¼Œä¸¦æä¾›é›»æºå¾Œï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨å¯ä»¥æ¥æ”¶ UART ç›¸é—œçš„ç¨‹å¼ï¼Œå¦‚ gtktermã€teratermã€screenã€emacs ç­‰ï¼Œå•Ÿå‹•å®ƒä¸¦é–‹å•Ÿ <code>/dev/ttyUSB1</code> å¾Œï¼Œè¨­å®š baudrate ç‚º <code>115200</code> ï¼Œå°±å¯ä»¥çœ‹åˆ°é–‹æ©Ÿåˆ° rootfs çš„ç‹€æ…‹ã€‚</p><div class="figure"><p><img src="s1.png"></p></div></div></div><div id="outline-container-org0330386" class="outline-2"><h2 id="org0330386">å–å¾—ç¨‹å¼ç¢¼</h2><div class="outline-text-2" id="text-org0330386"><p>æœ¬æ–‡çš„ç¯„ä¾‹å·²ç¶“æ”¾ç½®æ–¼ <a href="https://github.com/coldnew/zybo-examples" target="_blank" rel="external">GitHub</a> ä¸Šï¼Œä½ å¯ä»¥åˆ°ä»¥ä¸‹çš„ repo å»å°‹æ‰¾ï¼Œå…·é«”å°ˆæ¡ˆå°æ‡‰çš„æ•™å­¸åç¨±ï¼Œå‰‡è«‹åƒè€ƒ <code>README.md</code> æª”æ¡ˆ</p><div data-theme="default" data-height="" data-width="400" data-github="coldnew/zybo-examples" class="github-card"></div><script src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script></div></div><div id="outline-container-org09decde" class="outline-2"><h2 id="org09decde">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org09decde"><p><code>[1]</code> <a href="http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_1/ug1165-zynq-embedded-design-tutorial.pdf" target="_blank" rel="external">Zynq-7000 All Programmable SoC: Embedded Design Tutorial - A Hands-On Guide to Effective Embedded System Design (UG1165)</a></p><p><code>[2]</code> <a href="http://www.dbrss.org/zybo/tutorial4.html" target="_blank" rel="external">ZYBO Zync-7000 Development Board Work - Booting Linux on the ZYBO</a></p><p><code>[3]</code> <a href="http://www.zynqbook.com/" target="_blank" rel="external">The Zynq Book</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/d9dfdd56/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board é–‹ç™¼è¨˜éŒ„: Zynq èˆ‡ LED é–ƒçˆæ§åˆ¶</title>
      <link>https://coldnew.github.io/dec85bd3/</link>
      <guid>https://coldnew.github.io/dec85bd3/</guid>
      <pubDate>Tue, 05 Jul 2016 15:41:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
åœ¨ &lt;a href=&quot;http://coldnew.github.io/zybo-board/pl_led/&quot;&gt;zybo board é–‹ç™¼è¨˜éŒ„: é€éå¯ç¨‹å¼é‚è¼¯æ§åˆ¶ LED é–ƒçˆ&lt;/a&gt; ä¸€æ–‡ä¸­æˆ‘å€‘èªªåˆ°äº†æ€æ¨£ç´”ç²¹ä½¿ç”¨ å¯ç¨‹å¼é‚è¼¯ (Programmable Logic, PL) å»æ§åˆ¶ Zybo board ä¸Šé¢çš„å››å€‹ LED ç‡ˆ (LD0 ~ LD3)ï¼Œæ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘é€é Zynq ä¸Šçš„ ARM è™•ç†å™¨ä¾†ä½œåˆ°åŒæ¨£çš„ä¸€ä»¶äº‹æƒ…å§ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>åœ¨ <a href="http://coldnew.github.io/zybo-board/pl_led/">zybo board é–‹ç™¼è¨˜éŒ„: é€éå¯ç¨‹å¼é‚è¼¯æ§åˆ¶ LED é–ƒçˆ</a> ä¸€æ–‡ä¸­æˆ‘å€‘èªªåˆ°äº†æ€æ¨£ç´”ç²¹ä½¿ç”¨ å¯ç¨‹å¼é‚è¼¯ (Programmable Logic, PL) å»æ§åˆ¶ Zybo board ä¸Šé¢çš„å››å€‹ LED ç‡ˆ (LD0 ~ LD3)ï¼Œæ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘é€é Zynq ä¸Šçš„ ARM è™•ç†å™¨ä¾†ä½œåˆ°åŒæ¨£çš„ä¸€ä»¶äº‹æƒ…å§ã€‚</p><a id="more"></a><p>æœ¬æ–‡ä¸»è¦åƒè€ƒè‡ª <a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Digilentinc</a> çš„ <a href="https://reference.digilentinc.com/zybo/gsg" target="_blank" rel="external">Getting Start Guide</a> ä¸¦åŠ å…¥æˆ‘è‡ªå·±è©¦ç©çš„ä¸€äº›å¿ƒå¾—ã€‚</p><div id="outline-container-org208a6a2" class="outline-2"><h2 id="org208a6a2">é–‹ç™¼ç›®æ¨™</h2><div class="outline-text-2" id="text-org208a6a2"><p>æˆ‘å€‘è¦é€é Zynq ä¸Šçš„ ARM è™•ç†å™¨ï¼Œä¹Ÿå°±æ˜¯ è™•ç†ç³»çµ± (Processing System, PS)å»æ§åˆ¶ LEDï¼Œå…·é«”ç›®æ¨™èˆ‡é›»è·¯è³‡è¨Šå¦‚ä¸‹:</p><div class="figure"><p><img src="zybo_led.png"></p></div><p>æ ¹æ“š <a href="https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf" target="_blank" rel="external">ZYBO FPGA Board Reference Manual</a> ä¸Šé¢çš„è³‡æ–™ï¼Œæˆ‘å€‘æƒ³è¦æ§åˆ¶çš„é€™å››å€‹åœ¨æ¿å­ä¸Šçš„ LED éƒ½æ˜¯ä½æ–¼å¯ç¨‹å¼é‚è¼¯å€(Programmable Logic, PL)å¯ä»¥ç¢°è§¸åˆ°çš„åœ°æ–¹ï¼Œå¦‚æœä½ æƒ³è¦é€é Zynq å»å°é€™äº› LED é€²è¡Œæ§åˆ¶ï¼Œä½ å°±æœƒéœ€è¦é€é  AXI GPIO çš„å¹«åŠ©ï¼Œå°±åƒé€™æ¨£:</p><div class="figure"><p><img src="zynq_axi_gpio_led.png"></p></div></div></div><div id="outline-container-org1898507" class="outline-2"><h2 id="org1898507">èªè­˜ AXI åŒ¯æµæ’</h2><div class="outline-text-2" id="text-org1898507"><p>AXI åŒ¯æµæ’æ˜¯ä½œä»€éº¼ç”¨çš„ï¼Ÿæˆ‘å€‘å°±å¾ Zynq çš„æ¶æ§‹ä¾†çœ‹ (åƒç…§ <a href="http://www.zynqbook.com/" target="_blank" rel="external">The Zynq Book</a> p.28)</p><div class="figure"><p><img src="zynq_hw_arch.png"></p></div><p>ç”±ä¸Šåœ–å¯ä»¥çœ‹åˆ° AXI åŒ¯æµæ’æ©«è·¨äº†è™•ç†å™¨ç³»çµ± (Processing System, PS) èˆ‡å¯ç¨‹å¼é‚è¼¯ (Programmable Logc, PL) å…©å€ï¼Œä¸¦é€£æ¥åˆ°é€±é‚Šã€‚</p><p>å¯¦éš›ä¸Šï¼ŒAXI å”è­°ç‚º ARM çš„å”è­°è¦ç¯„ï¼Œä¾†è‡ªæ–¼ AMBA åŒ¯æµæ’æ¶æ§‹ï¼Œè‹¥ä½ å°æ•´å€‹å”è­°çš„å…§å®¹æœ‰èˆˆè¶£ï¼Œå¯ä»¥åˆ° ARM çš„ <a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.set.amba/index.html" target="_blank" rel="external">ç¶²ç«™</a> å»ä¸‹è¼‰è¦æ ¼æ›¸ã€‚</p></div></div><div id="outline-container-org580a212" class="outline-2"><h2 id="org580a212">å»ºç«‹æˆ‘å€‘çš„å°ˆæ¡ˆ</h2><div class="outline-text-2" id="text-org580a212"><p>æˆ‘å€‘é¦–å…ˆç•¶ç„¶æ˜¯å»ºç«‹æˆ‘å€‘çš„å°ˆæ¡ˆäº†ï¼Œåœ¨é€²è¡Œé€™ä¸€æ­¥å‰ï¼Œè«‹å…ˆç¢ºå®šä½ æœ‰æŒ‰ç…§ <a href="https://coldnew.github.io/zybo-board/vivado_zybo_setting_file/">è®“ Vivado æœ‰ Zybo Board çš„è¨­å®šæª”</a> ä¸€æ–‡æ‰€èªªï¼Œå°‡ Zybo board çš„è¨­è¨ˆå°å…¥ã€‚</p><p>å•Ÿå‹•äº† Vivado å¾Œï¼Œé»é¸ <code>Create New Project</code> ã€‚</p><div class="figure"><p><img src="create_prj0.png"></p></div><p>æ¥ä¸‹ä¾†æŒ‡å®šå¥½ä½ çš„å°ˆæ¡ˆåç¨±èˆ‡è·¯å¾‘</p><div class="figure"><p><img src="cprj1.png"></p></div><p>é¸æ“‡ <code>RTL Project</code></p><div class="figure"><p><img src="new_prj.png"></p></div><p>åœ¨é–‹ç™¼æ¿é¸é …ä¸­ï¼Œé¸æ“‡ <code>Zybo Board</code></p><div class="figure"><p><img src="new_prj2.png"></p></div><p>å®Œæˆå°ˆæ¡ˆå»ºç«‹</p><div class="figure"><p><img src="cprj2.png"></p></div></div></div><div id="outline-container-org02197b7" class="outline-2"><h2 id="org02197b7">å»ºç«‹ Block Design</h2><div class="outline-text-2" id="text-org02197b7"><p>ç•¶æˆ‘å€‘çš„è¨­è¨ˆéœ€è¦ç”¨åˆ° Zynq çš„è™•ç†å™¨ç³»çµ±(Processing System, PS)æ™‚å€™ï¼Œå°±éœ€è¦é€é Block Design ä¾†å»ºç«‹æˆ‘å€‘çš„é›»è·¯è¨­è¨ˆï¼Œé¦–å…ˆé»é¸ <code>IP Integrator -&gt; Create Block Design</code> ã€‚</p><div class="figure"><p><img src="cb1.png"></p></div><p>æ¥è‘—é»é¸ <code>OK</code> å»ºç«‹æˆ‘å€‘çš„ block design</p><div class="figure"><p><img src="cb2.png"></p></div><p>é»é¸ <code>Add IP</code> æŒ‰éˆ•å»å¢åŠ æˆ‘å€‘éœ€è¦çš„ IP æ ¸</p><div class="figure"><p><img src="cb3.png"></p></div><p>æˆ‘å€‘é¦–å…ˆå°‹æ‰¾ <code>Zynq</code> ä¸¦å°‡ <code>ZYNQ7 Processing System</code> åŠ å…¥åˆ°æˆ‘å€‘çš„ Block Designï¼Œä¸¦é»é¸ <code>Run Block Automation</code> å° Zynq è™•ç†å™¨é€²è¡Œä¸€äº›è¨­å®š</p><div class="figure"><p><img src="cb4.png"></p></div><p>é€²å…¥åˆ° <code>Run Block Automation</code> çš„è¨­å®šé é¢å¾Œï¼Œç¢ºèª <code>processing_system7_0</code> æœ‰è¢«å‹¾é¸åˆ°ï¼Œä¸¦ä¸” <code>Cross Trigger In</code> ä»¥åŠ <code>Cross Trigger Out</code> éƒ½æ˜¯ <code>Disable</code> çš„ç‹€æ…‹ï¼Œé»é¸ Ok çµæŸè¨­å®šã€‚</p><div class="figure"><p><img src="cb5.png"></p></div><p>ä¸Šé¢çš„è¨­å®šå¥½äº†å¾Œï¼Œå°±æœƒçœ‹åˆ° ZYNQ7 Processing System çš„ DDR ä»¥åŠ FIXED_IO éƒ½æœ‰æ¥ç·šå‡ºä¾†</p><div class="figure"><p><img src="cb6.png"></p></div><p>é»é¸ <code>Add IP</code> æŒ‰éˆ•å»å¢åŠ æˆ‘å€‘éœ€è¦çš„ IP æ ¸ï¼Œé€™æ¬¡æˆ‘å€‘è¦å¢åŠ  <code>AXI_GPIO</code> ï¼Œç”¨ä¾†å°å¯ç¨‹å¼é‚è¼¯(Programmable Logic, PL)å€åŸŸçš„ LED é€²è¡Œæ§åˆ¶ï¼Œå®Œæˆå¾Œé»é¸ä¸Šæ–¹çš„ <code>Run Connection Automation</code> æŒ‰éˆ•</p><div class="figure"><p><img src="cb7.png"></p></div><p>åœ¨ <code>Run Conenction Automation</code> è¦–çª—å…§ï¼Œæˆ‘å€‘é¸æ“‡ <code>Custom</code> (å…¶å¯¦ä¹Ÿå¯ä»¥åœ¨é€™é‚Šç›´æ¥é¸æ“‡ <code>leds 4bits</code>)</p><div class="figure"><p><img src="cb8-1.png"></p></div><p>æ¥ä¸‹ä¾†å‹¾é¸ <code>S_AXI</code> ï¼Œä¸¦é»é¸ Ok é€²è¡Œç¢ºèªã€‚</p><div class="figure"><p><img src="cb8.png"></p></div><p>å¥½äº†å¾Œæœƒåƒé€™æ¨£ï¼Œæˆ‘å€‘æ¥ä¸‹ä¾†å° <code>axi_gpio_0</code> é€™å€‹å€å¡Šé»å…©ä¸‹ï¼Œé€²è¡Œæ‰‹å‹•è¨­å®š</p><div class="figure"><p><img src="cb9.png"></p></div><p>åœ¨ <code>IP Configuration</code> é é¢ï¼Œè¨­å®š GPIO ç‚ºè¼¸å‡ºè…³ï¼Œä¸¦è¨­å¯¬åº¦ç‚º <code>4</code> ï¼Œé€™é‚Šæˆ‘å°‡è¼¸å‡ºé è¨­å€¼è¨­å®šç‚º 0xF, ä¹Ÿå°±æ˜¯é è¨­é€™å››å€‹ LED ç”¨çš„è¼¸å‡ºè…³éƒ½æ˜¯ High çš„é›»å£“ã€‚å®Œæˆå¾Œé»é¸ OK, çµæŸ AXI_GPIO çš„è¨­å®šã€‚</p><div class="figure"><p><img src="cb10.png"></p></div><p>æ¥ä¸‹ä¾†é»é¸ <code>Validate Design</code> æŒ‰éˆ•ï¼Œæˆ‘å€‘è¦ç¢ºèªæˆ‘å€‘çš„ Block Design æ²’å•é¡Œæ‰èƒ½å¤ ç¹¼çºŒå¾€ä¸‹èµ°ã€‚</p><div class="figure"><p><img src="cb11.png"></p></div><p>æ­£å¸¸ä¾†è¬›ä¸æœƒæœ‰å•¥å•é¡Œæ‰å°ï¼Œæˆ‘å€‘çµæŸ Block Design çš„å·¥ä½œ</p><div class="figure"><p><img src="cb12.png"></p></div></div></div><div id="outline-container-orgb43ffdd" class="outline-2"><h2 id="orgb43ffdd">åŠ å…¥ Constraints</h2><div class="outline-text-2" id="text-orgb43ffdd"><p>åœ¨ <a href="http://coldnew.github.io/zybo-board/pl_led/">zybo board é–‹ç™¼è¨˜éŒ„: é€éå¯ç¨‹å¼é‚è¼¯æ§åˆ¶ LED é–ƒçˆ</a> ä¸€æ–‡æœ‰æåˆ°å¦‚ä½•å–å¾— Constraints æª”æ¡ˆï¼Œä¸éç‚ºäº†è®“é€™ç¯‡æ–‡ç« å®Œæ•´ï¼Œæˆ‘å€‘å†è¬›ä¸€æ¬¡ã€‚</p><p>æˆ‘å€‘å…ˆé€£çµåˆ° <a href="https://reference.digilentinc.com/zybo:zybo" target="_blank" rel="external">Zybo Resource Center</a> å»ä¸‹è¼‰ <code>Master XDC</code> æª”æ¡ˆã€‚</p><div class="figure"><p><img src="dl_constraints.png"></p></div><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥é€é wget å‘½ä»¤ä¸‹è¼‰ä¸¦è§£å£“å‡º <code>ZYBO_Master.xdc</code> é€™å€‹æª”æ¡ˆï¼Œå®ƒå°±æ˜¯æœ¬ç¯€è¦åŠ å…¥çš„ Constraints æª”</p><pre class="example">coldnew@gentoo /tmp $ wget https://reference.digilentinc.com/_media/zybo/zybo_master_xdc.zipcoldnew@gentoo /tmp $ unzip zybo_master_xdc.zipArchive:  zybo_master_xdc.zip  inflating: ZYBO_Master.xdc</pre><p>æ¥ä¸‹ä¾†ä¸€æ¨£é¸æ“‡ <code>Project Manager -&gt; Add sources</code> ä¾†å¢åŠ æª”æ¡ˆ</p><div class="figure"><p><img src="as1.png"></p></div><p>é€™æ¬¡æˆ‘å€‘è¦å¢åŠ çš„æ˜¯ Constraints æª”ï¼Œå› æ­¤é¸æ“‡ <code>Add or create constraints</code></p><div class="figure"><p><img src="add_constraints1.png"></p></div><p>é€é <code>Add Files</code> æ·»åŠ å‰›å‰›ä¸‹è¼‰çš„ ZYBO_Master.xdc æª”æ¡ˆ</p><div class="figure"><p><img src="add_constraints2.png"></p></div></div><div id="outline-container-orga166f76" class="outline-3"><h3 id="orga166f76">ZYBO_Master.xdc</h3><div class="outline-text-3" id="text-orga166f76"><p>åœ¨ ZYBO_Master.xdc è£¡é¢ï¼Œé è¨­æ‰€æœ‰å°æ‡‰æ¥è…³éƒ½æ˜¯è¢«è¨»è§£æ‰çš„ï¼Œé€™é‚Šæˆ‘å€‘åè¨»è§£æˆ‘å€‘éœ€è¦çš„ led æ¥è…³ï¼Œè¦è¨˜å¾—ä¸€ä¸‹é€™é‚Šçš„ I/O åç¨±ï¼Œæˆ‘å€‘ç­‰ç­‰è¦å’Œç”¢ç”Ÿå‡ºä¾†çš„ HDL Wrapper é€²è¡Œå°æ‡‰çš„å·¥ä½œã€‚</p><div class="org-src-container"><pre class="src src-sh"><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">LEDs</span><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">IO_L23P_T3_35</span>set_property PACKAGE_PIN M14 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>0<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span>set_property IOSTANDARD LVCMOS33 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>0<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">IO_L23N_T3_35</span>set_property PACKAGE_PIN M15 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>1<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span>set_property IOSTANDARD LVCMOS33 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>1<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">IO_0_35</span>set_property PACKAGE_PIN G14 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>2<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span>set_property IOSTANDARD LVCMOS33 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>2<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">IO_L3N_T0_DQS_AD1N_35</span>set_property PACKAGE_PIN D18 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>3<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span>set_property IOSTANDARD LVCMOS33 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>3<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span></pre></div><p>é€™æ¨£æˆ‘å€‘å°±å¯ä»¥æº–å‚™å°‡ Block Design å’Œç¡¬é«”æ¥è…³å°æ‡‰åœ¨ä¸€èµ·äº†ã€‚</p></div></div></div><div id="outline-container-org74df5ae" class="outline-2"><h2 id="org74df5ae">ç”¢ç”Ÿ HDL Wrapper</h2><div class="outline-text-2" id="text-org74df5ae"><p>æ¥ä¸‹ä¾†æˆ‘å€‘è¦é€é Block Design ç”¢ç”Ÿæˆ‘å€‘çš„ HDL wrapperï¼Œå°ä½ çš„ Block Design æª”æ¡ˆé»é¸å³éµï¼Œé¸æ“‡ <code>Create HDL Wrapper</code> ã€‚å®ƒæœƒæ ¹æ“šä½ å°ˆæ¡ˆè¨­å®šçš„èªè¨€ (VHDL æˆ–æ˜¯ Verilog) ä¾†ç”¢ç”Ÿç›¸å°çš„ HDL ç¨‹å¼ç¢¼ã€‚</p><div class="figure"><p><img src="w1.png"></p></div><p>ç”¢ç”Ÿå‡ºä¾†çš„æ±è¥¿æˆ‘å€‘å¯èƒ½éœ€è¦æ”¹äº›æ±è¥¿ï¼Œç‚ºäº†é¿å…éº»ç…©é€™é‚Šæˆ‘é¸ç¬¬ä¸€å€‹é¸é …ã€‚</p><div class="figure"><p><img src="w2.png"></p></div><p>å¥½äº†å¾Œï¼Œå‡è¨­ä½ çš„ Block Design æª”æ¡ˆå«åš design_1.bdï¼Œé‚£å°±æœƒç”¢ç”Ÿ design_1_wrapper.v æˆ–æ˜¯ design_1_wrapper.vhdl é€™æ¨£çš„æª”æ¡ˆ</p><div class="figure"><p><img src="w3.png"></p></div><p>æˆ‘å€‘æ¥è‘—è¦ä¿®æ”¹é€™å€‹ HDL Wrapperï¼Œé€™æ˜¯ç‚ºä»€éº¼å‘¢? å›å»çœ‹ä¸€ä¸‹å‰é¢åšå¥½çš„ Block Design ä»¥åŠ Constraints çš„è³‡è¨Šï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ° Block Design è¨­å®šå¥½çš„ AXI_GPIO å…¶è¼¸å‡ºè…³å«åš <code>gpio_rtl</code> ï¼Œè€Œåœ¨ Constraints ä¸­ï¼Œæˆ‘å€‘ç›®æ¨™çš„ LED è¼¸å‡ºè…³åç¨±æ˜¯ <code>led</code> ï¼Œå› æ­¤æˆ‘å€‘è¦èª¿æ•´ä¸€ä¸‹é€™å€‹ HDL Wrapper è®“ <code>gpio_rtl</code> å’Œ <code>led</code> å¯ä»¥å°æ‡‰åœ¨ä¸€èµ·ã€‚</p><div class="figure"><p><img src="w4.png"></p></div><p>ç”±æ–¼åœ¨æœ¬ç¯„ä¾‹ä¸­ï¼Œdesign_1_wrapper.v ä¹Ÿå°±æ˜¯ toplevel çš„æ¨¡çµ„ï¼Œå› æ­¤åœ¨é€™é‚Šå°‡å°å¤–çš„ <code>gpio_rtl_tri_o</code> æ¥è…³æ”¹ç‚º <code>led</code> è®“å®ƒæ¥å‡ºå³å¯ã€‚</p><div class="org-src-container"><pre class="src src-diff"><span style="color: #dddddd;">diff --git a/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v b/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v</span><span style="color: #dddddd;">index 7b1b0bd..c57caa0 100644</span><span style="color: #aaaaaa; background-color: #202020;">--- </span><span style="color: #aaaaaa; background-color: #202020;">a/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v</span><span style="color: #aaaaaa; background-color: #202020;">+++ </span><span style="color: #aaaaaa; background-color: #202020;">b/led_flash_zynq.srcs/sources_1/imports/hdl/design_1_wrapper.v</span><span style="color: #aaaaaa; background-color: #202020;">@@ -31,7 +31,7 @@</span><span style="color: #aaaaaa; background-color: #202020;"> module design_1_wrapper</span><span style="color: #dddddd;">     FIXED_IO_ps_clk,</span><span style="color: #dddddd;">     FIXED_IO_ps_porb,</span><span style="color: #dddddd;">     FIXED_IO_ps_srstb,</span><span style="color: #ff3333; font-weight: bold;">-</span><span style="color: #ff3333; font-weight: bold;">    gpio_rtl_tri_o);</span><span style="color: #aaffaa; font-weight: bold;">+</span><span style="color: #aaffaa; font-weight: bold;">    led);</span><span style="color: #dddddd;">   inout [14:0]DDR_addr;</span><span style="color: #dddddd;">   inout [2:0]DDR_ba;</span><span style="color: #dddddd;">   inout DDR_cas_n;</span><span style="color: #aaaaaa; background-color: #202020;">@@ -53,7 +53,7 @@</span><span style="color: #aaaaaa; background-color: #202020;"> module design_1_wrapper</span><span style="color: #dddddd;">   inout FIXED_IO_ps_clk;</span><span style="color: #dddddd;">   inout FIXED_IO_ps_porb;</span><span style="color: #dddddd;">   inout FIXED_IO_ps_srstb;</span><span style="color: #ff3333; font-weight: bold;">-</span><span style="color: #ff3333; font-weight: bold;">  output [3:0]gpio_rtl_tri_o;</span><span style="color: #aaffaa; font-weight: bold;">+</span><span style="color: #aaffaa; font-weight: bold;">  output [3:0]led;</span><span style="color: #dddddd;">   wire [14:0]DDR_addr;</span><span style="color: #dddddd;">   wire [2:0]DDR_ba;</span><span style="color: #aaaaaa; background-color: #202020;">@@ -76,7 +76,7 @@</span><span style="color: #aaaaaa; background-color: #202020;"> module design_1_wrapper</span><span style="color: #dddddd;">   wire FIXED_IO_ps_clk;</span><span style="color: #dddddd;">   wire FIXED_IO_ps_porb;</span><span style="color: #dddddd;">   wire FIXED_IO_ps_srstb;</span><span style="color: #ff3333; font-weight: bold;">-</span><span style="color: #ff3333; font-weight: bold;">  wire [3:0]gpio_rtl_tri_o;</span><span style="color: #aaffaa; font-weight: bold;">+</span><span style="color: #aaffaa; font-weight: bold;">  wire [3:0]led;</span><span style="color: #dddddd;">   design_1 design_1_i</span><span style="color: #dddddd;">        (.DDR_addr(DDR_addr),</span><span style="color: #aaaaaa; background-color: #202020;">@@ -100,5 +100,5 @@</span><span style="color: #aaaaaa; background-color: #202020;"> module design_1_wrapper</span><span style="color: #dddddd;">         .FIXED_IO_ps_clk(FIXED_IO_ps_clk),</span><span style="color: #dddddd;">         .FIXED_IO_ps_porb(FIXED_IO_ps_porb),</span><span style="color: #dddddd;">         .FIXED_IO_ps_srstb(FIXED_IO_ps_srstb),</span><span style="color: #ff3333; font-weight: bold;">-</span><span style="color: #ff3333; font-weight: bold;">        .gpio_rtl_tri_o(gpio_rtl_tri_o));</span><span style="color: #aaffaa; font-weight: bold;">+</span><span style="color: #aaffaa; font-weight: bold;">        .gpio_rtl_tri_o(led));</span><span style="color: #dddddd;"> endmodule</span></pre></div><p>æ”¹å¥½å¾Œï¼Œé»é¸ä¸Šæ–¹çš„ <code>Run Implementation</code> ä¾†ç¢ºèªæˆ‘å€‘é€™æ¨£çš„ä¿®æ”¹æ˜¯å¦èƒ½ç·¨è­¯/é©—è­‰æˆåŠŸã€‚</p><div class="figure"><p><img src="w5.png"></p></div></div></div><div id="outline-container-orgbcb0d93" class="outline-2"><h2 id="orgbcb0d93">ç”¢ç”Ÿä½å…ƒæµ (bitstream)</h2><div class="outline-text-2" id="text-orgbcb0d93"><p>å‰é¢çš„è™•ç†éƒ½å¥½äº†å¾Œï¼Œæ¥ä¸‹ä¾†é»é¸ <code>Program and Debug -&gt; Generate Bitstream</code> å»è®“ Vivado å°‡é€™å€‹å°ˆæ¡ˆç”¢ç”Ÿå‡ºä½å…ƒæµ (bitstream)ï¼ŒZYNQ æœƒæ ¹æ“š bitstream çš„è³‡è¨Šå° FPGA é€²è¡Œè¨­å®šã€‚</p><div class="figure"><p><img src="w6.png"></p></div><p>ç•¶ bitstream ç”¢ç”Ÿå®Œæˆå¾Œï¼Œç”±æ–¼æˆ‘å€‘é€™æ¬¡çš„å¯¦ä½œï¼Œæ˜¯è¦é€éå¯« C èªè¨€ç¨‹å¼ä¾†æ§åˆ¶ Zynq é€²è¡Œ LED çš„äº®æš—ï¼Œå› æ­¤è¦å…ˆå°‡å‰›å‰›ç”¢ç”Ÿçš„ç¡¬é«”è³‡è¨Šè¼¸å‡ºçµ¦ Xilinx SDK å»ã€‚</p><p>é»é¸ <code>File -&gt; Export -&gt; Export Hardware</code></p><div class="figure"><p><img src="w7.png"></p></div><p>ç¢ºå®šä½ æœ‰å‹¾é¸ <code>Include bitstream</code> ï¼Œé»é¸ Ok</p><div class="figure"><p><img src="w8.png"></p></div><p>å®Œæˆå¾Œï¼Œå•Ÿå‹• Xilinx SDK</p><div class="figure"><p><img src="w9.png"></p></div></div></div><div id="outline-container-orgde6a75a" class="outline-2"><h2 id="orgde6a75a">Xilinx SDK</h2><div class="outline-text-2" id="text-orgde6a75a"><p>æˆ‘å€‘å•Ÿå‹• Xilinx SDK å¾Œï¼Œå¯ä»¥å…ˆçœ‹åˆ°ä¸€äº›åƒæ˜¯ä½å€æ˜ å°„ (Address Map) çš„è³‡è¨Š</p><div class="figure"><p><img src="x1.png"></p></div><p>é¸æ“‡ <code>File -&gt; New -&gt; Application Project</code> å»å»ºç«‹æ–°çš„å°ˆæ¡ˆ</p><div class="figure"><p><img src="x2.png"></p></div><p>é€™é‚Šæˆ‘å‘½åé€™å€‹å°ˆæ¡ˆå«åš LEDï¼Œä¸¦ä¸”ç‚ºç¨ç«‹çš„ç¨‹å¼</p><div class="figure"><p><img src="x3.png"></p></div><p>é¸æ“‡ <code>Empty Application</code> ï¼Œæˆ‘å€‘è¦è‡ªå·±ä¾†å¯«æˆ‘å€‘çš„ç¨‹å¼ã€‚</p><div class="figure"><p><img src="x4.png"></p></div><p>ç•¶å°ˆæ¡ˆå»ºç«‹å®Œæˆå¾Œï¼Œæœƒè‡ªå‹•æ‰“é–‹ <code>LED_bsp</code> è£¡é¢çš„ <code>system.mss</code> ï¼Œè£¡é¢æœƒé¡¯ç¤ºæˆ‘å€‘æ‰€ç”¨çš„é€±é‚Šç¯„ä¾‹ç¨‹å¼ç¢¼ä»¥åŠä½¿ç”¨æ‰‹å†Šçš„é€£çµï¼Œæˆ‘å€‘å¯ä»¥é»é¸é€™äº›é€£çµä¾†äº†è§£é€™äº›é€±é‚Šè¦æ€æ¨£ä½¿ç”¨ã€‚</p><div class="figure"><p><img src="doc.png"></p></div><p>å¦‚æœä½ é€£çµé»é¸ä¸é–‹çš„è©±ï¼Œå¯ä»¥åˆ°ä½ å®‰è£ SDK çš„è·¯å¾‘ä¸‹å»å°‹æ‰¾ï¼Œæ¯”å¦‚èªªæˆ‘è£çš„æ˜¯ Vivado 2016.2ï¼Œå‰‡æ‰‹å†Šçš„è·¯å¾‘åœ¨</p><pre class="example">/opt/Xilinx/SDK/2016.2/data/embeddedsw/XilinxProcessorIPLib/drivers</pre><p>é€™è£¡çµ¦å€‹çµæœçš„ç¯„ä¾‹ï¼Œæ¯”å¦‚æˆ‘æƒ³è¦æŸ¥è©¢ xgpio çš„è³‡æ–™ï¼Œå‰‡å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„ HTML æª”æ¡ˆ</p><div class="figure"><p><img src="doc2.png"></p></div></div><div id="outline-container-orgd84a7f3" class="outline-3"><h3 id="orgd84a7f3">å»ºç«‹ main.c</h3><div class="outline-text-3" id="text-orgd84a7f3"><p>ç”±æ–¼æˆ‘å€‘å»ºç«‹çš„æ˜¯ç©ºç™½å°ˆæ¡ˆï¼Œå¿…é ˆè‡ªå·±æ·»åŠ è‡ªå·±çš„ä¸»ç¨‹å¼ï¼Œå› æ­¤æˆ‘å€‘å° LED å°ˆæ¡ˆçš„ src æŒ‰ä¸‹å³éµï¼Œé¸æ“‡å»ºç«‹æ–°çš„æª”æ¡ˆ</p><div class="figure"><p><img src="x5.png"></p></div><p>é€™é‚Šå°‡å®ƒå‘½åç‚º <code>main.c</code> ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘å”¯ä¸€çš„ä¸»ç¨‹å¼ï¼Œé»é¸ <code>Finish</code> å®Œæˆæª”æ¡ˆå»ºç«‹ã€‚</p><div class="figure"><p><img src="x6.png"></p></div><p>åœ¨ main.c åŠ å…¥ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼Œå…·é«”åŠŸèƒ½å¾…æœƒåœ¨èªªæ˜ã€‚</p><div class="org-src-container"><pre class="src src-c"><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">"xparameters.h"</span><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">"xgpio.h"</span><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">stdio.h</span><span style="color: #aadddd;">&gt;</span><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">stdlib.h</span><span style="color: #aadddd;">&gt;</span><span style="color: #fff59d;">void</span> <span style="color: #aaccff;">simple_delay</span> <span style="color: #aadddd;">(</span><span style="color: #fff59d;">int</span> <span style="color: #aaccff;">simple_delay</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">{</span>        <span style="color: #aaffaa;">volatile</span> <span style="color: #fff59d;">int</span> <span style="color: #aaccff;">i</span> = 0;        <span style="color: #aaffaa;">for</span> <span style="color: #81d4fa;">(</span>i = 0; i &lt; simple_delay; i++<span style="color: #81d4fa;">)</span>;<span style="color: #aadddd;">}</span><span style="color: #fff59d;">int</span> <span style="color: #aaccff;">main</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">int</span> <span style="color: #aaccff;">argc</span>, <span style="color: #fff59d;">char</span> *<span style="color: #aaccff;">argv</span><span style="color: #81d4fa;">[]</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">{</span>        <span style="color: #fff59d;">XGpio</span> <span style="color: #aaccff;">led_gpio</span>;              <span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">LED Instance </span><span style="color: #5f5f5f; font-style: italic;">*/</span>        <span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">Initialize LED GPIO settings </span><span style="color: #5f5f5f; font-style: italic;">*/</span>        XGpio_Initialize<span style="color: #81d4fa;">(</span>&amp;led_gpio, XPAR_AXI_GPIO_0_DEVICE_ID<span style="color: #81d4fa;">)</span>;        XGpio_SetDataDirection<span style="color: #81d4fa;">(</span>&amp;led_gpio, 1, 0<span style="color: #81d4fa;">)</span>;        <span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">Output something via UART1, 115200 baudrate </span><span style="color: #5f5f5f; font-style: italic;">*/</span>        printf<span style="color: #81d4fa;">(</span><span style="color: #aadddd;">"Start to blink led_gpio !!!\n\r"</span><span style="color: #81d4fa;">)</span>;        <span style="color: #fff59d;">int</span> <span style="color: #aaccff;">led_value</span> = 0x03;   <span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">default led_gpio value </span><span style="color: #5f5f5f; font-style: italic;">*/</span>        <span style="color: #aaffaa;">while</span><span style="color: #81d4fa;">(</span>1<span style="color: #81d4fa;">)</span> <span style="color: #81d4fa;">{</span>                printf<span style="color: #aaccff;">(</span><span style="color: #aadddd;">"led_gpio value set to 0x%X\n\r"</span>, led_value<span style="color: #aaccff;">)</span>;                <span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">Set GPIO Channel 1 value. </span><span style="color: #5f5f5f; font-style: italic;">*/</span>                XGpio_DiscreteWrite<span style="color: #aaccff;">(</span>&amp;led_gpio, 1 , led_value<span style="color: #aaccff;">)</span>;                <span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">sleep and change led_gpio value </span><span style="color: #5f5f5f; font-style: italic;">*/</span>                simple_delay<span style="color: #aaccff;">(</span>10000000<span style="color: #aaccff;">)</span>;                led_value = ~led_value;        <span style="color: #81d4fa;">}</span>        <span style="color: #aaffaa;">return</span> 0;<span style="color: #aadddd;">}</span></pre></div></div></div><div id="outline-container-orgf89434e" class="outline-3"><h3 id="orgf89434e">main.c</h3><div class="outline-text-3" id="text-orgf89434e"><p>åœ¨ main.c çš„é–‹é ­ï¼Œæˆ‘å€‘è¼‰å…¥äº†éœ€è¦ä½¿ç”¨çš„å¹¾å€‹æ¨™é ­æª”ï¼Œåœ¨ Xilinx SDK ä¸­ï¼Œå·²ç¶“åŒ…å«äº†ä¸€äº›é è¨­å¥½çš„å‡½å¼åº«ç­‰åŠŸèƒ½ï¼Œå…·é«”è³‡è¨Šè«‹æŸ¥é–± <a href="http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_3/oslib_rm.pdf" target="_blank" rel="external">Xilinx OS and Libraries Document Collection</a> (UG643) æ‰‹å†Šã€‚</p><p><code>xparameters.h</code> é€™å€‹æ¨™é ­æª”å‰‡æ˜¯ Xilinx SDK è‡ªå·±ç”¢ç”Ÿçš„ï¼Œè£¡é¢æœƒåŒ…å«ä¸€äº›é—œæ–¼ä½ ä½¿ç”¨çš„ IP Core çš„è³‡è¨Šï¼Œæ¯”å¦‚æ¨™æº–è¼¸å‡ºçš„åŸºåº•ä½å€ (base address) æˆ–æ˜¯å…¶ä»–å’Œä½ é€™ä»½ç¡¬é«”ç›¸é—œçš„è¨­å®šã€‚è€Œ <code>xgpio.h</code> å‰‡æä¾›äº†ä¸€äº›é«˜éšçš„æŠ½è±¡å‡½å¼ï¼Œè®“ä½ é–‹ç™¼ GPIO ç›¸é—œçš„åŠŸèƒ½å¯ä»¥æ›´åŠ è¼•é¬†ã€‚</p><div class="org-src-container"><pre class="src src-c"><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">"xparameters.h"</span><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">"xgpio.h"</span><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">stdio.h</span><span style="color: #aadddd;">&gt;</span><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">stdlib.h</span><span style="color: #aadddd;">&gt;</span></pre></div><p>æˆ‘å€‘ç”¨ä¸€å€‹éå¸¸ç°¡å–®çš„å»¶é² (delay) å‡½å¼è®“ CPU å¾ˆå¿™ç¢Œçš„è¨ˆç®—ï¼Œä¾†é”åˆ°å»¶é²ç¨‹å¼çš„æ•ˆæœã€‚</p><div class="org-src-container"><pre class="src src-c"><span style="color: #fff59d;">void</span> <span style="color: #aaccff;">simple_delay</span> <span style="color: #aadddd;">(</span><span style="color: #fff59d;">int</span> <span style="color: #aaccff;">simple_delay</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">{</span>        <span style="color: #aaffaa;">volatile</span> <span style="color: #fff59d;">int</span> <span style="color: #aaccff;">i</span> = 0;        <span style="color: #aaffaa;">for</span> <span style="color: #81d4fa;">(</span>i = 0; i &lt; simple_delay; i++<span style="color: #81d4fa;">)</span>;<span style="color: #aadddd;">}</span></pre></div><p>æ¥ä¸‹ä¾†æ˜¯æˆ‘å€‘çš„ä¸»ç¨‹å¼ï¼Œæˆ‘å€‘å°‡å®ƒæ‹†é–‹ä¾†çœ‹ï¼Œå¾Œé¢è¦‹åˆ°çš„ç¨‹å¼ç¢¼éƒ½æœƒå¡åˆ°ä¸»ç¨‹å¼ä¸­ã€‚</p><div class="org-src-container"><pre class="src src-c"><span style="color: #fff59d;">int</span> <span style="color: #aaccff;">main</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">int</span> <span style="color: #aaccff;">argc</span>, <span style="color: #fff59d;">char</span> *<span style="color: #aaccff;">argv</span><span style="color: #81d4fa;">[]</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">{</span>        <span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">code</span>        <span style="color: #aaffaa;">return</span> 0;<span style="color: #aadddd;">}</span></pre></div><p>æ˜¯æ™‚å€™é€²å…¥åˆ° GPIO çš„åŠŸèƒ½è¨­å®šï¼Œæ³¨æ„åˆ° <code>XPAR_AXI_GPIO_0_DEVICE_ID</code> é€™å€‹ï¼Œä½ å¯ä»¥æŠŠå®ƒå°æ‡‰å›æˆ‘å€‘çš„ Block Design çš„ <code>axi_gpio_0</code> ï¼Œé€™å€‹å·¨é›†(Macro)å³æ˜¯ Xilinx SDK ç”¢ç”Ÿï¼Œå®šç¾©åœ¨ <code>xparameter.h</code> è£¡é¢ã€‚</p><div class="org-src-container"><pre class="src src-c"><span style="color: #fff59d;">XGpio</span> <span style="color: #aaccff;">led_gpio</span>;              <span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">LED Instance </span><span style="color: #5f5f5f; font-style: italic;">*/</span><span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">Initialize LED GPIO settings </span><span style="color: #5f5f5f; font-style: italic;">*/</span>XGpio_Initialize<span style="color: #aadddd;">(</span>&amp;led_gpio, XPAR_AXI_GPIO_0_DEVICE_ID<span style="color: #aadddd;">)</span>;XGpio_SetDataDirection<span style="color: #aadddd;">(</span>&amp;led_gpio, 1, 0<span style="color: #aadddd;">)</span>;</pre></div><p>æˆ‘å€‘é€é printf å»é¡¯ç¤ºä¸€äº›ç°¡å–®å¾—é™¤éŒ¯è¨Šæ¯ï¼Œé€™é‚Šçš„è¨Šæ¯æœƒé€é UART è¼¸å‡ºï¼Œä½ å¯ä»¥é€éé›»è…¦ç«¯çš„è»Ÿé«”ä¾†æ”¶åˆ°(ex: gtktermã€teraterm)ï¼Œæˆ‘è‡ªå·±æ˜¯é€é emacs çš„ <code>serial-term</code> å‘½ä»¤ä¾†æ”¶è¨Šæ¯ï¼Œbaud rate å‰‡æ˜¯è¨­å®šç‚º <code>115200</code> ã€é€£æ¥ç›®æ¨™å‰‡æ˜¯ <code>/dev/ttyUSB1</code> ã€‚</p><div class="org-src-container"><pre class="src src-c"><span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">Output something via UART1, 115200 baudrate </span><span style="color: #5f5f5f; font-style: italic;">*/</span>printf<span style="color: #aadddd;">(</span><span style="color: #aadddd;">"Start to blink led !!!\n\r"</span><span style="color: #aadddd;">)</span>;</pre></div><p>æœ€å¾Œï¼Œä½¿ç”¨ä¸€å€‹ç„¡çª®è¿´åœˆå»æ§åˆ¶ LED æ•¸å€¼çš„è®ŠåŒ–ï¼Œä¸¦é€é <code>XGpio_DiscreteWrite</code> å»å° GPIO çš„é€šé“ 1 (åƒè€ƒå‰é¢ Block Design) é€²è¡Œè³‡æ–™å¯«å…¥çš„å·¥ç¨‹ï¼Œå†èª¿æ•´ä¸‹ä¸€æ¬¡åˆ°è¿´åœˆæ™‚è¦çš„ LED æ•¸å€¼ï¼Œä¸€ç›´é‡è¤‡é€™äº›å‹•ä½œã€‚</p><p>å°±é€™æ¨£ï¼Œæˆ‘å€‘çš„ç¨‹å¼å®Œæˆäº†ã€‚</p><div class="org-src-container"><pre class="src src-c"><span style="color: #fff59d;">int</span> <span style="color: #aaccff;">led_value</span> = 0x03;   <span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">default led value </span><span style="color: #5f5f5f; font-style: italic;">*/</span><span style="color: #aaffaa;">while</span><span style="color: #aadddd;">(</span>1<span style="color: #aadddd;">)</span> <span style="color: #aadddd;">{</span>        printf<span style="color: #81d4fa;">(</span><span style="color: #aadddd;">"led value set to 0x%X\n\n"</span>, led_value<span style="color: #81d4fa;">)</span>;        <span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">Set GPIO Channel 1 value. </span><span style="color: #5f5f5f; font-style: italic;">*/</span>        XGpio_DiscreteWrite<span style="color: #81d4fa;">(</span>&amp;led_gpio, 1, led_value<span style="color: #81d4fa;">)</span>;        <span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">sleep and change led value </span><span style="color: #5f5f5f; font-style: italic;">*/</span>        simple_delay<span style="color: #81d4fa;">(</span>10000000<span style="color: #81d4fa;">)</span>;        led_value = ~led_value;<span style="color: #aadddd;">}</span></pre></div></div></div></div><div id="outline-container-org81136b8" class="outline-2"><h2 id="org81136b8">ä¸‹è¼‰åˆ° Zybo board</h2><div class="outline-text-2" id="text-org81136b8"><p>ç¢ºå®šæ­¤æ™‚ä½ æœ‰å°‡ Zybo board æ¥åˆ°é›»è…¦ï¼Œä¸¦ä¸”ä½  <code>JP5</code> è¨­å®šåœ¨ <code>QSPI</code> æ¨¡å¼ä¸‹ï¼Œå°±åƒé€™æ¨£</p><div class="figure"><p><img src="qspi.png"></p></div><p>é¸æ“‡ <code>Xilinx Tools -&gt; Program FPGA</code> é€²è¡Œ FPGA çš„ç‡’éŒ„ã€‚</p><div class="figure"><p><img src="d1.png"></p></div><p>ç¢ºèªè¦ç‡’éŒ„çš„è³‡æ–™ç„¡èª¤å¾Œï¼Œé»é¸ <code>Program</code> å°‡ä½å…ƒæµ (bitstream) ç‡’éŒ„åˆ° FPGA å»ï¼Œç‡’å®Œå¾Œä½ æœƒç™¼ç¾ LD0 ~ LD3 éƒ½æ˜¯äº®ç‡ˆçš„ç‹€æ…‹ï¼Œå› ç‚ºæˆ‘å€‘åœ¨ Block Design é è¨­ AXI_GPIO è¼¸å‡ºç‚º <code>0xF</code> ã€‚</p><div class="figure"><p><img src="d2.png"></p></div><p>é¸æ“‡ <code>Run -&gt; Run Configuration</code> é€²è¡ŒåŸ·è¡Œå‰çš„ä¸€äº›è¨­å®šã€‚</p><div class="figure"><p><img src="d3.png"></p></div><p>æˆ‘å€‘åœ¨ <code>Xilinx C/C++ Application(GDB)</code> å»ºç«‹ä¸€å€‹æ–°çš„è¨­å®šï¼Œç”±æ–¼æˆ‘å€‘å·²ç¶“ç‡’éŒ„å¥½ FPGA å› æ­¤åªéœ€è¦é‡èµ·è™•ç†å™¨ç³»çµ± (Processing System, PS)å³å¯ã€‚</p><p>ç¢ºèªä½ æœ‰å•Ÿç”¨ <code>ps7_init</code> é€™äº›è¨­å®šï¼Œps7_init å®šç¾©äº†ä¸€äº›åˆå§‹åŒ–çš„ç¨‹å¼ï¼Œæˆ‘å€‘ä¹‹æ‰€ä»¥èƒ½å¤ ä½¿ç”¨ <code>printf</code> å°‡è³‡è¨Šé€é UART è¼¸å‡ºï¼Œä¹Ÿæ˜¯é€é ps7_init çš„å”åŠ©ï¼Œå…·é«”è«‹åƒè€ƒ <a href="http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_2/ug1165-zynq-embedded-design-tutorial.pdf" target="_blank" rel="external">Zynq-7000 All Programmable SoC: Embedded Design Tutorial A Hands-On Guide to Effective Embedded System Design (UG1165)</a>, p.24 é ã€‚</p><div class="figure"><p><img src="d4.png"></p></div><p>é™¤äº†é€™é‚Šè¨­å®šå¤–ï¼Œåˆ¥å¿˜è¨˜æŒ‡å®šè¦è·‘çš„å°ˆæ¡ˆï¼ŒXilinx SDK æ˜¯å…è¨±åŒä»½ç¡¬é«”è¨­è¨ˆæª”è·‘å¾ˆå¤šç¨®å°ˆæ¡ˆçš„ï¼Œä»¥æœ¬æ–‡ç¯„ä¾‹è€Œè¨€ï¼Œæˆ‘å€‘è¦è·‘å¾—å°ˆæ¡ˆå«åš <code>LED</code> ã€‚</p><div class="figure"><p><img src="d5.png"></p></div><p>éƒ½è¨­å®šå¥½å¾Œï¼Œé»é¸ <code>Run</code> ç„¶å¾Œç¥ˆç¦±ä¸€åˆ‡æ­£å¸¸!!</p></div></div><div id="outline-container-org57e917f" class="outline-2"><h2 id="org57e917f">çµæœ</h2><div class="outline-text-2" id="text-org57e917f"><p>åœ¨ä½ åŸ·è¡Œ <i>Program device</i> ä»¥åŠ <i>Run</i> å¾Œï¼ŒXilinx SDK æœƒå°‡ä½å…ƒæµ(bitstream) ä¸‹è¼‰åˆ°æˆ‘å€‘çš„ Zybo Boardï¼Œæ¥è‘—é‡è¨­ CPU å¾ŒåŸ·è¡Œæˆ‘å€‘ä¸‹è¼‰çš„ç¨‹å¼ï¼Œæœ€å¾Œå®Œæˆçš„æˆæœå¦‚ä¸‹</p><div class="figure"><p><img src="result.gif"></p></div><p>å¦‚æœä½ æœ‰å•Ÿç”¨å¯ä»¥æ¥æ”¶ UART ç›¸é—œçš„ç¨‹å¼ï¼Œå¦‚ gtktermã€teratermã€screenã€emacs ç­‰çš„è©±ï¼Œå•Ÿå‹•å®ƒä¸¦é–‹å•Ÿ <code>/dev/ttyUSB1</code> å¾Œï¼Œè¨­å®š baudrate ç‚º <code>115200</code> ï¼Œå°±æœƒçœ‹åˆ°æˆ‘å€‘ç¨‹å¼é€é <code>printf</code> è¼¸å‡ºçš„è¨Šæ¯</p><div class="figure"><p><img src="s.png"></p></div></div></div><div id="outline-container-orgea2cab4" class="outline-2"><h2 id="orgea2cab4">å–å¾—ç¨‹å¼ç¢¼</h2><div class="outline-text-2" id="text-orgea2cab4"><p>æœ¬æ–‡çš„ç¯„ä¾‹å·²ç¶“æ”¾ç½®æ–¼ <a href="https://github.com/coldnew/zybo-examples" target="_blank" rel="external">GitHub</a> ä¸Šï¼Œä½ å¯ä»¥åˆ°ä»¥ä¸‹çš„ repo å»å°‹æ‰¾ï¼Œå…·é«”å°ˆæ¡ˆå°æ‡‰çš„æ•™å­¸åç¨±ï¼Œå‰‡è«‹åƒè€ƒ <code>README.md</code> æª”æ¡ˆ</p><div data-theme="default" data-height="" data-width="400" data-github="coldnew/zybo-examples" class="github-card"></div><script src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script></div></div><div id="outline-container-org5a3a758" class="outline-2"><h2 id="org5a3a758">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org5a3a758"><p><code>[1]</code> <a href="http://www.zynqbook.com/" target="_blank" rel="external">The Zynq Book</a></p><p><code>[2]</code> <a href="http://sunsided.github.io/zybo-tutorial/" target="_blank" rel="external">ZYBO Quick-Start Tutorial</a></p><p><code>[3]</code> <a href="http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_1/ug1043-embedded-system-tools.pdf" target="_blank" rel="external">XILINX - Embedded System Tools Reference Manual</a></p><p><code>[4]</code> <a href="http://www.xilinx.com/support/documentation/ip_documentation/axi_gpio/v2_0/pg144-axi-gpio.pdf" target="_blank" rel="external">AXI GPIO v2.0 LogiCORE IP Product Guide</a></p><p><code>[5]</code> <a href="http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_3/oslib_rm.pdf" target="_blank" rel="external">Xilinx OS and Libraries Document Collection (UG643)</a></p><p><code>[6]</code> <a href="http://www.dbrss.org/zybo/tutorial1.html" target="_blank" rel="external">ZYBO Zync-7000 Development Board Work - Getting the LEDs to flash</a></p><p><code>[7]</code> <a href="http://www.xilinx.com/support/documentation/sw_manuals/xilinx2015_2/ug1165-zynq-embedded-design-tutorial.pdf" target="_blank" rel="external">Zynq-7000 All Programmable SoC: Embedded Design Tutorial A Hands-On Guide to Effective Embedded System Design (UG1165)</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/dec85bd3/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board é–‹ç™¼è¨˜éŒ„: é€éå¯ç¨‹å¼é‚è¼¯æ§åˆ¶ LED é–ƒçˆ</title>
      <link>https://coldnew.github.io/6c5717d7/</link>
      <guid>https://coldnew.github.io/6c5717d7/</guid>
      <pubDate>Sat, 02 Jul 2016 08:40:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
åœ¨é€²å…¥åˆ°é€™ç¨®æ··æ­ ARM/FPGA çš„é–‹ç™¼æ¿çš„ä¸–ç•Œä¹‹å‰ï¼Œå¾ˆå¤šäººéƒ½æ˜¯å¾ç´”ç²¹çš„ FPGA é–‹ç™¼æ¿ç©èµ·ï¼Œå› æ­¤ä¹Ÿè®“æˆ‘å€‘çœ‹çœ‹å¦‚ä½•åƒ…é€éå¯ç¨‹å¼é‚è¼¯(Programmable Logic, PL) ä¾†å° Zybo board ä¸Šé¢çš„ LED é€²è¡Œé–ƒçˆæ§åˆ¶ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>åœ¨é€²å…¥åˆ°é€™ç¨®æ··æ­ ARM/FPGA çš„é–‹ç™¼æ¿çš„ä¸–ç•Œä¹‹å‰ï¼Œå¾ˆå¤šäººéƒ½æ˜¯å¾ç´”ç²¹çš„ FPGA é–‹ç™¼æ¿ç©èµ·ï¼Œå› æ­¤ä¹Ÿè®“æˆ‘å€‘çœ‹çœ‹å¦‚ä½•åƒ…é€éå¯ç¨‹å¼é‚è¼¯(Programmable Logic, PL) ä¾†å° Zybo board ä¸Šé¢çš„ LED é€²è¡Œé–ƒçˆæ§åˆ¶ã€‚</p><a id="more"></a><p>æœ¬æ–‡å°‡æ¡ç”¨æ¥­ç•Œæ¯”è¼ƒå¸¸ç”¨çš„ Verilog é€²è¡Œç¤ºç¯„ã€‚</p><div id="outline-container-org0c47947" class="outline-2"><h2 id="org0c47947">é–‹ç™¼ç›®æ¨™</h2><div class="outline-text-2" id="text-org0c47947"><p>æˆ‘å€‘è¦é€éç´”ç²¹çš„å¯ç¨‹å¼é‚è¼¯(Programmable Logic, PL) å»æ§åˆ¶ LEDï¼Œä¹Ÿå°±æ˜¯èªªï¼Œæˆ‘å€‘åªå¯«ç¡¬é«”æè¿°èªè¨€ Verilog ä¾†æ§åˆ¶ Zybo board ä¸Šé¢çš„ LEDï¼Œè®“ä»–ä¾ç…§æˆ‘å€‘è¨­å®šçš„é »ç‡é€²è¡Œé–ƒçˆ/äº®æ»…ã€‚</p><div class="figure"><p><img src="zybo_led.png"></p></div><p>æ ¹æ“š <a href="https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf" target="_blank" rel="external">ZYBO FPGA Board Reference Manual</a> ä¸Šé¢çš„è³‡è¨Šï¼Œæˆ‘å€‘æƒ³è¦æ§åˆ¶çš„é€™å››å€‹åœ¨æ¿å­ä¸Šçš„ LED éƒ½æ˜¯ä½æ–¼å¯ç¨‹å¼é‚è¼¯å€(Programmable Logic, PL)å¯ä»¥ç¢°è§¸åˆ°çš„åœ°æ–¹ï¼Œå¦‚æœä½ æƒ³è¦é€é Zynq å»å°é€™äº› LED é€²è¡Œæ§åˆ¶ï¼Œä½ å°±æœƒéœ€è¦é€é  AXI GPIO çš„å¹«åŠ©ï¼Œå°±åƒé€™æ¨£:</p><div class="figure"><p><img src="zynq_axi_gpio_led.png"></p></div><p>é—œæ–¼å¦‚ä½•åœ¨ Zynq ä¸‹é¢æ§åˆ¶é€™å¹¾å€‹ LEDï¼Œé€™éƒ¨ä»½æˆ‘å€‘å°‡ä¸‹ä¸€ç¯‡æ–‡ç« å†ä¾†æåŠã€‚</p></div></div><div id="outline-container-orgc6bafbf" class="outline-2"><h2 id="orgc6bafbf">å»ºç«‹æˆ‘å€‘çš„å°ˆæ¡ˆ</h2><div class="outline-text-2" id="text-orgc6bafbf"><p>æˆ‘å€‘é¦–å…ˆç•¶ç„¶æ˜¯å»ºç«‹æˆ‘å€‘çš„å°ˆæ¡ˆäº†ï¼Œåœ¨é€²è¡Œé€™ä¸€æ­¥å‰ï¼Œè«‹å…ˆç¢ºå®šä½ æœ‰æŒ‰ç…§ <a href="https://coldnew.github.io/zybo-board/vivado_zybo_setting_file/">è®“ Vivado æœ‰ Zybo Board çš„è¨­å®šæª”</a> ä¸€æ–‡æ‰€èªªï¼Œå°‡ Zybo board çš„è¨­è¨ˆå°å…¥ã€‚</p><p>å•Ÿå‹•äº† Vivado å¾Œï¼Œé»é¸ <code>Create Project</code> ã€‚</p><div class="figure"><p><img src="create_prj0.png"></p></div><p>æ¥ä¸‹ä¾†æŒ‡å®šå¥½ä½ çš„å°ˆæ¡ˆåç¨±èˆ‡è·¯å¾‘</p><div class="figure"><p><img src="create_prj1.png"></p></div><p>é¸æ“‡ <code>RTL Project</code></p><div class="figure"><p><img src="new_prj.png"></p></div><p>åœ¨é–‹ç™¼æ¿é¸é …ä¸­ï¼Œé¸æ“‡ <code>Zybo Board</code></p><div class="figure"><p><img src="new_prj2.png"></p></div><p>å®Œæˆå°ˆæ¡ˆå»ºç«‹</p><div class="figure"><p><img src="new_prj3.png"></p></div></div></div><div id="outline-container-org57f7aa3" class="outline-2"><h2 id="org57f7aa3">æ’°å¯«ç¨‹å¼</h2><div class="outline-text-2" id="text-org57f7aa3"><p>åœ¨å°ˆæ¡ˆå»ºç«‹å®Œå¾Œï¼Œæ¥ä¸‹ä¾†å°±æ˜¯æ·»åŠ ä¸¦æ’°å¯«æˆ‘å€‘çš„ Verilog ç¨‹å¼ï¼Œé»é¸ <code>Project Manager -&gt; Add sources</code> ä¾†å¢åŠ æª”æ¡ˆ</p><div class="figure"><p><img src="create_prj2.png"></p></div><p>ç”±æ–¼æˆ‘å€‘è¦å¢åŠ çš„æ˜¯å¯ç¨‹å¼é‚è¼¯çš„è¨­è¨ˆæª”ï¼Œå› æ­¤é¸æ“‡ <code>Add or create design sources</code></p><div class="figure"><p><img src="add_sources1.png"></p></div><p>é¸æ“‡ <code>Create File</code> å»å»ºç«‹ <code>top.v</code> é€™å€‹æª”æ¡ˆï¼Œé€™ä¹ŸåŒæ™‚æ˜¯æˆ‘å€‘çš„ä¸»ç¨‹å¼</p><div class="figure"><p><img src="add_sources2.png"></p></div><p>å»ºç«‹å¥½ top.v å¾Œï¼Œé»é¸å®ƒä¾†é€²è¡Œç·¨è¼¯</p><div class="figure"><p><img src="add_sources3.png"></p></div></div><div id="outline-container-orgc6a5ac6" class="outline-3"><h3 id="orgc6a5ac6">top.v</h3><div class="outline-text-3" id="text-orgc6a5ac6"><p>åœ¨æˆ‘å€‘çš„ä¸»ç¨‹å¼ top.v ä¸­ï¼Œæˆ‘å€‘å®šç¾©äº†ä¸€çµ„æš«å­˜å™¨ç”¨ä¾†å­˜æ”¾ç•¶å‰è¨ˆæ•¸çš„ç‹€æ…‹ï¼Œæ¯è¨ˆæ•¸ 125 ç™¾è¬æ¬¡å¾Œï¼Œå°±è®“ led æš«å­˜å™¨çš„æ•¸å€¼å¢åŠ ï¼Œåä¹‹å‰‡æ˜¯è®“è¨ˆæ•¸å™¨çš„å…§å®¹å¢åŠ ã€‚</p><p>é¸æ“‡è¨ˆæ•¸ 125 ç™¾è¬æ¬¡çš„åŸå› ï¼Œåœ¨æ–¼æˆ‘å€‘æœƒæŠŠ <code>clk</code> é€™å€‹è¼¸å…¥ï¼Œé€£çµåˆ° <code>125M Hz</code> çš„æ™‚è„ˆè¼¸å…¥ï¼Œé€™å€‹æ™‚è„ˆæ˜¯ç”± 50M Hz çš„çŸ³è‹±æŒ¯ç›ªå™¨ç¶“é Ethernet PHY å¾Œæ‰€ç”¢ç”Ÿçš„</p><div class="figure"><p><img src="clock_source.png"></p></div><p>ä¹Ÿå°±æ˜¯èªªï¼Œç”±æ–¼æˆ‘å€‘çš„æ™‚è„ˆè¼¸å…¥å°‡æœƒè¨­å®šç‚º 125 MHzï¼Œå› æ­¤è®“è¨ˆæ•¸å™¨è¨ˆæ•¸ 125 ç™¾è¬æ¬¡å¾Œèª¿æ•´ LED æš«å­˜å™¨çš„è³‡è¨Šï¼Œç›¸ç•¶æ–¼ <code>æ¯ 1 ç§’</code> ä¿®æ”¹ä¸€æ¬¡ LED æš«å­˜å™¨çš„å…§å®¹</p><p>æˆ‘å€‘çš„ top.v ç¨‹å¼å¦‚ä¸‹</p><div class="org-src-container"><pre class="src src-verilog"><span style="color: #ff8888;">`timescale</span> 1ns / 1ps<span style="color: #aaffaa;">module</span> <span style="color: #aaccff;">top</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">output</span> <span style="color: #81d4fa;">[</span>3:0<span style="color: #81d4fa;">]</span> led,           <span style="color: #fff59d;">input</span> clk<span style="color: #aadddd;">)</span>;   <span style="color: #fff59d;">reg</span> <span style="color: #aadddd;">[</span>3:0<span style="color: #aadddd;">]</span>     led;   <span style="color: #fff59d;">reg</span> <span style="color: #aadddd;">[</span>26:0<span style="color: #aadddd;">]</span>    counter;   <span style="color: #aaffaa;">always</span> <span style="color: #fff59d;">@</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">posedge</span> clk<span style="color: #aadddd;">)</span> <span style="color: #fff59d;">begin</span>      <span style="color: #aaffaa;">if</span> <span style="color: #aadddd;">(</span>counter == 27'd1250000000<span style="color: #aadddd;">)</span> <span style="color: #fff59d;">begin</span>         led &lt;= led + 1;         counter &lt;= 0;      <span style="color: #fff59d;">end</span>      <span style="color: #aaffaa;">else</span> <span style="color: #fff59d;">begin</span>         counter &lt;= counter +1;      <span style="color: #fff59d;">end</span>   <span style="color: #fff59d;">end</span><span style="color: #aaffaa;">endmodule</span></pre></div></div></div></div><div id="outline-container-org8d3b34a" class="outline-2"><h2 id="org8d3b34a">åŠ å…¥ Constraints</h2><div class="outline-text-2" id="text-org8d3b34a"><p>æˆ‘å€‘æ’°å¯«å¥½äº† Verilog æ¨¡çµ„ top.vï¼Œæ¥ä¸‹ä¾†å°±æ˜¯è¦è®“é€™æ¨¡çµ„çš„ I/O å’Œ Zybo board çš„è…³ä½å°æ‡‰åˆ°ï¼Œæˆ‘å€‘å…ˆé€£çµåˆ° <a href="https://reference.digilentinc.com/zybo:zybo" target="_blank" rel="external">Zybo Resource Center</a> å»ä¸‹è¼‰ <code>Master XDC</code> æª”æ¡ˆã€‚</p><div class="figure"><p><img src="dl_constraints.png"></p></div><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥é€é wget å‘½ä»¤ä¸‹è¼‰ä¸¦è§£å£“å‡º <code>ZYBO_Master.xdc</code> é€™å€‹æª”æ¡ˆï¼Œå®ƒå°±æ˜¯æœ¬ç¯€è¦åŠ å…¥çš„ Constraints æª”</p><pre class="example">coldnew@gentoo /tmp $ wget https://reference.digilentinc.com/_media/zybo/zybo_master_xdc.zipcoldnew@gentoo /tmp $ unzip zybo_master_xdc.zipArchive:  zybo_master_xdc.zip  inflating: ZYBO_Master.xdc</pre><p>æ¥ä¸‹ä¾†ä¸€æ¨£é¸æ“‡ <code>Project Manager -&gt; Add sources</code> ä¾†å¢åŠ æª”æ¡ˆ</p><div class="figure"><p><img src="create_prj2.png"></p></div><p>é€™æ¬¡æˆ‘å€‘è¦å¢åŠ çš„æ˜¯ Constraints æª”ï¼Œå› æ­¤é¸æ“‡ <code>Add or create constraints</code></p><div class="figure"><p><img src="add_constraints1.png"></p></div><p>é€é <code>Add Files</code> æ·»åŠ å‰›å‰›ä¸‹è¼‰çš„ ZYBO_Master.xdc æª”æ¡ˆ</p><div class="figure"><p><img src="add_constraints2.png"></p></div></div><div id="outline-container-orga3b2278" class="outline-3"><h3 id="orga3b2278">ZYBO_Master.xdc</h3><div class="outline-text-3" id="text-orga3b2278"><p>åœ¨ ZYBO_Master.xdc è£¡é¢ï¼Œé è¨­æ‰€æœ‰å°æ‡‰æ¥è…³éƒ½æ˜¯è¢«è¨»è§£æ‰çš„ï¼Œé€™é‚Šæˆ‘å€‘åè¨»è§£æˆ‘å€‘éœ€è¦çš„ clk ä»¥åŠ led æ¥è…³ï¼Œè¦æ³¨æ„åˆ°é€™é‚Šçš„ I/O åç¨±è¦å°æ‡‰åˆ°å‰é¢æ‰€å¯«çš„ top.v è£¡é¢çš„ I/O åç¨±ã€‚</p><div class="org-src-container"><pre class="src src-sh"><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">Clock signal</span><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">IO_L11P_T1_SRCC_35</span>set_property PACKAGE_PIN L16 <span style="color: #aadddd;">[</span>get_ports clk<span style="color: #aadddd;">]</span>set_property IOSTANDARD LVCMOS33 <span style="color: #aadddd;">[</span>get_ports clk<span style="color: #aadddd;">]</span><span style="color: #5f5f5f; font-style: italic;">#</span><span style="color: #9ac; font-style: italic;">create_clock -add -name sys_clk_pin -period 8.00 -waveform {0 4} [get_ports clk]</span><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">LEDs</span><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">IO_L23P_T3_35</span>set_property PACKAGE_PIN M14 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>0<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span>set_property IOSTANDARD LVCMOS33 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>0<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">IO_L23N_T3_35</span>set_property PACKAGE_PIN M15 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>1<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span>set_property IOSTANDARD LVCMOS33 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>1<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">IO_0_35</span>set_property PACKAGE_PIN G14 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>2<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span>set_property IOSTANDARD LVCMOS33 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>2<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span><span style="color: #5f5f5f; font-style: italic;">##</span><span style="color: #9ac; font-style: italic;">IO_L3N_T0_DQS_AD1N_35</span>set_property PACKAGE_PIN D18 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>3<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span>set_property IOSTANDARD LVCMOS33 <span style="color: #aadddd;">[</span>get_ports <span style="color: #81d4fa;">{</span>led<span style="color: #aaccff;">[</span>3<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span></pre></div><p>é€™æ¨£æˆ‘å€‘å°±æŠŠ Verilog æ¨¡çµ„å’Œå¯¦éš›ç¡¬é«”å°æ‡‰çš„éƒ¨ä»½è§£æ±ºäº†</p></div></div></div><div id="outline-container-orgf2103a0" class="outline-2"><h2 id="orgf2103a0">ç”¢ç”Ÿä½å…ƒæµ (bitstream)</h2><div class="outline-text-2" id="text-orgf2103a0"><p>å‰é¢çš„è™•ç†éƒ½å¥½äº†å¾Œï¼Œæ¥ä¸‹ä¾†é»é¸ <code>Program and Debug -&gt; Generate Bitstream</code> å»è®“ Vivado å°‡é€™å€‹å°ˆæ¡ˆç”¢ç”Ÿå‡ºä½å…ƒæµ (bitstream)ï¼ŒZYNQ æœƒæ ¹æ“š bitstream çš„è³‡è¨Šå° FPGA é€²è¡Œè¨­å®šã€‚</p><div class="figure"><p><img src="gen_bitstream.png"></p></div><p>ç•¶ bitstream ç”¢ç”Ÿå®Œæˆå¾Œï¼Œæœƒå½ˆå‡ºä¸€å€‹è¦–çª—ï¼Œé€™é‚Šæˆ‘å€‘é¸æ“‡ <code>Open Harware Manager</code> é€²å…¥åˆ°ä¸‹è¼‰ç¨‹åº</p><div class="figure"><p><img src="hwm1.png"></p></div></div></div><div id="outline-container-org3fc7e6f" class="outline-2"><h2 id="org3fc7e6f">ä¸‹è¼‰åˆ° Zybo board</h2><div class="outline-text-2" id="text-org3fc7e6f"><p>ç¢ºå®šæ­¤æ™‚ä½ æœ‰å°‡ Zybo board æ¥åˆ°é›»è…¦ï¼Œä¸¦ä¸”ä½  <code>JP5</code> è¨­å®šåœ¨ <code>QSPI</code> æ¨¡å¼ä¸‹ï¼Œå°±åƒé€™æ¨£</p><div class="figure"><p><img src="qspi.png"></p></div><p>é»é¸ <code>Open target</code> é¸æ“‡æˆ‘å€‘çš„ç›®æ¨™é–‹ç™¼æ¿</p><div class="figure"><p><img src="hwm2.png"></p></div><p>é¸æ“‡ Auto Connect è®“ Vivado è‡ªè¡Œå°‹æ‰¾ä¸‹è¼‰ç›®æ¨™</p><div class="figure"><p><img src="hwm3.png"></p></div><p>Vivado å‘Šè¨´æˆ‘å€‘æ‰¾åˆ°äº†ä¸€å°ä½¿ç”¨ <code>xc7z010</code> IC çš„æ¿å­ï¼Œå°±æ˜¯æˆ‘å€‘çš„ Zybo boardï¼Œé¸æ“‡é€™å€‹é€²è¡Œç‡’éŒ„</p><div class="figure"><p><img src="hwm4.png"></p></div><p>åœ¨ä¸‹è¼‰å‰ï¼ŒVivado æœƒåœ¨ç¢ºèªä¸€æ¬¡ bitstream çš„ä½ç½®ï¼Œç¢ºèªç„¡èª¤å¾Œé»é¸ <code>Program</code> é€²è¡Œç‡’éŒ„</p><div class="figure"><p><img src="hwm5.png"></p></div></div></div><div id="outline-container-orgf1d81ef" class="outline-2"><h2 id="orgf1d81ef">çµæœ</h2><div class="outline-text-2" id="text-orgf1d81ef"><p>åœ¨ä½ åŸ·è¡Œ <i>Program device</i> å¾Œï¼ŒVivado æœƒå°‡å‰›å‰›ç”¢ç”Ÿçš„ bitstream ä¸‹è¼‰åˆ°æˆ‘å€‘çš„ Zybo Board ä¸¦åŸ·è¡Œå®ƒï¼Œæœ€å¾Œå®Œæˆçš„æˆæœå¦‚ä¸‹</p><div class="figure"><p><img src="result.gif"></p></div></div></div><div id="outline-container-org9ac3806" class="outline-2"><h2 id="org9ac3806">å–å¾—ç¨‹å¼ç¢¼</h2><div class="outline-text-2" id="text-org9ac3806"><p>æœ¬æ–‡çš„ç¯„ä¾‹å·²ç¶“æ”¾ç½®æ–¼ <a href="https://github.com/coldnew/zybo-examples" target="_blank" rel="external">GitHub</a> ä¸Šï¼Œä½ å¯ä»¥åˆ°ä»¥ä¸‹çš„ repo å»å°‹æ‰¾ï¼Œå…·é«”å°ˆæ¡ˆå°æ‡‰çš„æ•™å­¸åç¨±ï¼Œå‰‡è«‹åƒè€ƒ <code>README.md</code> æª”æ¡ˆ</p><div data-theme="default" data-height="" data-width="400" data-github="coldnew/zybo-examples" class="github-card"></div><script src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script></div></div><div id="outline-container-org77670e5" class="outline-2"><h2 id="org77670e5">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org77670e5"><p><code>[1]</code> <a href="http://johanngoetz.blogspot.tw/2014/04/first-steps-with-zybo-development-board.html" target="_blank" rel="external">FPGA Programming: First Steps with the ZYBO Development Board</a></p><p><code>[2]</code> <a href="http://www.borisivanov.com/fpga/verilog_zybo1.pdf" target="_blank" rel="external">Simple Verilog example useing Vivado 2015 with zybo FPGA board v0.1</a></p><p><code>[3]</code> <a href="http://ece.gmu.edu/coursewebpages/ECE/ECE699_SW_HW/S15/viewgraphs/ECE699_lecture_3.pdf" target="_blank" rel="external">ECE 699: Lecture 3 General Purpose Input Output GPIO</a></p><p><code>[4]</code> <a href="http://www.beyond-circuits.com/wordpress/tutorial/tutorial1/" target="_blank" rel="external">Tutorial 1: The Simplest FPGA in the World | Beyond Circuits</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/6c5717d7/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board é–‹ç™¼è¨˜éŒ„: è®“ Vivado æœ‰ Zybo Board çš„è¨­å®šæª”</title>
      <link>https://coldnew.github.io/cd57308/</link>
      <guid>https://coldnew.github.io/cd57308/</guid>
      <pubDate>Mon, 27 Jun 2016 09:49:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
åœ¨é€é &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot;&gt;Vivado&lt;/a&gt; å»å»ºç«‹æ–°çš„å°ˆæ¡ˆçš„æ™‚å€™ï¼Œé–‹ç™¼æ¿æ²’æœ‰ Zybo Board çš„é¸é …å¯ä»¥é¸ï¼Œæˆ‘å€‘å°±å¿…é ˆè‡ªå·±å»è¨­å®šé—œæ–¼ Zybo Board çš„è³‡è¨Šã€‚å¹¸å¥½ï¼Œ &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot;&gt;Digilentinc&lt;/a&gt; é‡å°é€™å€‹å•é¡Œæœ‰æä¾›é—œæ–¼ Zybo Board çš„è¨­å®šæª”ï¼Œå°±è®“æˆ‘å€‘ä¾†æå®šä»–å§ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>åœ¨é€é <a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado</a> å»å»ºç«‹æ–°çš„å°ˆæ¡ˆçš„æ™‚å€™ï¼Œé–‹ç™¼æ¿æ²’æœ‰ Zybo Board çš„é¸é …å¯ä»¥é¸ï¼Œæˆ‘å€‘å°±å¿…é ˆè‡ªå·±å»è¨­å®šé—œæ–¼ Zybo Board çš„è³‡è¨Šã€‚å¹¸å¥½ï¼Œ <a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Digilentinc</a> é‡å°é€™å€‹å•é¡Œæœ‰æä¾›é—œæ–¼ Zybo Board çš„è¨­å®šæª”ï¼Œå°±è®“æˆ‘å€‘ä¾†æå®šä»–å§ã€‚</p><a id="more"></a><p>é—œæ–¼ Zybo Board çš„è¨­å®šæª”å¯ä»¥åœ¨ <a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Digilentinc</a> çš„ GitHub ä¸Šæ‰¾åˆ°</p><div data-theme="default" data-height="150" data-width="400" data-github="Digilent/vivado-boards" class="github-card"></div><script src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script><div id="outline-container-org2e635bf" class="outline-2"><h2 id="org2e635bf">ä¸‹è¼‰è¨­å®šæª”</h2><div class="outline-text-2" id="text-org2e635bf"><p>æˆ‘å€‘å¯ä»¥é€é git æˆ–æ˜¯ç›´æ¥ä¸‹è¼‰ <a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Digilentinc</a> ä½æ–¼ GitHub çš„ <a href="https://github.com/Digilent/vivado-boards/archive/master.zip" target="_blank" rel="external">è¨­å®šæª”</a> ï¼Œé€™é‚Šæ¡ç”¨ wget é€²è¡Œä¸‹è¼‰ã€‚</p><pre class="example">coldnew@gentoo ~ $ wget https://github.com/Digilent/vivado-boards/archive/master.zip</pre><p>ä¸‹è¼‰å®Œæˆå¾Œï¼Œå°‡å…¶è§£å£“</p><pre class="example">coldnew@gentoo ~ $ unzip master.zip</pre><p>ä½ æœƒçœ‹åˆ°è£¡é¢æœ‰ä»¥ä¸‹å…§å®¹ï¼Œå¯¦éš›ä¸Šé€™ä»½å£“ç¸®åŒ…åŒ…å«äº†æ‰€æœ‰ <a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Digilentinc</a> è¨­è¨ˆçš„ Xilinx ç›¸é—œçš„é–‹ç™¼æ¿çš„è¨­å®šè³‡è¨Šã€‚</p><pre class="example">coldnew@gentoo ~/vivado-boards-master $ tree -L 3 .. &lt;b&gt;â”œâ”€â”€ new &lt;b&gt;â”‚Â Â  â””â”€â”€ board_files &lt;b&gt;â”‚Â Â      â”œâ”€â”€ arty &lt;b&gt;â”‚Â Â      â”œâ”€â”€ arty-z20  &lt;b&gt;â”‚Â Â      â”œâ”€â”€ basys3  &lt;b&gt;â”‚Â Â      â”œâ”€â”€ cmod_a7-15t  &lt;b&gt;â”‚Â Â      â”œâ”€â”€ cmod_a7-35t  &lt;b&gt;â”‚Â Â      â”œâ”€â”€ genesys2  &lt;b&gt;â”‚Â Â      â”œâ”€â”€ nexys4  &lt;b&gt;â”‚Â Â      â”œâ”€â”€ nexys4_ddr  &lt;b&gt;â”‚Â Â      â”œâ”€â”€ nexys_video  &lt;b&gt;â”‚Â Â      â””â”€â”€ zybo  &lt;b&gt;â”œâ”€â”€ old  &lt;b&gt;â”‚Â Â  â””â”€â”€ board_parts  &lt;b&gt;â”‚Â Â      â”œâ”€â”€ artix7  &lt;b&gt;â”‚Â Â      â”œâ”€â”€ kintex7  &lt;b&gt;â”‚Â Â      â””â”€â”€ zynq  &lt;b&gt;â””â”€â”€ README.md17 directories, 1 file</pre></div></div><div id="outline-container-orgb003e0b" class="outline-2"><h2 id="orgb003e0b">å®‰è£è¨­å®šæª”</h2><div class="outline-text-2" id="text-orgb003e0b"><p>æ¥ä¸‹ä¾†å°±æ˜¯é€²è¡Œå®‰è£äº†ï¼Œå‡è¨­ä½ çš„ <a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado</a> å®‰è£åˆ° <code>/opt/Xilinx/Vivado/2016.1/</code> çš„è©±ï¼Œæˆ‘å€‘è¦æŠŠ <code>vivado-boards-master/new/board_files</code> è¤‡è£½éå»</p><pre class="example">coldnew@gentoo ~/vivado-boards-master $ cp -rf new/board_files /opt/Xilinx/Vivado/2016.1/data/boards/</pre><p>å®Œæˆå¾Œï¼Œä½ åœ¨ <code>/opt/Xilinx/Vivado/2016.1/data/boards/</code> çš„è³‡æ–™æ‡‰è©²æœƒåƒé€™æ¨£</p><pre class="example">coldnew@gentoo /opt/Xilinx/Vivado/2016.1/data/boards/board_files $ tree -L 1 .. &lt;b&gt;â”œâ”€â”€ ac701 &lt;b&gt;â”œâ”€â”€ arty &lt;b&gt;â”œâ”€â”€ basys3 &lt;b&gt;â”œâ”€â”€ cmod_a7-15t &lt;b&gt;â”œâ”€â”€ cmod_a7-35t &lt;b&gt;â”œâ”€â”€ genesys2 &lt;b&gt;â”œâ”€â”€ nexys4 &lt;b&gt;â”œâ”€â”€ nexys4_ddr &lt;b&gt;â”œâ”€â”€ nexys_video &lt;b&gt;â”œâ”€â”€ README.mdâ”œâ”€â”€ zc702 &lt;b&gt;â”œâ”€â”€ zed &lt;b&gt;â””â”€â”€ zybo &lt;b&gt;12 directories, 1 file</pre></div></div><div id="outline-container-orge9fb992" class="outline-2"><h2 id="orge9fb992">å»ºç«‹å°ˆæ¡ˆ</h2><div class="outline-text-2" id="text-orge9fb992"><p>å¦‚æœä½ å®‰è£éç¨‹éƒ½æ²’é‡åˆ°å•é¡Œï¼Œé‡æ–°å•Ÿå‹• <a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado</a> å»ºç«‹æ–°çš„å°ˆæ¡ˆï¼Œå°±å¯ä»¥çœ‹åˆ° Zybo Board çš„é–‹ç™¼æ¿è¨­å®šå›‰~</p><div class="figure"><p><img src="zybo_create_prj.png"></p></div></div></div><div id="outline-container-org02bfdcf" class="outline-2"><h2 id="org02bfdcf">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org02bfdcf"><p><code>[1]</code> <a href="https://reference.digilentinc.com/vivado/boardfiles2015" target="_blank" rel="external">https://reference.digilentinc.com/vivado/boardfiles2015</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/cd57308/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board é–‹ç™¼è¨˜éŒ„: Xilinx SDK åœ¨ Linux çš„ä¸€äº›æ³¨æ„äº‹é …</title>
      <link>https://coldnew.github.io/8d3a2531/</link>
      <guid>https://coldnew.github.io/8d3a2531/</guid>
      <pubDate>Mon, 27 Jun 2016 07:38:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
åœ¨ä½¿ç”¨ Xilinx çš„é–‹ç™¼ç’°å¢ƒ &lt;a href=&quot;http://www.xilinx.com/products/design-tools/vivado.html&quot;&gt;Vivado 2016.1&lt;/a&gt; æœ‰é‡åˆ°ä¸€äº›å•é¡Œï¼Œç‰¹åˆ¥ç´€éŒ„ä¹‹ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>åœ¨ä½¿ç”¨ Xilinx çš„é–‹ç™¼ç’°å¢ƒ <a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado 2016.1</a> æœ‰é‡åˆ°ä¸€äº›å•é¡Œï¼Œç‰¹åˆ¥ç´€éŒ„ä¹‹ã€‚</p><a id="more"></a><p>(Xilinx çš„é–‹ç™¼ç’°å¢ƒ <a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado</a> ä½¿ç”¨ Java é–‹ç™¼ï¼Œè€Œ Altera çš„ <a href="http://dl.altera.com/?edition=lite" target="_blank" rel="external">Quartus</a> ä½¿ç”¨ Qt é–‹ç™¼ï¼Œä»¥æˆ‘é‡åˆ°çš„ç‹€æ³ä¾†èªªï¼Œå¾Œè€…åœ¨ Linux ä¸Šçš„é«”é©—å¥½å¤šäº†ã€‚)</p><div id="outline-container-orgf96db8c" class="outline-2"><h2 id="orgf96db8c">å®‰è£ Vivado åœ¨å…¶ä»–çš„ Linux å¹³å°</h2><div class="outline-text-2" id="text-orgf96db8c"><p><a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado</a> å®‰è£ç¨‹å¼åœ¨éå®˜æ–¹æ”¯æ´çš„ Linux å¹³å°ä¸Šå¯èƒ½æœƒå°è‡´å®‰è£å‡ºå•é¡Œï¼Œä»¥æˆ‘çš„ Gentoo Linux ç‚ºä¾‹ï¼Œæˆ‘å¿…é ˆæŠŠè§£å£“å‡ºçš„ <code>xsetup</code> å®‰è£è…³æœ¬è£¡é¢çš„é€™éƒ¨åˆ†ä¿®æ”¹æ‰ï¼Œä¸ç„¶æœƒåœ¨ 64bit ä¸¦å…·æœ‰ 32bit å‡½å¼åº«çš„ Gentoo Linux ä¸‹å®‰è£å¤±æ•—ã€‚</p><div class="org-src-container"><pre class="src src-sh"><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">ERROR out if this installation is running on 32 bit OS</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">and does not support 32 bit installation</span><span style="color: #aaffaa;">if</span> <span style="color: #aadddd;">[</span> <span style="color: #aadddd;">"$(</span><span style="color: #fa8072;">uname</span><span style="color: #aadddd;"> -i)"</span> != <span style="color: #aadddd;">"x86_64"</span> <span style="color: #aadddd;">]</span>; <span style="color: #aaffaa;">then</span>    <span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">check that the 32 bit library directory exist or not</span>    <span style="color: #aaccff;">lnx32LibDir</span>=<span style="color: #aadddd;">"${workingDir}/lib/lnx32.o"</span>    <span style="color: #aaffaa;">if</span> <span style="color: #aadddd;">[</span> <span style="color: #ff3333;">!</span> -d $<span style="color: #aaccff;">lnx32LibDir</span> <span style="color: #aadddd;">]</span>; <span style="color: #aaffaa;">then</span>        <span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">terminate with an ERROR</span>        <span style="color: #ccaaff;">echo</span> <span style="color: #aadddd;">"ERROR: This installation is not supported on 32 bit platforms."</span>        <span style="color: #aaffaa;">exit</span> 1  <span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">&lt;----- NOTE: Just remove this line if your linux is 64-bit system</span>    <span style="color: #aaffaa;">fi</span><span style="color: #aaffaa;">fi</span></pre></div></div></div><div id="outline-container-org8a12bd1" class="outline-2"><h2 id="org8a12bd1">è®“ Linux è¾¨è­˜ USB UART</h2><div class="outline-text-2" id="text-org8a12bd1"><p>å¦‚æœä½ æ¥ä¸Š USB åˆ° Zybo Board çš„ USB UART æ¥è…³ï¼Œå»æ²’åœ¨ä½ çš„ Linux ä¸Šé¢çœ‹åˆ°ä»»ä½• <code>/dev/ttyUSB*</code> è¢«å»ºç«‹çš„è©±ï¼Œé‚£å°±æ˜¯ä½ å°‘è£äº†ä¸€äº› UDEV ruleï¼Œé€™é‚Šçš„èªªæ˜å¯ä»¥åœ¨  <a href="http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_2/ug973-vivado-release-notes-install-license.pdf" target="_blank" rel="external">Vivado Design Suite User Guide</a> æ‰¾åˆ°ï¼Œç°¡å–®çš„èªª&#x2026;.</p><p>å‡è¨­ä½ çš„ vivado å®‰è£åœ¨ <code>/opt/Xilinx/Vivado/2016.1</code> çš„è©±ï¼Œæˆ‘å€‘å¯ä»¥é€éä»¥ä¸‹ç¨‹å¼ä¾†å®‰è£ udev è¨­å®šã€‚</p><pre class="example">/opt/Xilinx/Vivado/2016.1/data/xicom/cable_drivers/lin64/install_script/install_drivers/install_digilent.sh</pre></div></div><div id="outline-container-org4a257d9" class="outline-2"><h2 id="org4a257d9">HiDPI ç’°å¢ƒä¸‹çš„ Vivado å•é¡Œ</h2><div class="outline-text-2" id="text-org4a257d9"><p>æˆ‘æ˜¯åœ¨ Macbook Pro 2015 ä¸Šç›´æ¥å®‰è£ Gentoo Linux ä¾†åŸ·è¡Œ Vivado, å› æ­¤æœƒé‡åˆ°é¡¯ç¤ºå‡ºä¾†çš„ Vivado ç¨‹å¼å› ç‚º DPI è¨­å®šçš„å•é¡Œï¼Œå°è‡´ç•«é¢å¤ªå°ï¼Œåƒé€™æ¨£</p><div class="figure"><p><img src="vivado_hidpi_issue.png"></p></div><p>é€™å•é¡Œçš„å…ƒå…‡æ˜¯ <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">Oracle JDK</a> ä½¿ç”¨ <a href="https://zh.wikipedia.org/zh-tw/Swing_%28Java%29" target="_blank" rel="external">Java Swing</a> æ™‚ï¼Œåœ¨ Linux ä¸Šä¸¦æœªæ”¯æ´ HiDPI è§£æåº¦ï¼Œå°è‡´å‡ºç¾çš„ç•«é¢å¤ªå°ï¼Œé€™ <a href="http://openjdk.java.net/jeps/263" target="_blank" rel="external">å•é¡Œ</a> æ“šèªªæœƒä¿®æ­£åœ¨ JDK 9 ä¸Šï¼Œç›®å‰æˆ‘å€‘åªèƒ½ç”¨ä¸€äº›è‡¨æ™‚è§£ (workround)ä¾†è™•ç†é€™ç‹€æ³ï¼Œæˆ–æ˜¯å°‡ Vivado è¦–çª—ç§»å‹•åˆ°è§£æåº¦æ²’é‚£æ¨£å¥½çš„å¤–æ¥è¢å¹•ä¸Šä¹Ÿå¯ä»¥ã€‚</p><p>é‡å° HiDPI ä¸‹ï¼Œæˆ‘æ¡ç”¨çš„å¦å¤–ä¸€ç¨®è§£æ±ºæ–¹æ¡ˆæ˜¯ä½¿ç”¨ <a href="https://github.com/feklee/vncdesk" target="_blank" rel="external">vncdesk</a> ä¾†å”åŠ©æˆ‘å€‘é€é VNC å”å®šå°ç‰¹å®šçš„ç¨‹å¼é€²è¡Œè¦–çª—çš„ç¸®æ”¾åŠŸèƒ½ï¼Œè©²ç¨‹å¼æœƒåœ¨èƒŒæ™¯å•Ÿå‹•ä¸€å€‹ VNC ä¼ºæœå™¨ï¼Œç„¶å¾Œåœ¨æ ¹æ“šæˆ‘å€‘çš„è¨­å®šå•Ÿå‹•æˆ‘å€‘éœ€è¦çš„ç¨‹å¼ï¼Œæ¥è‘—å‘¼å« VNC Client ä¸¦é€²è¡Œç•«é¢ç¸®æ”¾ä¾†é”åˆ°æˆ‘å€‘çš„è¦æ±‚ã€‚</p><p>åœ¨ Gentoo Linux ä¸Šï¼Œä½ å¯ä»¥é€éæˆ‘å¯«å¥½çš„ <a href="https://github.com/coldnew/coldnew-overlay/blob/master/app-misc/vncdesk/vncdesk-1.4.0.ebuild" target="_blank" rel="external">ebuild</a> ä¾†å®‰è£ vncdesk</p><pre class="example">coldnew@gentoo ~ $ sudo emerge app-misc/vncdesk</pre><p>å¦å¤–è¦æ³¨æ„åˆ°çš„æ˜¯ï¼Œvncdesk åªæ”¯æ´ Python 3.xï¼Œå› æ­¤ä½ ä¹Ÿéœ€è¦å°‡ç³»çµ±çš„ python ç‰ˆæœ¬åˆ‡æ›åˆ° 3.x ç³»åˆ—ï¼Œé€™é‚Šæˆ‘å°‡å®ƒåˆ‡æ›åˆ° Python 3.4 å»ã€‚</p><pre class="example">coldnew@gentoo ~ $ sudo eselect python listAvailable Python interpreters, in order of preference:  [1]   python2.7  [2]   python3.4  [3]   python3.5 (fallback)coldnew@gentoo ~ $ sudo eselect python set 2</pre><p>å®Œæˆå¾Œï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘è¦å»ºç«‹ä¸€äº›è¨­å®šæª”æ¡ˆï¼Œæˆ‘å€‘é¦–å…ˆå…ˆå»ºç«‹ <code>~/.vncdesk</code> è³‡æ–™å¤¾</p><pre class="example">coldnew@gentoo ~ $ mkdir -p ~/.vncdesk</pre><p>å‡è¨­æˆ‘å€‘è¦ä½¿ç”¨ <code>DISPLAY=:21</code> ä¾†ä½œç‚º Vivado é¡¯ç¤ºç”¨çš„ä½ç½®çš„è©±ï¼Œæˆ‘å€‘è¦å»ºç«‹ <code>~/.vncdesk/21</code> é€™æ¨£çš„è³‡æ–™å¤¾</p><pre class="example">coldnew@gentoo ~ $ mkdir -p ~/.vncdesk/21</pre><p>è€Œåœ¨ <code>~/.vncdesk/21</code> å‰‡è¦å†å»ºç«‹ä»¥ä¸‹å…©å€‹æª”æ¡ˆ</p><pre class="example">coldnew@gentoo ~/vncdesk/21 $ tree .. &lt;b&gt;â”œâ”€â”€ settings.iniâ””â”€â”€ startup &lt;g&gt;0 directories, 2 files</pre><p>æˆ‘å€‘å…ˆä¾†çœ‹ <code>settings.ini</code> é€™å€‹æª”æ¡ˆï¼Œé€™æ˜¯ vncdesk æœ€ä¸»è¦çš„è¨­å®šï¼Œè£¡é¢åŒ…å«äº†ä½ è¦å»ºç«‹çš„è¦–çª—åç¨±ã€å¤§å°ä»¥åŠç¸®æ”¾åº¦</p><div class="org-src-container"><pre class="src src-conf">[<span style="color: #fff59d;">desktop</span>]<span style="color: #aaccff;">width</span> = 1280<span style="color: #aaccff;">height</span> = 800[<span style="color: #fff59d;">window</span>]<span style="color: #aaccff;">title</span> = Xilinx Vivado<span style="color: #aaccff;">name</span> = vivado in vncdesk<span style="color: #aaccff;">class</span> = FigInVncdesk<span style="color: #aaccff;">scale_factor</span> = 1.8</pre></div><p>æ¥ä¸‹ä¾†å‰‡æ˜¯æˆ‘å€‘åŸ·è¡Œç¨‹å¼ç”¨çš„è…³æœ¬ <code>startup</code> ï¼Œè¨˜å¾—é€™å€‹æª”æ¡ˆéœ€è¦åŠ ä¸ŠåŸ·è¡Œæ¬Šé™ï¼Œåœ¨é€™ä»½æª”æ¡ˆä¸­ï¼Œæˆ‘å€‘å…ˆè¨­å®šå¹¾å€‹ç’°å¢ƒè®Šæ•¸ï¼Œæ¥è‘—ç”±æ–¼å¯èƒ½æœƒæœ‰å¤šè¦–çª—çš„éœ€æ±‚ï¼Œå› æ­¤å•Ÿç”¨ <code>openbox</code> 1 ä½œç‚ºçª—å£ç®¡ç†ç¨‹å¼ï¼Œæœ€å¾Œå‰‡æ˜¯å•Ÿå‹• vivado é€™éš»ç¨‹å¼ã€‚</p><p>æ³¨æ„åˆ° <code>export SWT_GTK3=0</code> é€™å€‹è¨­å®šï¼Œå¾…æœƒæœƒè§£é‡‹å®ƒåˆ°åº•æœƒæœ‰å•¥å½±éŸ¿ï¼Œç¸½ä¹‹å…ˆç…§è‘—è¨­å®šå°±æ˜¯äº†ã€‚</p><div class="org-src-container"><pre class="src src-sh"><span style="color: #5f5f5f; font-style: italic;">#</span><span style="color: #9ac; font-style: italic;">!/bin/</span><span style="color: #aaffaa;">sh</span><span style="color: #ccaaff;">export</span> <span style="color: #aaccff;">LC_ALL</span>=C<span style="color: #ccaaff;">export</span> <span style="color: #aaccff;">SWT_GTK3</span>=0   <span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">Fix annoying error on Xilinx SDK</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">Make java application look more nice</span><span style="color: #aaccff;">_SILENT_JAVA_OPTIONS</span>=<span style="color: #aadddd;">"-Dawt.useSystemAAFontSettings=on -Dsun.java2d.xrender=true -Dswing.aatext=true"</span><span style="color: #ccaaff;">unset</span> _JAVA_OPTIONS<span style="color: #ccaaff;">alias</span> <span style="color: #aaccff;">java</span>=<span style="color: #aadddd;">'java $_SILENT_JAVA_OPTIONS'</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">start window manager</span>openbox &amp;<span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">Source vivado env before launch</span><span style="color: #ccaaff;">export</span> <span style="color: #aaccff;">TARGET_DIR</span>=/opt/Xilinx/Vivado/2016.1<span style="color: #ccaaff;">source</span> $<span style="color: #aaccff;">TARGET_DIR</span>/settings64.sh<span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">Launch Vivado</span><span style="color: #ccaaff;">cd</span> /tmp<span style="color: #aaffaa;">exec</span> $<span style="color: #aaccff;">TARGET_DIR</span>/bin/vivado</pre></div><p>é€™å…©å€‹è¨­å®šéƒ½å»ºç«‹å¥½ä»¥å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤å»åŸ·è¡Œç•«é¢æœ‰ç¸®æ”¾éçš„ Vivado ç¨‹å¼</p><pre class="example">coldnew@gentoo ~ $ vncdesk 21</pre><p>é¡¯ç¤ºçš„ç•«é¢æœƒè®Šæˆé€™æ¨£ï¼Œåœ¨ HiDPI çš„ç’°å¢ƒä¸‹ä¹Ÿå°±æ¸…æ¥šå¤šäº†</p><div class="figure"><p><img src="vncdesk.png"></p></div></div></div><div id="outline-container-org3e6221b" class="outline-2"><h2 id="org3e6221b">ä¸€å®šè¦è¨­å®š export SWT_GTK3=0</h2><div class="outline-text-2" id="text-org3e6221b"><p>åœ¨ä¸Šé¢æˆ‘å€‘èªªäº†è¦è¨­å®š <code>SWT_GTK3=0</code> ï¼Œå¦‚æœä¸è¨­å®šçš„è©±ï¼Œå¾ˆå®¹æ˜“å‡ºç¾å•é¡Œï¼Œä»¥æˆ‘é‡åˆ°çš„ç‹€æ³ä¾†è¬›ï¼Œæˆ‘åœ¨ Xilinx SDK æƒ³è¦å»ºç«‹ Zynq Boot Imageï¼Œä½†æ˜¯è¦–çª—å»ä¸æœƒçµ¦æˆ‘å½ˆå‡ºä¾†</p><iframe width="420" height="315" src="https://www.youtube.com/embed/AQtjDvPhMiQ" frameborder="0" allowfullscreen></iframe><p>å¦‚æœä½ è¨­å®šäº† <code>SWT_GTK3=0</code> å¾Œåœ¨å•Ÿå‹• Xilinx SDKï¼Œé€™å•é¡Œå°±ä¸è¦‹å›‰ = =|||</p><iframe width="420" height="315" src="https://www.youtube.com/embed/dRtCMgc-bHA" frameborder="0" allowfullscreen></iframe></div></div><div id="outline-container-orge5cfc8f" class="outline-2"><h2 id="orge5cfc8f">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-orge5cfc8f"><p><code>[1]</code> <a href="http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_2/ug973-vivado-release-notes-install-license.pdf" target="_blank" rel="external">Vivado Design Suite User Guide</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/8d3a2531/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board é–‹ç™¼è¨˜éŒ„: å‡ç´š Digilent æä¾›çš„è¨­è¨ˆæª”</title>
      <link>https://coldnew.github.io/49454c4d/</link>
      <guid>https://coldnew.github.io/49454c4d/</guid>
      <pubDate>Sun, 26 Jun 2016 15:31:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
&lt;a href=&quot;http://store.digilentinc.com/&quot;&gt;Digilent&lt;/a&gt; é‡å° &lt;a href=&quot;http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot;&gt;Zybo board&lt;/a&gt; ç”¨æ–¼ Embedded Linux çš„ç’°å¢ƒä¸Šï¼Œæä¾›äº†ä¸€å€‹é å…ˆå®šç¾©å¥½æ¥è…³çš„è¨­å®šæª” (zybo_base_system)ï¼Œ &lt;a href=&quot;https://reference.digilentinc.com/_media/zybo/zybo_base_system.zip&quot;&gt;æ—©æœŸçš„ç‰ˆæœ¬&lt;/a&gt; æ˜¯ç›´æ¥å°‡å°ˆæ¡ˆæ‰“åŒ…èµ·ä¾†é‡‹å‡ºï¼Œå¾ŒæœŸå‰‡æ¡ç”¨ git å»é€²è¡Œç¶­è­·ï¼Œå…¶å°ˆæ¡ˆä½æ–¼ &lt;a href=&quot;https://github.com/Digilent/ZYBO&quot;&gt;GitHub&lt;/a&gt; ä¸Šã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p><a href="http://store.digilentinc.com/" target="_blank" rel="external">Digilent</a> é‡å° <a href="http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Zybo board</a> ç”¨æ–¼ Embedded Linux çš„ç’°å¢ƒä¸Šï¼Œæä¾›äº†ä¸€å€‹é å…ˆå®šç¾©å¥½æ¥è…³çš„è¨­å®šæª” (zybo_base_system)ï¼Œ <a href="https://reference.digilentinc.com/_media/zybo/zybo_base_system.zip" target="_blank" rel="external">æ—©æœŸçš„ç‰ˆæœ¬</a> æ˜¯ç›´æ¥å°‡å°ˆæ¡ˆæ‰“åŒ…èµ·ä¾†é‡‹å‡ºï¼Œå¾ŒæœŸå‰‡æ¡ç”¨ git å»é€²è¡Œç¶­è­·ï¼Œå…¶å°ˆæ¡ˆä½æ–¼ <a href="https://github.com/Digilent/ZYBO" target="_blank" rel="external">GitHub</a> ä¸Šã€‚</p><a id="more"></a><div data-theme="default" data-height="150" data-width="400" data-github="Digilent/ZYBO" class="github-card"></div><script src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script><p>ç”±æ–¼ <a href="http://store.digilentinc.com/" target="_blank" rel="external">Digilent</a> æä¾›çš„ git ç‰ˆæœ¬çš„ <a href="http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Zybo board</a> <a href="https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd" target="_blank" rel="external">è¨­å®šæª”</a> æœƒå› ç‚º Xilinx çš„ <a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado</a> é–‹ç™¼å·¥å…·çš„ç‰ˆæœ¬å‡ç´šè€Œè®Šæˆç‰ˆæœ¬ä¸åŒ¹é…çš„ç‹€æ³ï¼Œæœ¬æ–‡å°‡ç´€éŒ„å¦‚ä½•å°è©²è¨­å®šæª”é€²è¡Œå‡ç´šä¸¦ç”¢ç”Ÿæˆ‘å€‘çš„å°ˆæ¡ˆã€‚</p><p>åœ¨æ’°å¯«æœ¬æ–‡æ™‚ï¼Œè©²è¨­å®šæª” commit id ç‚º <a href="https://github.com/Digilent/ZYBO/commit/177c2c97c5cae29a05359479565c2f5256d8d629" target="_blank" rel="external">177c2c</a> ï¼Œä½¿ç”¨çš„æ˜¯ <a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado</a> 2015.4 ç‰ˆæœ¬ï¼Œ æˆ‘å€‘è¦å°‡å®ƒå‡ç´šåˆ° <a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado</a> 2016.1 å»ã€‚</p><div id="outline-container-org31d2144" class="outline-2"><h2 id="org31d2144">äº‹å‰æº–å‚™</h2><div class="outline-text-2" id="text-org31d2144"><p>åœ¨é€²è¡Œå‡ç´šæ™‚ï¼Œä½ éœ€è¦å®‰è£å¥½ <a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado</a> 2015.4 ä»¥åŠ <a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado</a> 2016.1 æ‰èƒ½æŒ‰ç…§æœ¬æ–‡çš„æ­¥é©Ÿé€²è¡Œã€‚</p></div></div><div id="outline-container-org174fbd3" class="outline-2"><h2 id="org174fbd3">ä¸‹è¼‰è¨­å®šæª”ä¸¦ç”¨ Vivado 2015.4 é–‹å•Ÿ</h2><div class="outline-text-2" id="text-org174fbd3"><p>æˆ‘å€‘é¦–å…ˆä¸‹è¼‰ <a href="http://store.digilentinc.com/" target="_blank" rel="external">Digilent</a> æä¾›çš„ <a href="https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd" target="_blank" rel="external">Zybo board è¨­å®šæª”</a></p><div class="org-src-container"><pre class="src src-sh">git clone https://github.com/Digilent/ZYBO.git -b vivado-2015.4 63ca49</pre></div><p>æ¥è‘—é€²å…¥åˆ° <code>ZYBO/Projects/linux_bd/proj</code> è³‡æ–™å¤¾å»ï¼Œä½¿ç”¨ä½ çš„ vivado 2015.4 å»ç”¢ç”Ÿæ–°çš„å°ˆæ¡ˆ</p><pre class="example">coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ /opt/Xilinx/Vivado/2015.4/bin/vivado -mode batch -source create_project.tcl</pre><p>å¦‚æœä¸æƒ³ç”¨æŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥æ‰“é–‹ Vivado åœ–å½¢ç•Œé¢ï¼Œé¸æ“‡ <code>Tools -&gt; Run Tcl Script</code> ç„¶å¾Œå†é¸ <code>create_project.tcl</code> é€™æª”æ¡ˆå»åŸ·è¡Œ</p><div class="figure"><p><img src="run_tcl_script.png"></p></div><p>å®Œæˆå¾Œï¼Œä½ æœƒç™¼ç¾ç•¶ä¸‹ç›®éŒ„å¤šå‡ºäº†ä¸€äº›æª”æ¡ˆ</p><pre class="example">coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ tree -L 1. &lt;b&gt;â”œâ”€â”€ cleanup.cmdâ”œâ”€â”€ cleanup.shâ”œâ”€â”€ create_project.tclâ”œâ”€â”€ ip_upgrade.log &lt;g&gt;â”œâ”€â”€ linux_bd.cache &lt;b&gt;â”œâ”€â”€ linux_bd.hw &lt;b&gt;â”œâ”€â”€ linux_bd.ip_user_files &lt;b&gt;â”œâ”€â”€ linux_bd.sim &lt;b&gt;â”œâ”€â”€ linux_bd.srcs &lt;b&gt;â”œâ”€â”€ linux_bd.xprâ”œâ”€â”€ vivado.jouâ””â”€â”€ vivado.log &lt;g&gt;5 directories, 7 files</pre><p>é€™äº› linux_bd.* æª”æ¡ˆå°±æ˜¯æˆ‘å€‘é€é Vivado 2015.4 ç”¢ç”Ÿçš„å°ˆæ¡ˆï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘è¦ç”¨ <code>Vivado 2016.1</code> æ‰“é–‹å®ƒå»åšå‡ç´šçš„å‹•ä½œã€‚</p></div></div><div id="outline-container-org96bba03" class="outline-2"><h2 id="org96bba03">å‡ç´šè¨­å®šæª”</h2><div class="outline-text-2" id="text-org96bba03"><p>æ¥ä¸‹ä¾†æˆ‘å€‘ä½¿ç”¨ <code>Vivado 2016.1</code> æ‰“é–‹æˆ‘å€‘å‰›å‰›ç”¨ Vivado 2015.4 æ‰€ç”¢ç”Ÿçš„ <code>linux_bd.*</code> å°ˆæ¡ˆ</p><div class="figure"><p><img src="prj_upgrade1.png"></p></div><p>ç”±æ–¼åŸæœ¬çš„å°ˆæ¡ˆæ˜¯é€é Vivado 2015.4 ç”¢ç”Ÿçš„ï¼Œå› æ­¤æœƒè¢«è©¢å•è¦ä¸è¦å‡ç´šï¼Œé€™é‚Šé»é¸ <code>Report IP Status</code></p><div class="figure"><p><img src="prj_upgrade2.png"></p></div><p>æ¥ä¸‹ä¾†é»é¸ <code>Upgrade Selected</code> å°‡é€™äº›éæ™‚çš„ IP core é€²è¡Œå‡ç´š</p><div class="figure"><p><img src="prj_upgrade3.png"></p></div><p>æ²’å‡ºéŒ¯çš„è©±ï¼Œéä¸€æ®µæ™‚é–“ Vivado æœƒå›å ±å‡ç´šå®Œæˆ</p><div class="figure"><p><img src="prj_upgrade4.png"></p></div><p>å‡ç´šå®Œæˆå¾Œï¼Œæˆ‘å€‘è¦ç”¢ç”Ÿå¹¾å€‹ç¬¦åˆ Vivado 2016.1 çš„ <code>tcl è…³æœ¬</code> ï¼Œé€™æ¨£ä»¥å¾Œæˆ‘å€‘æ‰å¯ä»¥ç”¨ Vivado 2016.1 ç”¢ç”Ÿæˆ‘å€‘çš„æ–°å°ˆæ¡ˆ</p></div></div><div id="outline-container-org5c13148" class="outline-2"><h2 id="org5c13148">ç”¢ç”Ÿ tcl è…³æœ¬</h2><div class="outline-text-2" id="text-org5c13148"><p>å¥½äº†ï¼Œç¾åœ¨æˆ‘å€‘æŠŠåŸæœ¬ç”¨æ–¼ Vivado 2015.4 çš„ tcl è…³æœ¬æ‰€ç”¢ç”Ÿçš„å°ˆæ¡ˆå‡ç´šåˆ° Vivado 2016.1 äº†ï¼Œå¯¦éš›ä¸Šå°è‡´æˆ‘å€‘ä¸èƒ½å¤ ç›´æ¥ä½¿ç”¨ <a href="http://www.xilinx.com/products/design-tools/vivado.html" target="_blank" rel="external">Vivado</a> 2016.1 ä¾†ç”¢ç”Ÿå°ˆæ¡ˆçš„åŸå› ï¼Œåœ¨æ–¼ <code>src/bd/system.tcl</code> é€™å€‹æª”æ¡ˆå’Œ Vivado çš„ç‰ˆæœ¬æœ‰ä¾è³´æ€§ï¼Œå› æ­¤æˆ‘å€‘è¦é‡æ–°ç”¢ç”Ÿæ–°çš„ <code>system.tc</code> å»å°‡å®ƒæ›¿æ›æ‰</p><p>é€é <code>File -&gt; Export -&gt; Export Block Design</code> ä¾†å°‡æ–°çš„ block design åŒ¯å‡º</p><div class="figure"><p><img src="prj_upgrade7.png"></p></div><p>å°‡å®ƒå­˜æ”¾åˆ° <code>ZYBO/Projects/linux_bd/src/bd/system.tcl</code> å°±å®Œæˆå›‰~</p></div></div><div id="outline-container-orga717c1d" class="outline-2"><h2 id="orga717c1d">å°‡é è¨­èªè¨€è¨­ç‚º Verilog</h2><div class="outline-text-2" id="text-orga717c1d"><p><a href="http://store.digilentinc.com/" target="_blank" rel="external">Digilent</a> é‡å° <a href="http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Zybo board</a> æä¾›ç”¢ç”Ÿå°ˆæ¡ˆç”¨çš„æ¨£æ¿ï¼Œé è¨­æ˜¯æ¡ç”¨ VHDL ä½œç‚ºé€™å€‹å°ˆæ¡ˆç”¨çš„ç¡¬é«”æè¿°èªè¨€ï¼Œå¦‚æœä½ å¸Œæœ›ä¹‹å¾Œé€™æ¨£å»ºç«‹çš„å°ˆæ¡ˆéƒ½æ˜¯é è¨­ä½¿ç”¨ Verilog çš„è©±ï¼Œä½ å¯ä»¥é€™æ¨£ä¿®æ”¹ <code>create_project.tcl</code></p><div class="org-src-container"><pre class="src src-diff"><span style="color: #dddddd;">diff --git a/Projects/linux_bd/proj/create_project.tcl b/Projects/linux_bd/proj/create_project.tcl</span><span style="color: #dddddd;">index 825281a..74c726e 100644</span><span style="color: #aaaaaa; background-color: #202020;">--- </span><span style="color: #aaaaaa; background-color: #202020;">a/Projects/linux_bd/proj/create_project.tcl</span><span style="color: #aaaaaa; background-color: #202020;">+++ </span><span style="color: #aaaaaa; background-color: #202020;">b/Projects/linux_bd/proj/create_project.tcl</span><span style="color: #aaaaaa; background-color: #202020;">@@ -39,7 +39,7 @@</span><span style="color: #aaaaaa; background-color: #202020;"> set_property "default_lib" "xil_defaultlib" $obj</span><span style="color: #dddddd;"> set_property "part" $part $obj</span><span style="color: #dddddd;"> set_property "board_part" $brd_part $obj</span><span style="color: #dddddd;"> set_property "simulator_language" "Mixed" $obj</span><span style="color: #ff3333; font-weight: bold;">-</span><span style="color: #ff3333; font-weight: bold;">set_property "target_language" "VHDL" $obj</span><span style="color: #aaffaa; font-weight: bold;">+</span><span style="color: #aaffaa; font-weight: bold;">set_property "target_language" "Verilog" $obj</span><span style="color: #dddddd;"> # Create 'sources_1' fileset (if not found)</span><span style="color: #dddddd;"> if {[string equal [get_filesets -quiet sources_1] ""]} {</span></pre></div><p>é€™æ¨£ä¸€ä¾†ï¼Œé€é <code>create_project.tcl</code> å»ºç«‹çš„å°ˆæ¡ˆï¼Œä¸ç®¡æ˜¯ HDL wrapper æˆ–æ˜¯é è¨­ HDL éƒ½æœƒæ˜¯ Verilog å›‰~</p></div></div><div id="outline-container-org046962d" class="outline-2"><h2 id="org046962d">é‡å»ºæ–°çš„å°ˆæ¡ˆ</h2><div class="outline-text-2" id="text-org046962d"><p>æˆ‘å€‘å‰›å‰›é‡å»ºäº† <code>src/bd/system.tcl</code> é€™å€‹æª”æ¡ˆï¼Œå°‡å…¶å‡ç´šåˆ° Vivado 2016.1 ç‰ˆæœ¬ï¼Œç¾åœ¨å¯ä»¥è©¦è©¦é‡æ–°ç”¢ç”Ÿæ–°çš„å°ˆæ¡ˆå›‰</p><p>ä¸éç”±æ–¼æˆ‘å€‘å¯èƒ½æœ‰ä¹‹å‰å»ºç«‹å¥½åç‚º <code>linux_bd.*</code> çš„æª”æ¡ˆï¼Œå› æ­¤å¯ä»¥é€é <code>cleanup.sh</code> å»å°‡é€™äº›ç”¢ç”Ÿå‡ºä¾†çš„æª”æ¡ˆæ¸…é™¤</p><pre class="example">coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ sh cleanup.sh</pre><p>æ¥ä¸‹ä¾†ç”¨ Vivado 2016.1 é‡æ–°ç”Ÿå‡ºæ–°çš„å°ˆæ¡ˆå°±å¥½å›‰ ~</p><pre class="example">coldnew@gentoo ~/ZYBO/Projects/linux_bd/proj $ /opt/Xilinx/Vivado/2016.1/bin/vivado -mode batch -source create_project.tcl</pre></div></div><div id="outline-container-org43a459d" class="outline-2"><h2 id="org43a459d">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org43a459d"><p><code>[1]</code> <a href="https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd" target="_blank" rel="external">https://github.com/Digilent/ZYBO/tree/master/Projects/linux_bd</a></p><p><code>[2]</code> <a href="http://xillybus.com/tutorials/vivado-version-control-packaging" target="_blank" rel="external">Vivado: Packaging for version control, distribution and repeatability</a></p><p><code>[3]</code> <a href="http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_1/ug835-vivado-tcl-commands.pdf" target="_blank" rel="external">Vivado Design Suite Tcl Command Reference Guide</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/49454c4d/#disqus_thread</comments>
    </item>
    
    <item>
      <title>zybo board é–‹ç™¼è¨˜éŒ„: ç¡¬é«”èªè­˜</title>
      <link>https://coldnew.github.io/7004ff00/</link>
      <guid>https://coldnew.github.io/7004ff00/</guid>
      <pubDate>Thu, 23 Jun 2016 16:52:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
ç‚ºäº†å­¸ç¿’ RISC-V ä»¥åŠé«”é©—çœ‹çœ‹ Xilinx çš„é–‹ç™¼å¹³å°ï¼Œæœ€è¿‘æˆ‘å…¥æ‰‹äº† &lt;a href=&quot;https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/&quot;&gt;Zybo Board&lt;/a&gt; ï¼Œé€™æ˜¯ä¸€å¡Šå…·æœ‰ FPGA åŒæ™‚åˆåŒ…å«äº† ARM Cortex-A9 é›™æ ¸å¿ƒçš„é–‹ç™¼æ¿ã€‚
&lt;/p&gt;

&lt;p&gt;
åœ¨æˆ‘å€‘é–‹å§‹é€™ä¸€åˆ‡ä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦ç¨å¾®äº†è§£ä¸€ä¸‹é€™ç‰‡é–‹ç™¼æ¿ä»¥åŠä»–çš„é€±é‚Šç­‰è³‡è¨Šã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>ç‚ºäº†å­¸ç¿’ RISC-V ä»¥åŠé«”é©—çœ‹çœ‹ Xilinx çš„é–‹ç™¼å¹³å°ï¼Œæœ€è¿‘æˆ‘å…¥æ‰‹äº† <a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Zybo Board</a> ï¼Œé€™æ˜¯ä¸€å¡Šå…·æœ‰ FPGA åŒæ™‚åˆåŒ…å«äº† ARM Cortex-A9 é›™æ ¸å¿ƒçš„é–‹ç™¼æ¿ã€‚</p><p>åœ¨æˆ‘å€‘é–‹å§‹é€™ä¸€åˆ‡ä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦ç¨å¾®äº†è§£ä¸€ä¸‹é€™ç‰‡é–‹ç™¼æ¿ä»¥åŠä»–çš„é€±é‚Šç­‰è³‡è¨Šã€‚</p><a id="more"></a><p>è¦äº†è§£ <a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Zybo Board</a> çš„é€±é‚Šï¼Œé¦–å…ˆè¦çœ‹çš„å°±æ˜¯é–‹ç™¼å•† <a href="http://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">DIGILENT</a> æ‰€æä¾›çš„ <a href="https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf" target="_blank" rel="external">ZYBO FPGA Board Reference Manual</a>ã€‚è®“æˆ‘å€‘ä¾†çœ‹çœ‹ä¸€äº›æ¯”è¼ƒé‡è¦çš„åœ°æ–¹å§!</p><div id="outline-container-org14ff60c" class="outline-2"><h2 id="org14ff60c">åŸºæœ¬ç¡¬é«”èªè­˜</h2><div class="outline-text-2" id="text-org14ff60c"><p>æ‹¿åˆ°æ‰‹çš„ <a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Zybo Board</a> æœƒåƒä¸‹é¢é€™å€‹æ¨£å­ï¼Œæˆ‘å€‘æœ‰é€™äº›åŸºæœ¬çš„è¼¸å…¥/è¼¸å‡ºæ¨¡çµ„ï¼Œä»¥åŠæœªæ¨™ç¤ºçš„éƒ¨ä»½(Pmod)ï¼Œå¯ä»¥åšå»¶ä¼¸çš„åŠŸèƒ½</p><div class="figure"><p><img src="zybo_a.png"></p></div><p>è®“æˆ‘å€‘ä¾†çœ‹çœ‹é€™äº›é€±é‚Šæ¨¡çµ„å§</p></div></div><div id="outline-container-orgd7e15da" class="outline-2"><h2 id="orgd7e15da">é›»æºè¼¸å…¥(5V)</h2><div class="outline-text-2" id="text-orgd7e15da"><p><a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Zybo Board</a> å…è¨±ä¸‰ç¨®ä¸åŒé¡å‹çš„é›»æºè¼¸å…¥æ¨¡å¼ï¼Œåˆ†åˆ¥æ˜¯ USBã€å¤–æ¥é›»æº(J15)ã€å¤–æ¥é›»æ± ã€‚æˆ‘å€‘å¯ä»¥å¾ <a href="https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf" target="_blank" rel="external">Reference Manual</a> å¾—åˆ°é›»æºæ¨¡çµ„çš„å¤§è‡´è³‡è¨Šã€‚</p><div class="figure"><p><img src="power_cricuit_overview.png"></p></div><p>æ§åˆ¶é›»æºè¼¸å…¥çš„ä½ç½®åœ¨ <code>JP7</code> çš„æ’é‡åº§ä¸Šï¼Œæˆ‘å€‘å¯ä»¥é€éåˆ‡æ›è·³ç·š(Jumper)ä¾†é¸æ“‡æˆ‘å€‘éœ€è¦çš„é›»æºè¼¸å…¥ï¼Œåœ¨é€±é‚Šä½¿ç”¨ä¸å¤šçš„æƒ…æ³ä¸‹ï¼Œæˆ‘æœƒç›´æ¥ä½¿ç”¨ USB (5V) ä¾†ä½œç‚ºé›»æµçš„è¼¸å…¥ã€‚</p><p>è¦æ³¨æ„åˆ°çš„æ˜¯ï¼Œ<a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Zybo Board</a> åƒ…åƒ <code>5V</code> é›»æºï¼Œå› æ­¤ä¸è«–ä½ æ˜¯ç”¨å¤–æ¥é›»æº(J15)æˆ–æ˜¯å¤–æ¥é›»æ± ï¼Œä½ æœ€å¥½éƒ½å…ˆç¢ºèªä½ çš„é›»å£“æ˜¯å¦ç‚º <code>5V</code> (æˆ–æ˜¯ä½æ–¼) ï¼Œå¦å‰‡ä½ çš„é–‹ç™¼æ¿å¯èƒ½å› æ­¤ç‡’å£ã€‚</p><p>æ’ä¸Šé›»æºå¾Œï¼Œé€éé›»æºé–‹é—œ (Power Switch, SW4) çš„åˆ‡æ›å³å¯å®Œæˆçµ¦é›»/æ–·é›»çš„å‹•ä½œã€‚</p></div></div><div id="outline-container-org4369b97" class="outline-2"><h2 id="org4369b97">Zynq SOC</h2><div class="outline-text-2" id="text-org4369b97"><p><a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Zybo Board</a> æ ¸å¿ƒæ˜¯ <a href="http://www.xilinx.com/" target="_blank" rel="external">Xilinx</a> Zynq-7000 ç³»åˆ—çš„ <a href="http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf" target="_blank" rel="external">Z-7010</a> ARM/FPGA SoC è™•ç†å™¨ï¼Œé€™æ˜¯ä¸€ç¨®æ··å’Œäº† FPGA ä»¥åŠ ARM Cortex-A9 è™•ç†å™¨çš„ FPGA æ ¸å¿ƒã€‚ä»¥å¾€çš„ FPGA é–‹ç™¼æ¿éœ€è¦ç”¨åˆ° CPU çš„æ™‚å€™åªèƒ½å¤ ç‡’éŒ„ç”¨ HDL èªè¨€æ’°å¯«çš„è»Ÿæ ¸å¿ƒåˆ°é–‹ç™¼æ¿ä¸Šï¼Œé€™ç¨®æ··æ­ FPGA/ARM çš„é–‹ç™¼æ¿å‰‡æ˜¯è®“ä½ å¯ä»¥é‡å°é€šç”¨éœ€æ±‚ä½¿ç”¨ ARM CPU é€²è¡Œç¨‹å¼çš„é–‹ç™¼ï¼Œç‰¹æ®Šéœ€æ±‚å‰‡é€é FPGA é€²è¡Œè™•ç†/åŠ é€Ÿä¾†é‹ä½œï¼Œæ˜¯ä¸€ç¨®è »æœ‰è¶£çš„æ¶æ§‹ã€‚</p><p>æˆ‘å€‘å¯ä»¥æŠŠ Zynq SoC åˆ†ç‚ºå…©å€‹å€å¡Š, è™•ç†ç³»çµ± (Processing System, PS) ä»¥åŠ å¯ç¨‹å¼é‚è¼¯å€å¡Š(Programmable Logic, PL)ï¼Œåƒé€™æ¨£</p><div class="figure"><p><img src="zynq_block.png"></p></div><p>è™•ç†ç³»çµ±(Processing Syste, PS) ä¹Ÿå°±æ˜¯æœ‰ ARM Cortex-A9 è™•ç†å™¨çš„éƒ¨ä»½ï¼Œå¯ç¨‹å¼é‚è¼¯å€å¡Š(Programmable Logic, PL) å‰‡æ˜¯ FPGA æ‰€åŒ…å«çš„éƒ¨ä»½ã€‚</p><p>åœ¨ä¸Šé¢çš„å€å¡Šåœ–ä¸­ï¼Œæˆ‘å€‘è¦å¦å¤–æ³¨æ„åˆ° <code>MIO (Multiplexed I/O)</code> ä»¥åŠ <code>EMIO (Extended multiplexed I/O)</code> ï¼Œåœ¨ Zynq 7000 ç³»åˆ— SoC ä¸­ï¼Œæˆ‘å€‘å…±æœ‰ 54 å€‹ MIO å¯ç”¨ï¼Œè€Œé€™äº› MIO æ‰€é€£æ¥çš„ä½å€æ˜¯ç„¡æ³•åœ¨ å¯ç¨‹å¼é‚è¼¯å€å¡Š (Programmable Logic, PL) ä¸­çœ‹åˆ°ã€‚</p><p>åœ¨ <a href="https://store.digilentinc.com/zybo-zynq-7000-arm-fpga-soc-trainer-board/" target="_blank" rel="external">Zybo Board</a> æˆ‘å€‘æœ‰é€™å¹¾å€‹åœ°æ–¹æ˜¯é€£æ¥åˆ° MIO (Multiplexed I/O) ä¸Šçš„</p><div class="figure"><p><img src="mio_pinout.png"></p></div></div><div id="outline-container-orga73f0e1" class="outline-3"><h3 id="orga73f0e1">ç³»çµ±å•Ÿå‹•æµç¨‹</h3><div class="outline-text-3" id="text-orga73f0e1"><p>ç”±æ–¼ Zynq 7000 ç³»åˆ—å…§å»ºäº† ARM CPUï¼Œä¹Ÿå› æ­¤å’Œå‚³çµ±çš„ FPGA é–‹ç™¼æ¿ç›¸æ¯”ï¼Œç³»çµ±å•Ÿå‹•æµç¨‹ä¹Ÿæœƒä¸åŒï¼Œæ•´é«”é–‹æ©Ÿæµç¨‹å¯ä»¥åˆ†ç‚ºä¸‰å€‹éšæ®µ:</p><ul class="org-ul"><li><p>éšæ®µ 0</p><p>ç•¶ Zybo board é›»æºå•Ÿå‹•å¾Œï¼ŒCPU0 æœƒåŸ·è¡Œå…§éƒ¨å·²ç¶“é ç‡’éŒ„çš„ç¨‹å¼ BootROMï¼Œé€™å€‹ç¨‹å¼æœƒæ ¹æ“š <code>JP5</code> æ‰€è¨­å®šçš„è³‡è¨Šä¾†æ›´æ–°ç‹€æ…‹æš«å­˜å™¨(mode register)ï¼Œæ¥è‘— BootROM æœƒé€éç‹€æ…‹è®šå­˜å™¨(mode register)çš„è³‡è¨Šå¾ MicroSDã€NOR Flashã€JTAG ç­‰ä½ç½®æŠ“å– Zynq Boot Imageï¼Œä¸¦å°‡åŒ…åœ¨ Zynq Boot Image è£¡é¢çš„ <code>ç¬¬ä¸€ç´šå•Ÿå‹•é–‹æ©Ÿç¨‹å¼ (First Stage Bootloader, FSBL)</code> è¤‡è£½åˆ°å…§éƒ¨ 256KB çš„è¨˜æ†¶é«” (On-Chip Memory, OCM) å»ï¼Œæœ€å¾ŒåŸ·è¡Œ FSBLï¼Œé€²å…¥ä¸‹ä¸€å€‹éšæ®µã€‚</p><p>å¦‚æœ BootROM æ˜¯å› ç‚ºæŒ‰ä¸‹äº† RESET æŒ‰éˆ•ç­‰ç‹€æ³è€Œè¢«åŸ·è¡Œï¼ŒZybo board æœƒé¸ç”¨ä¹‹å‰å·²ç¶“å­˜æ”¾åœ¨ç‹€æ…‹æš«å­˜å™¨(mode register)çš„é–‹æ©Ÿç‹€æ…‹ï¼Œè€Œä¸æ˜¯ç•¶ä¸‹çš„ <code>JP5</code> ç‹€æ…‹ã€‚</p></li><li><p>éšæ®µ 1</p><p>åœ¨é€™éšæ®µä¸­, ç¬¬ä¸€ç´šå•Ÿå‹•é–‹æ©Ÿç¨‹å¼ (First Stage Bootloader, FSBL) åˆå§‹åŒ–äº† DDR è¨˜æ†¶é«”ã€GPIO ç­‰é€±é‚Šè¨­å®šï¼Œæ¥ä¸‹ä¾†æœƒè¼‰å…¥å­˜æ”¾åœ¨ Boot Image å…§çš„ä½å…ƒæµ (bitstream)ï¼Œç”¨ä»–ä¾†å°å¯ç¨‹å¼é‚è¼¯å€å¡Š (Programmable Logic, PL) é€²è¡Œè¨­å®šã€‚</p><p>ç•¶å¯ç¨‹å¼é‚è¼¯å€å¡Š(Programmable Logic, PL)è¨­å®šå®Œæˆå¾Œï¼ŒFSBL æœƒå»è¼‰å…¥ç¨‹å¼(ex: u-boot)ä¸¦åŸ·è¡Œå®ƒã€‚</p></li><li><p>éšæ®µ 2</p><p>æœ€å¾Œçš„æ¥æ®µå³æ˜¯åŸ·è¡Œ FSBL æ‰€è¼‰å…¥çš„ç¨‹å¼ï¼Œé€™äº›ç¨‹å¼å¯ä»¥å¾ç°¡å–®çš„ "Hello World"ï¼Œåˆ°åƒ u-boot é€™æ¨£çš„ç¬¬äºŒéšæ®µé–‹æ©Ÿç¨‹å¼ï¼Œç”¨ä¾†è¼‰å…¥ Linux æˆ–æ˜¯å…¶ä»–çš„ä½œæ¥­ç³»çµ±ã€‚</p></li></ul></div></div><div id="outline-container-org6384830" class="outline-3"><h3 id="org6384830">æ›´æ”¹é–‹æ©Ÿæ¨¡å¼</h3><div class="outline-text-3" id="text-org6384830"><p>æˆ‘å€‘å¯ä»¥é€éåˆ‡æ› <code>JP5</code> çš„è·³ç·š(Jumper)ä¾†æ±ºå®šæˆ‘å€‘è¦é€éå“ªç¨®æ–¹å¼å»è¼‰å…¥ç¬¬ä¸€ç´šå•Ÿå‹•é–‹æ©Ÿç¨‹å¼ (First Stage Bootloader, FSBL)</p><div class="figure"><p><img src="zybo_config_pins.png"></p></div></div><div id="outline-container-orgab44c67" class="outline-4"><h4 id="orgab44c67">MicroSD å•Ÿå‹•</h4><div class="outline-text-4" id="text-orgab44c67"><p>ç•¶ä½¿ç”¨è€…å°‡ MicroSD æ’å…¥åˆ° <code>J4</code> çš„ SD å¡æ§½ï¼Œä¸¦è¨­å®šå¥½ <code>JP5</code> çš„è·³ç·šçš„è©±ï¼Œæˆ‘å€‘å¯ä»¥é€é MicroSD ä¾†é€²è¡Œé–‹æ©Ÿçš„å‹•ä½œã€‚</p><p>è‹¥ä½ å¸Œæœ›é€é MicroSD é€²è¡Œé–‹æ©Ÿï¼Œä½ éœ€è¦å…ˆè¨­å®šå¥½ä½ çš„ SD å¡:</p><ol class="org-ol"><li>é€éé›»è…¦æ ¼å¼åŒ– MicroSD å¡æˆ <code>FAT32</code> æª”æ¡ˆæ ¼å¼</li><li>è¤‡è£½å¾ Xilinx SDK è£½ä½œå‡ºä¾†çš„ Zynq Boot Image åˆ° MicroSD å¡ä¸Š</li><li>å°‡ Zynq Boot Image å‘½åç‚º <code>BOOT.bin</code></li><li>å°‡ MicroSD å¡å¾é›»è…¦ç§»é™¤ï¼Œä¸¦æ’å…¥åˆ° Zybo Board çš„ J4 SD å¡æ§½ä¸Š</li><li>æ¥ä¸Šé›»æºï¼Œä¸¦è¨­å®šå¥½ JP7 (Power Source Select)</li><li>å°‡ <code>JP5</code> çš„è·³ç·š (Jumper) èª¿æ•´åˆ° MicroSD æ¨¡å¼ (æ¿ä¸Šæ¨™ç¤ºç‚º SD çš„é‚£å€‹)</li><li>å•Ÿå‹•é›»æºã€‚æ¥ä¸‹ä¾† Zybo Board å°±æœƒå¾ MicroSD å¡å•Ÿå‹•ã€‚</li></ol></div></div><div id="outline-container-org927cbbe" class="outline-4"><h4 id="org927cbbe">QSPI å•Ÿå‹•</h4><div class="outline-text-4" id="text-org927cbbe"><p>åœ¨ Zybo board ä¸Šæœ‰ä¸€é¡† 128-Mbit Quad-SPI (QSPI) çš„ NOR Flashï¼Œæˆ‘å€‘å¯ä»¥é€é Xilinx ISE å’Œ Vivado ç­‰å·¥å…·å»å°‡ Zynq Boot Image ä¸‹è¼‰åˆ° QSPI Flash ä¸Šã€‚</p><p>ç•¶ä¸‹è¼‰å®Œæˆå¾Œï¼Œç…§é€™æ¨£çš„æ­¥é©Ÿå³å¯é€é QSPI å•Ÿå‹•:</p><ol class="org-ol"><li>æ¥ä¸Šé›»æºï¼Œä¸¦è¨­å®šå¥½ JP7 (Power Source Select)</li><li>å°‡ <code>JP5</code> çš„è·³ç·š (Jumper) èª¿æ•´åˆ° QSPI æ¨¡å¼ (æ¿ä¸Šæ¨™ç¤ºç‚º QSPI çš„é‚£å€‹)</li><li>å•Ÿå‹•é›»æºã€‚æ¥ä¸‹ä¾† Zybo Board å°±æœƒå¾ QSPI å¡å•Ÿå‹•ã€‚</li></ol></div></div><div id="outline-container-org5cc1587" class="outline-4"><h4 id="org5cc1587">JTAG å•Ÿå‹•</h4><div class="outline-text-4" id="text-org5cc1587"><p>ç•¶ä½ å°‡ <code>JP5</code> è¨­å®šç‚º JTAG å•Ÿå‹•æ¨¡å¼ï¼ŒZynq å…§çš„ Cortex-A9 è™•ç†å™¨æœƒç­‰åˆ°é›»è…¦ç«¯çš„ Xilinx å·¥å…·è¼‰å…¥äº†è¦åŸ·è¡Œçš„ç¨‹å¼ä¹‹å¾Œï¼Œå†åŸ·è¡Œé åŸ·è¡Œçš„ç¨‹å¼ï¼Œæˆ–æ˜¯å•Ÿç”¨ä¸€æ­¥ä¸€æ­¥(step-by-step)çš„åŸ·è¡Œæ¨¡å¼ä¾†æ–¹ä¾¿æˆ‘å€‘é™¤éŒ¯ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥é€é iMPACT æˆ–æ˜¯ Vivado Hardware Server é€é JTAG ä¾†è¨­å®šå¯ç¨‹å¼é‚è¼¯å€å¡Š (Programmable Logic, PL)ã€‚</p><p>Zybo Board é è¨­æ˜¯é–‹æ©Ÿå•Ÿå‹• Cascaded JTAG æ¨¡å¼ï¼Œåœ¨é€™ç¨®æ¨¡å¼ä¸‹ è™•ç†å™¨ç³»çµ± (Processing System, PS) å’Œ å¯ç¨‹å¼é‚è¼¯å€å¡Š (Programmable Logic, PL) å¯ä»¥é€éåŒä¸€å€‹ JTAG å»é€²è¡Œæ§åˆ¶ã€‚å¦‚æœä½ å°‡ <code>JP6</code> çŸ­è·¯ï¼Œå‰‡å¯ä»¥è®“ JTAG åƒ…çœ‹å¾—åˆ° å¯ç¨‹å¼é‚è¼¯å€å¡Š (Programmable Logic, PL)ï¼Œåœ¨é€™ç¨®ç‹€æ³ä¸‹ï¼Œä½¿ç”¨è€…å¯ä»¥é€é EMIO (Extended multiplexed I/O) å°‡ PJTAG æ‹‰å‡ºï¼Œè®“å¤–éƒ¨çš„è¨­å‚™å¯ä»¥å’Œ è™•ç†å™¨ç³»çµ± (Processing System, PS) é€²è¡Œæºé€šã€‚</p></div></div></div></div><div id="outline-container-org0f6fbaf" class="outline-2"><h2 id="org0f6fbaf">SPI Flash</h2><div class="outline-text-2" id="text-org0f6fbaf"><p>Zybo Board å…§å»ºäº† 4-bit SPI (QSPI) NOR Flashï¼Œç¡¬ä»¶å‹è™Ÿç‚º <a href="http://www.cypress.com/file/177966/download" target="_blank" rel="external">Spansion S25FL128S</a>ã€‚</p><p>å‡è¨­ <code>JP5</code> è¨­å®šç‚º NOR Flash é–‹æ©Ÿï¼Œå‰‡æˆ‘å€‘å¯ä»¥é€éé€™é¡† NOR Flash ä¾†åˆå§‹åŒ–è™•ç†å™¨ç³»çµ±(Processing System, PS)ä»¥åŠå¯ç¨‹å¼é‚è¼¯å€å¡Š(Programmable Logic, PL)ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç•¶é–‹æ©Ÿå®Œæˆå¾Œï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ Spansionæª”æ¡ˆç³»çµ±(<a href="http://www.cypress.com/software-and-drivers-spansion-flash-memory" target="_blank" rel="external">Spansion Flash File System</a>, FFS) ä¾†å°æª”æ¡ˆé€²è¡Œè®€å¯«çš„è™•ç†ã€‚</p><div class="figure"><p><img src="spi_circuit.png"></p></div><p>å¾é›»è·¯åœ–æˆ‘å€‘å¯ä»¥çœ‹åˆ° SPI Flash æ˜¯ç›´æ¥é€£åˆ° Zynq è™•ç†å™¨ä¸Šçš„ Quad-I/O SPI interfaceã€‚</p></div></div><div id="outline-container-orgeb33e6a" class="outline-2"><h2 id="orgeb33e6a">DDR è¨˜æ†¶é«”</h2><div class="outline-text-2" id="text-orgeb33e6a"><p>Zybo Board ä½¿ç”¨çš„æ˜¯ <a href="https://www.micron.com/~/media/documents/products/data-sheet/dram/ddr3/2gb_ddr3_sdram.pdf" target="_blank" rel="external">Micron MT41J128M16JT-125</a> æˆ–æ˜¯ <a href="https://www.micron.com/~/media/documents/products/data-sheet/dram/ddr3/2gb_1_35v_ddr3l.pdf" target="_blank" rel="external">MT41K128M16JT-125</a> é€™å…©ç¨® DDR3 è¨˜æ†¶é«”å…ƒä»¶ï¼Œåœ¨ Zybo Board ä¸Šæˆ‘å€‘å…±æœ‰ 512MB çš„è¨˜æ†¶é«”ç©ºé–“å¯ä»¥ä½¿ç”¨ã€‚</p><p>æ ¹æ“š <a href="http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf" target="_blank" rel="external">Zynq-7000 All Programmable SoC Technical Reference Manual</a>ï¼ŒDDR3 è¨˜æ†¶é«”æ˜¯ç›´æ¥é€£æ¥åˆ°è™•ç†å™¨ç³»çµ± (Processing System, PS)ã€‚</p></div></div><div id="outline-container-orgd4304d5" class="outline-2"><h2 id="orgd4304d5">USB UART æ¥å£</h2><div class="outline-text-2" id="text-orgd4304d5"><p>Zybo Board ä¸¦æœªå°‡ UART åºåˆ—åŸ æ‹‰å‡ºï¼Œå–è€Œä»£ä¹‹çš„å®ƒæ¡ç”¨äº† <a href="http://www.ftdichip.com/Support/Documents/DataSheets/ICs/DS_FT2232H.pdf" target="_blank" rel="external">FTDI FT2232HQ</a> é€™æ¬¾ USB è½‰ UART çš„ IC è®“ä½ çš„é›»è…¦å¯ä»¥å’Œ Zybo Board é€²è¡Œæºé€šã€‚</p><div class="figure"><p><img src="usb-uart-bridge.png"></p></div><p>å¦‚æœä½ æ˜¯ Linux ä½¿ç”¨è€…ï¼Œåœ¨å®‰è£å®Œ Vivado å¾Œï¼Œä½ æœƒéœ€è¦æ‰‹å‹•å®‰è£ udev è¨­å®šå¥½è®“ Linux å¯ä»¥åµæ¸¬åˆ°é€™å€‹ USB è½‰ UART è¨­å‚™(å…±å…©çµ„ï¼Œ/dev/ttyUSB0, /dev/ttyUSB1)ï¼Œå‡è¨­ä½ çš„ vivado å®‰è£åœ¨ <code>/opt/Xilinx/Vivado/2016.1</code> çš„è©±ï¼Œæˆ‘å€‘å¯ä»¥é€éä»¥ä¸‹ç¨‹å¼ä¾†å®‰è£ udev è¨­å®šã€‚</p><pre class="example">/opt/Xilinx/Vivado/2016.1/data/xicom/cable_drivers/lin64/install_script/install_drivers/install_digilent.sh</pre></div></div><div id="outline-container-orgbffe6e6" class="outline-2"><h2 id="orgbffe6e6">MicroSD æ’æ§½</h2><div class="outline-text-2" id="text-orgbffe6e6"><p>åœ¨ Zybo Board çš„èƒŒé¢ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ° Micro SD æ’æ§½(J4)ï¼Œæ ¹æ“š <a href="http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf" target="_blank" rel="external">Zynq-7000 All Programmable SoC Technical Reference Manual</a> ï¼ŒZynq çš„ SDIO æ§åˆ¶å™¨åƒ…æ”¯æ´ 1-bit æˆ–æ˜¯ 4-bit å‚³è¼¸æ¨¡å¼ (Host Modes)ï¼Œä¸æ”¯æ´ SPI æ¨¡å¼ã€‚</p><div class="figure"><p><img src="microsd_circuit.png"></p></div><p>è€Œ Micro SD ä½¿ç”¨åˆ°çš„ MIO (Multiplexed I/O) è³‡è¨Šå¦‚ä¸‹:</p><div class="figure"><p><img src="microsd_pinout.png"></p></div></div></div><div id="outline-container-org687dade" class="outline-2"><h2 id="org687dade">USB OTG</h2><div class="outline-text-2" id="text-org687dade"><p>Zybo Board æä¾›äº†ä¸€çµ„ <a href="https://zh.wikipedia.org/wiki/USB_On-The-Go" target="_blank" rel="external">USB OTG</a> æ”¯æ´ï¼Œåœ¨é€™å€‹ç•Œé¢ä¸­ä½¿ç”¨äº† Microchip çš„ <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/00001792E.pdf" target="_blank" rel="external">USB3320</a> é€™é¡† IC ä¾†ä½œç‚ºç«¯å£ç‰©ç†å±¤ (Port Physical Layer, PHY)ï¼Œè¦æ³¨æ„åˆ°çš„æ˜¯ï¼Œä½ ä¸å¯ä»¥ <code>åŒæ™‚</code> å°‡ USB ä¸»æ©Ÿ (HOST) ä»¥åŠ USB è¨­å‚™ (Device) æ¥åˆ° USB OTG ç«¯å£ä¸Šã€‚</p><p>(ä¹Ÿå°±æ˜¯ä¸è¦åŒæ™‚æ¥ä¸Šè¨­å‚™åˆ° <code>J9</code> ä»¥åŠ <code>J10</code>)</p><div class="figure"><p><img src="usb_otg_circuit.png"></p></div><p>è€Œåœ¨ USB OTG çš„åŠŸèƒ½ä¸Šï¼Œæˆ‘å€‘å‰‡æ˜¯ç”¨æ‰äº† <code>MIO 28 ~ 39</code> çš„ä½ç½®ã€‚</p><p>å¦å¤–ï¼Œç”±æ–¼ USB 2.0 çš„è¦æ ¼æ˜¯ USB ä¸»æ©Ÿæœ€å¤šå¯ä»¥æä¾› 500mA çš„é›»æµï¼Œç•¶ä½ è¨­å®šç‚º USB ä¸»æ©Ÿçš„æ¨¡å¼æ™‚ï¼Œåœ¨ <code>J11</code> çš„é›»æºç«¯ <code>å¿…é ˆ</code> æ”¹ç”¨å¤–æ¥é›»æºæˆ–æ˜¯é›»æ± è¼¸å…¥ï¼Œé¿å…é›»æµä¸å¤ çš„æƒ…æ³ç™¼ç”Ÿã€‚</p></div></div><div id="outline-container-orgc4e4cd8" class="outline-2"><h2 id="orgc4e4cd8">Ethernet PHY</h2><div class="outline-text-2" id="text-orgc4e4cd8"><p>Zybo Board ä½¿ç”¨ <a href="http://download3.dvd-driver.cz/realtek/datasheets/pdf/rtl8211e%28g%29-vb%28vl%29-cg_datasheet_1.6.pdf" target="_blank" rel="external">Realtek RTL8211E-VL</a> PHY ä¾†å¯¦ç¾ 10/100/1000 ç¶²è·¯å‚³è¼¸çš„åŠŸèƒ½ã€‚å…·é«”ä½¿ç”¨åˆ°çš„ MIO ä»¥åŠ EMIO æ¥è…³è³‡è¨Šå¦‚ä¸‹:</p><div class="figure"><p><img src="ethernet_phy_overview.png"></p></div><p>æˆ‘å€‘å¯ä»¥é€éåœ¨ RJ45 é™„è¿‘çš„ LED ä¾†è§€å¯Ÿæµé‡ (LD7) ä»¥åŠé€£ç·šç‹€æ…‹ (LD6) çš„è³‡è¨Š</p><div class="figure"><p><img src="ethernet_phy_status.png"></p></div><p>ç¶²å¡çš„ MAC ä½å€å‰‡æ˜¯å­˜æ”¾åœ¨ Micrichip <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/22124B.pdf" target="_blank" rel="external">24AA02E48</a> é€™é¡† EEPROM ä¸Šé¢ï¼ŒZynq è™•ç†å™¨é€é EMIO ä¸Šçš„ IÂ²C æ¥å£ä¾†å’Œ EEPROM é€²è¡Œæºé€šã€‚</p><div class="figure"><p><img src="ethernet_macaddr.png"></p></div></div></div><div id="outline-container-org8c95d4e" class="outline-2"><h2 id="org8c95d4e">HDMI Source/Sink</h2><div class="outline-text-2" id="text-org8c95d4e"><p>Zybo Board çš„ HDMI æ¥å£ä¸¦æœªé€éå¤–éƒ¨ IC å»é©…å‹•ï¼Œå› æ­¤æˆ‘å€‘å¿…é ˆé€éå¯ç¨‹å¼é‚è¼¯(Programmable Logic, PL) å»å¯¦ç¾å½±ç‰‡ç·¨ç¢¼ (Encoding)èˆ‡è§£ç¢¼(Decoding)çš„åŠŸèƒ½ã€‚</p><div class="figure"><p><img src="hdmi_circuit.png"></p></div><p>ç”±æ–¼ Zybo Board çš„ HDMI æ¥å£æ”¯æ´ HDMI ä¾†æºè£ç½®(HDMI Source) ä»¥åŠ HDMI ç›®æ¨™è£ç½® (HDMI Sink) çš„åŠŸèƒ½ï¼Œæˆ‘å€‘ä¹Ÿé ˆæ³¨æ„è¨Šè™Ÿçš„æ–¹å‘è®ŠåŒ–ã€‚</p><div class="figure"><p><img src="hdmi_roles.png"></p></div><p>æ ¹æ“š <a href="https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf" target="_blank" rel="external">ZYBO FPGA Board Reference Manual</a> å¯çŸ¥ Zyboard Board çš„ HDMI è‡³å°‘æ”¯æ´åˆ° 720p (1280x720) çš„è§£æåº¦ã€‚</p></div></div><div id="outline-container-orgf512d29" class="outline-2"><h2 id="orgf512d29">VGA</h2><div class="outline-text-2" id="text-orgf512d29"><p>Zybo Board çš„ VGA è¼¸å‡ºä¹Ÿæ˜¯æ²’æœ‰é€éå¤–éƒ¨ IC å°‡æ•¸ä½è¨Šè™Ÿè½‰æ›ç‚ºé¡æ¯”è¨Šè™Ÿï¼Œå–è€Œä»£ä¹‹çš„ï¼Œå®ƒæ¡ç”¨äº† <a href="https://en.wikipedia.org/wiki/Resistor_ladder#R.E2.80.932R_resistor_ladder_network_.28digital_to_analog_conversion.2C_or_DAC.29" target="_blank" rel="external">Râ€“2R resistor ladder</a> é€™ç¨®åˆ†å£“çš„æ–¹å¼å°‡æ•¸ä½è¨Šè™Ÿè®Šæˆäº† VGA ç”¨çš„é¡æ¯”è¨Šè™Ÿã€‚</p><div class="figure"><p><img src="vga_circuit.png"></p></div></div></div><div id="outline-container-org8d8f9bf" class="outline-2"><h2 id="org8d8f9bf">æ™‚è„ˆæº (Clock Sources)</h2><div class="outline-text-2" id="text-org8d8f9bf"><p>ZYBO board æä¾›äº† 50MHZ çš„æ™‚è„ˆåˆ° Zynq è™•ç†å™¨çš„ <code>PS_CLK</code> æ¥è…³ï¼ŒåŸºæœ¬é€£æ¥è³‡è¨Šå¦‚ä¸‹:</p><div class="figure"><p><img src="clock_source.png"></p></div><p>è¦æ³¨æ„åˆ°çš„ä¸€é»æ˜¯ï¼Œç”±æ–¼ Ethernet PHY æœƒæ¥æ”¶ 50HMZ æ™‚è„ˆè¼¸å…¥ï¼Œä¸¦è¼¸å‡º 125HMZ åˆ° Zynq è™•ç†å™¨ä¸Šï¼Œç•¶ Ethernet PHY é‡ç½®(reset)çš„æ™‚å€™ï¼ŒCLK125 çš„è¼¸å‡ºæœƒè¢«å–æ¶ˆã€‚</p></div></div><div id="outline-container-orga36c1d9" class="outline-2"><h2 id="orga36c1d9">åŸºæœ¬è¼¸å…¥/è¼¸å‡º (I/O)</h2><div class="outline-text-2" id="text-orga36c1d9"><p>Zybo board æ¿ä¸Šæœ‰ä¸€äº›é å…ˆå®šç¾©å¥½çš„ IO, æ¯”å¦‚æŒ‡æ’¥é–‹é—œ (Switch)ã€LED ç‡ˆã€ç„¡æ®µæŒ‰éˆ•ç­‰ã€‚</p><div class="figure"><p><img src="basic_io.png"></p></div></div></div><div id="outline-container-orgd824ebc" class="outline-2"><h2 id="orgd824ebc">è²éŸ³ (Audio)</h2><div class="outline-text-2" id="text-orgd824ebc"><p>Zybo Board ä¸Šæœ‰ä¸‰çµ„è²éŸ³ç›¸é—œçš„ IOï¼Œåˆ†åˆ¥æ˜¯è€³æ©Ÿå­”è¼¸å‡º(Headphone Out)ã€éº¥å…‹é¢¨è¼¸å…¥(Microphone In)ã€éŸ³æºè½‰éŒ„åŠŸèƒ½(Line In)ï¼Œé€™äº› IO æœƒé€£æ¥åˆ° Ananlog Device çš„ <a href="http://www.analog.com/media/en/technical-documentation/data-sheets/SSM2603.pdf" target="_blank" rel="external">SSM2603</a> éŸ³é »è§£ç¢¼å™¨ä¸Šã€‚</p><div class="figure"><p><img src="audio_an.png"></p></div><p><a href="http://www.analog.com/media/en/technical-documentation/data-sheets/SSM2603.pdf" target="_blank" rel="external">SSM2603</a> å‰‡æ˜¯é€é IÂ²C æ¥å£ä¾†å°‡è³‡æ–™å‚³é€çµ¦ Zynq è™•ç†å™¨å»ã€‚</p><div class="figure"><p><img src="audio_di.png"></p></div></div></div><div id="outline-container-org532f48e" class="outline-2"><h2 id="org532f48e">Pmod æ¥è…³</h2><div class="outline-text-2" id="text-org532f48e"><p>åœ¨ Zybo Board çš„å‘¨é­ï¼Œå…±æœ‰ 6 å€‹ 2x6 æ¯æ’åº§ï¼Œç”¨ä¾†å°‡å¤šé¤˜çš„ GPIO æ‹‰å‡ºã€‚æ¯å€‹ Pmod æä¾›äº†å…©å€‹ 3.3 VCC é›»æºã€å…©å€‹ GND è¨Šè™Ÿä»¥åŠ 8 å€‹ IO å¯ä»¥ç”¨ã€‚åœ¨ Pmod ä¸Šçš„ VCC ä»¥åŠ GND æœ€å¤šå¯ä»¥æä¾›åˆ° 1A çš„é›»æµ(ä½†è¦è¨˜å¾—å¤–æ¥é›»æº)ã€‚</p><div class="figure"><p><img src="pmod_dia.png"></p></div><p>ä¸åŒçš„ Pmod ç”¨é€”å‰‡å¯èƒ½ä¸åŒï¼Œè©³æƒ…è«‹åƒè¦‹ä¸‹è¡¨:</p><div class="figure"><p><img src="pmod_pin.png"></p></div></div></div><div id="outline-container-org9b8fcf6" class="outline-2"><h2 id="org9b8fcf6">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org9b8fcf6"><p><code>[1]</code> <a href="https://reference.digilentinc.com/_media/zybo/zybo_rm.pdf" target="_blank" rel="external">ZYBO FPGA Board Reference Manual</a></p><p><code>[2]</code> <a href="http://electronicdesign.com/fpgas/principles-fpgas" target="_blank" rel="external">The Principles of FPGAs | FPGAs content from Electronic Design</a></p><p><code>[3]</code> <a href="http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf" target="_blank" rel="external">Zynq-7000 All Programmable SoC Technical Reference Manual</a></p><p><code>[4]</code> <a href="http://www.ioe.nchu.edu.tw/Pic/CourseItem/4468_20_Zynq_Architecture.pdf" target="_blank" rel="external">Xilinx - Zynq Architecture</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/7004ff00/#disqus_thread</comments>
    </item>
    
    <item>
      <title>clojure/clojurescript èˆ‡ left-pad</title>
      <link>https://coldnew.github.io/7c811780/</link>
      <guid>https://coldnew.github.io/7c811780/</guid>
      <pubDate>Sat, 26 Mar 2016 16:07:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
æœ€è¿‘é¬§å¾—æ²¸æ²¸æšæšçš„äº‹æƒ…ï¼Œå¤§æ¦‚å°±æ˜¯ &lt;a href=&quot;https://github.com/azer&quot;&gt;Azer KoÃ§ulu&lt;/a&gt; åœ¨ npm ä¸Š&lt;a href=&quot;https://medium.com/@azerbike/i-ve-just-liberated-my-modules-9045c06be67c#.eww19oprb&quot;&gt;ä¸‹æ¶ left-pad&lt;/a&gt;é€™ä»¶äº‹ï¼Œå°è‡´è¨±è¨±å¤šå¤šä¾è³´ä»–çš„ Node.js å°ˆæ¡ˆ &lt;a href=&quot;https://github.com/azer/left-pad/issues/4&quot;&gt;ä¸èƒ½ä½¿ç”¨&lt;/a&gt;ã€‚
&lt;/p&gt;

&lt;p&gt;
å°±è®“æˆ‘å€‘è¶é€™å€‹æ©Ÿæœƒï¼Œçœ‹ä¸€ä¸‹æˆ‘å€‘åœ¨ clojure/clojurescript ä¸‹åˆ°åº•æœ‰æ²’æœ‰éœ€è¦é€™å€‹å‡½å¼åº«ï¼Œæˆ–æ˜¯æ˜¯å¦å·²ç¶“æœ‰å…§å»ºå¯æ›¿ä»£çš„å‡½å¼å¯ä»¥è™•ç†é€™å€‹åŠŸèƒ½ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>æœ€è¿‘é¬§å¾—æ²¸æ²¸æšæšçš„äº‹æƒ…ï¼Œå¤§æ¦‚å°±æ˜¯ <a href="https://github.com/azer" target="_blank" rel="external">Azer KoÃ§ulu</a> åœ¨ npm ä¸Š<a href="https://medium.com/@azerbike/i-ve-just-liberated-my-modules-9045c06be67c#.eww19oprb" target="_blank" rel="external">ä¸‹æ¶ left-pad</a>é€™ä»¶äº‹ï¼Œå°è‡´è¨±è¨±å¤šå¤šä¾è³´ä»–çš„ Node.js å°ˆæ¡ˆ <a href="https://github.com/azer/left-pad/issues/4" target="_blank" rel="external">ä¸èƒ½ä½¿ç”¨</a>ã€‚</p><p>å°±è®“æˆ‘å€‘è¶é€™å€‹æ©Ÿæœƒï¼Œçœ‹ä¸€ä¸‹æˆ‘å€‘åœ¨ clojure/clojurescript ä¸‹åˆ°åº•æœ‰æ²’æœ‰éœ€è¦é€™å€‹å‡½å¼åº«ï¼Œæˆ–æ˜¯æ˜¯å¦å·²ç¶“æœ‰å…§å»ºå¯æ›¿ä»£çš„å‡½å¼å¯ä»¥è™•ç†é€™å€‹åŠŸèƒ½ã€‚</p><a id="more"></a><div id="outline-container-org74a3101" class="outline-2"><h2 id="org74a3101">leftpad åšäº†å“ªäº›äº‹?</h2><div class="outline-text-2" id="text-org74a3101"><p>åœ¨æˆ‘å€‘é–‹å§‹å‰ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹ <a href="https://github.com/azer/left-pad" target="_blank" rel="external">left-pad</a> é€™å€‹å‡½å¼åº«åˆ°åº•å¤šå¥½ç”¨ï¼Œç‚ºä»€éº¼ä¸€å †å¥—ä»¶éƒ½ä¾è³´ä»–ã€‚å¯¦éš›ä¸Š <a href="https://github.com/azer/left-pad" target="_blank" rel="external">left-pad</a> åªæœ‰çŸ­çŸ­çš„å¹¾è¡Œï¼Œå…§å®¹å¦‚ä¸‹:</p><div class="org-src-container"><pre class="src src-javascript"><span style="color: #aaffaa;">function</span> <span style="color: #aaccff;">leftpad</span> <span style="color: #aadddd;">(</span><span style="color: #aaccff;">str</span>, <span style="color: #aaccff;">len</span>, <span style="color: #aaccff;">ch</span><span style="color: #aadddd;">)</span> <span style="color: #aadddd;">{</span>    str = String<span style="color: #81d4fa;">(</span>str<span style="color: #81d4fa;">)</span>;    <span style="color: #aaffaa;">var</span> <span style="color: #aaccff;">i</span> = -1;    <span style="color: #aaffaa;">if</span> <span style="color: #81d4fa;">(</span>!ch &amp;&amp; ch !== 0<span style="color: #81d4fa;">)</span> ch = <span style="color: #aadddd;">' '</span>;    len = len - str.length;    <span style="color: #aaffaa;">while</span> <span style="color: #81d4fa;">(</span>++i &lt; len<span style="color: #81d4fa;">)</span> <span style="color: #81d4fa;">{</span>        str = ch + str;    <span style="color: #81d4fa;">}</span>    <span style="color: #aaffaa;">return</span> str;<span style="color: #aadddd;">}</span></pre></div><p>è€Œä»–çš„åŠŸèƒ½ä¹Ÿå¾ˆå–®ç´”ï¼Œå°±æ˜¯å°‡è¼¸å…¥çš„æ±è¥¿ä¾æ“šè¨­å®šï¼Œé€²è¡Œ padding çš„å‹•ä½œ</p><div class="org-src-container"><pre class="src src-javascript"><span style="color: #aaffaa;">var</span> <span style="color: #aaccff;">leftpad</span> = require<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'left-pad'</span><span style="color: #aadddd;">)</span>leftpad<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'foo'</span>, 5<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">=&gt; "  foo"</span>leftpad<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'foobar'</span>, 6<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">=&gt; "foobar"</span>leftpad<span style="color: #aadddd;">(</span>1, 2, 0<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">=&gt; "01"</span></pre></div></div></div><div id="outline-container-org7229028" class="outline-2"><h2 id="org7229028">å¦‚ä½•åœ¨ clojure ä¸Šå¯¦ä½œ</h2><div class="outline-text-2" id="text-org7229028"><p>é‚£æˆ‘å€‘åœ¨ clojure ä¸‹è¦æ€æ¨£å¯¦ä½œ leftpad é€™å‡½å¼çš„åŠŸèƒ½å‘¢ï¼Ÿå¯¦éš›ä¸Šæˆ‘å€‘ä½¿ç”¨ <a href="https://clojuredocs.org/clojure.core/format" target="_blank" rel="external">clojure.core/format</a> æ­é…ä¸€äº›å­—ä¸²çš„æ›¿ä»£å°±å¯ä»¥è¾¦åˆ° (è¨»: åƒè€ƒè‡ª <a href="http://beginnersbook.com/2014/07/java-left-padding-a-string-with-spaces-and-zeros/" target="_blank" rel="external">java â€“ Left padding a String with Spaces and Zeros</a> ä¸€æ–‡)</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">leftpad</span>  <span style="color: #97abc6; font-style: italic;">"If S is shorter than LEN, pad it with CH on the left."</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaccff;">[</span>s len<span style="color: #aaccff;">]</span> <span style="color: #aaccff;">(</span>leftpad s len <span style="color: #aadddd;">" "</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaccff;">[</span>s len ch<span style="color: #aaccff;">]</span>   <span style="color: #aaccff;">(</span><span style="color: #aaffaa;">-&gt;</span> <span style="color: #aaeecc;">(</span>format <span style="color: #ccaaff;">(</span>str <span style="color: #aadddd;">"%"</span> len <span style="color: #aadddd;">"s"</span><span style="color: #ccaaff;">)</span> <span style="color: #ccaaff;">(</span>str s<span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span>       <span style="color: #aaeecc;">(</span><span style="color: #fff59d;">clojure.string</span><span style="color: #c6cccc; background-color: #202020;">/</span>replace #<span style="color: #aadddd;">"</span><span style="color: #aadddd; font-weight: bold;">\s</span><span style="color: #aadddd;">"</span> <span style="color: #ccaaff;">(</span>str ch<span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span>leftpad 1 2 0<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; "01"</span></pre></div><p>ç•¶ç„¶åƒé€™æ¨£ç”¨å­—ä¸²æŸ¥æ‰¾æ›¿ä»£çš„æ–¹å¼å¾ˆå®¹æ˜“æ‰“æ­»è‡ªå·±ï¼Œæ­¤å¤–ï¼Œ<a href="https://clojuredocs.org/clojure.core/format" target="_blank" rel="external">clojure.core/format</a> å› ç‚º <a href="http://dev.clojure.org/jira/browse/CLJS-324" target="_blank" rel="external">CLJS-324 ISSUE</a> çš„é—œä¿‚ï¼Œç›®å‰æ˜¯ç„¡æ³•åœ¨ clojurescript ä¸Šä½¿ç”¨çš„ï¼Œå› æ­¤æˆ‘å€‘æ‡‰è©²è€ƒæ…®çœ‹çœ‹ clojure/clojurescript éƒ½å¯ä»¥å…±ç”¨çš„ <a href="https://clojuredocs.org/clojure.pprint/cl-format" target="_blank" rel="external">cl-format</a> ã€‚</p></div></div><div id="outline-container-org0dad3ca" class="outline-2"><h2 id="org0dad3ca">å¦‚ä½•åœ¨ clojurescript ä¸Šå¯¦ä½œ</h2><div class="outline-text-2" id="text-org0dad3ca"><p><a href="https://clojuredocs.org/clojure.pprint/cl-format" target="_blank" rel="external">cl-format</a> æ˜¯ç§»æ¤è‡ª common lisp çš„ <a href="http://www.cs.cmu.edu/afs/cs.cmu.edu/project/ai-repository/ai/html/cltl/clm/node200.html#SECTION002633000000000000000%29" target="_blank" rel="external">format</a> å‡½å¼ï¼Œæ˜¯ä¸€ç¨®éå¸¸å¼·å¤§çš„å­—ä¸²æ ¼å¼åŒ–æ–¹å¼ã€‚å…·é«”ç¯„ä¾‹åœ¨ <a href="http://www.gigamonkeys.com/book/a-few-format-recipes.html" target="_blank" rel="external">Praticle Common Lisp</a> ä¸€æ›¸å…§æ–‡æœ‰æåˆ°ï¼Œæˆ‘å€‘åœ¨é€™é‚Šåªæ³¨é‡å¦‚ä½•é€é <a href="https://clojuredocs.org/clojure.pprint/cl-format" target="_blank" rel="external">cl-format</a> é€²è¡Œ padding:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>cl-format <span style="color: #ccaaff;">nil</span> <span style="color: #aadddd;">"~5,'qd"</span> <span style="color: #aadddd;">"hi"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; "qqqhi"</span><span style="color: #aadddd;">(</span>cl-format <span style="color: #ccaaff;">nil</span> <span style="color: #aadddd;">"~6,'0d"</span> 1<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; "000001"</span><span style="color: #aadddd;">(</span>cl-format <span style="color: #ccaaff;">nil</span> <span style="color: #aadddd;">"~7d"</span> 1<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt; "      1"</span></pre></div><p>äº†è§£äº† <a href="https://clojuredocs.org/clojure.pprint/cl-format" target="_blank" rel="external">cl-format</a> åœ¨ padding åŠŸèƒ½ä¸Šçš„ä½¿ç”¨ï¼Œæˆ‘å€‘å°±å¯ä»¥é€éå®ƒä¾†è£½ä½œ clojure/clojurescript çš†èƒ½ä½¿ç”¨çš„ <code>leftpad</code> å‡½å¼:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">ns</span> <span style="color: #fff59d;">coldnew.left-pad</span>  <span style="color: #81d4fa;">(</span><span style="color: #ccaaff;">:require</span> #?<span style="color: #aaccff;">(</span><span style="color: #ccaaff;">:clj</span>  <span style="color: #aaeecc;">[</span><span style="color: #fff59d;">clojure.pprint</span> <span style="color: #ccaaff;">:refer</span> <span style="color: #ccaaff;">[</span>cl-format<span style="color: #ccaaff;">]</span><span style="color: #aaeecc;">]</span>               <span style="color: #ccaaff;">:cljs</span> <span style="color: #aaeecc;">[</span><span style="color: #fff59d;">cljs.pprint</span>    <span style="color: #ccaaff;">:refer</span> <span style="color: #ccaaff;">[</span>cl-format<span style="color: #ccaaff;">]</span><span style="color: #aaeecc;">]</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">leftpad</span>  <span style="color: #97abc6; font-style: italic;">"If S is shorter than LEN, pad it with CH on the left."</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaccff;">[</span>s len<span style="color: #aaccff;">]</span> <span style="color: #aaccff;">(</span>leftpad s len <span style="color: #aadddd;">" "</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaccff;">[</span>s len ch<span style="color: #aaccff;">]</span>   <span style="color: #aaccff;">(</span>cl-format <span style="color: #ccaaff;">nil</span> <span style="color: #aaeecc;">(</span>str <span style="color: #aadddd;">"~"</span> len <span style="color: #aadddd;">",'"</span> ch <span style="color: #aadddd;">"d"</span><span style="color: #aaeecc;">)</span> <span style="color: #aaeecc;">(</span>str s<span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-org6b4e039" class="outline-2"><h2 id="org6b4e039">å¾Œè¨˜</h2><div class="outline-text-2" id="text-org6b4e039"><p>æœ¬æ–‡åªæ˜¯æˆ‘çœ‹åˆ°äº† <a href="http://www.haneycodes.net/npm-left-pad-have-we-forgotten-how-to-program/" target="_blank" rel="external">NPM &amp; left-pad: Have We Forgotten How To Program?</a> é€™ç¯‡æ–‡ç« å¾Œï¼Œä¾†ç¢ºèªä¸€ä¸‹æˆ‘åˆ°åº•æœƒä¸æœƒå¯«ç¨‹å¼ä¹‹ç”¨ï¼Œæ–‡å…§å¯¦ä½œçš„ clojure/clojurescript ç‰ˆæœ¬ä½ å¯ä»¥åœ¨ <a href="https://github.com/coldnew/left-pad.clj" target="_blank" rel="external">coldnew/left-pad.clj</a> é€™å€‹å°ˆæ¡ˆçœ‹åˆ°ã€‚</p><p>å¦‚æœä½ æƒ³çœ‹çœ‹ emacs-lisp ä¸‹è¦æ€æ¨£å¯¦ä½œ leftpad å‡½å¼ï¼Œå‰‡å¯ä»¥åœ¨ <a href="https://github.com/coldnew/left-pad.el" target="_blank" rel="external">coldnew/left-pad.el</a> çœ‹åˆ°æˆ‘å¯¦ä½œçš„ç¯„ä¾‹ã€‚</p><p>å¯¦éš›ä¸Š leftpad çš„äº‹ä»¶é‚„è¡ç”Ÿäº†å¦å¤–ä¸€å€‹å•é¡Œ: <code>å¥—ä»¶æ˜¯å¦å¯ä»¥é€™éº¼å®¹æ˜“è¢«ä¸‹æ¶?</code></p><p>åœ¨ Clojure çš„ä¸–ç•Œä¸­ï¼Œæˆ‘å€‘æœƒæŠŠæˆ‘å€‘çš„å°ˆæ¡ˆæ”¾ç½®åˆ° <a href="http://clojars.org/" target="_blank" rel="external">Clojars</a> å»ï¼Œè€Œåœ¨ <a href="http://clojars.org/" target="_blank" rel="external">Clojars</a> å‰‡æ˜¯é€™æ¨£è¦å®š <a href="https://github.com/clojars/clojars-web/wiki/About#how-do-i-delete-a-jar" target="_blank" rel="external">How do I delete a jar?</a></p><blockquote><p>Deletion of entire projects or particular versions is discouraged as you will break anyone's build that depends on the project or version. There is also a cost associated with deletion, as it requires an admin's time. If you're sure nobody is using your jar or absolutely must remove it open an issue against the Clojars GitHub project. If you need it done privately contact the server caretakers. Before doing so, push a new revision with "Delete me" in the description in order to prove you're the owner of the project.</p></blockquote><br><p><a href="http://clojars.org/" target="_blank" rel="external">Clojars</a> çš„ç¶­è­·è€…æ˜¯ä¸å¤ªè´ŠåŒé–‹ç™¼è€…ç§»é™¤è‡ªå·±çš„å¥—ä»¶çš„ï¼Œæˆ‘æ›¾ç¶“è¦æ±‚ clojar å¹«æˆ‘ç§»é™¤ä¸€å€‹ä»¥å‰èª¤ä¸Šå‚³çš„å¥—ä»¶ (è«‹è¦‹ <a href="https://github.com/clojars/clojars-web/issues/391" target="_blank" rel="external">issue/391</a>)ï¼Œä¹Ÿæ˜¯èŠ±äº†å¥½ä¸€æ®µæ™‚é–“é€™å€‹å¥—ä»¶æ‰çœŸçš„è¢«åˆªé™¤ï¼Œå› æ­¤åœ¨ Clojure ä¸–ç•Œä¸­æˆ‘å€‘æ‡‰è©²ä¸å¤ªéœ€è¦æ“”å¿ƒæœ‰ä½¿ç”¨è€…ä¸‹æ¶å¥—ä»¶é€™ä»¶äº‹ :Sã€‚</p></div></div><div id="outline-container-org749f7b3" class="outline-2"><h2 id="org749f7b3">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org749f7b3"><p><code>[1]</code> <a href="http://www.haneycodes.net/npm-left-pad-have-we-forgotten-how-to-program/" target="_blank" rel="external">NPM &amp; left-pad: Have We Forgotten How To Program?</a></p><p><code>[2]</code> <a href="http://www.gigamonkeys.com/book/a-few-format-recipes.html" target="_blank" rel="external">Praticle Common Lisp - A Few FORMAT Recipes</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/7c811780/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Zephyr RTOS é–‹ç™¼è¨˜éŒ„: Mac OSX ä¸‹ SDK ç·¨è­¯</title>
      <link>https://coldnew.github.io/70ccebe8/</link>
      <guid>https://coldnew.github.io/70ccebe8/</guid>
      <pubDate>Mon, 29 Feb 2016 03:14:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
åœ¨ &lt;a href=&quot;http://coldnew.github.io/blog/2016/02/21_zephyr/&quot;&gt;Zephyr RTOS é–‹ç™¼è¨˜éŒ„: åŸºæœ¬ç’°å¢ƒå»ºç«‹&lt;/a&gt; ä¸€æ–‡ä¸­æåˆ°äº†æˆ‘å€‘å¦‚ä½•å®‰è£ &lt;a href=&quot;https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/&quot;&gt;Zephyr SDK&lt;/a&gt; åˆ° Linux ç³»çµ±ä¾†é€²è¡Œé–‹ç™¼ï¼Œé‚£å¦‚æœæˆ‘æƒ³è¦åœ¨ Mac OSX ä¸Šé¢é–‹ç™¼è¦æ€éº¼è¾¦å‘¢ï¼Ÿ
&lt;/p&gt;

&lt;p&gt;
ç”±æ–¼ &lt;a href=&quot;https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/&quot;&gt;Zephyr SDK&lt;/a&gt; ç›®å‰åƒ…æä¾› Linux çš„ç‰ˆæœ¬ï¼Œå› æ­¤åœ¨ Mac OSX ä¸­æˆ‘å€‘å¿…é ˆè‡ªå·±é€é &lt;a href=&quot;http://crosstool-ng.org/&quot;&gt;crosstool-ng&lt;/a&gt; å»ç·¨è­¯æˆ‘å€‘è‡ªå·±çš„ SDKã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>åœ¨ <a href="http://coldnew.github.io/blog/2016/02/21_zephyr/">Zephyr RTOS é–‹ç™¼è¨˜éŒ„: åŸºæœ¬ç’°å¢ƒå»ºç«‹</a> ä¸€æ–‡ä¸­æåˆ°äº†æˆ‘å€‘å¦‚ä½•å®‰è£ <a href="https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/" target="_blank" rel="external">Zephyr SDK</a> åˆ° Linux ç³»çµ±ä¾†é€²è¡Œé–‹ç™¼ï¼Œé‚£å¦‚æœæˆ‘æƒ³è¦åœ¨ Mac OSX ä¸Šé¢é–‹ç™¼è¦æ€éº¼è¾¦å‘¢ï¼Ÿ</p><p>ç”±æ–¼ <a href="https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/" target="_blank" rel="external">Zephyr SDK</a> ç›®å‰åƒ…æä¾› Linux çš„ç‰ˆæœ¬ï¼Œå› æ­¤åœ¨ Mac OSX ä¸­æˆ‘å€‘å¿…é ˆè‡ªå·±é€é <a href="http://crosstool-ng.org/" target="_blank" rel="external">crosstool-ng</a> å»ç·¨è­¯æˆ‘å€‘è‡ªå·±çš„ SDKã€‚</p><a id="more"></a><div id="outline-container-orgd2bde7b" class="outline-2"><h2 id="orgd2bde7b">å®‰è£ä¾è³´çš„ç›¸é—œå¥—ä»¶</h2><div class="outline-text-2" id="text-orgd2bde7b"><p>ç¬¬ä¸€æ­¥è¦åšçš„ï¼Œç•¶ç„¶å°±æ˜¯å®‰è£ç›¸é—œå¥—ä»¶å•¦ï¼Œé€™é»æˆ‘å€‘ç›´æ¥é€é <a href="http://brew.sh/" target="_blank" rel="external">homebrew</a> ä¾†å®‰è£</p><pre class="example">coldnew@MacOSX ~ $ brew install gettext qemu help2man mpfr gmp coreutils wget</pre><p>æ¥ä¸‹ä¾†æˆ‘å€‘è¦å®‰è£ GNU çš„ grep å‘½ä»¤ä¾†æ›¿ä»£ç³»çµ±å…§å»ºçš„ grep å‘½ä»¤</p><pre class="example">coldnew@MacOSX ~ $ brew tap homebrew/dupescoldnew@MacOSX ~ $ brew install grep --default-names</pre><p>æ¥è‘—ï¼Œå®‰è£æˆ‘å€‘éœ€è¦ç”¨çš„ç¨‹å¼: <a href="http://crosstool-ng.org/" target="_blank" rel="external">crosstool-ng</a></p><pre class="example">coldnew@MacOSX ~ $ brew install crosstool-ng</pre></div></div><div id="outline-container-org1418752" class="outline-2"><h2 id="org1418752">å»ºç«‹ç·¨è­¯ç’°å¢ƒ</h2><div class="outline-text-2" id="text-org1418752"><p>å®‰è£å¥½ <a href="http://crosstool-ng.org/" target="_blank" rel="external">crosstool-ng</a> å¾Œï¼Œæˆ‘å€‘éœ€è¦å»ºç«‹ä¸€å€‹ <code>Case Sensitive</code> çš„ HFS+ ç¡¬ç¢Ÿä¾†è®“ MacOSX å¯ä»¥é †åˆ©ç·¨è­¯ï¼Œä»¥ä¸‹ç‚ºæˆ‘å»ºç«‹é€™é¡†ç¡¬ç¢Ÿæ‰€ç”¨çš„å‘½ä»¤ (ä½” 10G çš„ç¡¬ç¢Ÿç©ºé–“)</p><div class="org-src-container"><pre class="src src-sh">hdiutil create -volname CrossToolNG -type SPARSE <span style="color: #aadddd;">\</span>        -fs <span style="color: #aadddd;">'Case-sensitive Journaled HFS+'</span> <span style="color: #aadddd;">\</span>        -size 10g CrossToolNG.sparseimage</pre></div><p>å®Œæˆå¾Œï¼Œæ‰“é–‹ <code>CrossToolNG.sparseimage</code> é€™å€‹æ˜ åƒæª”ï¼Œä»–æœƒè¢«æ›è¼‰åˆ° <code>/Volumes/CrossToolNG</code> å»</p><pre class="example">coldnew@MacOSX ~ $ open CrossToolNG.sparseimage</pre><p>æ¥è‘—æˆ‘å€‘å°±åˆ‡æ›åˆ° <code>/Volumes/CrossToolNG</code> ä¾†æº–å‚™é€²è¡Œæˆ‘å€‘çš„ç·¨è­¯ï¼Œé †ä¾¿å»ºç«‹ä¸€å€‹ <code>src</code> è³‡æ–™å¤¾è®“ <a href="http://crosstool-ng.org/" target="_blank" rel="external">crosstool-ng</a> å­˜æ”¾ä»–ä¸‹è¼‰çš„åŸå§‹ç¢¼</p><pre class="example">coldnew@MacOSX ~ $ cd /Volumes/CrossToolNG &amp;&amp; mkdir src</pre><p>æˆ‘å€‘å…ˆè¤‡è£½ <a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> è£¡é¢æä¾›çš„è¨­å®šæª”åˆ°ç•¶å‰ç›®éŒ„</p><pre class="example">coldnew@MacOSX /Volumes/CrossToolNG $ cp ${ZEPHYR_BASE}/scripts/cross_compiler/x86.config .config</pre><p>å¦‚æœä½ æœ‰ä»€éº¼è¨­å®šè¦ä¿®æ­£çš„è©±ï¼Œå¯ä»¥ä½¿ç”¨ <code>ct-ng menuconfig</code> ä¾†é€²è¡Œä¿®æ”¹</p><pre class="example">coldnew@MacOSX /Volumes/CrossToolNG $ ct-ng menuconfig</pre><div class="figure"><p><img src="menuconfig-osx.png"></p></div><p>å¦å¤–ï¼Œåœ¨é€²è¡Œç·¨è­¯å‰è¦ç¢ºèªä»¥ä¸‹å¹¾å€‹è¨­å®šæ˜¯å¦å’Œä½ ç·¨è­¯ç›®éŒ„ (/Volumes/CrossToolNG) ä¸€è‡´</p><div class="org-src-container"><pre class="src src-sh"><span style="color: #aaccff;">CT_LOCAL_TARBALLS_DIR</span>=<span style="color: #aadddd;">"/Volumes/CrossToolNG/src"</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">CT_SAVE_TARBALLS is not set</span><span style="color: #aaccff;">CT_WORK_DIR</span>=<span style="color: #aadddd;">"${CT_TOP_DIR}/.build"</span><span style="color: #aaccff;">CT_PREFIX_DIR</span>=<span style="color: #aadddd;">"/Volumes/CrossToolNG/x-tools/${CT_TARGET}"</span><span style="color: #aaccff;">CT_INSTALL_DIR</span>=<span style="color: #aadddd;">"${CT_PREFIX_DIR}"</span></pre></div><p>éƒ½ç¢ºèªæ²’å•é¡Œå¾Œï¼Œå°±é–‹å§‹æˆ‘å€‘çš„ç·¨è­¯å§ gogogo ~</p><pre class="example">coldnew@MacOSX /Volumes/CrossToolNG $ ct-ng build</pre><p>æ¥è‘—ä½ å¯ä»¥å»æ³¡æ¯å’–å•¡æˆ–å‡ºå»èµ°èµ°ï¼Œç·¨è­¯å·¥å…·éŠ (toolchain) å¾ˆèŠ±æ™‚é–“çš„</p></div></div><div id="outline-container-orga26ce4f" class="outline-2"><h2 id="orga26ce4f">è¨­å®šç·¨è­¯ç’°å¢ƒ</h2><div class="outline-text-2" id="text-orga26ce4f"><p>å®Œæˆç·¨è­¯æˆ‘å€‘è¦çš„å·¥å…·éŠ (toolchain) å¾Œï¼Œæˆ‘å€‘å¯ä»¥åœ¨ <code>/Volumes/CrossToolNG</code> çœ‹åˆ°ä»¥ä¸‹çš„è³‡æ–™å¤¾ï¼Œå…¶ä¸­ <code>x-tools</code> å°±æ˜¯æˆ‘å€‘ç·¨è­¯å‡ºä¾†çš„çµæœ</p><pre class="example">coldnew@MacOSX /Volumes/CrossToolNG $ tree -L 1.. &lt;b&gt;â”œâ”€â”€ build.log &lt;g&gt;â”œâ”€â”€ config -&gt; /usr/local/Cellar/crosstool-ng/1.22.0/lib/crosstool-ng-1.22.0/config &lt;lb&gt;â”œâ”€â”€ config.gen &lt;b&gt;â”œâ”€â”€ src &lt;b&gt;â””â”€â”€ x-tools &lt;b&gt;4 directories, 1 file</pre><p>æœ€å¾Œï¼Œåœ¨ä½ çš„ <code>~/.zephyrrc</code> è¨­å®šé€™äº›ç’°å¢ƒè®Šæ•¸å°±å¯ä»¥å»å˜—è©¦ç·¨è­¯ä½ çš„ <a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr kernel</a> çœ‹çœ‹å›‰ ~</p><div class="org-src-container"><pre class="src src-sh">coldnew@MacOSX ~ $ vim ~/.zephyrrc<span style="color: #ccaaff;">export</span> <span style="color: #aaccff;">XTOOLS_TOOLCHAIN_PATH</span>=/Volumes/CrossToolNG/x-tools<span style="color: #ccaaff;">export</span> <span style="color: #aaccff;">ZEPHYR_SDK_INSTALL_DIR</span>=$<span style="color: #aadddd;">{</span><span style="color: #aaccff;">XTOOLS_TOOLCHAIN_PATH</span><span style="color: #aadddd;">}</span><span style="color: #ccaaff;">export</span> <span style="color: #aaccff;">ZEPHYR_GCC_VARIANT</span>=xtools</pre></div></div></div><div id="outline-container-org3781a6c" class="outline-2"><h2 id="org3781a6c">å¯èƒ½æœƒé‡åˆ°çš„éŒ¯èª¤</h2><div class="outline-text-2" id="text-org3781a6c"><p>åœ¨ Mac OSX ä¸‹ç·¨è­¯é Apple å®˜æ–¹çš„æ±è¥¿å¸¸å¸¸æœƒå‡ºç¾ä¸€å †å¥‡æ€ªçš„éŒ¯èª¤ï¼Œæœ‰æ™‚æ˜¯å› ç‚º XCode çš„æ”¹å‹•ï¼Œæœ‰æ™‚æ˜¯å› ç‚ºä½ é€é <a href="http://brew.sh/" target="_blank" rel="external">homebrew</a> å®‰è£äº†å…¶ä»–å‘½ä»¤å’Œ Mac OSX å…§å»ºçš„æœ‰è¡çªã€‚</p><p>ä¸‹é¢ç´€éŒ„æˆ‘åœ¨é€™æ¬¡ç·¨è­¯é‡åˆ°çš„éŒ¯èª¤:</p></div><div id="outline-container-orgabed34b" class="outline-3"><h3 id="orgabed34b">stat: cannot read file system information for '%Lp'</h3><div class="outline-text-3" id="text-orgabed34b"><p>å¦‚æœä½ é‡åˆ°äº†é€™å€‹å•é¡Œï¼Œå“ªå¾ˆæœ‰å¯èƒ½æ˜¯å› ç‚ºä½ çš„ç³»çµ±åŒæ™‚ä¹Ÿè£äº† <a href="http://www.gnu.org/software/coreutils/coreutils.html" target="_blank" rel="external">GNU coreutils</a> å°è‡´ <a href="http://crosstool-ng.org/" target="_blank" rel="external">crosstool-ng</a> èª¿ç”¨çš„å‘½ä»¤æ˜¯ GNU çš„ <code>stat</code> å‘½ä»¤ï¼Œè€Œä¸æ˜¯ç³»çµ±å…§å»ºçš„ stat å‘½ä»¤ã€‚</p><pre class="example">[INFO ]  Performing some trivial sanity checks[INFO ]  Build started 20160229.010627[INFO ]  Building environment variables[EXTRA]  Preparing working directories[00:01] / stat: cannot read file system information for '%Lp': No such file or directory[ERROR][ERROR]  &gt;&gt;[ERROR]  &gt;&gt;  Build failed in step '(top-level)'[ERROR]  &gt;&gt;[ERROR]  &gt;&gt;  Error happened in: CT_DoForceRmdir[scripts/functions@460][ERROR]  &gt;&gt;        called from: main[scripts/crosstool-NG.sh@238][ERROR]  &gt;&gt;[ERROR]  &gt;&gt;  For more info on this error, look at the file: 'build.log'[ERROR]  &gt;&gt;  There is a list of known issues, some with workarounds, in:[ERROR]  &gt;&gt;      '/usr/local/Cellar/crosstool-ng/1.22.0/share/doc/crosstool-ng/crosstool-ng-1.22.0/B - Known issues.txt'[ERROR][ERROR]  (elapsed: 0:00.70)[00:01] / make: *** [build] Error 1</pre><p>æˆ‘å€‘å¯ä»¥é€é <code>which</code> å‘½ä»¤å»æª¢æŸ¥æ˜¯å¦çœŸçš„ç”¨åˆ°  <a href="http://www.gnu.org/software/coreutils/coreutils.html" target="_blank" rel="external">GNU coreutils</a> çš„ <code>stat</code> å‘½ä»¤</p><pre class="example">coldnew@MacOSX ~ $ which stat/usr/local/opt/coreutils/libexec/gnubin/stat</pre><p>æˆ‘è‡ªå·±ç”±æ–¼ä¸å¸¸ç”¨ <i>stat</i> å‘½ä»¤ï¼Œæ‰€ä»¥é¸æ“‡ç§»é™¤å·²ç¶“ç·¨è­¯å¥½çš„ stat é€£çµï¼Œæ”¹ç”¨ç³»çµ±å…§å»ºçš„ <i>stat</i></p><pre class="example">coldnew@MacOSX ~ $ rm /usr/local/opt/coreutils/libexec/gnubin/stat</pre><p><a href="http://crosstool-ng.org/" target="_blank" rel="external">crosstool-ng</a> è¦æ‰¾çš„ <i>stat</i> å‰‡æ˜¯åœ¨ <code>/usr/bin</code> ä¸‹</p><pre class="example">coldnew@MacOSX ~ $ which stat/usr/bin/stat</pre></div></div><div id="outline-container-org4b44215" class="outline-3"><h3 id="org4b44215">ld: library not found for -lcrt0.o</h3><div class="outline-text-3" id="text-org4b44215"><p><a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> æä¾›çš„ <code>.config</code> æœ‰æ‰“é–‹éœæ…‹é€£çµ (static link) ç›¸é—œçš„è¨­å®šï¼Œæ–¼æ˜¯ä½ æœƒé‡åˆ°é€™æ¨£çš„ç‹€æ³ï¼Œè§£æ³•åƒè€ƒ <a href="https://github.com/crosstool-ng/crosstool-ng/issues/31" target="_blank" rel="external">issue #31</a> ç§»é™¤ static link ç›¸é—œè¨­å®šã€‚</p><pre class="example">[INFO ]  Performing some trivial sanity checks[INFO ]  Build started 20160229.011000[INFO ]  Building environment variables[EXTRA]  Preparing working directories[ERROR]    clang: error: linker command failed with exit code 1 (use -v to see invocation)[ERROR][ERROR]  &gt;&gt;[ERROR]  &gt;&gt;  Build failed in step 'Checking that gcc can compile a trivial statically linked program (CT_WANTS_STATIC_LINK)'[ERROR]  &gt;&gt;        called in step '(top-level)'[ERROR]  &gt;&gt;[ERROR]  &gt;&gt;  Error happened in: CT_DoExecLog[scripts/functions@216][ERROR]  &gt;&gt;        called from: main[scripts/crosstool-NG.sh@554][ERROR]  &gt;&gt;[ERROR]  &gt;&gt;  For more info on this error, look at the file: 'build.log'[ERROR]  &gt;&gt;  There is a list of known issues, some with workarounds, in:[ERROR]  &gt;&gt;      '/usr/local/Cellar/crosstool-ng/1.22.0/share/doc/crosstool-ng/crosstool-ng-1.22.0/B - Known issues.txt'[ERROR][ERROR]  (elapsed: 0:03.48)[00:05] / make: *** [build] Error 1</pre><p>æˆ‘è‡ªå·±æ˜¯å°‡ <code>.config</code> è£¡é¢é€™å…©å€‹éœæ…‹é€£çµ (static link) ç›¸é—œçš„å‡½å¼åº«è¨­å®šç‚ºå–æ¶ˆå¾Œå°±å¯ä»¥æ­£å¸¸ç·¨è­¯å›‰~</p><div class="org-src-container"><pre class="src src-sh"><span style="color: #aaccff;">CT_WANTS_STATIC_LINK</span>=n<span style="color: #aaccff;">CT_CC_GCC_STATIC_LIBSTDCXX</span>=n</pre></div></div></div></div><div id="outline-container-org202cc4d" class="outline-2"><h2 id="org202cc4d">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org202cc4d"><p><code>[1]</code> <a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr Project Website</a></p><p><code>[2]</code> <a href="http://linuxgizmos.com/zephyr-a-tiny-open-source-iot-rtos/" target="_blank" rel="external">Meet Linux's little brother: Zephyr, a tiny open-source IoT RTOS</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/70ccebe8/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Zephyr RTOS é–‹ç™¼è¨˜éŒ„: åŸºæœ¬ç’°å¢ƒå»ºç«‹</title>
      <link>https://coldnew.github.io/7f7c0c84/</link>
      <guid>https://coldnew.github.io/7f7c0c84/</guid>
      <pubDate>Sun, 28 Feb 2016 11:21:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
&lt;a href=&quot;https://www.zephyrproject.org/&quot;&gt;Zephyr&lt;/a&gt; æ˜¯ Linux åŸºé‡‘æœƒæœ€è¿‘ç™¼ä½ˆçš„å³æ™‚ä½œæ¥­ç³»çµ± (RTOS) é …ç›®ï¼Œä¸»è¦ç”¨æ–¼ç‰©è¯ç¶²ä»¥åŠ IOT è¨­å‚™ï¼Œå…¶å‰èº«ç‚º &lt;a href=&quot;http://www.windriver.com/&quot;&gt;Wind River&lt;/a&gt; çš„ &lt;a href=&quot;http://www.windriver.com/products/operating-systems/rocket/&quot;&gt;Rocket RTOS&lt;/a&gt;ã€‚å’Œ Linux Kernel ä¸åŒçš„æ˜¯ï¼Œ&lt;a href=&quot;https://www.zephyrproject.org/&quot;&gt;Zephyr&lt;/a&gt; åŸå§‹ç¢¼æ¡ç”¨çš„æ˜¯ &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot;&gt;Apache-2.0&lt;/a&gt; æˆæ¬Šã€‚
&lt;/p&gt;

&lt;p&gt;
é—œæ–¼æ›´å¤š &lt;a href=&quot;https://www.zephyrproject.org/&quot;&gt;Zephyr&lt;/a&gt; ç›¸é—œè³‡è¨Šï¼Œè«‹åƒè€ƒ Linux åŸºé‡‘æœƒçš„ &lt;a href=&quot;https://www.zephyrproject.org/&quot;&gt;å°ˆæ¡ˆç¶²ç«™&lt;/a&gt; æˆ–æ˜¯ &lt;a href=&quot;http://linuxgizmos.com/zephyr-a-tiny-open-source-iot-rtos/&quot;&gt;LinuxGizmos.com çš„å ±å°&lt;/a&gt; ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p><a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> æ˜¯ Linux åŸºé‡‘æœƒæœ€è¿‘ç™¼ä½ˆçš„å³æ™‚ä½œæ¥­ç³»çµ± (RTOS) é …ç›®ï¼Œä¸»è¦ç”¨æ–¼ç‰©è¯ç¶²ä»¥åŠ IOT è¨­å‚™ï¼Œå…¶å‰èº«ç‚º <a href="http://www.windriver.com/" target="_blank" rel="external">Wind River</a> çš„ <a href="http://www.windriver.com/products/operating-systems/rocket/" target="_blank" rel="external">Rocket RTOS</a>ã€‚å’Œ Linux Kernel ä¸åŒçš„æ˜¯ï¼Œ<a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> åŸå§‹ç¢¼æ¡ç”¨çš„æ˜¯ <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="external">Apache-2.0</a> æˆæ¬Šã€‚</p><p>é—œæ–¼æ›´å¤š <a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> ç›¸é—œè³‡è¨Šï¼Œè«‹åƒè€ƒ Linux åŸºé‡‘æœƒçš„ <a href="https://www.zephyrproject.org/" target="_blank" rel="external">å°ˆæ¡ˆç¶²ç«™</a> æˆ–æ˜¯ <a href="http://linuxgizmos.com/zephyr-a-tiny-open-source-iot-rtos/" target="_blank" rel="external">LinuxGizmos.com çš„å ±å°</a> ã€‚</p><a id="more"></a><p>æœ¬æ–‡åªæ˜¯è¨˜éŒ„æˆ‘è©¦ç© <a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> çš„ä¸€äº›è³‡è¨Šã€‚</p><div id="outline-container-org9dc259a" class="outline-2"><h2 id="org9dc259a">æ”¯æ´çš„é–‹ç™¼ç‰ˆèˆ‡å¹³å°</h2><div class="outline-text-2" id="text-org9dc259a"><p>åœ¨æ’°å¯«é€™ç¯‡æ–‡ç« æ™‚ï¼Œ<a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> å…±æ”¯æ´ä»¥ä¸‹ç›®æ¨™èˆ‡å¹³å°: (å¾ˆå¯æƒœé€™é‚Šåˆ—çš„æ¿å­æˆ‘åŠç‰‡éƒ½æ²’æœ‰ Orz&#x2026;)</p><ul class="org-ul"><li>x86 æŒ‡ä»¤é›†<ul class="org-ul"><li><a href="https://www.zephyrproject.org/doc/board/arduino_101.html" target="_blank" rel="external">Arduino 101</a></li><li><a href="https://www.zephyrproject.org/doc/board/quark_d2000_crb.html" target="_blank" rel="external">Quark D2000 CRB</a></li><li><a href="https://www.zephyrproject.org/doc/board/galileo.html" target="_blank" rel="external">Galileo Gen1/Gen2</a></li><li><a href="https://www.zephyrproject.org/doc/board/minnowboard.html" target="_blank" rel="external">Minnowboard Max</a></li><li><a href="https://www.zephyrproject.org/doc/board/qemu_x86.html" target="_blank" rel="external">x86 Emulation (QEMU)</a></li></ul></li><li>ARM (v7-M ä»¥åŠ v7E-M) æŒ‡ä»¤é›†<ul class="org-ul"><li><a href="https://www.zephyrproject.org/doc/board/qemu_cortex_m3.html" target="_blank" rel="external">ARM Cortex-M3 Emulation (QEMU)</a></li><li><a href="https://www.zephyrproject.org/doc/board/arduino_due.html" target="_blank" rel="external">Arduino Due</a></li><li><a href="https://www.zephyrproject.org/doc/board/frdm_k64f.html" target="_blank" rel="external">Freescale FRDM-K64F</a></li></ul></li><li>ARC EM4 æŒ‡ä»¤é›†<ul class="org-ul"><li><a href="https://www.zephyrproject.org/doc/board/arduino_101.html" target="_blank" rel="external">Arduino 101</a></li></ul></li></ul></div></div><div id="outline-container-org7290eb4" class="outline-2"><h2 id="org7290eb4">å–å¾— Zephyr kernel åŸå§‹ç¢¼èˆ‡ SDK</h2><div class="outline-text-2" id="text-org7290eb4"><p><a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> åŸå§‹ç¢¼æ¡ç”¨ <i>git</i> è¨—ç®¡åœ¨ <a href="https://gerrit.zephyrproject.org/r/zephyr" target="_blank" rel="external">https://gerrit.zephyrproject.org/r/zephyr</a> é€™ç¶²ç«™ï¼Œæˆ‘å€‘å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼å–å¾— <i>v1.0.0</i> åŸå§‹ç¢¼ã€‚</p><pre class="example">coldnew@Gentoo ~ $ git clone https://gerrit.zephyrproject.org/r/zephyr --branch v1.0.0</pre><p>é™¤äº†åŸå§‹ç¢¼ä»¥å¤–ï¼Œæˆ‘å€‘é‚„éœ€è¦ä¸‹è¼‰ <a href="https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/" target="_blank" rel="external">Zephyr SDK</a> ï¼Œè£¡é¢åŒ…å«äº†ä¸åŒå¹³å°ç·¨è­¯ç”¨çš„å·¥å…·åŒ… (toolchain)</p><pre class="example">coldnew@Gentoo ~ $ wget https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/0.7.2-i686/zephyr-sdk-0.7.2-i686-setup.run</pre></div><div id="outline-container-orgc43159f" class="outline-3"><h3 id="orgc43159f">å®‰è£ SDK å‰ç½®ä½œæ¥­</h3><div class="outline-text-3" id="text-orgc43159f"><p>é™¤äº†ä¸‹è¼‰ SDK å¤–ï¼Œä¸åŒç™¼è¡Œç‰ˆçš„ Linux é‚„éœ€è¦å®‰è£ä¸€äº› x86 å‡½å¼åº«ä¾†ä½¿ç”¨é€™ä»½ SDKï¼Œå…·é«”è«‹åƒç…§ <a href="https://www.zephyrproject.org/doc/getting_started/installation_linux.html" target="_blank" rel="external">Development Environment Setup on Linux</a> ä¸€æ–‡ï¼Œç”±æ–¼æœ¬äººçš„ <i>Gentoo Linux</i> é‹ä½œè‰¯å¥½ï¼Œé€™é‚Šå°±ä¸è´…è¿°ã€‚</p></div></div><div id="outline-container-orge7fb046" class="outline-3"><h3 id="orge7fb046">å®‰è£ SDK</h3><div class="outline-text-3" id="text-orge7fb046"><p>å–å¾— SDK å¾Œï¼Œå…ˆå°‡å®ƒåŠ ä¸Šå¯åŸ·è¡Œæ¬Šé™</p><pre class="example">coldnew@Gentoo ~ $ chmod +x zephyr-sdk-0.7.2-i686-setup.run</pre><p>æ¥ä¸‹ä¾†å°‡å®ƒè£åˆ° <code>/opt/zephyr</code> å» (è¨»ï¼šåœ¨æˆ‘çš„ç³»çµ±ä¸­ï¼Œæˆ‘çš„å¸³æˆ¶å…·æœ‰ <code>/opt</code> è³‡æ–™å¤¾çš„è®€å¯«æ¬Šé™ï¼Œä¸€èˆ¬æƒ…æ³ä¸‹å®‰è£åˆ° <code>/opt</code> éœ€è¦ä½¿ç”¨ <code>sudo</code> ä¾†å®‰è£)</p><pre class="example">coldnew@Gentoo ~ $ ./zephyr-sdk-0.7.2-i686-setup.runVerifying archive integrity... All good.Uncompressing SDK for Zephyr  100%Enter target directory for SDK (default: /opt/zephyr-sdk/):Installing SDK to /opt/zephyr-sdkThe existing directory /opt/zephyr-sdk will be removed!Do you want to continue (y/n)? [*] Installing x86 tools... [*] Installing arm tools... [*] Installing arc tools... [*] Installing iamcu tools... [*] Installing mips tools... [*] Installing additional host tools...Success installing SDK. SDK is ready to be used.</pre><p>å®‰è£å®Œæˆå¾Œï¼Œæˆ‘å€‘å¯ä»¥åˆ° <code>/opt/zephyr</code> çœ‹é€™ä»½ SDK åŒ…å«äº†å“ªäº›æ±è¥¿</p><pre class="example">coldnew@Gentoo /opt/zephyr-sdk $ tree -L 2 .. &lt;b&gt;â”œâ”€â”€ sysroots &lt;b&gt;â”‚Â Â  â”œâ”€â”€ arc-poky-elf &lt;b&gt;â”‚Â Â  â”œâ”€â”€ armv5-poky-eabi &lt;b&gt;â”‚Â Â  â”œâ”€â”€ i586-poky-elf &lt;b&gt;â”‚Â Â  â”œâ”€â”€ i686-pokysdk-linux &lt;b&gt;â”‚Â Â  â”œâ”€â”€ iamcu-poky-elfiamcu &lt;b&gt;â”‚Â Â  â””â”€â”€ mips32r2-poky-elf &lt;b&gt;â”œâ”€â”€ version-arc-poky-elfâ”œâ”€â”€ version-armv5-poky-eabiâ”œâ”€â”€ version-i586-poky-elfâ”œâ”€â”€ version-i686-pokysdk-linuxâ”œâ”€â”€ version-iamcu-poky-elfiamcuâ””â”€â”€ version-mips32r2-poky-elf7 directories, 6 files</pre></div></div><div id="outline-container-orgd52dfb4" class="outline-3"><h3 id="orgd52dfb4">è¨­å®š SDK</h3><div class="outline-text-3" id="text-orgd52dfb4"><p>å®‰è£å®Œ <a href="https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/" target="_blank" rel="external">Zephyr SDK</a> å¾Œï¼Œæˆ‘å€‘å¯ä»¥è¨­å®šä»¥ä¸‹ç’°å¢ƒè®Šæ•¸ä¾†è®“æˆ‘å€‘ç•¶å‰çš„ shell å¯ä»¥ä½¿ç”¨é€™ä»½ SDK</p><div class="org-src-container"><pre class="src src-sh">coldnew@Gentoo ~ $ export <span style="color: #aaccff;">ZEPHYR_GCC_VARIANT</span>=zephyrcoldnew@Gentoo ~ $ export <span style="color: #aaccff;">ZEPHYR_SDK_INSTALL_DIR</span>=/opt/zephyr-sdk</pre></div><p>ç•¶ç„¶æ¯æ¬¡è¦ç·¨è­¯ <a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> æ™‚éƒ½è¦é‡æ–°è¨­å®šç’°å¢ƒè®Šæ•¸å¾ˆéº»ç…©ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥å°‡ä»–å¯«åˆ° <code>~/.zephyrrc</code> å»</p><pre class="example">coldnew@Gentoo ~ $ cat &lt;&lt;EOF &gt; ~/.zephyrrcexport ZEPHYR_GCC_VARIANT=zephyrexport ZEPHYR_SDK_INSTALL_DIR=/opt/zephyr-sdkEOF</pre></div></div></div><div id="outline-container-org118ded5" class="outline-2"><h2 id="org118ded5">Hello World (x86 QEMU)</h2><div class="outline-text-2" id="text-org118ded5"><p>å®Œæˆ <a href="https://nexus.zephyrproject.org/content/repositories/releases/org/zephyrproject/zephyr-sdk/" target="_blank" rel="external">Zephyr SDK</a> çš„è¨­å®šèˆ‡å®‰è£å¾Œï¼Œè®“æˆ‘å€‘æ¸¬è©¦ç¬¬ä¸€å€‹ç¯„ä¾‹ç¨‹å¼ <i>Hello World</i> ï¼Œé¡§åæ€ç¾©å°±æ˜¯æœƒåœ¨è™›æ“¬æ©Ÿä¸­é¡¯ç¤º <i>Hello World</i> å‡ºä¾†ã€‚</p><p>ä¸éæˆ‘å€‘è¦å…ˆè®“ç•¶å‰ shell å–å¾—åˆé©çš„é–‹ç™¼ç’°å¢ƒè®Šæ•¸ï¼Œå…ˆä¾† <code>source zephyr-env.sh</code> ä¸€ä¸‹:</p><pre class="example">coldnew@Gentoo ~/zephyr $ source zephyr-env.sh</pre><p>æ¥è‘—åˆ‡æ›åˆ° <code>samples/hello_world/microkernel</code> å»</p><pre class="example">coldnew@Gentoo ~/zephyr $ cd samples/hello_world/microkernelcoldnew@Gentoo ~/zephyr/samples/hello_world/microkernel $ tree -L 2 .. &lt;b&gt;â”œâ”€â”€ Makefileâ”œâ”€â”€ prj.confâ”œâ”€â”€ prj.mdefâ”œâ”€â”€ README.txt &lt;g&gt;â””â”€â”€ src &lt;b&gt;    â”œâ”€â”€ main.c    â””â”€â”€ Makefile1 directory, 6 files</pre><p>æˆ‘å€‘æ¸¬è©¦çš„ç›®æ¨™æ˜¯ <code>QEMU</code> ï¼Œå› æ­¤ç›´æ¥ <code>make qemu</code> å³å¯çœ‹åˆ° <a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> ç·¨è­¯åˆ° x86 ç’°å¢ƒä¸‹ä¸¦é‹è¡Œçš„ç‹€æ³</p><div class="org-src-container"><pre class="src src-sh">coldnew@Gentoo ~/zephyr/samples/hello_world/microkernel $ make qemumake<span style="color: #aadddd;">[</span>1<span style="color: #aadddd;">]</span>: Entering directory <span style="color: #aadddd;">'/home/coldnew/zephyr'</span>make<span style="color: #aadddd;">[</span>2<span style="color: #aadddd;">]</span>: Entering directory <span style="color: #aadddd;">'/home/coldnew/zephyr/samples/hello_world/microkernel/outdir'</span>  Using /home/coldnew/zephyr as source for kernel  GEN     ./Makefile  CHK     include/generated/version.h  CHK     misc/generated/configs.c  CHK     include/generated/offsets.h  CHK     misc/generated/sysgen/prj.mdefTo exit from QEMU enter: <span style="color: #aadddd;">'CTRL+a, x'</span><span style="color: #aadddd;">[</span>QEMU<span style="color: #aadddd;">]</span> CPU: qemu32qemu-system-i386: pci_add_option_rom: failed to find romfile <span style="color: #aadddd;">"vgabios-cirrus.bin"</span>Hello World!</pre></div><p>å¦‚æœä½ çœ‹è†©äº†é€™å€‹çµæœï¼Œå¯ä»¥ä½¿ç”¨ <code>C-a x</code> é›¢é–‹ <i>QEMU</i> æ¨¡æ“¬ã€‚</p><p>ä¸€æ—¦ç¶“éäº†ç·¨è­¯ï¼Œä½ å¯ä»¥çœ‹åˆ°æœƒå¤šå‡ºä¸€å€‹ <code>outdir</code> ç”¨ä¾†å­˜æ”¾è‘—ç·¨è­¯å¾Œçš„ç‰©ä»¶æª”ã€‚</p><pre class="example">coldnew@Gentoo ~/zephyr/samples/hello_world/microkernel $ lsMakefile  outdir&lt;b&gt;  prj.conf  prj.mdef  README.txt&lt;g&gt;  src</pre><p>é€™å€‹ <code>outdir</code> æ˜¯å¯ä»¥é€é <code>make</code> ç³»åˆ—å‘½ä»¤æ¸…é™¤ä¹¾æ·¨çš„ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åœ¨ <code>make help</code> çœ‹åˆ°å¦‚ä½•æ¸…é™¤å°ˆæ¡ˆçš„ç‰©ä»¶æª”ã€‚</p><pre class="example">coldnew@Gentoo ~/zephyr/samples/hello_world/microkernel $ make helpCleaning targets:  clean           - Remove most generated files but keep configuration and backup files  mrproper        - Remove all generated files + config + various backup files  distclean       - mrproper + remove editor backup and patch files  pristine        - Remove the output directory with all generated filesskip...</pre><p>æ­¤å¤–ï¼Œ <a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> ä¹Ÿæ”¯æ´ <code>make menuconfig</code> ï¼Œæˆ‘å€‘å¯ä»¥åœ¨é¸å–®ç›´æ¥é¸å–æˆ‘å€‘çš„ç›®æ¨™ã€‚</p><pre class="example">coldnew@Gentoo ~/zephyr/samples/hello_world/microkernel $ make menuconfig</pre><div class="figure"><p><img src="menuconfig.png"></p></div></div></div><div id="outline-container-org0a77c40" class="outline-2"><h2 id="org0a77c40">Hello World (arm QEMU)</h2><div class="outline-text-2" id="text-org0a77c40"><p>æˆ‘å€‘æ¥ä¸‹ä¾†è©¦è©¦ <i>Hello World</i> é‹ä½œåœ¨ ARM Cortex-M3 çš„ QEMU çš„æƒ…æ³ï¼Œäº†è§£æ›´å¤šå¾Œèªªä¸å®šæˆ‘å€‘å°±å¯ä»¥è‡ªå·±å°‡ <a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr</a> ç§»æ¤åˆ° STM32 å¹³å°ï¼Œæˆ–æ˜¯å…¶ä»–æ‰‹ä¸­æœ‰çš„é–‹ç™¼ç‰ˆç’°å¢ƒå»ã€‚</p><p>ä¸€æ¨£åˆ‡æ›åˆ° <code>samples/hello_world/microkernel</code> å»ï¼Œå¦‚æœå‰›å‰›å·²ç¶“ç·¨è­¯é x86 ç‰ˆæœ¬çš„è©±ï¼Œè¦è¨˜å¾—å°‡ <code>outdir</code> æ¸…ä¹¾æ·¨</p><pre class="example">coldnew@Gentoo ~/zephyr/samples/hello_world/microkernel $ make distclean</pre><p>æ¥ä¸‹ä¾†ç·¨è­¯çš„æ™‚å€™æŒ‡å®šç›®æ¨™ç«¯ç‚º <code>qemu_cortex_m3</code> ä¸¦ä¸” <code>ARCH=arm</code></p><div class="org-src-container"><pre class="src src-sh">coldnew@Gentoo ~/zephyr/samples/hello_world/microkernel $ make <span style="color: #aaccff;">BOARD</span>=qemu_cortex_m3 <span style="color: #aaccff;">ARCH</span>=arm qemumake<span style="color: #aadddd;">[</span>1<span style="color: #aadddd;">]</span>: Entering directory <span style="color: #aadddd;">'/home/coldnew/zephyr'</span>make<span style="color: #aadddd;">[</span>2<span style="color: #aadddd;">]</span>: Entering directory <span style="color: #aadddd;">'/home/coldnew/zephyr/samples/hello_world/microkernel/outdir'</span>  Using /tmp/zephyr-project-fork as source for kernel  GEN     ./Makefile  CHK     include/generated/version.h  CHK     misc/generated/configs.c  CHK     include/generated/offsets.h  CHK     misc/generated/sysgen/prj.mdefTo exit from QEMU enter: <span style="color: #aadddd;">'CTRL+a, x'</span><span style="color: #aadddd;">[</span>QEMU<span style="color: #aadddd;">]</span> CPU: cortex-m3Hello World!</pre></div><p>è¦é›¢é–‹çš„è©±ï¼Œä¸€æ¨£æ˜¯ä½¿ç”¨ <code>C-a x</code> ä¾†é›¢é–‹ <i>QEMU</i></p><p>ç”±æ–¼ç·¨è­¯å‡ºä¾†çš„åŸ·è¡Œæª”æœƒå‡ºç¾åœ¨ <code>outdir</code> ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥åœ¨ <code>outdir</code> è£¡é¢æ‰¾åˆ°ç·¨è­¯å‡ºä¾†çš„ ELF æª”ä»¥åŠäºŒé€²åˆ¶æ–‡ä»¶ï¼Œé è¨­é€™äº›æ±è¥¿çš†æ˜¯ä»¥ <code>zephyr.*</code> ä¾†å‘½åã€‚</p><pre class="example">coldnew@Gentoo ~/zephyr/samples/hello_world/microkernel/outdir $ ls zephyr.*zephyr.bin&lt;g&gt;  zephyr.elf&lt;g&gt;  zephyr.lnk  zephyr.lst  zephyr.map  zephyr.strip&lt;g&gt;</pre></div></div><div id="outline-container-org51579a3" class="outline-2"><h2 id="org51579a3">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org51579a3"><p><code>[1]</code> <a href="https://www.zephyrproject.org/" target="_blank" rel="external">Zephyr Project Website</a></p><p><code>[2]</code> <a href="http://linuxgizmos.com/zephyr-a-tiny-open-source-iot-rtos/" target="_blank" rel="external">Meet Linux's little brother: Zephyr, a tiny open-source IoT RTOS</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/7f7c0c84/#disqus_thread</comments>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Clojure æ“·å–å°ç£éŠ€è¡Œç‰Œå‘ŠåŒ¯ç‡</title>
      <link>https://coldnew.github.io/c8ce3cdb/</link>
      <guid>https://coldnew.github.io/c8ce3cdb/</guid>
      <pubDate>Fri, 26 Feb 2016 05:49:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
æœ€è¿‘é–‹å§‹åœ¨çœ‹ç†è²¡ç›¸é—œçš„è³‡è¨Šï¼Œç•¢ç«ŸéŒ¢ä¸€ç›´å­˜è‘—ä¹Ÿåªæ˜¯å­˜è‘—ï¼Œå‰›å¥½çœ‹åˆ°äº† &lt;a href=&quot;http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm&quot;&gt;å°ç£éŠ€è¡Œç‰Œå‘ŠåŒ¯ç‡&lt;/a&gt; çš„è¨Šæ¯ï¼Œå°±è®“æˆ‘å€‘ç”¨ Clojure ä¾†å¯«ä¸€å€‹ parser å°‡é€™å€‹ HTML ç¶²é è½‰æ›æˆ Clojure å¸¸ç”¨çš„ &lt;a href=&quot;https://github.com/edn-format/edn&quot;&gt;edn&lt;/a&gt; æ ¼å¼å§ã€‚
&lt;/p&gt;

&lt;p&gt;
æœ¬æ–‡å°‡ç°¡è¿°å¦‚ä½•é€é &lt;a href=&quot;https://github.com/dakrone/clj-http&quot;&gt;clj-http&lt;/a&gt; å–å¾— &lt;a href=&quot;http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm&quot;&gt;å°ç£éŠ€è¡Œç‰Œå‘ŠåŒ¯ç‡&lt;/a&gt; è³‡è¨Šå¾Œï¼Œå†ä½¿ç”¨ &lt;a href=&quot;https://github.com/davidsantiago/hickory&quot;&gt;hickory&lt;/a&gt; å°å–å¾—ç¶²é çš„è³‡æ–™é€²è¡Œè™•ç†ï¼Œæœ€å¾Œå›å‚³ &lt;a href=&quot;https://github.com/edn-format/edn&quot;&gt;edn&lt;/a&gt; æ ¼å¼å¥½æ–¹ä¾¿æˆ‘å€‘æœªä¾†çš„ Clojure ç¨‹å¼å¯ä»¥å°é€™äº›è¨Šæ¯é€²è¡Œè™•ç†ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>æœ€è¿‘é–‹å§‹åœ¨çœ‹ç†è²¡ç›¸é—œçš„è³‡è¨Šï¼Œç•¢ç«ŸéŒ¢ä¸€ç›´å­˜è‘—ä¹Ÿåªæ˜¯å­˜è‘—ï¼Œå‰›å¥½çœ‹åˆ°äº† <a href="http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm" target="_blank" rel="external">å°ç£éŠ€è¡Œç‰Œå‘ŠåŒ¯ç‡</a> çš„è¨Šæ¯ï¼Œå°±è®“æˆ‘å€‘ç”¨ Clojure ä¾†å¯«ä¸€å€‹ parser å°‡é€™å€‹ HTML ç¶²é è½‰æ›æˆ Clojure å¸¸ç”¨çš„ <a href="https://github.com/edn-format/edn" target="_blank" rel="external">edn</a> æ ¼å¼å§ã€‚</p><p>æœ¬æ–‡å°‡ç°¡è¿°å¦‚ä½•é€é <a href="https://github.com/dakrone/clj-http" target="_blank" rel="external">clj-http</a> å–å¾— <a href="http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm" target="_blank" rel="external">å°ç£éŠ€è¡Œç‰Œå‘ŠåŒ¯ç‡</a> è³‡è¨Šå¾Œï¼Œå†ä½¿ç”¨ <a href="https://github.com/davidsantiago/hickory" target="_blank" rel="external">hickory</a> å°å–å¾—ç¶²é çš„è³‡æ–™é€²è¡Œè™•ç†ï¼Œæœ€å¾Œå›å‚³ <a href="https://github.com/edn-format/edn" target="_blank" rel="external">edn</a> æ ¼å¼å¥½æ–¹ä¾¿æˆ‘å€‘æœªä¾†çš„ Clojure ç¨‹å¼å¯ä»¥å°é€™äº›è¨Šæ¯é€²è¡Œè™•ç†ã€‚</p><a id="more"></a><div id="outline-container-org94edfe8" class="outline-2"><h2 id="org94edfe8">è¨­å®šæˆ‘å€‘çš„ç›®æ¨™</h2><div class="outline-text-2" id="text-org94edfe8"><p>åœ¨é–‹å§‹å¯«ç¨‹å¼å‰ï¼Œå…ˆä¾†ç¢ºç«‹æˆ‘å€‘çš„ç›®æ¨™ã€‚æˆ‘å€‘å¸Œæœ›å–å¾— <a href="http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm" target="_blank" rel="external">å°ç£éŠ€è¡Œç‰Œå‘ŠåŒ¯ç‡</a> çš„è³‡è¨Šï¼Œä¸¦å°‡ä¸‹åœ–è£¡é¢çš„è³‡æ–™è½‰æ›æˆ Clojure çš„ <a href="https://github.com/edn-format/edn" target="_blank" rel="external">edn</a> æ ¼å¼ã€‚</p><div class="figure"><p><img src="twbank.png"></p></div><p>å› æ­¤æœ€å¾Œæˆ‘å€‘å¸Œæœ›å¯ä»¥å¾—åˆ°é€™æ¨£çš„çµæœ:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">{</span><span style="color: #ccaaff;">:url</span> <span style="color: #aadddd;">"http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm"</span>, <span style="color: #ccaaff;">:date</span> <span style="color: #aadddd;">"2016/02/25 16:00"</span>, <span style="color: #ccaaff;">:count</span> 19, <span style="color: #ccaaff;">:results</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:USD</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"&#32654;&#37329; (USD)"</span>,                 <span style="color: #ccaaff;">:cash-selling</span> <span style="color: #aadddd;">"32.92500"</span>,                 <span style="color: #ccaaff;">:cash-buying</span> <span style="color: #aadddd;">"33.46700"</span>,                 <span style="color: #ccaaff;">:spot-selling</span> <span style="color: #aadddd;">"33.22500"</span>,                 <span style="color: #ccaaff;">:spot-buying</span> <span style="color: #aadddd;">"33.32500"</span><span style="color: #aaccff;">}</span>,           <span style="color: #ccaaff;">:EUR</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"&#27472;&#20803; (EUR)"</span>,                 <span style="color: #ccaaff;">:cash-selling</span> <span style="color: #aadddd;">"35.99000"</span>,                 <span style="color: #ccaaff;">:cash-buying</span> <span style="color: #aadddd;">"37.13000"</span>,                 <span style="color: #ccaaff;">:spot-selling</span> <span style="color: #aadddd;">"36.47000"</span>,                 <span style="color: #ccaaff;">:spot-buying</span> <span style="color: #aadddd;">"36.87000"</span><span style="color: #aaccff;">}</span>,           <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip ...</span>           <span style="color: #ccaaff;">:PHP</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"&#33778;&#22283;&#27604;&#32034; (PHP)"</span>,                 <span style="color: #ccaaff;">:cash-selling</span> <span style="color: #aadddd;">"0.64980"</span>,                 <span style="color: #ccaaff;">:cash-buying</span> <span style="color: #aadddd;">"0.78250"</span>,                 <span style="color: #ccaaff;">:spot-selling</span> <span style="color: #aadddd;">"-"</span>,                 <span style="color: #ccaaff;">:spot-buying</span> <span style="color: #aadddd;">"-"</span><span style="color: #aaccff;">}</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">}</span></pre></div></div></div><div id="outline-container-orgdc9b542" class="outline-2"><h2 id="orgdc9b542">å»ºç«‹æˆ‘å€‘çš„å°ˆæ¡ˆ</h2><div class="outline-text-2" id="text-orgdc9b542"><p>é¦–å…ˆæˆ‘å€‘å…ˆé€é <a href="http://leiningen.org/" target="_blank" rel="external">leinigen</a> ç”¢ç”Ÿæˆ‘å€‘ Clojure å°ˆæ¡ˆçš„åŸºæœ¬æ¨£æ¿ï¼Œé€™é‚Šå‘½åè©²å°ˆæ¡ˆç‚º <code>twbank-forex</code></p><pre class="example">coldnew@Rosia ~ $ lein new twbank-forex</pre><p>å°ˆæ¡ˆå»ºç«‹å®Œæˆå¾Œï¼Œæˆ‘å€‘è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ <i>project.clj</i> æ·»åŠ  <a href="https://github.com/davidsantiago/hickory" target="_blank" rel="external">hickory</a> ä»¥åŠ <a href="https://github.com/dakrone/clj-http" target="_blank" rel="external">clj-http</a> é€™å…©å€‹å‡½å¼åº«ã€‚</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defproject</span> <span style="color: #aaccff;">twbank-forex</span> <span style="color: #aadddd;">"0.1.0-SNAPSHOT"</span>  <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip ...</span>  <span style="color: #ccaaff;">:dependencies</span> <span style="color: #81d4fa;">[</span><span style="color: #aaccff;">[</span><span style="color: #fff59d;">org.clojure</span><span style="color: #c6cccc; background-color: #202020;">/</span>clojure <span style="color: #aadddd;">"1.8.0"</span><span style="color: #aaccff;">]</span>                 <span style="color: #aaccff;">[</span>hickory <span style="color: #aadddd;">"0.6.0"</span><span style="color: #aaccff;">]</span>                 <span style="color: #aaccff;">[</span>clj-http <span style="color: #aadddd;">"2.1.0"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">]</span>  <span style="color: #ccaaff;">:main</span> <span style="color: #fff59d;">twbank-forex.core</span><span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-orge5078e3" class="outline-2"><h2 id="orge5078e3">é–‹å§‹æˆ‘å€‘çš„ç¨‹å¼</h2><div class="outline-text-2" id="text-orge5078e3"><p>å°±è®“æˆ‘å€‘ä¾†é–‹å§‹æˆ‘å€‘çš„å°ˆæ¡ˆå§ï¼Œé¦–å…ˆç·¨è¼¯ <code>src/twbank_forex/core.clj</code> é€™å€‹æª”æ¡ˆï¼Œä¸¦æ·»åŠ ä¸€äº›æˆ‘å€‘éœ€è¦çš„å‡½å¼åº«è³‡è¨Š:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">ns</span> <span style="color: #fff59d;">twbank-forex.core</span>  <span style="color: #81d4fa;">(</span><span style="color: #ccaaff;">:require</span> <span style="color: #aaccff;">[</span><span style="color: #fff59d;">clj-http.client</span> <span style="color: #ccaaff;">:as</span> http<span style="color: #aaccff;">]</span>            <span style="color: #aaccff;">[</span><span style="color: #fff59d;">hickory.core</span>    <span style="color: #ccaaff;">:as</span> hickory<span style="color: #aaccff;">]</span>            <span style="color: #aaccff;">[</span><span style="color: #fff59d;">hickory.select</span>  <span style="color: #ccaaff;">:as</span> s<span style="color: #aaccff;">]</span>            <span style="color: #aaccff;">[</span><span style="color: #fff59d;">clojure.string</span>  <span style="color: #ccaaff;">:as</span> str<span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>ç”±æ–¼æˆ‘å€‘è¦åˆ†æçš„ç›®æ¨™æ˜¯ <a href="http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm" target="_blank" rel="external">å°ç£éŠ€è¡Œç‰Œå‘ŠåŒ¯ç‡</a> é€™å€‹ç¶²é ï¼Œå› æ­¤å…ˆè¨­ç«‹ä¸€å€‹å…¨åŸŸè®Šæ•¸ï¼Œå…¶å…§å®¹å­˜æ”¾æˆ‘å€‘æƒ³è¦åˆ†æçš„ç¶²å€</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">The webpage we want to parse</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">def</span> ^<span style="color: #ccaaff;">:private</span>  <span style="color: #aaccff;">twbank-url</span> <span style="color: #97abc6; font-style: italic;">"http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm"</span><span style="color: #aadddd;">)</span></pre></div><p>æ¥è‘—ï¼Œè®“æˆ‘å€‘ä¸€æ­¥ä¸€æ­¥ä¾†å¯¦ä½œ</p></div><div id="outline-container-org9e695ef" class="outline-3"><h3 id="org9e695ef">å–å¾—ç¶²é å…§å®¹</h3><div class="outline-text-3" id="text-org9e695ef"><p>æˆ‘å€‘çš„ç›®çš„æ˜¯ä¸‹è¼‰ <a href="http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm" target="_blank" rel="external">å°ç£éŠ€è¡Œç‰Œå‘ŠåŒ¯ç‡</a> ç¶²é å…§å®¹ä¸¦é€²è¡Œè§£æï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥é€é <a href="https://github.com/dakrone/clj-http" target="_blank" rel="external">clj-http</a> ä¾†è™•ç†é€™ä»¶äº‹</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #fff59d;">http</span><span style="color: #c6cccc; background-color: #202020;">/</span>get twbank-url<span style="color: #aadddd;">)</span></pre></div><p>å¦‚æœä½ çš„ç¶²è·¯é€£å¾—ä¸Šæˆ‘å€‘çš„ç›®æ¨™ç¶²å€çš„è©±ï¼Œä½ æœƒå¾—åˆ°å¦‚ä¸‹çš„å›æ‡‰</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">{</span><span style="color: #ccaaff;">:status</span> 200, <span style="color: #ccaaff;">:headers</span> <span style="color: #81d4fa;">{</span><span style="color: #aadddd;">"Server"</span> <span style="color: #aadddd;">"Microsoft-IIS/8.5"</span>,           <span style="color: #aadddd;">"Content-Type"</span> <span style="color: #aadddd;">"text/html"</span>,           <span style="color: #aadddd;">"Content-Length"</span> <span style="color: #aadddd;">"3664"</span>,           <span style="color: #aadddd;">"Connection"</span> <span style="color: #aadddd;">"close"</span>,           <span style="color: #aadddd;">"Accept-Ranges"</span> <span style="color: #aadddd;">"bytes"</span>,           <span style="color: #aadddd;">"ETag"</span> <span style="color: #aadddd;">"W/</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">809337e3b70d11:0</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">"</span>,           <span style="color: #aadddd;">"Date"</span> <span style="color: #aadddd;">"Fri, 26 Feb 2016 02:23:39 GMT"</span>,           <span style="color: #aadddd;">"Vary"</span> <span style="color: #aadddd;">"Accept-Encoding"</span>,           <span style="color: #aadddd;">"Last-Modified"</span> <span style="color: #aadddd;">"Fri, 26 Feb 2016 02:14:59 GMT"</span>,           <span style="color: #aadddd;">"X-Powered-By"</span> <span style="color: #aadddd;">"ASP.NET"</span><span style="color: #81d4fa;">}</span>, <span style="color: #ccaaff;">:body</span> <span style="color: #aadddd;">"&#65279;</span><span style="color: #aadddd; font-weight: bold;">\r\n\r\n</span><span style="color: #aadddd;">&lt;!DOCTYPE html PUBLIC </span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">-//W3C//DTD XHTML 1.0 Transitional//EN</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;"> </span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">&gt;</span><span style="color: #aadddd; font-weight: bold;">\r\n\r\n</span><span style="color: #aadddd;">&lt;html xmlns=</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">http://www.w3.org/1999/xhtml</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">&gt;</span><span style="color: #aadddd; font-weight: bold;">\r\n</span><span style="color: #aadddd;">&lt;head&gt;&lt;link href=</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">../../App_Themes/Builtin/Default.css</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;"> type=</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">text/css</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;"> rel=</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">stylesheet</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;"> /&gt;&lt;meta http-equiv=</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">Content-Type</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;"> content=</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">text/html;charset=utf-8</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;"> /&gt;&lt;title&gt;</span><span style="color: #aadddd; font-weight: bold;">\r\n\t</span><span style="color: #aadddd;"> &#33274;&#28771;&#37504;&#34892;&#29260;&#21578;&#21295;&#29575;</span><span style="color: #aadddd; font-weight: bold;">\r\n</span><span style="color: #aadddd;">&lt;/title&gt;</span><span style="color: #aadddd; font-weight: bold;">\r\n</span><span style="color: #aadddd;"> "</span>, <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip ....</span> <span style="color: #ccaaff;">:request-time</span> 227, <span style="color: #ccaaff;">:trace-redirects</span> <span style="color: #81d4fa;">[</span><span style="color: #aadddd;">"http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm"</span><span style="color: #81d4fa;">]</span>, <span style="color: #ccaaff;">:orig-content-encoding</span> <span style="color: #aadddd;">"gzip"</span>, <span style="color: #ccaaff;">:cookies</span> <span style="color: #81d4fa;">{</span><span style="color: #aadddd;">"BankOfTaiwanCookie"</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:discard</span> <span style="color: #ccaaff;">false</span>,                                 <span style="color: #ccaaff;">:expires</span> #inst <span style="color: #aadddd;">"2016-02-26T05:23:42.000-00:00"</span>,                                 <span style="color: #ccaaff;">:path</span> <span style="color: #aadddd;">"/"</span>,                                 <span style="color: #ccaaff;">:secure</span> <span style="color: #ccaaff;">false</span>,                                 <span style="color: #ccaaff;">:value</span> <span style="color: #aadddd;">"352626880.20480.0000"</span>,                                 <span style="color: #ccaaff;">:version</span> 0<span style="color: #aaccff;">}</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">}</span></pre></div><p>ç”±ä¸Šé¢çš„å›æ‡‰ä¾†çœ‹ï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾ç¶²é çš„ <i>å…§å®¹</i> æ˜¯å­˜æ”¾åœ¨ <code>:body</code> è£¡é¢ï¼Œè€Œåœ¨æœ¬ä¾‹ä¸­æˆ‘å€‘åªéœ€è¦å–å¾—ç¶²é å…§å®¹å³å¯ï¼Œå› æ­¤å¯ä»¥é€™æ¨£å»ºç«‹å–å¾—ç¶²é å…§å®¹çš„å‡½å¼</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">fetch-html</span> <span style="color: #81d4fa;">[]</span>  <span style="color: #81d4fa;">(</span><span style="color: #ccaaff;">:body</span> <span style="color: #aaccff;">(</span><span style="color: #fff59d;">http</span><span style="color: #c6cccc; background-color: #202020;">/</span>get twbank-url<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-orgbefa3f8" class="outline-3"><h3 id="orgbefa3f8">å–å¾—æœ€æ–°æ›ç‰Œæ™‚é–“</h3><div class="outline-text-3" id="text-orgbefa3f8"><p>å–å¾—ç¶²é å…§å®¹å¾Œï¼Œæˆ‘å€‘å¯ä»¥ä¾†æŸ¥æ‰¾é€™å€‹ç¶²é çš„æ›ç‰Œæ™‚é–“ï¼Œå¾ç¶²é ä¸Šä¾†çœ‹å°±æ˜¯é€™å€‹</p><div class="figure"><p><img src="twbank-date.png"></p></div><p>å› æ­¤ä½¿ç”¨ç€è¦½å™¨æŸ¥çœ‹åŸå§‹ç¢¼æ™‚ï¼Œä½ å¯ä»¥æ‰¾åˆ°é€™æ¨£çš„è¨Šæ¯</p><div class="figure"><p><img src="twbank-date1.png"></p></div><p>ä¹Ÿå°±æ˜¯èªªï¼Œæˆ‘å€‘åªè¦é‡å°é—œéµå­— <code>ç‰Œåƒ¹æœ€æ–°æ›ç‰Œæ™‚é–“</code> ä½¿ç”¨æ­£è¦è¡¨é”å¼ä¾†é€²è¡Œè™•ç†ï¼Œå°±å¯ä»¥å–å¾—æ›ç‰Œæ™‚é–“çš„è³‡è¨Šï¼Œé‡å°æ­¤å•é¡Œï¼Œæˆ‘å€‘å¯ä»¥é€é Clojure çš„ <a href="https://clojuredocs.org/clojure.core/re-find" target="_blank" rel="external">re-find</a> ä¾†å°ç›®æ¨™é€²è¡Œåˆ‡å‰²</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>re-find #<span style="color: #aadddd;">"</span><span style="color: #ff8888;">(</span><span style="color: #aadddd;">.*&#29260;&#20729;&#26368;&#26032;&#25499;&#29260;&#26178;&#38291;&#65306;&amp;nbsp;</span><span style="color: #ff8888;">)(</span><span style="color: #aadddd;">[</span><span style="color: #aadddd; font-weight: bold;">\d\/</span><span style="color: #aadddd;">]+</span><span style="color: #aadddd; font-weight: bold;">\s</span><span style="color: #aadddd;">[</span><span style="color: #aadddd; font-weight: bold;">\d</span><span style="color: #aadddd;">:]+</span><span style="color: #ff8888;">)(</span><span style="color: #aadddd;">.*</span><span style="color: #ff8888;">)</span><span style="color: #aadddd;">"</span>         <span style="color: #aadddd;">"&lt;td style=</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">width:326px;text-align:left;vertical-align:top;color:#0000FF;font-size:11pt;font-weight:bold;</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">&gt;</span><span style="color: #aadddd;">      &lt;img style=</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">vertical-align:middle;width:20px;</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;"> src=</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;">../../Images/Monitor.gif</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;"> alt=</span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;"> </span><span style="color: #aadddd; font-weight: bold;">\"</span><span style="color: #aadddd;"> /&gt;&amp;nbsp;</span><span style="color: #aadddd;">      &#29260;&#20729;&#26368;&#26032;&#25499;&#29260;&#26178;&#38291;&#65306;&amp;nbsp;2016/02/26 10:28</span><span style="color: #aadddd;">    &lt;/td&gt;"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">["      &#29260;&#20729;&#26368;&#26032;&#25499;&#29260;&#26178;&#38291;&#65306;&amp;nbsp;2016/02/26 10:28"</span><span style="color: #5f5f5f; font-style: italic;">;;  </span><span style="color: #9ac; font-style: italic;">"      &#29260;&#20729;&#26368;&#26032;&#25499;&#29260;&#26178;&#38291;&#65306;&amp;nbsp;"</span><span style="color: #5f5f5f; font-style: italic;">;;  </span><span style="color: #9ac; font-style: italic;">"2016/02/26 10:28"</span><span style="color: #5f5f5f; font-style: italic;">;;  </span><span style="color: #9ac; font-style: italic;">""]</span></pre></div><p><a href="https://clojuredocs.org/clojure.core/re-find" target="_blank" rel="external">re-find</a> æœƒä¾ç…§ä½ è¨­å®šçš„æ­£è¦è¡¨é”å¼ï¼Œå°‡ç›®æ¨™åˆ†æˆä¸åŒç¾¤çµ„ï¼Œå¾—åˆ°çš„çµæœå¦‚ä¸Šã€‚ä¹Ÿå› æ­¤æˆ‘å€‘å¯ä»¥çŸ¥é“æˆ‘å€‘çš„ç›®æ¨™æœƒå‡ºç¾åœ¨çµæœçš„ <code>index 2</code> (Clojure é™£åˆ—æ˜¯å¾ 0 é–‹å§‹è¨ˆç®—)</p><p>æœ€å¾Œï¼Œå°‡é€™å‡½å¼æ•´ç†ä¸€ä¸‹å³å¯ç²å¾—</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">parse-date</span> <span style="color: #81d4fa;">[</span>html<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span>nth <span style="color: #aaccff;">(</span>re-find #<span style="color: #aadddd;">"</span><span style="color: #ff8888;">(</span><span style="color: #aadddd;">.*&#29260;&#20729;&#26368;&#26032;&#25499;&#29260;&#26178;&#38291;&#65306;&amp;nbsp;</span><span style="color: #ff8888;">)(</span><span style="color: #aadddd;">[</span><span style="color: #aadddd; font-weight: bold;">\d\/</span><span style="color: #aadddd;">]+</span><span style="color: #aadddd; font-weight: bold;">\s</span><span style="color: #aadddd;">[</span><span style="color: #aadddd; font-weight: bold;">\d</span><span style="color: #aadddd;">:]+</span><span style="color: #ff8888;">)(</span><span style="color: #aadddd;">.*</span><span style="color: #ff8888;">)</span><span style="color: #aadddd;">"</span> html<span style="color: #aaccff;">)</span> 2<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-org988d94b" class="outline-3"><h3 id="org988d94b">å°‡ç¶²é è½‰æ›æˆ hickory æ ¼å¼</h3><div class="outline-text-3" id="text-org988d94b"><p>åœ¨æœ¬ç¨‹å¼ä¸­æˆ‘å€‘å°‡é€é <a href="https://github.com/davidsantiago/hickory" target="_blank" rel="external">hickory</a> ä¾†è®“æˆ‘å€‘è§£æ HTML æ›´ç‚ºç°¡å–®ï¼Œ<a href="https://github.com/davidsantiago/hickory" target="_blank" rel="external">hickory</a> æ˜¯ä¸€å€‹å¯ç”¨æ–¼ Clojure/ClojureScript çš„å‡½å¼åº«ï¼Œå¯ä»¥ç°¡åŒ–æˆ‘å€‘è§£æ HTML æ–‡ä»¶çš„éº»ç…©ï¼Œå”¯ä¸€çš„ç¼ºé»æ˜¯ï¼Œç”±æ–¼ç›®å‰ <a href="https://nodejs.org/" target="_blank" rel="external">node.js</a> ç¼ºå°‘äº† <i>DOM</i> å…ƒä»¶ï¼Œå› æ­¤ä½¿ç”¨ <a href="https://github.com/davidsantiago/hickory" target="_blank" rel="external">hickory</a> å¯«å‡ºçš„ ClojureScript æ˜¯ç„¡æ³•åœ¨ <a href="https://nodejs.org" target="_blank" rel="external">node.js</a> ä¸ŠåŸ·è¡Œçš„ã€‚</p><p>æˆ‘å€‘é¦–å…ˆä½¿ç”¨ <a href="http://davidsantiago.github.io/hickory/hickory.core.html#var-parse" target="_blank" rel="external">hickory/parse</a> å°‡ HTML è½‰æ›æˆ DOM çµæ§‹</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #fff59d;">hickory</span><span style="color: #c6cccc; background-color: #202020;">/</span>parse <span style="color: #aadddd;">"&lt;b&gt;TEST&lt;/b&gt;"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">#object[org.jsoup.nodes.Document</span><span style="color: #5f5f5f; font-style: italic;">;;         </span><span style="color: #9ac; font-style: italic;">"0x13e4a71e"</span><span style="color: #5f5f5f; font-style: italic;">;;         </span><span style="color: #9ac; font-style: italic;">"&lt;html&gt;\n &lt;head&gt;&lt;/head&gt;\n &lt;body&gt;\n  &lt;b&gt;TEST&lt;/b&gt;\n &lt;/body&gt;\n&lt;/html&gt;"]</span></pre></div><p>æ¥è‘—å†ä½¿ç”¨ <a href="http://davidsantiago.github.io/hickory/hickory.core.html#var-as-hickory" target="_blank" rel="external">hickory/as-hickory</a> å°‡å‰›å‰›ç²å¾—çš„ DOM çµæ§‹è½‰æ›æˆ <i>hickory</i> çš„è³‡æ–™æ ¼å¼ï¼Œå…¶å½¢å¼å¦‚ä¸‹</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #fff59d;">hickory</span><span style="color: #c6cccc; background-color: #202020;">/</span>as-hickory <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">hickory</span><span style="color: #c6cccc; background-color: #202020;">/</span>parse <span style="color: #aadddd;">"&lt;b&gt;TEST&lt;/b&gt;"</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">=&gt;</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">{</span><span style="color: #9ac; font-style: italic;">:type</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:document</span><span style="color: #9ac; font-style: italic;">,</span><span style="color: #5f5f5f; font-style: italic;">;;  </span><span style="color: #9ac; font-style: italic;">:content</span><span style="color: #9ac; font-style: italic;"> [{</span><span style="color: #9ac; font-style: italic;">:type</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:element</span><span style="color: #9ac; font-style: italic;">,</span><span style="color: #5f5f5f; font-style: italic;">;;             </span><span style="color: #9ac; font-style: italic;">:attrs</span><span style="color: #9ac; font-style: italic;"> nil,</span><span style="color: #5f5f5f; font-style: italic;">;;             </span><span style="color: #9ac; font-style: italic;">:tag</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:html</span><span style="color: #9ac; font-style: italic;">,</span><span style="color: #5f5f5f; font-style: italic;">;;             </span><span style="color: #9ac; font-style: italic;">:content</span><span style="color: #9ac; font-style: italic;"> [{</span><span style="color: #9ac; font-style: italic;">:type</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:element</span><span style="color: #9ac; font-style: italic;">, </span><span style="color: #9ac; font-style: italic;">:attrs</span><span style="color: #9ac; font-style: italic;"> nil, </span><span style="color: #9ac; font-style: italic;">:tag</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:head</span><span style="color: #9ac; font-style: italic;">, </span><span style="color: #9ac; font-style: italic;">:content</span><span style="color: #9ac; font-style: italic;"> nil}</span><span style="color: #5f5f5f; font-style: italic;">;;                       </span><span style="color: #9ac; font-style: italic;">{</span><span style="color: #9ac; font-style: italic;">:type</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:element</span><span style="color: #9ac; font-style: italic;">,</span><span style="color: #5f5f5f; font-style: italic;">;;                        </span><span style="color: #9ac; font-style: italic;">:attrs</span><span style="color: #9ac; font-style: italic;"> nil,</span><span style="color: #5f5f5f; font-style: italic;">;;                        </span><span style="color: #9ac; font-style: italic;">:tag</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:body</span><span style="color: #9ac; font-style: italic;">,</span><span style="color: #5f5f5f; font-style: italic;">;;                        </span><span style="color: #9ac; font-style: italic;">:content</span><span style="color: #9ac; font-style: italic;"> [{</span><span style="color: #9ac; font-style: italic;">:type</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:element</span><span style="color: #9ac; font-style: italic;">,</span><span style="color: #5f5f5f; font-style: italic;">;;                                   </span><span style="color: #9ac; font-style: italic;">:attrs</span><span style="color: #9ac; font-style: italic;"> nil,</span><span style="color: #5f5f5f; font-style: italic;">;;                                   </span><span style="color: #9ac; font-style: italic;">:tag</span><span style="color: #9ac; font-style: italic;"> </span><span style="color: #9ac; font-style: italic;">:b</span><span style="color: #9ac; font-style: italic;">,</span><span style="color: #5f5f5f; font-style: italic;">;;                                   </span><span style="color: #9ac; font-style: italic;">:content</span><span style="color: #9ac; font-style: italic;"> ["TEST"]}]}]}]}</span></pre></div><p>å°‡ä¸Šé¢è³‡è¨Šæ•´ç†ä¸€ä¸‹ï¼Œæœ€å¾Œæˆ‘å€‘çš„å‡½å¼å³ç‚º</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">html-&gt;hickory</span> <span style="color: #81d4fa;">[</span>html<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">-&gt;&gt;</span> html       <span style="color: #fff59d;">hickory</span><span style="color: #c6cccc; background-color: #202020;">/</span>parse       <span style="color: #fff59d;">hickory</span><span style="color: #c6cccc; background-color: #202020;">/</span>as-hickory<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>å¦‚æœå°‡é€™å‡½å¼ä½œç”¨æ–¼å‰é¢æ‰€ç²å¾—çš„ HTML å…§å®¹ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘å€‘å–å¾—äº†ä»¥ä¸‹çš„è³‡è¨Š</p><div class="figure"><p><img src="hickory.png"></p></div></div></div><div id="outline-container-orga304134" class="outline-3"><h3 id="orga304134">å–å¾—åŒ¯ç‡è½‰æ›çš„è³‡è¨Š</h3><div class="outline-text-3" id="text-orga304134"><p>æ¥ä¸‹ä¾†å°±æ˜¯é€™å€‹ç¨‹å¼çš„é‡é ­æˆ²äº†ï¼Œä»¥ç¶²é ä¾†çœ‹ï¼Œæˆ‘å€‘çš„ç›®æ¨™å°±æ˜¯é€™äº›åŒ¯ç‡è³‡è¨Š</p><div class="figure"><p><img src="twbank-data.png"></p></div><p>ç‚ºäº†æ–¹ä¾¿å°‹æ‰¾ï¼Œæˆ‘å€‘å…ˆé‡å° <code>ç¾é‡‘ (USD)</code> çš„éƒ¨åˆ†æŸ¥æ‰¾æˆ‘å€‘é€éå‰é¢å‡½å¼å°‡ HTML è½‰æ›æˆ Hickory æ ¼å¼å¾Œçš„çµæœ</p><div class="figure"><p><img src="twbank-data1.png"></p></div><p>ç”±æ–¼æˆ‘å€‘çš„ç›®æ¨™æ˜¯ <code>titleLeft</code> ä»¥åŠ <code>decimal</code> é€™å…©ç¨® class, å› æ­¤å°±ç›´æ¥ä½¿ç”¨ <a href="http://davidsantiago.github.io/hickory/hickory.select.html#var-select" target="_blank" rel="external">hickory.select/select</a> ä¾†å¹«æˆ‘å€‘å°‡ç›®æ¨™è³‡è¨Šåˆ‡å‰²å‡ºä¾†</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">let</span> <span style="color: #81d4fa;">[</span>data <span style="color: #aaccff;">(</span><span style="color: #aaffaa;">-&gt;</span> <span style="color: #aaeecc;">(</span>fetch-html<span style="color: #aaeecc;">)</span> html-&gt;hickory<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>select <span style="color: #aaccff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>child             <span style="color: #aaeecc;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>or <span style="color: #ccaaff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>class <span style="color: #aadddd;">"titleLeft"</span><span style="color: #ccaaff;">)</span>                   <span style="color: #ccaaff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>class <span style="color: #aadddd;">"decimal"</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>            data<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>é€éé€™ç¨®æ–¹å¼ï¼Œæˆ‘å€‘å¾—åˆ°ä»¥ä¸‹çš„é™£åˆ—è³‡è¨Š</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">[</span><span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>,  <span style="color: #ccaaff;">:attrs</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"titleLeft"</span><span style="color: #aaccff;">}</span>,  <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:td</span>,  <span style="color: #ccaaff;">:content</span> <span style="color: #aaccff;">[</span><span style="color: #aaeecc;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>,             <span style="color: #ccaaff;">:attrs</span> <span style="color: #ccaaff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"paddingLeft16"</span>,                     <span style="color: #ccaaff;">:src</span> <span style="color: #aadddd;">"/Images/Flags/America.gif"</span>,                     <span style="color: #ccaaff;">:title</span> <span style="color: #aadddd;">""</span>,                     <span style="color: #ccaaff;">:alt</span> <span style="color: #aadddd;">""</span><span style="color: #ccaaff;">}</span>,             <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:img</span>,             <span style="color: #ccaaff;">:content</span> <span style="color: #ccaaff;">nil</span><span style="color: #aaeecc;">}</span>            <span style="color: #aadddd;">"&#160;&#32654;&#37329; (USD)"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>, <span style="color: #ccaaff;">:attrs</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"decimal"</span><span style="color: #aaccff;">}</span>, <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:td</span>, <span style="color: #ccaaff;">:content</span> <span style="color: #aaccff;">[</span><span style="color: #aadddd;">"32.89000"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>, <span style="color: #ccaaff;">:attrs</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"decimal"</span><span style="color: #aaccff;">}</span>, <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:td</span>, <span style="color: #ccaaff;">:content</span> <span style="color: #aaccff;">[</span><span style="color: #aadddd;">"33.43200"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>, <span style="color: #ccaaff;">:attrs</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"decimal"</span><span style="color: #aaccff;">}</span>, <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:td</span>, <span style="color: #ccaaff;">:content</span> <span style="color: #aaccff;">[</span><span style="color: #aadddd;">"33.19000"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>, <span style="color: #ccaaff;">:attrs</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"decimal"</span><span style="color: #aaccff;">}</span>, <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:td</span>, <span style="color: #ccaaff;">:content</span> <span style="color: #aaccff;">[</span><span style="color: #aadddd;">"33.29000"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span> <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip ...</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>,  <span style="color: #ccaaff;">:attrs</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"titleLeft"</span><span style="color: #aaccff;">}</span>,  <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:td</span>,  <span style="color: #ccaaff;">:content</span> <span style="color: #aaccff;">[</span><span style="color: #aaeecc;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>,             <span style="color: #ccaaff;">:attrs</span> <span style="color: #ccaaff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"paddingLeft16"</span>,                     <span style="color: #ccaaff;">:src</span> <span style="color: #aadddd;">"/Images/Flags/HongKong.gif"</span>,                     <span style="color: #ccaaff;">:title</span> <span style="color: #aadddd;">""</span>,                     <span style="color: #ccaaff;">:alt</span> <span style="color: #aadddd;">""</span><span style="color: #ccaaff;">}</span>,             <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:img</span>,             <span style="color: #ccaaff;">:content</span> <span style="color: #ccaaff;">nil</span><span style="color: #aaeecc;">}</span>            <span style="color: #aadddd;">"&#160;&#28207;&#24163; (HKD)"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>, <span style="color: #ccaaff;">:attrs</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"decimal"</span><span style="color: #aaccff;">}</span>, <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:td</span>, <span style="color: #ccaaff;">:content</span> <span style="color: #aaccff;">[</span><span style="color: #aadddd;">"4.12500"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>, <span style="color: #ccaaff;">:attrs</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"decimal"</span><span style="color: #aaccff;">}</span>, <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:td</span>, <span style="color: #ccaaff;">:content</span> <span style="color: #aaccff;">[</span><span style="color: #aadddd;">"4.32400"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>, <span style="color: #ccaaff;">:attrs</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"decimal"</span><span style="color: #aaccff;">}</span>, <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:td</span>, <span style="color: #ccaaff;">:content</span> <span style="color: #aaccff;">[</span><span style="color: #aadddd;">"4.24900"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:type</span> <span style="color: #ccaaff;">:element</span>, <span style="color: #ccaaff;">:attrs</span> <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:class</span> <span style="color: #aadddd;">"decimal"</span><span style="color: #aaccff;">}</span>, <span style="color: #ccaaff;">:tag</span> <span style="color: #ccaaff;">:td</span>, <span style="color: #ccaaff;">:content</span> <span style="color: #aaccff;">[</span><span style="color: #aadddd;">"4.30900"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">]</span></pre></div><p>å¯¦éš›ä¸Šæˆ‘å€‘åªå°é€™ä»½è³‡æ–™ä¸­çš„ <code>:content</code> æ¬„ä½æœ‰èˆˆè¶£ï¼Œå› æ­¤é€é <a href="https://clojuredocs.org/clojure.core/map" target="_blank" rel="external">map</a> å°‡æˆ‘å€‘è¦çš„æ±è¥¿åˆ‡å‰²å‡ºä¾†</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">let</span> <span style="color: #81d4fa;">[</span>data <span style="color: #aaccff;">(</span><span style="color: #aaffaa;">-&gt;</span> <span style="color: #aaeecc;">(</span>fetch-html<span style="color: #aaeecc;">)</span> html-&gt;hickory<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">-&gt;&gt;</span> <span style="color: #aaccff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>select <span style="color: #aaeecc;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>child                  <span style="color: #ccaaff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>or <span style="color: #fff59d;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>class <span style="color: #aadddd;">"titleLeft"</span><span style="color: #fff59d;">)</span>                        <span style="color: #fff59d;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>class <span style="color: #aadddd;">"decimal"</span><span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span>                 data<span style="color: #aaccff;">)</span>       <span style="color: #aaccff;">(</span>map #<span style="color: #aaeecc;">(</span><span style="color: #aaffaa;">-&gt;</span> <span style="color: #aaccff;">%</span> <span style="color: #ccaaff;">:content</span> last<span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span>   <span style="color: #9ac; font-style: italic;">; &lt;= add this</span></pre></div><p>é€™æ¨£çš„è©±æˆ‘å€‘å°±æœƒå¾—åˆ°ä»¥ä¸‹çš„é™£åˆ—ï¼Œè£¡é¢çš„æ±è¥¿éƒ½æ˜¯æˆ‘å€‘è¦çš„è³‡è¨Š</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aadddd;">"&#160;&#32654;&#37329; (USD)"</span> <span style="color: #aadddd;">"32.89000"</span> <span style="color: #aadddd;">"33.43200"</span> <span style="color: #aadddd;">"33.19000"</span> <span style="color: #aadddd;">"33.29000"</span> <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip ...</span> <span style="color: #aadddd;">"&#160;&#20154;&#27665;&#24163; (CNY)"</span> <span style="color: #aadddd;">"4.98500"</span> <span style="color: #aadddd;">"5.14900"</span> <span style="color: #aadddd;">"5.05900"</span> <span style="color: #aadddd;">"5.10900"</span><span style="color: #aadddd;">)</span></pre></div><p>æˆ‘å€‘ç™¼ç¾åˆ°å¾—åˆ°çš„æ¨™é¡Œï¼Œæ¯”å¦‚ <code>Â ç¾é‡‘ (USD)</code> å‰é¢éƒ½å¤šäº†ä¸€å€‹åƒæ˜¯ç©ºæ ¼çš„æ±è¥¿ç„¡æ³•é¡¯ç¤ºï¼Œé‚£è¦æ€æ¨£æ¿¾æ‰å‘¢? å¯¦éš›ä¸Šé€™å€‹æ±è¥¿åœ¨ HTML ä¸­æ˜¯ <code>&amp;nbsp;</code> é€™ç¨®ç‰¹æ®Šç¬¦è™Ÿï¼Œ <i>hickory</i> å‰‡æ˜¯å°‡å®ƒè½‰æˆä¸€å€‹ç‰¹æ®Šå­—å…ƒï¼Œåœ¨é€™é‚Šæˆ‘ä½¿ç”¨ <a href="https://clojuredocs.org/clojure.core/replace" target="_blank" rel="external">replace</a> ç›´æ¥å°‡é€™å€‹å­—å…ƒæ›¿ä»£æ‰ <i>(è¨»: è©²å­—å…ƒç¶²é ä¸Šçœ‹ä¸åˆ°æ‚ ~)</i></p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">let</span> <span style="color: #81d4fa;">[</span>data <span style="color: #aaccff;">(</span><span style="color: #aaffaa;">-&gt;</span> <span style="color: #aaeecc;">(</span>fetch-html<span style="color: #aaeecc;">)</span> html-&gt;hickory<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">-&gt;&gt;</span>  <span style="color: #aaccff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>select <span style="color: #aaeecc;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>child                   <span style="color: #ccaaff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>or <span style="color: #fff59d;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>class <span style="color: #aadddd;">"titleLeft"</span><span style="color: #fff59d;">)</span>                         <span style="color: #fff59d;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>class <span style="color: #aadddd;">"decimal"</span><span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span>                  data<span style="color: #aaccff;">)</span>        <span style="color: #aaccff;">(</span>map #<span style="color: #aaeecc;">(</span><span style="color: #aaffaa;">-&gt;</span> <span style="color: #aaccff;">%</span> <span style="color: #ccaaff;">:content</span> last<span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>        <span style="color: #aaccff;">(</span>map #<span style="color: #aaeecc;">(</span><span style="color: #fff59d;">str</span><span style="color: #c6cccc; background-color: #202020;">/</span>replace <span style="color: #aaccff;">%</span> #<span style="color: #aadddd;">"&#160;"</span> <span style="color: #aadddd;">""</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span> <span style="color: #9ac; font-style: italic;">; &lt;= add this</span></pre></div><p>å› æ­¤æˆ‘å€‘å¯ä»¥ç²å¾—</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aadddd;">"&#32654;&#37329; (USD)"</span> <span style="color: #aadddd;">"32.89000"</span> <span style="color: #aadddd;">"33.43200"</span> <span style="color: #aadddd;">"33.19000"</span> <span style="color: #aadddd;">"33.29000"</span> <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip</span> <span style="color: #aadddd;">"&#20154;&#27665;&#24163; (CNY)"</span> <span style="color: #aadddd;">"4.98500"</span> <span style="color: #aadddd;">"5.14900"</span> <span style="color: #aadddd;">"5.05900"</span> <span style="color: #aadddd;">"5.10900"</span><span style="color: #aadddd;">)</span></pre></div><p>ä»”ç´°çœ‹é€™ä»½è³‡æ–™ï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾è³‡æ–™å…¶å¯¦æ‡‰è©²æ˜¯ <code>5 å€‹ä¸€çµ„</code> ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥å†ä½¿ç”¨ <a href="https://clojuredocs.org/clojure.core/partition" target="_blank" rel="external">partition</a> å°‡é€™ä»½è³‡æ–™å¼„æˆæ¯äº”å€‹ä¸€çµ„</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">let</span> <span style="color: #81d4fa;">[</span>data <span style="color: #aaccff;">(</span><span style="color: #aaffaa;">-&gt;</span> <span style="color: #aaeecc;">(</span>fetch-html<span style="color: #aaeecc;">)</span> html-&gt;hickory<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">-&gt;&gt;</span>  <span style="color: #aaccff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>select <span style="color: #aaeecc;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>child                   <span style="color: #ccaaff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>or <span style="color: #fff59d;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>class <span style="color: #aadddd;">"titleLeft"</span><span style="color: #fff59d;">)</span>                         <span style="color: #fff59d;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>class <span style="color: #aadddd;">"decimal"</span><span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span>                  data<span style="color: #aaccff;">)</span>        <span style="color: #aaccff;">(</span>map #<span style="color: #aaeecc;">(</span><span style="color: #aaffaa;">-&gt;</span> <span style="color: #aaccff;">%</span> <span style="color: #ccaaff;">:content</span> last<span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>        <span style="color: #aaccff;">(</span>map #<span style="color: #aaeecc;">(</span><span style="color: #fff59d;">str</span><span style="color: #c6cccc; background-color: #202020;">/</span>replace <span style="color: #aaccff;">%</span> #<span style="color: #aadddd;">"&#160;"</span> <span style="color: #aadddd;">""</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>        <span style="color: #aaccff;">(</span>partition 5<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span>                 <span style="color: #9ac; font-style: italic;">; &lt;= add this</span></pre></div><p>é€™æ¨£å­å¾—åˆ°çš„è³‡è¨Šå¦‚ä¸‹</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #81d4fa;">(</span><span style="color: #aadddd;">"&#32654;&#37329; (USD)"</span> <span style="color: #aadddd;">"32.89000"</span> <span style="color: #aadddd;">"33.43200"</span> <span style="color: #aadddd;">"33.19000"</span> <span style="color: #aadddd;">"33.29000"</span><span style="color: #81d4fa;">)</span> <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip ...</span> <span style="color: #81d4fa;">(</span><span style="color: #aadddd;">"&#36234;&#21335;&#30462; (VND)"</span> <span style="color: #aadddd;">"0.00128"</span> <span style="color: #aadddd;">"0.00160"</span> <span style="color: #aadddd;">"-"</span> <span style="color: #aadddd;">"-"</span><span style="color: #81d4fa;">)</span> <span style="color: #81d4fa;">(</span><span style="color: #aadddd;">"&#39340;&#20358;&#24163; (MYR)"</span> <span style="color: #aadddd;">"6.70500"</span> <span style="color: #aadddd;">"8.43100"</span> <span style="color: #aadddd;">"-"</span> <span style="color: #aadddd;">"-"</span><span style="color: #81d4fa;">)</span> <span style="color: #81d4fa;">(</span><span style="color: #aadddd;">"&#20154;&#27665;&#24163; (CNY)"</span> <span style="color: #aadddd;">"4.98500"</span> <span style="color: #aadddd;">"5.14900"</span> <span style="color: #aadddd;">"5.05900"</span> <span style="color: #aadddd;">"5.10900"</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>å°‡é€™é‚Šçš„å‡½å¼æ•´ç†ä¸€ä¸‹ï¼Œå¾—åˆ°ä»¥ä¸‹çš„å‡½å¼</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">parse-data</span> <span style="color: #81d4fa;">[</span>data<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">-&gt;&gt;</span> <span style="color: #aaccff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>select <span style="color: #aaeecc;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>child                  <span style="color: #ccaaff;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>or <span style="color: #fff59d;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>class <span style="color: #aadddd;">"titleLeft"</span><span style="color: #fff59d;">)</span>                        <span style="color: #fff59d;">(</span><span style="color: #fff59d;">s</span><span style="color: #c6cccc; background-color: #202020;">/</span>class <span style="color: #aadddd;">"decimal"</span><span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span>                 data<span style="color: #aaccff;">)</span>       <span style="color: #aaccff;">(</span>map #<span style="color: #aaeecc;">(</span><span style="color: #aaffaa;">-&gt;</span> <span style="color: #aaccff;">%</span> <span style="color: #ccaaff;">:content</span> last<span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>       <span style="color: #aaccff;">(</span>map #<span style="color: #aaeecc;">(</span><span style="color: #fff59d;">str</span><span style="color: #c6cccc; background-color: #202020;">/</span>replace <span style="color: #aaccff;">%</span> #<span style="color: #aadddd;">"&#160;"</span> <span style="color: #aadddd;">""</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>       <span style="color: #aaccff;">(</span>partition 5<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-orgab2be65" class="outline-3"><h3 id="orgab2be65">æ ¹æ“šåŒ¯ç‡è½‰æ›çš„è³‡è¨Šè£½ä½œè³‡æ–™</h3><div class="outline-text-3" id="text-orgab2be65"><p>åœ¨å‰é¢æˆ‘å€‘å–å¾—äº†åŒ¯ç‡è½‰æ›çš„è³‡è¨Šï¼Œä½†æ˜¯æˆ‘å€‘è¦æ€æ¨£æŠŠé€™äº›è³‡è¨Šåšæˆä»¥ä¸‹çš„å½¢å¼å‘¢?</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">{</span><span style="color: #ccaaff;">:USD</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"&#32654;&#37329; (USD)"</span>,       <span style="color: #ccaaff;">:cash-selling</span> <span style="color: #aadddd;">"32.92500"</span>,       <span style="color: #ccaaff;">:cash-buying</span> <span style="color: #aadddd;">"33.46700"</span>,       <span style="color: #ccaaff;">:spot-selling</span> <span style="color: #aadddd;">"33.22500"</span>,       <span style="color: #ccaaff;">:spot-buying</span> <span style="color: #aadddd;">"33.32500"</span><span style="color: #81d4fa;">}</span>, <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip ...</span> <span style="color: #ccaaff;">:PHP</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"&#33778;&#22283;&#27604;&#32034; (PHP)"</span>,       <span style="color: #ccaaff;">:cash-selling</span> <span style="color: #aadddd;">"0.64980"</span>,       <span style="color: #ccaaff;">:cash-buying</span> <span style="color: #aadddd;">"0.78250"</span>,       <span style="color: #ccaaff;">:spot-selling</span> <span style="color: #aadddd;">"-"</span>,       <span style="color: #ccaaff;">:spot-buying</span> <span style="color: #aadddd;">"-"</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">}</span></pre></div><p>å°±è®“æˆ‘å€‘ä¸€æ­¥ä¸€æ­¥ä¾†å§ï¼Œé¦–å…ˆå…ˆé€é <a href="https://clojuredocs.org/clojure.core/zipmap" target="_blank" rel="external">zipmap</a> æ›¿é™£åˆ—è£¡é¢çš„æ¯ä¸€å…ƒç´ åŠ ä¸Š <i>keyword</i></p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span>map #<span style="color: #81d4fa;">(</span>zipmap <span style="color: #aaccff;">[</span><span style="color: #ccaaff;">:name</span> <span style="color: #ccaaff;">:cash-selling</span> <span style="color: #ccaaff;">:cash-buying</span> <span style="color: #ccaaff;">:spot-selling</span> <span style="color: #ccaaff;">:spot-buying</span><span style="color: #aaccff;">]</span> <span style="color: #aaccff;">%</span><span style="color: #81d4fa;">)</span>     '<span style="color: #81d4fa;">(</span><span style="color: #aaccff;">(</span><span style="color: #aadddd;">"&#32654;&#37329; (USD)"</span> <span style="color: #aadddd;">"32.89000"</span> <span style="color: #aadddd;">"33.43200"</span> <span style="color: #aadddd;">"33.19000"</span> <span style="color: #aadddd;">"33.29000"</span><span style="color: #aaccff;">)</span>       <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip ...</span>       <span style="color: #aaccff;">(</span><span style="color: #aadddd;">"&#20154;&#27665;&#24163; (CNY)"</span> <span style="color: #aadddd;">"4.98500"</span> <span style="color: #aadddd;">"5.14900"</span> <span style="color: #aadddd;">"5.05900"</span> <span style="color: #aadddd;">"5.10900"</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>é€™æ¨£å­æˆ‘å€‘çš„è³‡æ–™å°±å¼„å‡ºä¸€éƒ¨ä»½å›‰ ~</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"&#32654;&#37329; (USD)"</span>,  <span style="color: #ccaaff;">:cash-selling</span> <span style="color: #aadddd;">"32.89000"</span>,  <span style="color: #ccaaff;">:cash-buying</span> <span style="color: #aadddd;">"33.43200"</span>,  <span style="color: #ccaaff;">:spot-selling</span> <span style="color: #aadddd;">"33.19000"</span>,  <span style="color: #ccaaff;">:spot-buying</span> <span style="color: #aadddd;">"33.29000"</span><span style="color: #81d4fa;">}</span> <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip ...</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"&#20154;&#27665;&#24163; (CNY)"</span>,  <span style="color: #ccaaff;">:cash-selling</span> <span style="color: #aadddd;">"4.98500"</span>,  <span style="color: #ccaaff;">:cash-buying</span> <span style="color: #aadddd;">"5.14900"</span>,  <span style="color: #ccaaff;">:spot-selling</span> <span style="color: #aadddd;">"5.05900"</span>,  <span style="color: #ccaaff;">:spot-buying</span> <span style="color: #aadddd;">"5.10900"</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span></pre></div><p>æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘è¦æƒ³æŠŠæ³•æŠŠ <code>ç¾é‡‘ (USD)</code> è®Šæˆ <code>:USD</code> ï¼Œé€™å€‹ä¸€æ¨£å¯ä»¥é€é <a href="https://clojuredocs.org/clojure.core/re-find" target="_blank" rel="external">re-find</a> ä¾†è§£æ±º</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">-&gt;</span> <span style="color: #81d4fa;">(</span>re-find #<span style="color: #aadddd;">"</span><span style="color: #ff8888;">(</span><span style="color: #aadddd;">.*</span><span style="color: #aadddd; font-weight: bold;">\</span><span style="color: #ff8888; font-weight: bold;">(</span><span style="color: #ff8888;">)(</span><span style="color: #aadddd;">.*</span><span style="color: #ff8888;">)(</span><span style="color: #aadddd; font-weight: bold;">\</span><span style="color: #ff8888; font-weight: bold;">)</span><span style="color: #ff8888;">)</span><span style="color: #aadddd;">"</span> <span style="color: #aadddd;">"&#32654;&#37329; (USD)"</span><span style="color: #81d4fa;">)</span>    <span style="color: #81d4fa;">(</span>nth 2<span style="color: #81d4fa;">)</span>    keyword<span style="color: #aadddd;">)</span> <span style="color: #9ac; font-style: italic;">; =&gt; </span><span style="color: #9ac; font-style: italic;">:USD</span></pre></div><p>å› æ­¤æˆ‘å€‘å°‡å‰é¢å¯«çš„æ±è¥¿åˆä½µèµ·ä¾†ï¼Œå°‡æœ€å¾Œç”¢ç”Ÿçš„è³‡è¨Šæ•´åˆåˆ° <a href="https://clojuredocs.org/clojure.core/hash-map" target="_blank" rel="external">hash-map</a> ä¸­ï¼Œå°±å®Œæˆäº†</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">build-data</span> <span style="color: #81d4fa;">[</span>data<span style="color: #81d4fa;">]</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">-&gt;&gt;</span> data       <span style="color: #aaccff;">(</span>map #<span style="color: #aaeecc;">(</span>zipmap <span style="color: #ccaaff;">[</span><span style="color: #ccaaff;">:name</span> <span style="color: #ccaaff;">:cash-selling</span> <span style="color: #ccaaff;">:cash-buying</span> <span style="color: #ccaaff;">:spot-selling</span> <span style="color: #ccaaff;">:spot-buying</span><span style="color: #ccaaff;">]</span> <span style="color: #aaccff;">%</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>       <span style="color: #aaccff;">(</span>map #<span style="color: #aaeecc;">(</span>hash-map <span style="color: #ccaaff;">(</span>keyword                        <span style="color: #fff59d;">(</span>nth <span style="color: #ff8888;">(</span>re-find #<span style="color: #aadddd;">"</span><span style="color: #ff8888;">(</span><span style="color: #aadddd;">.*</span><span style="color: #aadddd; font-weight: bold;">\</span><span style="color: #ff8888; font-weight: bold;">(</span><span style="color: #ff8888;">)(</span><span style="color: #aadddd;">.*</span><span style="color: #ff8888;">)(</span><span style="color: #aadddd; font-weight: bold;">\</span><span style="color: #ff8888; font-weight: bold;">)</span><span style="color: #ff8888;">)</span><span style="color: #aadddd;">"</span> <span style="color: #795548;">(</span><span style="color: #ccaaff;">:name</span> <span style="color: #aaccff;">%</span><span style="color: #795548;">)</span><span style="color: #ff8888;">)</span> 2<span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span> <span style="color: #aaccff;">%</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>       <span style="color: #aaccff;">(</span>into <span style="color: #aaeecc;">{}</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-org9db8f36" class="outline-3"><h3 id="org9db8f36">åˆä½µæ‰€æœ‰çµæœ</h3><div class="outline-text-3" id="text-org9db8f36"><p>åœ¨ä¸Šä¸€æ­¥é©Ÿä¸­ï¼Œæˆ‘å€‘å·²ç¶“å¹¾ä¹å®Œæˆæˆ‘å€‘çš„ç¨‹å¼ï¼Œæ˜¯æ™‚å€™å°‡ä»–é€²è¡Œæ•´åˆæˆæˆ‘å€‘æœŸæœ›çš„çµæœ</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">fetch</span> <span style="color: #81d4fa;">[]</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">let</span> <span style="color: #aaccff;">[</span>html <span style="color: #aaeecc;">(</span>fetch-html<span style="color: #aaeecc;">)</span>        ctx  <span style="color: #aaeecc;">(</span><span style="color: #aaffaa;">-&gt;</span> html html-&gt;hickory<span style="color: #aaeecc;">)</span>        data <span style="color: #aaeecc;">(</span><span style="color: #aaffaa;">-&gt;</span> ctx parse-data build-data<span style="color: #aaeecc;">)</span><span style="color: #aaccff;">]</span>    <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:url</span> twbank-url     <span style="color: #ccaaff;">:date</span> <span style="color: #aaeecc;">(</span>parse-date html<span style="color: #aaeecc;">)</span>     <span style="color: #ccaaff;">:count</span> <span style="color: #aaeecc;">(</span>count data<span style="color: #aaeecc;">)</span>     <span style="color: #ccaaff;">:results</span> data<span style="color: #aaccff;">}</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>ç•¶ä½ åŸ·è¡Œ <code>fetch</code> é€™å‡½å¼æ™‚ï¼Œå°±æœƒå°‡ <a href="http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm" target="_blank" rel="external">å°ç£éŠ€è¡Œç‰Œå‘ŠåŒ¯ç‡</a> è½‰è®Šæˆé€™æ¨£çš„è³‡è¨Š:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">{</span><span style="color: #ccaaff;">:url</span> <span style="color: #aadddd;">"http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm"</span>, <span style="color: #ccaaff;">:date</span> <span style="color: #aadddd;">"2016/02/26 13:25"</span>, <span style="color: #ccaaff;">:count</span> 19, <span style="color: #ccaaff;">:results</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:CHF</span>           <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"&#29790;&#22763;&#27861;&#37070; (CHF)"</span>,            <span style="color: #ccaaff;">:cash-selling</span> <span style="color: #aadddd;">"32.91000"</span>,            <span style="color: #ccaaff;">:cash-buying</span> <span style="color: #aadddd;">"34.02000"</span>,            <span style="color: #ccaaff;">:spot-selling</span> <span style="color: #aadddd;">"33.51000"</span>,            <span style="color: #ccaaff;">:spot-buying</span> <span style="color: #aadddd;">"33.80000"</span><span style="color: #aaccff;">}</span>,           <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip..</span>           <span style="color: #ccaaff;">:ZAR</span>           <span style="color: #aaccff;">{</span><span style="color: #ccaaff;">:name</span> <span style="color: #aadddd;">"&#21335;&#38750;&#24163; (ZAR)"</span>,            <span style="color: #ccaaff;">:cash-selling</span> <span style="color: #aadddd;">"-"</span>,            <span style="color: #ccaaff;">:cash-buying</span> <span style="color: #aadddd;">"-"</span>,            <span style="color: #ccaaff;">:spot-selling</span> <span style="color: #aadddd;">"2.09000"</span>,            <span style="color: #ccaaff;">:spot-buying</span> <span style="color: #aadddd;">"2.19000"</span><span style="color: #aaccff;">}</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">}</span></pre></div></div></div></div><div id="outline-container-org48be390" class="outline-2"><h2 id="org48be390">å–å¾—ç¯„ä¾‹ç¨‹å¼ç¢¼</h2><div class="outline-text-2" id="text-org48be390"><p>æœ¬ç¯‡æ–‡ç« çš„ç¯„ä¾‹ç¨‹å¼ç¢¼å·²ç¶“ä¸Šå‚³åˆ° <a href="https://github.com/coldnew/blog-tutorial-examples/tree/master/2016/twbank-forex" target="_blank" rel="external">GitHub</a> ä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å–å¾—ç¨‹å¼ç¢¼</p><pre class="example">git clone https://github.com/coldnew/blog-tutorial-examples.git</pre><p>ä¸¦åˆ‡æ›åˆ° <code>2016/twbank-forex</code> è³‡æ–™å¤¾å»</p><div class="org-src-container"><pre class="src src-sh">coldnew@Rosia ~ $ cd blog-tutorial-examples/2016/twbank-forex</pre></div><p>ä½ å¯ä»¥é€é <code>lein run</code> ä¾†æ¸¬è©¦æœ¬æ–‡å–å¾—çš„è³‡è¨Š  ~ Have Fun~~</p><pre class="example">coldnew@Rosia ~/twbank-forex $ lein run{:url "http://rate.bot.com.tw/Pages/Static/UIP003.zh-TW.htm", :date "2016/02/26 13:25", :count 19, :results {:CHF  {:name "ç‘å£«æ³•éƒ (CHF)",   :cash-selling "32.91000",   :cash-buying "34.02000",   :spot-selling "33.51000",   :spot-buying "33.80000"},skip .....</pre></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/c8ce3cdb/#disqus_thread</comments>
    </item>
    
    <item>
      <title>ä½¿ç”¨ codox èˆ‡ CircleCI å»ºç«‹ Clojure å°ˆæ¡ˆçš„æ–‡æª”</title>
      <link>https://coldnew.github.io/2c9c3b0f/</link>
      <guid>https://coldnew.github.io/2c9c3b0f/</guid>
      <pubDate>Sat, 20 Feb 2016 13:50:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
åœ¨ Clojure ä¸–ç•Œä¸­ï¼Œå¸¸ç”¨çš„ç”¢ç”Ÿæ–‡æª”å·¥å…·æœ‰ &lt;a href=&quot;https://github.com/MichaelBlume/marginalia&quot;&gt;Marginalia&lt;/a&gt; ä»¥åŠ &lt;a href=&quot;https://github.com/weavejester/codox&quot;&gt;Codox&lt;/a&gt;ã€‚
æœ¬æ–‡å°‡è¬›è¿°å¦‚ä½•é€é &lt;a href=&quot;https://github.com/weavejester/codox&quot;&gt;Codox&lt;/a&gt; ä»¥åŠ &lt;a href=&quot;https://circleci.com&quot;&gt;Circle CI&lt;/a&gt; ä¾†å°ä½ çš„å‡½å¼åº«é€²è¡Œæ¸¬è©¦ä»¥åŠç”¢ç”Ÿæ–‡æª”ä¸¦ç™¼ä½ˆåˆ° GitHub pages å»ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>åœ¨ Clojure ä¸–ç•Œä¸­ï¼Œå¸¸ç”¨çš„ç”¢ç”Ÿæ–‡æª”å·¥å…·æœ‰ <a href="https://github.com/MichaelBlume/marginalia" target="_blank" rel="external">Marginalia</a> ä»¥åŠ <a href="https://github.com/weavejester/codox" target="_blank" rel="external">Codox</a>ã€‚æœ¬æ–‡å°‡è¬›è¿°å¦‚ä½•é€é <a href="https://github.com/weavejester/codox" target="_blank" rel="external">Codox</a> ä»¥åŠ <a href="https://circleci.com" target="_blank" rel="external">Circle CI</a> ä¾†å°ä½ çš„å‡½å¼åº«é€²è¡Œæ¸¬è©¦ä»¥åŠç”¢ç”Ÿæ–‡æª”ä¸¦ç™¼ä½ˆåˆ° GitHub pages å»ã€‚</p><a id="more"></a><p>ç•¶ç„¶ï¼Œç‚ºäº†ä¾¿æ–¼æè¿°ï¼Œæˆ‘å€‘ä¸€æ¨£å¾å°ˆæ¡ˆçš„å»ºç«‹é–‹å§‹ä¾†è¬› codox çš„ä½¿ç”¨ã€‚</p><div id="outline-container-org4235e81" class="outline-2"><h2 id="org4235e81">å»ºç«‹æˆ‘å€‘çš„å°ˆæ¡ˆ</h2><div class="outline-text-2" id="text-org4235e81"><p>é¦–å…ˆæˆ‘å€‘å…ˆé€é <a href="http://leiningen.org/" target="_blank" rel="external">leinigen</a> ç”¢ç”Ÿæˆ‘å€‘ Clojure å°ˆæ¡ˆçš„åŸºæœ¬æ¨£æ¿ï¼Œé€™é‚Šå‘½åè©²å°ˆæ¡ˆç‚º <code>example-lib</code></p><pre class="example">coldnew@Rosia ~ $ lein new example-lib</pre><p>å°ˆæ¡ˆå»ºç«‹å®Œæˆå¾Œï¼Œæˆ‘å€‘è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ <i>project.clj</i> ï¼Œåœ¨ <code>:plugin</code> æ¬„ä½åŠ ä¸Š lein-codox, é€™æœƒè®“æˆ‘å€‘å¤šä¸€å€‹ <code>lein codox</code> å‘½ä»¤å¯ä»¥ç”¨ä¾†ç”¢ç”Ÿæ–‡æª”ã€‚</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defproject</span> <span style="color: #aaccff;">example-lib</span> <span style="color: #aadddd;">"0.1.0-SNAPSHOT"</span>  <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip ...</span>  <span style="color: #ccaaff;">:plugins</span> <span style="color: #81d4fa;">[</span><span style="color: #aaccff;">[</span>lein-codox <span style="color: #aadddd;">"0.9.4"</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">)</span></pre></div><p>å¦‚æœä½ å¸Œæœ›ä½ ç”¢ç”Ÿçš„æ–‡æª”ï¼Œå¯ä»¥é€£æ¥åˆ° Github ä¸Šçš„ç¨‹å¼ç¢¼ï¼Œå‰‡å¯ä»¥å¤šåŠ ä¸Šé€™æ¨£ä¸€è¡Œ</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defproject</span> <span style="color: #aaccff;">example-lib</span> <span style="color: #aadddd;">"0.1.0-SNAPSHOT"</span>  <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">skip ...</span>  <span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">Add here to make codox can link function to github url</span>  <span style="color: #ccaaff;">:codox</span> <span style="color: #81d4fa;">{</span><span style="color: #ccaaff;">:source-uri</span> <span style="color: #aadddd;">"https://github.com/clojure-tw/example-codox-circleci/blob/master/{filepath}#L{line}"</span><span style="color: #81d4fa;">}</span><span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-orgf7714d3" class="outline-2"><h2 id="orgf7714d3">åŠ ä¸ŠåŸºæœ¬çš„å‡½å¼èˆ‡æ¸¬è©¦</h2><div class="outline-text-2" id="text-orgf7714d3"><p>å®Œæˆ <i>project.clj</i> ä¿®æ”¹å¾Œï¼Œè®“æˆ‘å€‘åˆ° <code>src/example_lib/core.clj</code> å»åŠ å…¥æˆ‘å€‘çš„åŸºæœ¬å‡½å¼ï¼Œé€™é‚Šå»ºç«‹ä¸€å€‹åç‚º <code>hello</code> çš„å‡½å¼ï¼ŒåŠŸèƒ½å°±æ˜¯å›å‚³ <code>Hello, World!</code> é€™å€‹å­—ä¸²å›ä¾†ã€‚</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">ns</span> <span style="color: #fff59d;">example-lib.core</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defn</span> <span style="color: #aaccff;">hello</span>  <span style="color: #97abc6; font-style: italic;">"Say `Hello World!'."</span>  <span style="color: #81d4fa;">[]</span>  <span style="color: #aadddd;">"Hello, World!"</span><span style="color: #aadddd;">)</span></pre></div><p>æ¥ä¸‹ä¾†ä¿®æ”¹ <code>test/example_lib/core_test.clj</code> , ä¸¦åŠ å…¥æˆ‘å€‘çš„æ¸¬è©¦ï¼Œä»¥æ­¤ä¾‹è€Œè¨€ï¼Œæˆ‘å€‘éœ€è¦ç¢ºèª <code>(hello)</code> å›å‚³çš„æœƒæ˜¯ <code>Hello, World!</code> é€™å€‹å­—ä¸²:</p><div class="org-src-container"><pre class="src src-clojure"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">ns</span> <span style="color: #fff59d;">example-lib.core-test</span>  <span style="color: #81d4fa;">(</span><span style="color: #ccaaff;">:require</span> <span style="color: #aaccff;">[</span><span style="color: #fff59d;">clojure.test</span> <span style="color: #ccaaff;">:refer</span> <span style="color: #ccaaff;">:all</span><span style="color: #aaccff;">]</span>            <span style="color: #aaccff;">[</span><span style="color: #fff59d;">example-lib.core</span> <span style="color: #ccaaff;">:refer</span> <span style="color: #ccaaff;">:all</span><span style="color: #aaccff;">]</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">deftest</span> <span style="color: #aaccff;">a-test</span>  <span style="color: #81d4fa;">(</span>testing <span style="color: #aadddd;">"Hello, World!"</span>    <span style="color: #aaccff;">(</span>is <span style="color: #aaeecc;">(</span>= <span style="color: #ccaaff;">(</span>hello<span style="color: #ccaaff;">)</span> <span style="color: #aadddd;">"Hello, World!"</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>å®Œæˆå¾Œï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>lein test</code> ç¢ºèªä½ çš„æ¸¬è©¦æ˜¯æˆåŠŸçš„</p><pre class="example">coldnew@Rosia ~/example-lib $ lein testlein test example-lib.core-testRan 1 tests containing 1 assertions.0 failures, 0 errors.</pre></div></div><div id="outline-container-orgf37172e" class="outline-2"><h2 id="orgf37172e">ä½¿ç”¨ codox ç”¢ç”Ÿæ–‡æª”</h2><div class="outline-text-2" id="text-orgf37172e"><p>ç•¶æˆ‘å€‘çš„å‡½å¼åº«å®Œæˆå¾Œï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>lein codox</code> ç”¢ç”Ÿæˆ‘å€‘çš„æ–‡æª”</p><pre class="example">coldnew@Rosia ~/example-lib $ lein codoxGenerated HTML docs in /home/coldnew/example-lib/target/doc</pre><p>ä½ æœƒåœ¨ <code>target/doc</code> ç™¼ç¾ä½ ç”¢ç”Ÿçš„æ–‡æª”</p><pre class="example">coldnew@Rosia ~/example-lib/target/doc $ tree -L 1 .. &lt;b&gt;â”œâ”€â”€ css &lt;b&gt;â”œâ”€â”€ example-lib.core.htmlâ”œâ”€â”€ index.htmlâ”œâ”€â”€ intro.htmlâ””â”€â”€ js &lt;b&gt;2 directories, 3 files</pre><p>å…¶ä¸­çš„ <code>intro.html</code> æ˜¯ç”¢ç”Ÿè‡ª <code>doc/intro.md</code> é€™å€‹æª”æ¡ˆï¼Œä¹Ÿå°±æ˜¯èªªï¼Œä½ å¯ä»¥é€é codox ç”¢ç”Ÿä½ çš„å‡½å¼æ–‡æª”å¤–ï¼Œè®“ä»–ä¹Ÿå¹«ä½ ç”¢ç”Ÿ <code>doc/</code> è³‡æ–™å¤¾ä¸‹çš„é‚£äº› <code>markdown</code> èªæ³•çš„æ–‡ä»¶ã€‚</p><pre class="example">coldnew@Rosia ~/example-lib/doc $ tree -L 1 .. &lt;b&gt;â””â”€â”€ intro.md0 directories, 1 file</pre><p>æ‰“é–‹ <code>index.html</code> æœƒçœ‹åˆ°é€™æ¨£çš„çµæœ</p><div class="figure"><p><img src="index.png"></p></div></div></div><div id="outline-container-orge018362" class="outline-2"><h2 id="orge018362">è®“ Circle CI ç™¼ä½ˆä½ çš„æ–‡æª”åˆ° gh-pages</h2><div class="outline-text-2" id="text-orge018362"><p>è‡ªå¾ GitHub åŠ å…¥äº†é¡¯ç¤º <a href="https://pages.github.com/" target="_blank" rel="external">gh-pages</a> çš„ html æª”æ¡ˆåŠŸèƒ½å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥å­˜æ”¾æˆ‘å€‘çš„ HTML æ–‡æª”åˆ° gh-pages åˆ†æ”¯å»ï¼Œä¸éå…ˆè®“æˆ‘å€‘åŠ å…¥  <a href="https://circleci.com" target="_blank" rel="external">Circle CI</a> çš„æ”¯æ´ã€‚</p></div><div id="outline-container-orgd80ae54" class="outline-3"><h3 id="orgd80ae54">circle.yml</h3><div class="outline-text-3" id="text-orgd80ae54"><p>æˆ‘å€‘åˆ‡å›å°ˆæ¡ˆç›®éŒ„ï¼Œä¸¦å»ºç«‹ <code>circle.yml</code> é€™å€‹æª”æ¡ˆ</p><pre class="example">coldnew@Rosia ~/example-lib $ touch circle.yml</pre><p>æ¥ä¸‹ä¾†ç·¨è¼¯ <code>circle.yml</code> åŠ å…¥æˆ‘å€‘çš„è¨­å®š</p><div class="org-src-container"><pre class="src src-yaml"><span style="color: #aaccff;">general</span>:  <span style="color: #aaccff;">branches</span>:    <span style="color: #aaccff;">ignore</span>:      - gh-pages<span style="color: #aaccff;">machine</span>:  <span style="color: #aaccff;">timezone</span>: Asia/Taipei  <span style="color: #aaccff;">java</span>:    <span style="color: #aaccff;">version</span>: oraclejdk8<span style="color: #aaccff;">dependencies</span>:  <span style="color: #aaccff;">pre</span>:    - wget -O lein https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein    - chmod 755 lein    - ./lein -v    - ./lein deps  <span style="color: #aaccff;">cache_directories</span>:    - ~/.m2    - ~/.lein<span style="color: #aaccff;">test</span>:  <span style="color: #aaccff;">override</span>:    - ./lein test</pre></div><p>åœ¨ <i>circle.yml</i> ä¸­ï¼Œæˆ‘å€‘å‘Šè¨´äº† Circle CI è¦å¿½ç•¥æ‰ <i>gh-pages</i> é€™å€‹åˆ†æ”¯ï¼Œä¸¦ä¸”ä½¿ç”¨ <code>lein test</code> ç¢ºä¿æˆ‘å€‘çš„å‡½å¼ä¸æœƒåœ¨æœªä¾†å› ç‚ºä¿®æ”¹è€Œé•åæˆ‘å€‘åœ¨æ¸¬è©¦ç¨‹å¼ä¸­å¯«çš„è¦ç¯„ã€‚</p><p>æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘åœ¨ <i>circle.yml</i> åŠ ä¸Šç™¼ä½ˆçš„æ–¹æ³•ï¼Œæˆ‘å€‘ä½¿ç”¨ <code>lein codox</code> ç”¢ç”Ÿæˆ‘å€‘çš„æ–‡æª”å¾Œï¼Œé€é <code>deploy.sh</code> å»é€²è¡Œç™¼ä½ˆåˆ° gh-pagesã€‚</p><div class="org-src-container"><pre class="src src-yaml"><span style="color: #aaccff;">deployment</span>:  <span style="color: #aaccff;">publish</span>:    <span style="color: #aaccff;">branch</span>: master    <span style="color: #aaccff;">commands</span>:      - ./lein codox      - sed -i <span style="color: #aadddd;">'s%https://${GH_TOKEN}@${GH_REF}%git@github.com:clojure-tw/example-codox-circleci.git%g'</span> deploy.sh      - ./deploy.sh</pre></div></div></div><div id="outline-container-orgb018e1d" class="outline-3"><h3 id="orgb018e1d">deploy.sh</h3><div class="outline-text-3" id="text-orgb018e1d"><p>æ¥ä¸‹ä¾†ç·¨è¼¯ <i>deploy.sh</i> é€™å€‹è…³æœ¬ï¼Œä¸»è¦çš„ä»»å‹™å¦‚ä¸‹:</p><ol class="org-ol"><li>å»ºç«‹ä¸€å€‹ repo è³‡æ–™å¤¾</li><li>å°‡è©²è¤‡è£½çš„æ–‡æª”è¤‡è£½éå»</li><li>è¨­å®šå¥½ git ç›¸é—œè³‡è¨Š</li><li>ä¸Šå‚³åˆ° gh-pages</li></ol><p>å› æ­¤æˆ‘å€‘å°±å¯ä»¥æ ¹æ“š <i>codox</i> æœƒç”¢ç”Ÿæ–‡æª”åˆ° <code>target/doc</code> é€™å€‹è¦å‰‡ä¾†å¯«æˆ‘å€‘çš„ <i>deploy.sh</i> è…³æœ¬ã€‚</p><div class="org-src-container"><pre class="src src-sh"><span style="color: #5f5f5f; font-style: italic;">#</span><span style="color: #9ac; font-style: italic;">!/usr/bin/</span><span style="color: #aaffaa;">env</span><span style="color: #9ac; font-style: italic;"> bash</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">exit with nonzero exit code if anything fails</span><span style="color: #ccaaff;">set</span> -e<span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">Local variables</span><span style="color: #aaccff;">OUT</span>=<span style="color: #aadddd;">".gh-pages"</span><span style="color: #aaccff;">ID</span>=$<span style="color: #aadddd;">(</span><span style="color: #fa8072;">git</span> rev-parse --short HEAD<span style="color: #aadddd;">)</span><span style="color: #aaccff;">DATE</span>=$<span style="color: #aadddd;">(</span><span style="color: #fa8072;">date</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">clear and re-create the out directory</span>rm -rf $<span style="color: #aaccff;">OUT</span> || <span style="color: #aaffaa;">exit</span> 0;<span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">create repo directory</span>mkdir $<span style="color: #aaccff;">OUT</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">Copy all prebuild files</span>cp README.* $<span style="color: #aaccff;">OUT</span>cp -R target/doc/* $<span style="color: #aaccff;">OUT</span>cp -f circle.yml $<span style="color: #aaccff;">OUT</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">go to the out directory and create a *new* Git repo</span><span style="color: #ccaaff;">cd</span> $<span style="color: #aaccff;">OUT</span>git init<span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">inside this git repo we'll pretend to be a new user</span>git config user.name <span style="color: #aadddd;">"Circle CI"</span>git config user.email <span style="color: #aadddd;">"clojure.tw@gmail.com"</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">The first and only commit to this new Git repo contains all the</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">files present with the commit message "Deploy to GitHub Pages".</span>git add .git commit -m <span style="color: #aadddd;">"Deploy commit $ID to GitHub Pages: $DATE"</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">Force push from the current repo's master branch to the remote</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">repo's gh-pages branch. (All previous history on the gh-pages branch</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">will be lost, since we are overwriting it.) We redirect any output to</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">/dev/null to hide any sensitive credential data that might otherwise be exposed.</span>git push --force --quiet <span style="color: #aadddd;">"https://${GH_TOKEN}@${GH_REF}"</span> master:gh-pages &gt; /dev/null 2&gt;&amp;1</pre></div></div></div><div id="outline-container-org903714e" class="outline-3"><h3 id="org903714e">å°‡ä½ çš„å°ˆæ¡ˆåŠ å…¥åˆ° CircleCI</h3><div class="outline-text-3" id="text-org903714e"><p>è©²è¨­å®šçš„æ±è¥¿è¨­å®šå¥½äº†ä»¥å¾Œï¼Œæˆ‘å€‘å°‡ç¨‹å¼ç¢¼ä¸Šå‚³åˆ° GitHub å°±å¯ä»¥å°‡å°ˆæ¡ˆåŠ å…¥åˆ° CircleCI å»</p><div class="figure"><p><img src="circleci1.png"></p></div><p>ç¬¬ä¸€æ¬¡ç·¨è­¯çš„æ™‚å€™ä½ æœƒç™¼ç¾å¤±æ•—åœ¨ <i>deploy.sh</i> é€™è£¡ï¼Œé€™æ˜¯å› ç‚º CircleCI æ²’æœ‰æ¬Šé™å¯ä»¥å°‡ä½ ç”¢ç”Ÿçš„æ–‡æª”ä¸Šå‚³åˆ° GitHub å»</p><div class="figure"><p><img src="circleci2.png"></p></div><p>ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œæˆ‘å€‘éœ€è¦ç”¢ç”Ÿä¸€å° <i>SSH key</i> ä¾†è®“ CircleCI å¯ä»¥ä¸Šå‚³åˆ° GitHub, é¦–å…ˆé€²å…¥ä½ åœ¨ CircleCI ä¸Šçš„ <code>Project Settings</code> é é¢ï¼Œæ¥è‘—æˆ‘å€‘é€é <i>ssh-keygen</i> é€™å‘½ä»¤å»ç”¢ç”Ÿæˆ‘å€‘çš„é‘°åŒ™å°ï¼Œä¸¦è¨­å®šç‚ºå…å¯†ç¢¼ã€‚</p><pre class="example">coldnew@Rosia ~/example-lib $ ssh-keygenGenerating public/private rsa key pair.Enter file in which to save the key (/Users/coldnew/.ssh/id_rsa): id_rsaEnter passphrase (empty for no passphrase):Enter same passphrase again:Your identification has been saved in id_rsa.Your public key has been saved in id_rsa.pub.The key fingerprint is:SHA256:CbSAl++hyYfrbK4/CdbCLZDzFj33Kl750F+jaT1SV8k coldnew@RosiaThe key's randomart image is:+---[RSA 2048]----+|   ....          ||  . oo .         || . o .o       . .||+ . o +. .     E.|| = = B oS      . ||  O B oo.   . .  || o + ++..  oo.   ||   .*..o .o+o.   ||  .B*o  ..+. .   |+----[SHA256]-----+</pre><p>æ–¼æ˜¯åœ¨ç•¶å‰ç›®éŒ„ä½ å°±æœ‰ <code>id_rsa</code> ä»¥åŠ <code>id_rsa.pub</code> å…©å€‹æª”æ¡ˆï¼Œå°‡ <code>id_rsa</code> è£¡é¢çš„å…§å®¹è²¼åˆ° <i>CircleCI</i> å», ä¸¦æŒ‡æ´¾ <i>Hostname</i> ç‚º <code>github.com</code> ã€‚</p><div class="figure"><p><img src="circleci3.png"></p></div><p>æ¥ä¸‹ä¾†åˆ°ä½ è©²å°ˆæ¡ˆçš„ GitHub é é¢å»ï¼Œæˆ‘å€‘é€²å…¥åˆ°é€™å€‹å°ˆæ¡ˆçš„ <i>Deploy keys</i> é é¢ï¼Œå°‡ <code>id_rsa.pub</code> è²¼ä¸Šã€‚</p><div class="figure"><p><img src="circleci4.png"></p></div><p>éƒ½å®Œæˆå¾Œï¼Œè®“ <i>CircleCI</i> å°ä½ å°ˆæ¡ˆé€²è¡Œ <code>Rebuild</code> çš„å‹•ä½œï¼Œä½ å°±æœƒçœ‹åˆ°ä½ çš„ <i>gh-pages</i> å¤šå‡ºäº†æ–°å»ºç«‹çš„æ–‡æª”å›‰ã€‚</p></div></div></div><div id="outline-container-org0726cb4" class="outline-2"><h2 id="org0726cb4">å–å¾—æœ¬æ–‡çš„ç¯„ä¾‹</h2><div class="outline-text-2" id="text-org0726cb4"><p>æœ¬æ–‡çš„ç¯„ä¾‹å·²ç¶“ä¸Šå‚³åˆ° <a href="https://github.com/clojure-tw/example-codox-circleci" target="_blank" rel="external">GitHub</a>, ä½ å¯ä»¥é€éä»¥ä¸‹å‘½ä»¤ä¸‹è¼‰åˆ°æœ¬åœ°ä¾†æŸ¥çœ‹</p><pre class="example">coldnew@Rosia ~ $ git clone https://github.com/clojure-tw/example-codox-circleci.git</pre><p>ç”¢ç”Ÿå‡ºä¾†çš„ç·šä¸Šæ–‡ä»¶å‰‡å¯ä»¥åˆ° <a href="http://clojure-tw.github.io/example-codox-circleci/" target="_blank" rel="external">http://clojure-tw.github.io/example-codox-circleci/</a> å»çœ‹ã€‚</p><p>Happy Coding :)</p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/2c9c3b0f/#disqus_thread</comments>
    </item>
    
    <item>
      <title>æ·ºè«‡ emacs25 çš„ dynamic modules åŠŸèƒ½</title>
      <link>https://coldnew.github.io/2d16cc25/</link>
      <guid>https://coldnew.github.io/2d16cc25/</guid>
      <pubDate>Sun, 03 Jan 2016 02:42:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
emacs é è¨ˆåœ¨ emacs 25 åŠ å…¥ &lt;code&gt;dynamic modules&lt;/code&gt; çš„åŠŸèƒ½ï¼Œé€éé€™å€‹åŠŸèƒ½æˆ‘å€‘å¯ä»¥ä½¿ç”¨
C/C++ ç­‰èªè¨€å°‡ä½ çš„ emacs-lisp å‡½å¼è®Šæˆæ”¹å¯«æˆå¦‚åŒ builtin çš„æ¨¡çµ„ï¼Œä¾†æå‡
emacs-lisp åŸ·è¡Œé€Ÿåº¦æˆ–æ˜¯è®“ emacs-lisp å¯ä»¥èˆ‡å¤–éƒ¨å‡½å¼åº«äº’å‹•ã€‚
&lt;/p&gt;

&lt;p&gt;
åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°‡ç¨å¾®è¬›è§£è‡ªå·±æ¸¬è©¦ dynamic modules çš„å¿ƒå¾—ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>emacs é è¨ˆåœ¨ emacs 25 åŠ å…¥ <code>dynamic modules</code> çš„åŠŸèƒ½ï¼Œé€éé€™å€‹åŠŸèƒ½æˆ‘å€‘å¯ä»¥ä½¿ç”¨C/C++ ç­‰èªè¨€å°‡ä½ çš„ emacs-lisp å‡½å¼è®Šæˆæ”¹å¯«æˆå¦‚åŒ builtin çš„æ¨¡çµ„ï¼Œä¾†æå‡emacs-lisp åŸ·è¡Œé€Ÿåº¦æˆ–æ˜¯è®“ emacs-lisp å¯ä»¥èˆ‡å¤–éƒ¨å‡½å¼åº«äº’å‹•ã€‚</p><p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°‡ç¨å¾®è¬›è§£è‡ªå·±æ¸¬è©¦ dynamic modules çš„å¿ƒå¾—ã€‚</p><a id="more"></a><div class="alert"><p>dynamic modules åŠŸèƒ½è™•æ–¼æ¸¬è©¦éšæ®µï¼Œç”±æ–¼æ­¤åŠŸèƒ½å¯èƒ½åœ¨æœªä¾†æœ‰é€²è¡Œä¸åŒçš„æ›´å‹•ï¼Œå› æ­¤é è¨­ç·¨è­¯æ™‚é€™é¸é … (<code>--with-modules</code>) æ˜¯é—œé–‰çš„ã€‚</p></div><div id="outline-container-orgd2d2c85" class="outline-2"><h2 id="orgd2d2c85">ç·¨è­¯ emacs</h2><div class="outline-text-2" id="text-orgd2d2c85"><p>ç›®å‰ <code>dynamic modules</code> åŠŸèƒ½å·²ç¶“ä½µå…¥åˆ° master branch, å› æ­¤åªè¦ä¸‹è¼‰ master branch å³å¯æ¸¬è©¦ã€‚</p><p>ç•¶ç„¶ï¼Œä½ çš„ç³»çµ±å¿…é ˆæ»¿è¶³ç·¨è­¯ emacs çš„æ¢ä»¶ï¼Œå…·é«”éœ€è¦å®‰è£çš„å‡½å¼åº«å°±ä¸åœ¨æœ¬æ–‡è´…è¿°ã€‚</p><p>æˆ‘å€‘é¦–å…ˆé€é git å»ä¸‹è¼‰ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬çš„ emacs åŸå§‹ç¢¼ä¸¦é€²è¡Œç·¨è­¯ï¼Œç·¨è­¯ emacs æ™‚è¨˜å¾—æ‰“é–‹ <code>--with-modules</code> é€™å€‹é¸é …ï¼Œé€™æ¨£æ‰èƒ½ä½¿ç”¨ dynamic modules åŠŸèƒ½ã€‚</p><div class="org-src-container"><pre class="src src-sh">git clone http://git.sv.gnu.org/r/emacs.git<span style="color: #ccaaff;">cd</span> emacs./autogen.sh./configure --with-modules --prefix=$<span style="color: #aadddd;">{</span><span style="color: #aaccff;">INSTALL_PATH</span><span style="color: #aadddd;">}</span> <span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">ex: --prefix=/usr</span>make &amp;&amp; make install</pre></div><p>ç·¨è­¯å¥½æ”¯æ´ dynamic modules åŠŸèƒ½çš„ emacs å¾Œï¼Œè®“æˆ‘å€‘ä¾†æ’°å¯«ç¬¬ä¸€å€‹æœ€ç°¡å–®çš„æ¨¡çµ„å§ï¼Œä¸éç‚ºäº†æ–¹ä¾¿å­¸ç¿’ï¼Œå…ˆå¾ emacs-lisp ç‰ˆæœ¬ä¾†å¯«èµ·ã€‚</p></div></div><div id="outline-container-orgc810900" class="outline-2"><h2 id="orgc810900">Hello World (elisp ç‰ˆæœ¬)</h2><div class="outline-text-2" id="text-orgc810900"><p>åœ¨ emacs-lisp ä¸­ï¼Œé™¤äº†ä½¿ç”¨ <a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Defining-Functions.html" target="_blank" rel="external">defun</a> ä»¥å¤–ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ä½¿ç”¨ <a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Defining-Functions.html" target="_blank" rel="external">fset</a> æ­é…åŒ¿åå‡½å¼ä¾†å®Œæˆæˆ‘å€‘è¦ä½¿ç”¨çš„ functionã€‚</p><p>æˆ‘å€‘å»ºç«‹ä¸€å€‹åç‚º <code>hello-elisp.el</code> çš„æ¨¡çµ„ï¼Œé€™å€‹æ¨¡çµ„ä¸­æˆ‘å€‘å®£å‘Šä¸€å€‹åç‚º <code>hello</code> çš„å‡½å¼ï¼Œç•¶åŸ·è¡Œä»–çš„æ™‚å€™å°±å›å‚³ <code>Hello Emacs</code> é€™å€‹å­—ä¸²ã€‚</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">A simple function define with `</span><span style="color: #ccaaff; font-style: italic;">fset</span><span style="color: #9ac; font-style: italic;">' following code work the same as</span><span style="color: #5f5f5f; font-style: italic;">;;</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">(defun hello () "Hello Emacs")</span><span style="color: #5f5f5f; font-style: italic;">;;</span><span style="color: #aadddd;">(</span>fset 'hello '<span style="color: #81d4fa;">(</span>lambda <span style="color: #aaccff;">()</span> <span style="color: #97abc6; font-style: italic;">"Hello Emacs"</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">we need to provide this feature to make emacs can use following method to</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">load it</span><span style="color: #5f5f5f; font-style: italic;">;;  </span><span style="color: #9ac; font-style: italic;">(require 'hello-elisp)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">provide</span> '<span style="color: #ccaaff;">hello-elisp</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">hello-elisp.el ends here</span></pre></div><p>åœ¨é€™å€‹æª”æ¡ˆçš„æœ€å¾ŒåŠ ä¸Š <code>provide</code> å¯ä»¥è®“ emacs é€é <code>require</code> çš„åŠŸèƒ½ä¾†æ‰¾åˆ°ä»–ï¼Œå‡è¨­ä½ é€™ä»½ <code>hello-elisp.el</code> å­˜æ”¾åœ¨ <code>~/test</code> è³‡æ–™å¤¾ä¸‹ï¼Œå‰‡æˆ‘å€‘å¯ä»¥åœ¨ emacs ä¸­é€™æ¨£è®€å–ä»–</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">Add ~/test to load-path let emacs can find it</span><span style="color: #aadddd;">(</span>add-to-list 'load-path <span style="color: #aadddd;">"~/test"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">load the hello-elisp module</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">you can also use (load "~/test/hello-elisp.el") but not recommand</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">require</span> '<span style="color: #ccaaff;">hello-elisp</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">call our hello function and a string should return</span><span style="color: #aadddd;">(</span>hello<span style="color: #aadddd;">)</span>   <span style="color: #5f5f5f; font-style: italic;">; </span><span style="color: #9ac; font-style: italic;">=&gt; Hello Emacs</span></pre></div><p>ç•¶æˆ‘å€‘åŸ·è¡Œåˆ° <code>(hello)</code> æ™‚ï¼Œå°±æœƒçœ‹åˆ°é€™å€‹å‡½å¼å›å‚³ <code>Hello Emacs</code> å­—ä¸²å‡ºä¾†ï¼Œæ–¼æ˜¯ emacs-lisp ç‰ˆæœ¬çš„ hello å‡½å¼å°±å®Œæˆäº† !</p><p>ç¾åœ¨è®“æˆ‘å€‘å°‡ä»–è®Šæˆ C èªè¨€ç‰ˆæœ¬çš„æ¨¡çµ„ã€‚</p></div></div><div id="outline-container-org69e8646" class="outline-2"><h2 id="org69e8646">Hello World (c ç‰ˆæœ¬)</h2><div class="outline-text-2" id="text-org69e8646"><p>æˆ‘å€‘è¦æ€æ¨£å»ºç«‹æˆ‘å€‘çš„ C èªè¨€ç‰ˆæœ¬çš„æ¨¡çµ„å‘¢? å…¶å¯¦åœ¨ä½ çš„ emacs åŸå§‹ç¢¼ <code>modules</code> è³‡æ–™å¤¾ä¸‹æœ‰ <code>modhelp.py</code> é€™å€‹æª”æ¡ˆï¼Œä»–æœƒå¹«å¿™ç”¢ç”Ÿå‡ºå¯ä»¥ä½¿ç”¨çš„æ¨¡çµ„æ¨£æ¿ï¼Œä¸éæœ¬æ–‡ç‚ºäº†è¬›è§£æ–¹ä¾¿å°±ç›´æ¥ç”¨æ‰‹åˆ»å§ ~</p></div><div id="outline-container-org03c67db" class="outline-3"><h3 id="org03c67db">Makefile</h3><div class="outline-text-3" id="text-org03c67db"><p>æˆ‘å€‘é¦–å…ˆå…ˆå¼„ <code>Makefile</code> ä¾†ç´€éŒ„ç·¨è­¯é€™å€‹æ¨¡çµ„çš„æ–¹æ³•ï¼Œåœ¨é€™é‚Š <code>EMACS_ROOT</code> æŒ‡çš„æ˜¯ emacs åŸå§‹ç¢¼çš„è³‡æ–™å¤¾ï¼Œ <code>EMACS</code> å‰‡æ˜¯æœ‰æ‰“é–‹ <code>--with-modules</code> é¸é …å¾Œç·¨è­¯å‡ºä¾†çš„ emacs åŸ·è¡Œæª”ã€‚</p><div class="org-src-container"><pre class="src src-makefile"><span style="color: #aaccff;">EMACS_ROOT</span> ?=  ../..<span style="color: #aaccff;">EMACS</span> ?= emacs<span style="color: #aaccff;">CC</span>      = gcc<span style="color: #aaccff;">LD</span>      = gcc<span style="color: #aaccff;">CPPFLAGS</span> = -I$<span style="color: #aadddd;">(</span><span style="color: #aaccff;">EMACS_ROOT</span><span style="color: #aadddd;">)</span>/src<span style="color: #aaccff;">CFLAGS</span> = -std=gnu99 -ggdb3 -O2 -Wall -fPIC $<span style="color: #aadddd;">(</span><span style="color: #aaccff;">CPPFLAGS</span><span style="color: #aadddd;">)</span><span style="color: #aaccff;">.PHONY</span> : clean test<span style="color: #aaccff;">all</span>: test<span style="color: #aaccff;">hello-core.so</span>: hello-core.o  $<span style="color: #aadddd;">(</span><span style="color: #aaccff;">LD</span><span style="color: #aadddd;">)</span> -L . -shared $<span style="color: #aadddd;">(</span><span style="color: #aaccff;">LDFLAGS</span><span style="color: #aadddd;">)</span> -o <span style="color: #aaccff;">$</span><span style="color: #ccaaff;">@</span> $<span style="color: #ccaaff;">^</span><span style="color: #aaccff;">hello-core.o</span>: hello-core.c  $<span style="color: #aadddd;">(</span><span style="color: #aaccff;">CC</span><span style="color: #aadddd;">)</span> $<span style="color: #aadddd;">(</span><span style="color: #aaccff;">CFLAGS</span><span style="color: #aadddd;">)</span> -c -o <span style="color: #aaccff;">$</span><span style="color: #ccaaff;">@</span> $<span style="color: #ccaaff;">^</span><span style="color: #aaccff;">clean</span>:  -rm -f hello-core.o hello-core.so<span style="color: #aaccff;">test</span>: hello-core.so  $<span style="color: #aadddd;">(</span><span style="color: #aaccff;">EMACS</span><span style="color: #aadddd;">)</span> -Q -batch -L . -l test/test.el -f ert-run-tests-batch-and-exit</pre></div><p>ç‚ºäº†ç¢ºèªæˆ‘å€‘ç·¨è­¯å‡ºä¾†çš„ .so æ¨¡çµ„æ˜¯å¦æœ‰æ­£ç¢ºåŸ·è¡Œï¼Œæˆ‘å€‘å¦å¤–å¼„ä¸€å€‹ <code>test.el</code> ä¾†åŸ·è¡Œ <a href="https://www.gnu.org/software/emacs/manual/html_mono/ert.html" target="_blank" rel="external">ert</a> æ¸¬è©¦ï¼Œå› æ­¤å…ˆä¾†å®Œæˆé€™å€‹æ¸¬è©¦ç¨‹å¼ã€‚</p></div></div><div id="outline-container-orge87bbbe" class="outline-3"><h3 id="orge87bbbe">test.el</h3><div class="outline-text-3" id="text-orge87bbbe"><p>åœ¨ test.el ä¸­æˆ‘å€‘è¼‰å…¥äº† <a href="https://www.gnu.org/software/emacs/manual/html_mono/ert.html" target="_blank" rel="external">ert</a> æ¨¡çµ„ä»¥åŠæˆ‘å€‘å³å°‡è¦ç·¨è­¯å‡ºä¾†çš„ <code>hello-core.so</code> æ¨¡çµ„ï¼Œæ³¨æ„åˆ°è¼‰å…¥ dynamic module æ¨¡çµ„çš„æ–¹å¼å’Œè¼‰å…¥ä¸€èˆ¬ .el çš„å‡½å¼åº«æ˜¯ä¸€æ¨£çš„ã€‚</p><p>æ–¼æ˜¯æˆ‘å€‘å°±å¯ä»¥å¯«å€‹ç°¡å–®çš„æ¸¬è©¦ä¾†ç¢ºèªç­‰ç­‰è¦å¯«çš„ C èªè¨€ç‰ˆæœ¬çš„ <code>hello-c</code> å‡½å¼æ˜¯å¦æœƒçœŸçš„å›å‚³ "Hello Emacs" å­—ä¸²å›ä¾†ã€‚</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #5f5f5f; font-style: italic;">;;; </span><span style="color: #9ac; font-style: italic;">test.el --- hello test</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">require</span> '<span style="color: #ccaaff;">ert</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">require</span> '<span style="color: #ccaaff;">hello-core</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">ert-deftest</span> <span style="color: #aaccff;">test-hello</span> <span style="color: #81d4fa;">()</span>  <span style="color: #97abc6; font-style: italic;">"hello-c should return \"Hello Emacs\" string."</span>  <span style="color: #81d4fa;">(</span>should <span style="color: #aaccff;">(</span>string= <span style="color: #aadddd;">"Hello Emacs"</span> <span style="color: #aaeecc;">(</span>hello-c<span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;;; </span><span style="color: #9ac; font-style: italic;">test.el ends here</span></pre></div></div></div><div id="outline-container-org20516ca" class="outline-3"><h3 id="org20516ca">hello-core.c</h3><div class="outline-text-3" id="text-org20516ca"><p>æ¥ä¸‹ä¾†å°±åˆ°äº†æˆ‘å€‘çš„é‡é ­æˆ²ï¼Œ <code>hello-core.c</code> é€™å€‹æ¨¡çµ„ä¸Šï¼Œæˆ‘å€‘é¦–å…ˆæ·»åŠ å¯èƒ½æœƒéœ€è¦çš„æ¨™é ­æª”</p><div class="org-src-container"><pre class="src src-c"><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">stdio.h</span><span style="color: #aadddd;">&gt;</span><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">stdlib.h</span><span style="color: #aadddd;">&gt;</span><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">string.h</span><span style="color: #aadddd;">&gt;</span><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">assert.h</span><span style="color: #aadddd;">&gt;</span><span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">emacs-module.h</span><span style="color: #aadddd;">&gt;</span>       <span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">in emacs source code </span><span style="color: #5f5f5f; font-style: italic;">*/</span></pre></div><p>æ¥ä¸‹ä¾†æˆ‘å€‘è¦å®šç¾©ä¸€å€‹ç‰¹åˆ¥çš„è®Šæ•¸ï¼Œé€™å’Œå¯« gcc plugin æ˜¯ä¸€æ¨£çš„ï¼Œå°±æ˜¯è¦å‘Šè¨´ emacs èªªé€™å€‹ .so æª”æ˜¯ <code>GPL ç›¸å®¹</code> çš„ï¼Œå¦‚æœä½ ä¸æ·»åŠ é€™å€‹ç¬¦è™Ÿé€²å»ï¼Œé‚£ä½ çš„ emacs å°±ä¸æœƒè¼‰å…¥ä½ å¯«çš„é€™å€‹æ¨¡çµ„ã€‚</p><div class="org-src-container"><pre class="src src-c"><span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">`plugin_is_GPL_compatible' indicates that its code is released under the GPL</span><span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">or compatible license; Emacs will refuse to load modules that don't export</span><span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">such a symbol.</span><span style="color: #fff59d;">int</span> <span style="color: #aaccff;">plugin_is_GPL_compatible</span>;</pre></div><p>ç‚ºäº†å¯ä»¥è¼‰å…¥æ¨¡çµ„ï¼Œæˆ‘å€‘éœ€è¦ä¸€å€‹é€²å…¥é»ä¾†è®“ emacs çŸ¥é“é€™å€‹æ¨¡çµ„çš„ç›¸é—œè³‡è¨Šï¼Œä¸¦é€é <code>fset</code> å®£å‘Šäº†åç‚º <code>hello-c</code> çš„å‡½å¼ï¼Œå…¶åŸå‹æœƒé€éå¾Œé¢å®šç¾©çš„ <code>Fcall_hello</code> å‡½å¼ä¾†å¯¦ç¾ï¼Œè€Œåœ¨é€™å€‹é€²å…¥é»ä¸­æˆ‘å€‘ä¹Ÿæä¾›äº†é€™å€‹æ¨¡çµ„çš„åç¨±ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥åœ¨ emacs-lisp ä¸­é€é <code>require</code> ä¾†çµ„å…¥é€™å€‹æ¨¡çµ„ã€‚</p><div class="org-src-container"><pre class="src src-c"><span style="color: #5f5f5f; font-style: italic;">/* </span><span style="color: #9ac; font-style: italic;">Module init function.  </span><span style="color: #5f5f5f; font-style: italic;">*/</span><span style="color: #fff59d;">int</span><span style="color: #aaccff;">emacs_module_init</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">struct</span> <span style="color: #fff59d;">emacs_runtime</span> *<span style="color: #aaccff;">ert</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">{</span>        <span style="color: #fff59d;">emacs_env</span> *<span style="color: #aaccff;">env</span> = ert-&gt;get_environment<span style="color: #81d4fa;">(</span>ert<span style="color: #81d4fa;">)</span>;        <span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">Bind NAME to FUN.</span>        <span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">(fset 'hello-c '(lambda () "Hello Emacs"))</span>        <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qfset</span> = env-&gt;intern<span style="color: #81d4fa;">(</span>env, <span style="color: #aadddd;">"fset"</span><span style="color: #81d4fa;">)</span>;        <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qsym</span> = env-&gt;intern<span style="color: #81d4fa;">(</span>env, <span style="color: #aadddd;">"hello-c"</span><span style="color: #81d4fa;">)</span>;        <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qfn</span> = env-&gt;make_function<span style="color: #81d4fa;">(</span>env, 0, 0, Fcall_hello, <span style="color: #aadddd;">"return hello string"</span>, <span style="color: #ccaaff;">NULL</span><span style="color: #81d4fa;">)</span>;        <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">fset_args</span><span style="color: #81d4fa;">[]</span> = <span style="color: #81d4fa;">{</span> Qsym, Qfn <span style="color: #81d4fa;">}</span>;        env-&gt;funcall<span style="color: #81d4fa;">(</span>env, Qfset, 2, fset_args<span style="color: #81d4fa;">)</span>;        <span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">Provide FEATURE to Emacs.</span>        <span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">(provide 'hello-core)</span>        <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qfeat</span> = env-&gt;intern<span style="color: #81d4fa;">(</span>env, <span style="color: #aadddd;">"hello-core"</span><span style="color: #81d4fa;">)</span>;        <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qprovide</span> = env-&gt;intern<span style="color: #81d4fa;">(</span>env, <span style="color: #aadddd;">"provide"</span><span style="color: #81d4fa;">)</span>;        <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">provide_args</span><span style="color: #81d4fa;">[]</span> = <span style="color: #81d4fa;">{</span> Qfeat <span style="color: #81d4fa;">}</span>;        env-&gt;funcall<span style="color: #81d4fa;">(</span>env, Qprovide, 1, provide_args<span style="color: #81d4fa;">)</span>;        <span style="color: #aaffaa;">return</span> 0;<span style="color: #aadddd;">}</span></pre></div><p>æœ€å¾Œå°±æ˜¯å¯¦ç¾æˆ‘å€‘çš„ <code>hello</code> å‡½å¼çš„æ–¹æ³•ï¼Œæˆ‘å€‘é€é <code>Fcall_hello</code> ä½œç‚ºä¸­é–“å±¤ä¾†å’Œ <code>hello</code> å‡½å¼æºé€šï¼Œä¸¦å›å‚³ emacs-lisp çš„å­—ä¸²é¡å‹å›å»çµ¦ emacs-vmã€‚</p><div class="org-src-container"><pre class="src src-c"><span style="color: #aaffaa;">const</span> <span style="color: #fff59d;">char</span> *<span style="color: #aaccff;">hello</span><span style="color: #aadddd;">()</span><span style="color: #aadddd;">{</span>        <span style="color: #aaffaa;">return</span> <span style="color: #aadddd;">"Hello Emacs"</span>;<span style="color: #aadddd;">}</span><span style="color: #aaffaa;">static</span> <span style="color: #fff59d;">emacs_value</span><span style="color: #aaccff;">Fcall_hello</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">emacs_env</span> *<span style="color: #aaccff;">env</span>, <span style="color: #fff59d;">ptrdiff_t</span> <span style="color: #aaccff;">nargs</span>, <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">args</span><span style="color: #81d4fa;">[]</span>, <span style="color: #fff59d;">void</span> *<span style="color: #aaccff;">data</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">{</span>        <span style="color: #aaffaa;">const</span> <span style="color: #fff59d;">char</span> *<span style="color: #aaccff;">str</span> = hello<span style="color: #81d4fa;">()</span>;        <span style="color: #aaffaa;">return</span> env-&gt;make_string<span style="color: #81d4fa;">(</span>env, str, strlen<span style="color: #aaccff;">(</span>str<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span>;<span style="color: #aadddd;">}</span></pre></div></div></div><div id="outline-container-org41149e4" class="outline-3"><h3 id="org41149e4">é©—è­‰ä½ å¯«çš„æ¨¡çµ„</h3><div class="outline-text-3" id="text-org41149e4"><p>éƒ½å®Œæˆå¾Œï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ <code>make test</code> å»åŸ·è¡Œæ¸¬è©¦ï¼Œä¸€åˆ‡æ­£å¸¸çš„è©±å°±æœƒåƒé€™å€‹æ¨£å­ã€‚</p><div class="org-src-container"><pre class="src src-emacs-lisp">Running 1 tests <span style="color: #aadddd;">(</span>2016-01-03 13:10:24+0800<span style="color: #aadddd;">)</span>   passed  1/1  test-hello</pre></div><p>ç•¶ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å•Ÿå‹•ä½ çš„ emacs ä¸¦ä¸”å°‡é€™å€‹ .so åŠ å…¥åˆ°ä½ çš„ <code>load-path</code> ä¸­ï¼Œä¸¦åŸ·è¡Œä»–</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #aadddd;">(</span>add-to-list 'load-path <span style="color: #aadddd;">"~/emacs-hello"</span><span style="color: #aadddd;">)</span> <span style="color: #5f5f5f; font-style: italic;">; </span><span style="color: #9ac; font-style: italic;">path contains hello-core.so</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">you can use (load "~/emacs-hello/hello-core.so") directly, but we use</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">require here.</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">require</span> '<span style="color: #ccaaff;">hello-core</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span>hello-c<span style="color: #aadddd;">)</span>               <span style="color: #5f5f5f; font-style: italic;">; </span><span style="color: #9ac; font-style: italic;">=&gt; "Hello Emacs"</span></pre></div></div></div></div><div id="outline-container-orgf7f3358" class="outline-2"><h2 id="orgf7f3358">åƒè€ƒ mod-test.c é€²è¡Œæ›´å¤šçš„ç°¡åŒ–</h2><div class="outline-text-2" id="text-orgf7f3358"><p>åœ¨ä¸Šé¢çš„ C èªè¨€ç‰ˆæœ¬ä¸­ï¼Œæˆ‘å€‘æ¯æ¬¡å®šç¾©ä¸€å€‹å‡½å¼éƒ½è¦é€™æ¨£ä¸€å¤§ä¸²å…¶å¯¦é‚„è »ç´¯äººçš„</p><div class="org-src-container"><pre class="src src-c"><span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">Bind NAME to FUN.</span><span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">(fset 'hello-c '(lambda () "Hello Emacs"))</span><span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qfset</span> = env-&gt;intern<span style="color: #aadddd;">(</span>env, <span style="color: #aadddd;">"fset"</span><span style="color: #aadddd;">)</span>;<span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qsym</span> = env-&gt;intern<span style="color: #aadddd;">(</span>env, <span style="color: #aadddd;">"hello-c"</span><span style="color: #aadddd;">)</span>;<span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qfn</span> = env-&gt;make_function<span style="color: #aadddd;">(</span>env, 0, 0, Fcall_hello, <span style="color: #aadddd;">"return hello string"</span>, <span style="color: #ccaaff;">NULL</span><span style="color: #aadddd;">)</span>;<span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">fset_args</span><span style="color: #aadddd;">[]</span> = <span style="color: #aadddd;">{</span> Qsym, Qfn <span style="color: #aadddd;">}</span>;</pre></div><p>é€™é‚Šå¯ä»¥åƒè€ƒ emacs ç¨‹å¼ç¢¼ä¸­çš„ <a href="https://github.com/jwiegley/emacs/blob/54617ada51e49af04f0c3f609e724aafcaf0df16/modules/mod-test/mod-test.c" target="_blank" rel="external">src/modules/mod-test/mod-test.c</a> ï¼Œå…ˆåŠ å…¥é€™æ¨£çš„å¯¦ç¾</p><div class="org-src-container"><pre class="src src-c"><span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">Provide FEATURE to Emacs.</span><span style="color: #aaffaa;">static</span> <span style="color: #fff59d;">void</span><span style="color: #aaccff;">provide</span> <span style="color: #aadddd;">(</span><span style="color: #fff59d;">emacs_env</span> *<span style="color: #aaccff;">env</span>, <span style="color: #aaffaa;">const</span> <span style="color: #fff59d;">char</span> *<span style="color: #aaccff;">feature</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">{</span>    <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qfeat</span> = env-&gt;intern <span style="color: #81d4fa;">(</span>env, feature<span style="color: #81d4fa;">)</span>;    <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qprovide</span> = env-&gt;intern <span style="color: #81d4fa;">(</span>env, <span style="color: #aadddd;">"provide"</span><span style="color: #81d4fa;">)</span>;    <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">args</span><span style="color: #81d4fa;">[]</span> = <span style="color: #81d4fa;">{</span> Qfeat <span style="color: #81d4fa;">}</span>;    env-&gt;funcall <span style="color: #81d4fa;">(</span>env, Qprovide, 1, args<span style="color: #81d4fa;">)</span>;<span style="color: #aadddd;">}</span><span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">Bind NAME to FUN.</span><span style="color: #aaffaa;">static</span> <span style="color: #fff59d;">void</span><span style="color: #aaccff;">bind_function</span> <span style="color: #aadddd;">(</span><span style="color: #fff59d;">emacs_env</span> *<span style="color: #aaccff;">env</span>, <span style="color: #aaffaa;">const</span> <span style="color: #fff59d;">char</span> *<span style="color: #aaccff;">name</span>, <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Sfun</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">{</span>    <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qfset</span> = env-&gt;intern <span style="color: #81d4fa;">(</span>env, <span style="color: #aadddd;">"fset"</span><span style="color: #81d4fa;">)</span>;    <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">Qsym</span> = env-&gt;intern <span style="color: #81d4fa;">(</span>env, name<span style="color: #81d4fa;">)</span>;    <span style="color: #fff59d;">emacs_value</span> <span style="color: #aaccff;">args</span><span style="color: #81d4fa;">[]</span> = <span style="color: #81d4fa;">{</span> Qsym, Sfun <span style="color: #81d4fa;">}</span>;    env-&gt;funcall <span style="color: #81d4fa;">(</span>env, Qfset, 2, args<span style="color: #81d4fa;">)</span>;<span style="color: #aadddd;">}</span></pre></div><p>é€™æ¨£åœ¨æˆ‘å€‘å¯¦ä½œ <code>emacs_module_int</code> çš„æ™‚å€™ï¼Œå°±å¯ä»¥é€é C èªè¨€çš„å·¨é›†ç°¡åŒ–å‡½å¼çš„å®£å‘Š</p><div class="org-src-container"><pre class="src src-c"><span style="color: #fff59d;">int</span><span style="color: #aaccff;">emacs_module_init</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">struct</span> <span style="color: #fff59d;">emacs_runtime</span> *<span style="color: #aaccff;">ert</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">{</span>    <span style="color: #fff59d;">emacs_env</span> *<span style="color: #aaccff;">env</span> = ert-&gt;get_environment<span style="color: #81d4fa;">(</span>ert<span style="color: #81d4fa;">)</span>;<span style="color: #ff8888;">#define</span> <span style="color: #aaccff;">DEFUN</span><span style="color: #81d4fa;">(</span><span style="color: #aaccff;">lsym</span>, <span style="color: #aaccff;">csym</span>, <span style="color: #aaccff;">amin</span>, <span style="color: #aaccff;">amax</span>, <span style="color: #aaccff;">doc</span>, <span style="color: #aaccff;">data</span><span style="color: #81d4fa;">)</span>                        \    bind_function <span style="color: #81d4fa;">(</span>env, lsym,                                           \                   env-&gt;make_function <span style="color: #aaccff;">(</span>env, amin, amax, csym, doc, data<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span>    DEFUN <span style="color: #81d4fa;">(</span><span style="color: #aadddd;">"fib-c"</span>, Fcall_fib_c, 1, 1, <span style="color: #aadddd;">"Calculate Fibonacci number with recursive function call."</span>, <span style="color: #ccaaff;">NULL</span><span style="color: #81d4fa;">)</span>;    DEFUN <span style="color: #81d4fa;">(</span><span style="color: #aadddd;">"fib-loop-c"</span>, Fcall_fib_loop_c, 1, 1, <span style="color: #aadddd;">"Calculate Fibonacci number with loop."</span>, <span style="color: #ccaaff;">NULL</span><span style="color: #81d4fa;">)</span>;<span style="color: #ff8888;">#undef</span> DEFUN    provide<span style="color: #81d4fa;">(</span>env, <span style="color: #aadddd;">"fib-core"</span><span style="color: #81d4fa;">)</span>;    <span style="color: #aaffaa;">return</span> 0;<span style="color: #aadddd;">}</span></pre></div></div></div><div id="outline-container-orgc80b3a3" class="outline-2"><h2 id="orgc80b3a3">ä½¿ç”¨ C/C++ å¯«æ¨¡çµ„ä¸€å®šæ¯”è¼ƒå¿«?</h2><div class="outline-text-2" id="text-orgc80b3a3"><p>æ—¢ç„¶ emacs çµ‚æ–¼å¢åŠ äº† dynamic modules åŠŸèƒ½ï¼Œé‚£æ˜¯ä¸æ˜¯æŠŠå¤§å¤šæ•¸çš„ emacs-lisp æ”¹å¯«æˆ c/c++ æ¨¡çµ„æœƒæ¯”è¼ƒå¥½ï¼Ÿå¯¦éš›ä¸Šæ˜¯ä¸ä¸€å®šï¼Œæˆ‘å€‘å…ˆçœ‹çœ‹æˆ‘ç”¨ C å¯«çš„ fibonacci æ•ˆèƒ½å’Œ emacs-lisp çš„æ¯”è¼ƒç‹€æ³</p><div class="row show-grid"><div class="col-md-6"><p><b>emacs-lisp</b></p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defun</span> <span style="color: #aaccff;">fib-elisp</span> <span style="color: #81d4fa;">(</span>n<span style="color: #81d4fa;">)</span>  <span style="color: #97abc6; font-style: italic;">"Fibonacci in recursive function call."</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">if</span> <span style="color: #aaccff;">(</span>= 0 n<span style="color: #aaccff;">)</span> 0    <span style="color: #aaccff;">(</span><span style="color: #aaffaa;">if</span> <span style="color: #aaeecc;">(</span>= 1 n<span style="color: #aaeecc;">)</span> 1      <span style="color: #aaeecc;">(</span>+ <span style="color: #ccaaff;">(</span>fib-elisp <span style="color: #fff59d;">(</span>- n 1<span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span>         <span style="color: #ccaaff;">(</span>fib-elisp <span style="color: #fff59d;">(</span>- n 2<span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>Elapsed time: <code>211.466410s</code></p></div><div class="col-md-6 "><p><b>c</b></p><div class="org-src-container"><pre class="src src-c"><span style="color: #aaffaa;">static</span> <span style="color: #fff59d;">intmax_t</span> <span style="color: #aaccff;">fib</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">intmax_t</span> <span style="color: #aaccff;">n</span><span style="color: #aadddd;">)</span> <span style="color: #aadddd;">{</span>        <span style="color: #aaffaa;">if</span> <span style="color: #81d4fa;">(</span>0 == n<span style="color: #81d4fa;">)</span> <span style="color: #aaffaa;">return</span> 0;        <span style="color: #aaffaa;">if</span> <span style="color: #81d4fa;">(</span>1 == n<span style="color: #81d4fa;">)</span> <span style="color: #aaffaa;">return</span> 1;        <span style="color: #aaffaa;">return</span> fib<span style="color: #81d4fa;">(</span>n - 1<span style="color: #81d4fa;">)</span> + fib <span style="color: #81d4fa;">(</span>n - 2<span style="color: #81d4fa;">)</span>;<span style="color: #aadddd;">}</span></pre></div><p>Elapsed time: <code>1.389031s</code></p></div> </div><p>ä»¥éè¿´çš„ç‰ˆæœ¬ä¾†çœ‹ï¼Œç”¨ C èªè¨€å¯«çš„ Fibonacci æ•¸åˆ—é‹ç®—æ•¸åº¦æ˜¯å¤§å¹…å‹é emacs-lispï¼Œé‚£å¦‚æœæ˜¯ä½¿ç”¨è¿´åœˆçš„ç‰ˆæœ¬å‘¢ï¼Ÿæˆ‘å€‘å†ä¾†æ¯”è¼ƒä¸€æ¬¡çœ‹çœ‹</p><div class="row show-grid"><div class="col-md-6"><p><b>emacs-lisp</b></p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defun</span> <span style="color: #aaccff;">fib-loop-elisp</span> <span style="color: #81d4fa;">(</span>n<span style="color: #81d4fa;">)</span>  <span style="color: #97abc6; font-style: italic;">"Calculate Fibonacci number with loop."</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">let</span> <span style="color: #aaccff;">(</span><span style="color: #aaeecc;">(</span>a 0<span style="color: #aaeecc;">)</span>        <span style="color: #aaeecc;">(</span>b 1<span style="color: #aaeecc;">)</span>        <span style="color: #aaeecc;">(</span>tmp 0<span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>    <span style="color: #aaccff;">(</span><span style="color: #aaffaa;">dotimes</span> <span style="color: #aaeecc;">(</span>i n 0<span style="color: #aaeecc;">)</span>      <span style="color: #aaeecc;">(</span><span style="color: #aaffaa;">setq</span> tmp a<span style="color: #aaeecc;">)</span>      <span style="color: #aaeecc;">(</span><span style="color: #aaffaa;">setq</span> a b<span style="color: #aaeecc;">)</span>      <span style="color: #aaeecc;">(</span><span style="color: #aaffaa;">setq</span> b <span style="color: #ccaaff;">(</span>+ tmp b<span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>    a<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>Elapsed time: <code>0.002195s</code></p></div><div class="col-md-6 "><p><b>c</b></p><div class="org-src-container"><pre class="src src-c"><span style="color: #aaffaa;">static</span> <span style="color: #fff59d;">intmax_t</span> <span style="color: #aaccff;">fib_loop</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">intmax_t</span> <span style="color: #aaccff;">n</span><span style="color: #aadddd;">)</span> <span style="color: #aadddd;">{</span>        <span style="color: #fff59d;">int</span> <span style="color: #aaccff;">a</span> = 0, <span style="color: #aaccff;">b</span> = 1;        <span style="color: #aaffaa;">for</span> <span style="color: #81d4fa;">(</span><span style="color: #fff59d;">int</span> <span style="color: #aaccff;">i</span> = 0; i &lt; n; i++<span style="color: #81d4fa;">)</span> <span style="color: #81d4fa;">{</span>                <span style="color: #fff59d;">int</span> <span style="color: #aaccff;">tmp</span> = a;                a = b;                b = tmp + b;        <span style="color: #81d4fa;">}</span>        <span style="color: #aaffaa;">return</span> a;<span style="color: #aadddd;">}</span></pre></div><p>Elapsed time: <code>0.000072s</code></p></div> </div><p>å¥½åƒé‚„æ˜¯ç”¨ C å¯«çš„æ•ˆèƒ½æ¯”è¼ƒå¥½ï¼Ÿæˆ‘å€‘ä¾†çœ‹çœ‹ä¸€å€‹åä¾‹ï¼Œç”¨ C++ å¯«çš„æ¨¡ä»¿ <a href="https://github.com/magnars/s.el" target="_blank" rel="external">s.el</a> çš„åŠŸèƒ½</p><div class="row show-grid"><div class="col-md-6"><p><b>emacs-lisp</b></p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defun</span> <span style="color: #aaccff;">s-trim-left</span> <span style="color: #81d4fa;">(</span>s<span style="color: #81d4fa;">)</span>  <span style="color: #97abc6; font-style: italic;">"Remove whitespace at the beginning of S."</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">if</span> <span style="color: #aaccff;">(</span>string-match <span style="color: #aadddd;">"\\`[ \t\n\r]+"</span> s<span style="color: #aaccff;">)</span>      <span style="color: #aaccff;">(</span>replace-match <span style="color: #aadddd;">""</span> t t s<span style="color: #aaccff;">)</span>    s<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>Elapsed time: <code>0.000780s</code></p></div><div class="col-md-6 "><p><b>c++</b></p><div class="org-src-container"><pre class="src src-c++"><span style="color: #ccaaff;">std</span>::<span style="color: #fff59d;">string</span> <span style="color: #aaccff;">ltrim</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">const</span> <span style="color: #ccaaff;">std</span>::<span style="color: #fff59d;">string</span> &amp;<span style="color: #aaccff;">s</span><span style="color: #aadddd;">)</span> <span style="color: #aadddd;">{</span>    <span style="color: #aaffaa;">static</span> <span style="color: #aaffaa;">const</span> <span style="color: #ccaaff;">std</span>::<span style="color: #fff59d;">regex</span> <span style="color: #aaccff;">lws</span><span style="color: #81d4fa;">{</span><span style="color: #aadddd;">"^[ \t\n\r]+"</span>,        <span style="color: #ccaaff;">std</span>::<span style="color: #ccaaff;">regex_constants</span>::extended<span style="color: #81d4fa;">}</span>;    <span style="color: #aaffaa;">return</span> <span style="color: #ccaaff;">std</span>::regex_replace<span style="color: #81d4fa;">(</span>s, lws, <span style="color: #aadddd;">""</span><span style="color: #81d4fa;">)</span>;<span style="color: #aadddd;">}</span></pre></div><p>Elapsed time: <code>0.044819s</code></p></div> </div><p>åœ¨é€™å€‹ç‰ˆæœ¬ä¸­ï¼Œç‚ºäº†æ–¹ä¾¿å°ç…§å› æ­¤éƒ½æ˜¯ä½¿ç”¨ <code>regex</code> ä¾†è™•ç†å­—ä¸²ï¼Œä½†æ˜¯ C++ çš„ç‰ˆæœ¬çµæœå°±æ¯” emacs-lisp æ…¢äº†è¨±å¤šã€‚é›–ç„¶æˆ‘å€‘å¯ä»¥çŸ¥é“æ•ˆèƒ½ç“¶é ¸æ‡‰è©²æ˜¯å‡ºåœ¨ <code>std::regex</code> èº«ä¸Šï¼Œä½†é€™ä¹ŸåŒæ™‚èªªæ˜äº†ä¸æ˜¯ä»€éº¼æ±è¥¿éƒ½ç”¨ C/C++ é‡å¯«ä¸€å®šå¯ä»¥ç²å¾—æœ€ä½³æ•ˆèƒ½ã€‚</p></div></div><div id="outline-container-orgb94eafc" class="outline-2"><h2 id="orgb94eafc">ç¸½çµ</h2><div class="outline-text-2" id="text-orgb94eafc"><p><code>dynamic module</code> çµ‚æ–¼å¯ä»¥åœ¨ emacs ä¸­ä½¿ç”¨ï¼Œé€™å€‹æ¶ˆæ¯å°æˆ‘è€Œè¨€å…¶å¯¦æ˜¯è »é–‹å¿ƒçš„ï¼Œç•¢ç«Ÿé€™ä»£è¡¨äº†æˆ‘å¯ä»¥é€éè‡ªå·±å¯«çš„æ¨¡çµ„å»å¯¦ç¾æ›´å¤šçš„ç”¨é€”ï¼Œè€Œä¸ä¸€å®šè¦å¼·åˆ¶ä¿®æ”¹ emacs æ ¸å¿ƒç¨‹å¼ç¢¼ã€‚</p><p>ç›®å‰æˆ‘æ¸¬è©¦ç”¨çš„ç¨‹å¼ç¢¼å·²ç¶“æ”¾åˆ° <a href="https://github.com/coldnew/emacs-module-test" target="_blank" rel="external">GitHub</a> ä¸Šï¼Œæœ‰èˆˆè¶£ä¹Ÿæ­¡è¿ä¾†ç©ç©çœ‹ï¼Œçœ‹èƒ½ä¸èƒ½æ›¿ emacs å¢åŠ æ›´å¤šæœ‰è¶£çš„åŠŸèƒ½ã€‚</p></div></div><div id="outline-container-org535fcbc" class="outline-2"><h2 id="org535fcbc">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org535fcbc"><p><code>[1]</code> <a href="http://syohex.hatenablog.com/entry/2015/12/16/185458" target="_blank" rel="external">ejectã§å­¸ã¶ Dynamic module æ©Ÿèƒ½</a></p><p><code>[2]</code> <a href="http://qiita.com/syohex/items/5e06a34f1426fd2f28d8#_reference-c55c6773db283acc422d" target="_blank" rel="external">Emacsã‹ã‚‰ Cã®é–¢æ•¸ã‚’ã¤ã‹ã† -&gt; ã¯ã‚„ã„</a></p><p><code>[3]</code> <a href="http://qiita.com/syohex/items/fa71f1c61107b5e30c43" target="_blank" rel="external">Emacsã« mrubyã‚’çµ„ã¿è¾¼ã‚“ã§ã¿ãŸ</a></p><p><code>[4]</code> <a href="https://lists.gnu.org/archive/html/emacs-devel/2015-02/msg00960.html" target="_blank" rel="external">https://lists.gnu.org/archive/html/emacs-devel/2015-02/msg00960.html</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/2d16cc25/#disqus_thread</comments>
    </item>
    
    <item>
      <title>åœ¨ emacs ä¸‹ä½¿ç”¨ mu4e æ”¶ç™¼éƒµä»¶</title>
      <link>https://coldnew.github.io/6a7aa5c1/</link>
      <guid>https://coldnew.github.io/6a7aa5c1/</guid>
      <pubDate>Sat, 02 Jan 2016 16:22:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
æœ€è¿‘åˆé‡æ–°æ”¹å¯«äº†æˆ‘çš„ emacs è¨­å®šï¼Œæ¨æ£„æ‰äº† &lt;a href=&quot;https://github.com/syl20bnr/spacemacs&quot;&gt;spacemacs&lt;/a&gt; ä¸¦é‡æ–°ä½¿ç”¨ &lt;a href=&quot;http://orgmode.org/&quot;&gt;org-mode&lt;/a&gt; æ’°å¯«ï¼Œä½ å¯ä»¥åœ¨ &lt;a href=&quot;http://coldnew.github.io/coldnew-emacs&quot;&gt;é€™è£¡&lt;/a&gt; çœ‹åˆ°æˆ‘ç›®å‰çš„è¨­å®šã€‚
&lt;/p&gt;

&lt;p&gt;
æ—¢ç„¶å‰›å¥½é‡å¯«ï¼Œå°±é †ä¾¿ç´€éŒ„ä¸€ä¸‹å¦‚ä½•åœ¨ emacs ä¸‹é€²è¡Œéƒµä»¶çš„æ”¶ç™¼ï¼Œåœ¨ emacs ä¸‹æˆ‘å€‘æœ‰å¾ˆå¤šç¨®æ”¶ç™¼é›»å­éƒµä»¶çš„é¸æ“‡ï¼Œæ¯”å¦‚ &lt;a href=&quot;http://www.emacswiki.org/emacs/GnusGmail&quot;&gt;gnus&lt;/a&gt; ã€&lt;a href=&quot;http://www.emacswiki.org/emacs/WanderLust&quot;&gt;wanderlust&lt;/a&gt; ï¼Œæœ¬æ–‡è¦èªªçš„æ˜¯å¦å¤–ä¸€å€‹å¾ˆå¤šäººåœ¨ç”¨ä¸¦ä¸”æ¯”è¼ƒå¥½è¨­å®šçš„ &lt;a href=&quot;http://www.djcbsoftware.nl/code/mu/mu4e.html&quot;&gt;mu4e&lt;/a&gt;ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>æœ€è¿‘åˆé‡æ–°æ”¹å¯«äº†æˆ‘çš„ emacs è¨­å®šï¼Œæ¨æ£„æ‰äº† <a href="https://github.com/syl20bnr/spacemacs" target="_blank" rel="external">spacemacs</a> ä¸¦é‡æ–°ä½¿ç”¨ <a href="http://orgmode.org/" target="_blank" rel="external">org-mode</a> æ’°å¯«ï¼Œä½ å¯ä»¥åœ¨ <a href="http://coldnew.github.io/coldnew-emacs">é€™è£¡</a> çœ‹åˆ°æˆ‘ç›®å‰çš„è¨­å®šã€‚</p><p>æ—¢ç„¶å‰›å¥½é‡å¯«ï¼Œå°±é †ä¾¿ç´€éŒ„ä¸€ä¸‹å¦‚ä½•åœ¨ emacs ä¸‹é€²è¡Œéƒµä»¶çš„æ”¶ç™¼ï¼Œåœ¨ emacs ä¸‹æˆ‘å€‘æœ‰å¾ˆå¤šç¨®æ”¶ç™¼é›»å­éƒµä»¶çš„é¸æ“‡ï¼Œæ¯”å¦‚ <a href="http://www.emacswiki.org/emacs/GnusGmail" target="_blank" rel="external">gnus</a> ã€<a href="http://www.emacswiki.org/emacs/WanderLust" target="_blank" rel="external">wanderlust</a> ï¼Œæœ¬æ–‡è¦èªªçš„æ˜¯å¦å¤–ä¸€å€‹å¾ˆå¤šäººåœ¨ç”¨ä¸¦ä¸”æ¯”è¼ƒå¥½è¨­å®šçš„ <a href="http://www.djcbsoftware.nl/code/mu/mu4e.html" target="_blank" rel="external">mu4e</a>ã€‚</p><a id="more"></a><div id="outline-container-orga779810" class="outline-2"><h2 id="orga779810">å®‰è£ mu4e</h2><div class="outline-text-2" id="text-orga779810"><p><a href="http://www.djcbsoftware.nl/code/mu/mu4e.html" target="_blank" rel="external">mu4e</a> å¯¦éš›ä¸Šæ˜¯ <a href="http://www.djcbsoftware.nl/code/mu/mu4e.html" target="_blank" rel="external">mu</a> çš„ emacs å®¢æˆ¶ç«¯ï¼Œå› æ­¤æˆ‘å€‘çœŸæ­£è¦å®‰è£çš„æ˜¯ <a href="http://www.djcbsoftware.nl/code/mu/mu4e.html" target="_blank" rel="external">mu</a> é€™å¥—è»Ÿé«”ã€‚</p><p>åœ¨ Mac OSX ä¸­å¯ä»¥é€é homebrew å®Œæˆé€™ä»¶äº‹æƒ…</p><pre class="example">coldnew@osx ~ $ brew install mu --with-emacs --HEAD</pre><p>ç”±æ–¼ homebrew å®‰è£çš„æ±è¥¿ä¸æœƒåœ¨ emacs çš„ <code>load-path</code> ä¸­ï¼Œå› æ­¤åˆ¥å¿˜è¨˜åœ¨ä½ çš„ emacs åŠ ä¸Šä»¥ä¸‹é€™æ®µè¨­å®š</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">when</span> <span style="color: #81d4fa;">(</span>eq system-type 'darwin<span style="color: #81d4fa;">)</span>  <span style="color: #81d4fa;">(</span>add-to-list 'load-path <span style="color: #aadddd;">"/usr/local/Cellar/mu/HEAD/share/emacs/site-lisp/mu4e"</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>åœ¨ Gentoo Linux å®‰è£å°±å®¹æ˜“å¤šäº†ï¼Œä¹Ÿä¸éœ€è¦ä»€éº¼é¡å¤–çš„è¨­å®šï¼Œå°±åªè¦æ‰“é–‹ emacs çš„ <code>USE flag</code> å³å¯</p><div class="org-src-container"><pre class="src src-sh">coldnew@gentoo ~ $ sudo <span style="color: #aaccff;">USE</span>=<span style="color: #aadddd;">"emacs"</span> emerge net-mail/mu</pre></div></div></div><div id="outline-container-org462bc97" class="outline-2"><h2 id="org462bc97">å®‰è£ offlineimap</h2><div class="outline-text-2" id="text-org462bc97"><p><a href="http://www.djcbsoftware.nl/code/mu/mu4e.html" target="_blank" rel="external">mu</a> åªè² è²¬é€²è¡Œç´¢å¼•ï¼Œä¸¦æœªå…§å»ºæ“·å–ä¿¡ä»¶çš„å·¥å…·ï¼Œå› æ­¤ä½ éœ€è¦å®‰è£ç¬¬ä¸‰æ–¹ç¨‹å¼ä¾†å¹«å¿™ä¸‹è¼‰éƒµä»¶åˆ°æœ¬åœ°ç«¯ï¼Œå¸¸ç”¨çš„æœ‰ <a href="http://offlineimap.org/" target="_blank" rel="external">offlineimap</a> ä»¥åŠ <a href="http://isync.sourceforge.net/" target="_blank" rel="external">mbsync</a> ï¼Œåœ¨æœ¬æ–‡ä¸­ä½¿ç”¨ offlinemap ä¾†è² è²¬æ“·å–ä¿¡ä»¶ã€‚</p><p>è¦ä½¿ç”¨ offlineimapï¼Œç¬¬ä¸€æ­¥ç•¶ç„¶æ˜¯å®‰è£ä»–äº†ï¼Œåœ¨ Mac OSX ä¸­å¯ä»¥é€é homebrew å®Œæˆé€™ä»¶äº‹æƒ…</p><pre class="example">coldnew@osx ~ $ brew install offlineimap</pre><p>åœ¨æˆ‘çš„ Gentoo Linux å‰‡æ˜¯é€é portage å»å®‰è£</p><pre class="example">coldnew@gentoo ~ $ sudo emerge net-mail/offlineimap</pre></div><div id="outline-container-org250d546" class="outline-3"><h3 id="org250d546">è¨­å®š .offlineimaprc</h3><div class="outline-text-3" id="text-org250d546"><p>å®‰è£å®Œæˆå¾Œï¼Œæˆ‘å€‘éœ€è¦è¨­å®š <code>~/.offlineimaprc</code> é€™å€‹æª”æ¡ˆï¼Œé€™é‚Šä»¥æ”¶ç™¼ Gmail ç‚ºä¾‹ï¼Œæˆ‘çš„è¨­å®šæª”æ˜¯é•·é€™å€‹æ¨£å­çš„</p><div class="org-src-container"><pre class="src src-python"><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">-*- mode: python -*-</span><span style="color: #aadddd;">[</span>general<span style="color: #aadddd;">]</span><span style="color: #c6cccc; background-color: #202020;">accounts</span> = Gmail<span style="color: #c6cccc; background-color: #202020;">maxsyncaccounts</span> = <span style="color: #c6cccc; background-color: #202020;">3</span><span style="color: #c6cccc; background-color: #202020;">pythonfile</span> = ~/.offlineimap.py<span style="color: #aadddd;">[</span>Account Gmail<span style="color: #aadddd;">]</span><span style="color: #c6cccc; background-color: #202020;">localrepository</span> = Gmail-Local<span style="color: #c6cccc; background-color: #202020;">remoterepository</span> = Gmail-Remote<span style="color: #aadddd;">[</span>Repository Gmail-Local<span style="color: #aadddd;">]</span><span style="color: #ccaaff;">type</span> = Maildir<span style="color: #c6cccc; background-color: #202020;">localfolders</span> = ~/Maildir/Gmail<span style="color: #aadddd;">[</span>Repository Gmail-Remote<span style="color: #aadddd;">]</span><span style="color: #ccaaff;">type</span> = Gmail<span style="color: #c6cccc; background-color: #202020;">remotehost</span> = imap.gmail.com<span style="color: #c6cccc; background-color: #202020;">remoteuser</span> = YOUR_EMAIL_ACCOUNT <span style="color: #9ac; font-style: italic;"># &lt;---- Change to your account</span><span style="color: #c6cccc; background-color: #202020;">remotepasseval</span> = get_password_emacs<span style="color: #aadddd;">(</span><span style="color: #aadddd;">"imap.gmail.com"</span>, <span style="color: #aadddd;">"993"</span><span style="color: #aadddd;">)</span> <span style="color: #9ac; font-style: italic;"># &lt;---  get password from emacs</span><span style="color: #c6cccc; background-color: #202020;">ssl</span> = true<span style="color: #c6cccc; background-color: #202020;">sslcacertfile</span> = /etc/ssl/certs/ca-certificates.crt<span style="color: #c6cccc; background-color: #202020;">nametrans</span> = <span style="color: #aaffaa;">lambda</span> foldername: foldername.decode<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'imap4-utf-7'</span><span style="color: #aadddd;">)</span>.encode<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'utf-8'</span><span style="color: #aadddd;">)</span><span style="color: #c6cccc; background-color: #202020;">maxconnections</span> = <span style="color: #c6cccc; background-color: #202020;">4</span><span style="color: #c6cccc; background-color: #202020;">realdelete</span> = yes</pre></div><p>åœ¨é€™å€‹è¨­å®šæª”ä¸­æœ‰å¹¾å€‹åœ°æ–¹è¦è§£é‡‹ä¸€ä¸‹ï¼Œé¦–å…ˆç”±æ–¼ offlineimap å°ä¸­æ–‡æ¨™ç±¤æ”¯æŒä¸å¥½ï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦ä¸€å€‹ <code>~/.offlineimap.py</code> è…³æœ¬ä¾†å¹«å¿™é€²è¡Œç·¨ç¢¼çš„è½‰æ›ï¼Œä¸¦å¥—ç”¨åˆ° <code>nametrans</code> çš„è¨­å®šï¼Œå› æ­¤æˆ‘å€‘å¿…é ˆè¦å‘Šè¨´ offlineimap èªªæˆ‘å€‘è¦è¼‰å…¥ <code>~/.offlineimap.py</code> è…³æœ¬ä¸¦ä¸”å¥—ç”¨ <code>nametrans</code> è¦å‰‡</p><div class="org-src-container"><pre class="src src-python"><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">[general]</span><span style="color: #c6cccc; background-color: #202020;">pythonfile</span> = ~/.offlineimap.py<span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">[Repository Gmail-Remote]</span><span style="color: #c6cccc; background-color: #202020;">nametrans</span> = <span style="color: #aaffaa;">lambda</span> foldername: foldername.decode<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'imap4-utf-7'</span><span style="color: #aadddd;">)</span>.encode<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'utf-8'</span><span style="color: #aadddd;">)</span></pre></div><p>å¦å¤–ï¼Œç”±æ–¼æˆ‘å€‘éƒ½è¦åœ¨ emacs ä¸­æ”¶ç™¼éƒµä»¶äº†ï¼Œåœ¨ <code>.offlineimaprc</code> å¡«ä¸Šæ˜ç¢¼çš„å¯†ç¢¼æ˜¯å¾ˆè ¢çš„äº‹æƒ…ï¼Œå› æ­¤æˆ‘å€‘å‘Šè¨´ offlineimap èªªè¦å¯†ç¢¼è«‹å»å’Œ emacs è¦ï¼Œé€™é‚Šä¹Ÿè¨­å®šä¸€äº›è¦å‰‡åœ¨ <code>~/.offlineimap.py</code> ä¸­</p><div class="org-src-container"><pre class="src src-python"><span style="color: #c6cccc; background-color: #202020;">remotepasseval</span> = get_password_emacs<span style="color: #aadddd;">(</span><span style="color: #aadddd;">"imap.gmail.com"</span>, <span style="color: #aadddd;">"993"</span><span style="color: #aadddd;">)</span> <span style="color: #9ac; font-style: italic;"># &lt;---  get password from emacs</span></pre></div></div></div><div id="outline-container-org93a6e0e" class="outline-3"><h3 id="org93a6e0e">è¨­å®š .offlineimap.py</h3><div class="outline-text-3" id="text-org93a6e0e"><p>æ–¼æ˜¯æˆ‘å€‘è©²ä¾†çœ‹çœ‹ <code>~/.offlineimap.py</code> è£¡é¢åˆ°åº•è³£ä»€éº¼è†è—¥å›‰ï½</p></div><div id="outline-container-org4ae55d6" class="outline-4"><h4 id="org4ae55d6">.offlineimap.py - å¢åŠ ç·¨ç¢¼æˆ UTF-8 åŠŸèƒ½</h4><div class="outline-text-4" id="text-org4ae55d6"><p>é¦–å…ˆæˆ‘å€‘æœ€éœ€è¦çš„å°±æ˜¯é¿å…ä¸­æ–‡ä¿¡ä»¶æˆ–æ˜¯æ¨™ç±¤å‡ºç¾å•é¡Œï¼Œå› æ­¤æˆ‘å€‘éœ€è¦å°‡ä»¥ä¸‹é€™æ®µåŠ å…¥åˆ° <code>~/.offlineimap.py</code> ä¸­ã€‚</p><div class="org-src-container"><pre class="src src-python"><span style="color: #5f5f5f; font-style: italic;">#</span><span style="color: #9ac; font-style: italic;">!/usr/bin/env python</span><span style="color: #aaffaa;">import</span> binascii<span style="color: #aaffaa;">import</span> codecs<span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">modified_base64</span><span style="color: #aadddd;">(</span>s<span style="color: #aadddd;">)</span>:    <span style="color: #c6cccc; background-color: #202020;">s</span> = s.encode<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'utf-16be'</span><span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">return</span> binascii.b2a_base64<span style="color: #aadddd;">(</span>s<span style="color: #aadddd;">)</span>.rstrip<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'\n='</span><span style="color: #aadddd;">)</span>.replace<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'/'</span>, <span style="color: #aadddd;">','</span><span style="color: #aadddd;">)</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">doB64</span><span style="color: #aadddd;">(</span>_in, r<span style="color: #aadddd;">)</span>:    <span style="color: #aaffaa;">if</span> _in:    r.append<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'&amp;%s-'</span> % modified_base64<span style="color: #81d4fa;">(</span><span style="color: #aadddd;">''</span>.join<span style="color: #aaccff;">(</span>_in<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">del</span> _in<span style="color: #aadddd;">[</span>:<span style="color: #aadddd;">]</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">encoder</span><span style="color: #aadddd;">(</span>s<span style="color: #aadddd;">)</span>:    <span style="color: #c6cccc; background-color: #202020;">r</span> = <span style="color: #aadddd;">[]</span>    <span style="color: #c6cccc; background-color: #202020;">_in</span> = <span style="color: #aadddd;">[]</span>    <span style="color: #aaffaa;">for</span> c <span style="color: #aaffaa;">in</span> s:    <span style="color: #c6cccc; background-color: #202020;">ordC</span> = <span style="color: #ccaaff;">ord</span><span style="color: #aadddd;">(</span>c<span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">if</span> 0x20 &lt;= ordC &lt;= 0x25 <span style="color: #aaffaa;">or</span> 0x27 &lt;= ordC &lt;= 0x7e:        doB64<span style="color: #aadddd;">(</span>_in, r<span style="color: #aadddd;">)</span>        r.append<span style="color: #aadddd;">(</span>c<span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">elif</span> <span style="color: #c6cccc; background-color: #202020;">c</span> == <span style="color: #aadddd;">'&amp;'</span>:        doB64<span style="color: #aadddd;">(</span>_in, r<span style="color: #aadddd;">)</span>        r.append<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'&amp;-'</span><span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">else</span>:        _in.append<span style="color: #aadddd;">(</span>c<span style="color: #aadddd;">)</span>    doB64<span style="color: #aadddd;">(</span>_in, r<span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">return</span> <span style="color: #aadddd;">(</span>str<span style="color: #81d4fa;">(</span><span style="color: #aadddd;">''</span>.join<span style="color: #aaccff;">(</span>r<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span>, <span style="color: #ccaaff;">len</span><span style="color: #81d4fa;">(</span>s<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">decoding</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">modified_unbase64</span><span style="color: #aadddd;">(</span>s<span style="color: #aadddd;">)</span>:    <span style="color: #c6cccc; background-color: #202020;">b</span> = binascii.a2b_base64<span style="color: #aadddd;">(</span>s.replace<span style="color: #81d4fa;">(</span><span style="color: #aadddd;">','</span>, <span style="color: #aadddd;">'/'</span><span style="color: #81d4fa;">)</span> + <span style="color: #aadddd;">'==='</span><span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">return</span> <span style="color: #ccaaff;">unicode</span><span style="color: #aadddd;">(</span>b, <span style="color: #aadddd;">'utf-16be'</span><span style="color: #aadddd;">)</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">decoder</span><span style="color: #aadddd;">(</span>s<span style="color: #aadddd;">)</span>:    <span style="color: #c6cccc; background-color: #202020;">r</span> = <span style="color: #aadddd;">[]</span>    <span style="color: #c6cccc; background-color: #202020;">decode</span> = <span style="color: #aadddd;">[]</span>    <span style="color: #aaffaa;">for</span> c <span style="color: #aaffaa;">in</span> s:    <span style="color: #aaffaa;">if</span> <span style="color: #c6cccc; background-color: #202020;">c</span> == <span style="color: #aadddd;">'&amp;'</span> <span style="color: #aaffaa;">and</span> <span style="color: #aaffaa;">not</span> decode:        decode.append<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'&amp;'</span><span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">elif</span> <span style="color: #c6cccc; background-color: #202020;">c</span> == <span style="color: #aadddd;">'-'</span> <span style="color: #aaffaa;">and</span> decode:        <span style="color: #aaffaa;">if</span> <span style="color: #ccaaff;">len</span><span style="color: #aadddd;">(</span>decode<span style="color: #aadddd;">)</span> == <span style="color: #c6cccc; background-color: #202020;">1</span>:        r.append<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'&amp;'</span><span style="color: #aadddd;">)</span>        <span style="color: #aaffaa;">else</span>:        r.append<span style="color: #aadddd;">(</span>modified_unbase64<span style="color: #81d4fa;">(</span><span style="color: #aadddd;">''</span>.join<span style="color: #aaccff;">(</span>decode<span style="color: #aaeecc;">[</span><span style="color: #c6cccc; background-color: #202020;">1</span>:<span style="color: #aaeecc;">]</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span>        <span style="color: #c6cccc; background-color: #202020;">decode</span> = <span style="color: #aadddd;">[]</span>    <span style="color: #aaffaa;">elif</span> decode:        decode.append<span style="color: #aadddd;">(</span>c<span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">else</span>:        r.append<span style="color: #aadddd;">(</span>c<span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">if</span> decode:    r.append<span style="color: #aadddd;">(</span>modified_unbase64<span style="color: #81d4fa;">(</span><span style="color: #aadddd;">''</span>.join<span style="color: #aaccff;">(</span>decode<span style="color: #aaeecc;">[</span><span style="color: #c6cccc; background-color: #202020;">1</span>:<span style="color: #aaeecc;">]</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span>    <span style="color: #c6cccc; background-color: #202020;">bin_str</span> = <span style="color: #aadddd;">''</span>.join<span style="color: #aadddd;">(</span>r<span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">return</span> <span style="color: #aadddd;">(</span>bin_str, <span style="color: #ccaaff;">len</span><span style="color: #81d4fa;">(</span>s<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span><span style="color: #aaffaa;">class</span> <span style="color: #fff59d;">StreamReader</span><span style="color: #aadddd;">(</span>codecs.StreamReader<span style="color: #aadddd;">)</span>:    <span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">decode</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">self</span>, s, <span style="color: #c6cccc; background-color: #202020;">errors</span>=<span style="color: #aadddd;">'strict'</span><span style="color: #aadddd;">)</span>:    <span style="color: #aaffaa;">return</span> decoder<span style="color: #aadddd;">(</span>s<span style="color: #aadddd;">)</span><span style="color: #aaffaa;">class</span> <span style="color: #fff59d;">StreamWriter</span><span style="color: #aadddd;">(</span>codecs.StreamWriter<span style="color: #aadddd;">)</span>:    <span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">decode</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">self</span>, s, <span style="color: #c6cccc; background-color: #202020;">errors</span>=<span style="color: #aadddd;">'strict'</span><span style="color: #aadddd;">)</span>:    <span style="color: #aaffaa;">return</span> encoder<span style="color: #aadddd;">(</span>s<span style="color: #aadddd;">)</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">imap4_utf_7</span><span style="color: #aadddd;">(</span>name<span style="color: #aadddd;">)</span>:    <span style="color: #aaffaa;">if</span> <span style="color: #c6cccc; background-color: #202020;">name</span> == <span style="color: #aadddd;">'imap4-utf-7'</span>:    <span style="color: #aaffaa;">return</span> <span style="color: #aadddd;">(</span>encoder, decoder, StreamReader, StreamWriter<span style="color: #aadddd;">)</span>codecs.register<span style="color: #aadddd;">(</span>imap4_utf_7<span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-orge607246" class="outline-4"><h4 id="orge607246">.offlineimap.py - å¾ emacs ä¸­ç²å–å¯†ç¢¼</h4><div class="outline-text-4" id="text-orge607246"><p>åœ¨æˆ‘çš„ç³»çµ±ä¸­ï¼Œemacs è² è²¬é€²è¡Œè§£å¯† <code>~/.authinfo.gpg</code> é€™å€‹é€é gnupg åŠ å¯†çš„è¨­å®šæª”æ¡ˆï¼Œä¸¦ä¸”æˆ‘çš„ emacs æ˜¯ä¸é—œæ‰çš„ï¼Œå› æ­¤å°±ç›´æ¥å•Ÿå‹•ä¸€å€‹ emacsclient å»åŸ·è¡Œ <code>offlineimap-get-password</code> é€™å€‹å‡½å¼ (éœ€å®šç¾©åœ¨ä½ çš„ ~/.emacs.d/ è£¡é¢)</p><div class="org-src-container"><pre class="src src-python"><span style="color: #aaffaa;">import</span> subprocess<span style="color: #aaffaa;">import</span> re<span style="color: #aaffaa;">import</span> os<span style="color: #5f5f5f; font-style: italic;">#</span><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">pass password from emacs</span><span style="color: #5f5f5f; font-style: italic;">#</span><span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">get_output</span><span style="color: #aadddd;">(</span>cmd<span style="color: #aadddd;">)</span>:    <span style="color: #9ac; font-style: italic;"># Bunch of boilerplate to catch the output of a command:</span>    <span style="color: #c6cccc; background-color: #202020;">pipe</span> = subprocess.Popen<span style="color: #aadddd;">(</span>cmd, <span style="color: #c6cccc; background-color: #202020;">shell</span>=<span style="color: #aaffaa;">True</span>, <span style="color: #c6cccc; background-color: #202020;">stdout</span>=subprocess.PIPE, <span style="color: #c6cccc; background-color: #202020;">stderr</span>=subprocess.STDOUT<span style="color: #aadddd;">)</span>    <span style="color: #aadddd;">(</span>output, errout<span style="color: #aadddd;">)</span> = pipe.communicate<span style="color: #aadddd;">()</span>    <span style="color: #aaffaa;">assert</span> <span style="color: #c6cccc; background-color: #202020;">pipe.returncode</span> == <span style="color: #c6cccc; background-color: #202020;">0</span> <span style="color: #aaffaa;">and</span> <span style="color: #aaffaa;">not</span> errout    <span style="color: #aaffaa;">return</span> output<span style="color: #aaffaa;">def</span> <span style="color: #aaccff;">get_password_emacs</span><span style="color: #aadddd;">(</span>host, port<span style="color: #aadddd;">)</span>:    <span style="color: #c6cccc; background-color: #202020;">cmd</span> = <span style="color: #aadddd;">"emacsclient --eval '(offlineimap-get-password \"%s\" \"%s\")'"</span> % <span style="color: #aadddd;">(</span>host, port<span style="color: #aadddd;">)</span>    <span style="color: #aaffaa;">return</span> get_output<span style="color: #aadddd;">(</span>cmd<span style="color: #aadddd;">)</span>.strip<span style="color: #aadddd;">()</span>.lstrip<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'"'</span><span style="color: #aadddd;">)</span>.rstrip<span style="color: #aadddd;">(</span><span style="color: #aadddd;">'"'</span><span style="color: #aadddd;">)</span></pre></div><p>è‡³æ–¼ emacs ä¸­ <code>offlineimap-get-password</code> é€™å€‹å‡½å¼çš„å®šç¾©å‰‡åœ¨å¾Œé¢é€²è¡Œèªªæ˜ã€‚</p></div></div></div><div id="outline-container-org710d617" class="outline-3"><h3 id="org710d617">Mac OSX ä¸‹å¯èƒ½é‡åˆ°çš„éŒ¯èª¤</h3><div class="outline-text-3" id="text-org710d617"><p>åœ¨ Mac OSX ä¸‹ä½¿ç”¨ offlineimap æ™‚å€™ä½ å¯èƒ½æœƒé‡åˆ°ä»¥ä¸‹çš„éŒ¯èª¤</p><pre class="example">OfflineIMAP 6.6.0  Licensed under the GNU GPL v2 or any later version (with an OpenSSL exception)Account sync Gmail: *** Processing account Gmail Establishing connection to imap.gmail.com:993 ERROR: No CA certificates and no server fingerprints configured.  You must configure at least something, otherwise having SSL helps nothing. *** Finished account 'Gmail' in 0:00Account sync Weintek: *** Processing account Weintek Establishing connection to www.hibox.hinet.net:993 ERROR: No CA certificates and no server fingerprints configured.  You must configure at least something, otherwise having SSL helps nothing. *** Finished account 'Weintek' in 0:00ERROR: Exceptions occurred during the run!ERROR: No CA certificates and no server fingerprints configured.  You must configure at least something, otherwise having SSL helps nothing.Traceback:  File "/usr/local/Cellar/offline-imap/6.6.0/libexec/offlineimap/accounts.py", line 263, in syncrunner    self.__sync()  File "/usr/local/Cellar/offline-imap/6.6.0/libexec/offlineimap/accounts.py", line 326, in __sync    remoterepos.getfolders()  File "/usr/local/Cellar/offline-imap/6.6.0/libexec/offlineimap/repository/IMAP.py", line 384, in getfolders    imapobj = self.imapserver.acquireconnection()  File "/usr/local/Cellar/offline-imap/6.6.0/libexec/offlineimap/imapserver.py", line 483, in acquireconnection    tls_level=self.tlslevel,  File "/usr/local/Cellar/offline-imap/6.6.0/libexec/offlineimap/imaplibutil.py", line 186, in __init__    super(WrappedIMAP4_SSL, self).__init__(*args, **kwargs)  File "/usr/local/Cellar/offline-imap/6.6.0/libexec/offlineimap/imaplib2.py", line 2138, in __init__    IMAP4.__init__(self, host, port, debug, debug_file, identifier, timeout, debug_buf_lvl)  File "/usr/local/Cellar/offline-imap/6.6.0/libexec/offlineimap/imaplib2.py", line 357, in __init__    self.open(host, port)  File "/usr/local/Cellar/offline-imap/6.6.0/libexec/offlineimap/imaplibutil.py", line 193, in open    "having SSL helps nothing.", OfflineImapError.ERROR.REPO)</pre><p>é€™å•é¡Œæ˜¯å› ç‚º Mac OSX æ²’æœ‰å…§å»º <code>ca-certificates.crt</code> é€™æ¨£çš„é©—è­‰æª”æ¡ˆ (!?) ï¼Œå› æ­¤ä½ å¿…é ˆé€é homebrew å»å®‰è£ openssl ä¾†å–å¾—é€™å€‹æª”æ¡ˆ</p><pre class="example">coldnew@osx ~ $ brew install openssl</pre><p>æ¥è‘—ä½ å°±å¯ä»¥ä½¿ç”¨ <code>/usr/local/etc/openssl/cert.pem</code> ä½œç‚º sslcacertfileï¼Œå°‡ä½ çš„ .offlineimaprc ä¿®æ”¹å¦‚ä¸‹</p><div class="org-src-container"><pre class="src src-python"><span style="color: #c6cccc; background-color: #202020;">sslcacertfile</span> = /usr/local/etc/openssl/cert.pem</pre></div><p>æˆ‘è‡ªå·±çš„é›»è…¦ç‚ºäº†å¯ä»¥è®“ <code>.offlineimaprc</code> å¯ä»¥åŒæ™‚ç”¨æ–¼ Linux å’Œ Mac OSX ä¸Šï¼Œæˆ‘å‰‡æ˜¯é€éè»Ÿé€£çµä¾†å»ºç«‹ <code>/etc/ssl/certs/ca-certificates.crt</code> é€™å€‹æª”æ¡ˆã€‚</p><pre class="example">coldnew@osx ~ $ sudo ln -s /usr/local/etc/openssl/cert.pem /etc/ssl/certs/ca-certificates.crt</pre></div></div></div><div id="outline-container-orgf5791e4" class="outline-2"><h2 id="orgf5791e4">è¨­å®š Google é©—è­‰</h2><div class="outline-text-2" id="text-orgf5791e4"><p>æœ€è¿‘æ‰ç™¼ç¾ Google æ›å€‹é©—è­‰æ–¹å¼ï¼Œå‡å¦‚ä½ ç”¨ offlineimap ä¹‹é¡çš„è»Ÿé«”ä¸‹è¼‰ Gmail é‡åˆ°é€™æ¨£çš„å•é¡Œï¼Œé‚£å°±æ˜¯ä½ å¿…é ˆè¦ç…§ Google çš„è¦æ±‚é€²è¡Œæ–°çš„é©—è­‰æ–¹å¼</p><div class="org-src-container"><pre class="src src-org">Warning: Opening nnimap server on gmail...failed: NO (ALERT) Please log in via your web browser:<span style="color: #ccaaff; text-decoration: underline;"><a href="https://support.google.com/mail/accounts/answer/78754" target="_blank" rel="external">https://support.google.com/mail/accounts/answer/78754</a></span> (Failure);Server nnimap+gmail previously determined to be down; not retrying;</pre></div><p>é¦–å…ˆé€£ç·šåˆ° <a href="https://support.google.com/mail/answer/185833?hl=en&amp;rd=1" target="_blank" rel="external">https://support.google.com/mail/answer/185833?hl=en&amp;rd=1</a> è©²é é¢æè¿°äº†ç”¢ç”Ÿ App password çš„æ–¹æ³•</p><div class="figure"><p><img src="a1.png"></p></div><p>æ¥è‘—å°±å»é€²è¡Œä½ çš„å…©æ­¥é©Ÿé©—è­‰ï¼Œå®Œæˆå¾Œä½ å°±å¯ä»¥åœ¨å€‹äººçš„è¨­å®šé é¢å»è¨­å®š <code>æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼</code> ï¼Œé¦–å…ˆæˆ‘å€‘é¸æ“‡å…¶ä»–æ‡‰ç”¨ç¨‹å¼</p><div class="figure"><p><img src="a2.png"></p></div><p>æ¥è‘—è¨­å®šæ‡‰ç”¨ç¨‹å¼åç¨±ç‚º <code>emacs</code></p><div class="figure"><p><img src="a3.png"></p></div><p>å®Œæˆä»¥å¾Œä½ å°±æœƒå¾—åˆ°ä¸€çµ„ <code>16 å­—å…ƒ</code> çš„å¯†ç¢¼ï¼Œæˆ‘å€‘å°‡ä»–å¡«åˆ° <code>~/.authinfo.gpg</code> çš„ <code>YOUR_PASSWORD</code> æ¬„ä½å»ã€‚</p><div class="figure"><p><img src="a4.png"></p></div></div></div><div id="outline-container-org0c929bc" class="outline-2"><h2 id="org0c929bc">è¨­å®š ~/.authinfo.gpg</h2><div class="outline-text-2" id="text-org0c929bc"><p>è¨­å®šå®Œ Google é©—è­‰ä¸¦ä¸”å–å¾—ä½ çš„ app å¯†ç¢¼å¾Œï¼Œå°±æŠŠä½ çš„è³‡æ–™å¡«å…¥åˆ° <code>~/.authinfo.gpg</code> ä¸­å§ï¼Œåªè¦ä½ çš„ emacs æœ‰é€²è¡Œè¨­å®šï¼Œä»–æœƒå¹«ä½ å°‡ <code>.gpg</code> çµå°¾çš„æª”æ¡ˆåŠ å¯†èµ·ä¾†çš„ã€‚</p><div class="org-src-container"><pre class="src src-text">machine imap.gmail.com login YOUR_EMAIL_ACCOUNT port 993 password YOUR_PASSWORD port 993machine smtp.gmail.com login YOUR_EMAIL_ACCOUNT port 587 password YOUR_PASSWORD port 587</pre></div></div></div><div id="outline-container-org06e987d" class="outline-2"><h2 id="org06e987d">è¨­å®šä½ çš„ emacs</h2><div class="outline-text-2" id="text-org06e987d"><p>ä¸Šè¿°å·¥ä½œéƒ½å®Œæˆå¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥æº–å‚™ä¾†è¨­å®šæˆ‘å€‘çš„ emacs äº†~ é¦–å…ˆå…ˆåŠ ä¸Šä¸€å€‹å‡½å¼è®“ emacsclient å¯ä»¥å–å¾—å¯«åœ¨ <code>~/.authinfo.gpg</code> çš„å¯†ç¢¼</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">defun</span> <span style="color: #aaccff;">offlineimap-get-password</span> <span style="color: #81d4fa;">(</span>host port<span style="color: #81d4fa;">)</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">require</span> '<span style="color: #ccaaff;">netrc</span><span style="color: #81d4fa;">)</span>  <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">let*</span> <span style="color: #aaccff;">(</span><span style="color: #aaeecc;">(</span>netrc <span style="color: #ccaaff;">(</span>netrc-parse <span style="color: #fff59d;">(</span>expand-file-name <span style="color: #aadddd;">"~/.authinfo.gpg"</span><span style="color: #fff59d;">)</span><span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span>         <span style="color: #aaeecc;">(</span>hostentry <span style="color: #ccaaff;">(</span>netrc-machine netrc host port port<span style="color: #ccaaff;">)</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span>    <span style="color: #aaccff;">(</span><span style="color: #aaffaa;">when</span> hostentry <span style="color: #aaeecc;">(</span>netrc-get hostentry <span style="color: #aadddd;">"password"</span><span style="color: #aaeecc;">)</span><span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>æ¥ä¸‹ä¾†å°±æ˜¯æˆ‘å€‘ mu4e çš„è¨­å®šï¼Œæˆ‘å€‘è¨­å®šäº†ä¿¡ä»¶å­˜æ”¾ä½å€ç‚º <code>~/Maildir</code> é€™å€‹è³‡æ–™å¤¾ï¼Œä¸¦ä¸”ä½¿ç”¨ <a href="http://offlineimap.org/" target="_blank" rel="external">offlineimap</a> é€²è¡Œä¿¡ä»¶çš„æ“·å–åŠŸèƒ½ï¼Œæ¯ <code>60 ç§’</code> æ›´æ–°ä¸€æ¬¡è³‡è¨Šï¼Œå€¼å¾—ä¸€æçš„æ˜¯ç”±æ–¼ <a href="http://offlineimap.org/" target="_blank" rel="external">offlineimap</a> æ˜¯å¤–éƒ¨ç¨‹å¼ï¼Œåœ¨æ“·å–ä¿¡ä»¶çš„æ™‚å¾Œä¸¦ä¸æœƒå¡ä½ä½ çš„ emacsã€‚</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">require</span> '<span style="color: #ccaaff;">mu4e</span><span style="color: #aadddd;">)</span>                      <span style="color: #5f5f5f; font-style: italic;">; </span><span style="color: #9ac; font-style: italic;">load mu4e</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">Use mu4e as default mail agent</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> mail-user-agent 'mu4e-user-agent<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">Mail folder set to ~/Maildir</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> mu4e-maildir <span style="color: #aadddd;">"~/Maildir"</span><span style="color: #aadddd;">)</span>         <span style="color: #5f5f5f; font-style: italic;">; </span><span style="color: #9ac; font-style: italic;">NOTE: should not be symbolic link</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">Fetch mail by offlineimap</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> mu4e-get-mail-command <span style="color: #aadddd;">"offlineimap"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">Fetch mail in 60 sec interval</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> mu4e-update-interval 60<span style="color: #aadddd;">)</span></pre></div><p>æ¥ä¸‹ä¾†è¦è¨­å®šå¯„ä»¶å¤¾ã€è‰ç¨¿å¤¾ç­‰ä½å€ï¼Œæ³¨æ„åˆ°æˆ‘åœ¨ <code>~/.offlineimaprc</code> è£¡é¢æœ‰é€™æ¨£çš„è¨­å®š</p><div class="org-src-container"><pre class="src src-python"><span style="color: #5f5f5f; font-style: italic;"># </span><span style="color: #9ac; font-style: italic;">[Repository Gmail-Local]</span><span style="color: #c6cccc; background-color: #202020;">localfolders</span> = ~/Maildir/Gmail</pre></div><p>å› æ­¤åœ¨ä½ çš„ <code>.emacs</code> é€™é‚Šè¦é€™æ¨£åŠ å…¥è¨­å®š</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">folder for sent messages</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> mu4e-sent-folder   <span style="color: #aadddd;">"/Gmail/Sent"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">unfinished messages</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> mu4e-drafts-folder <span style="color: #aadddd;">"/Gmail/Drafts"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">trashed messages</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> mu4e-trash-folder  <span style="color: #aadddd;">"/Gmail/Trash"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">saved messages</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> mu4e-trash-folder  <span style="color: #aadddd;">"/Gmail/Archive"</span><span style="color: #aadddd;">)</span></pre></div><p>åœ¨æˆ‘å€‘æ”¶ä¿¡çš„æ™‚å€™ï¼Œæœ‰äº›ä¿¡ä»¶å¯èƒ½æ˜¯ HTML çš„æ ¼å¼ï¼Œå› æ­¤æˆ‘å€‘ä½¿ç”¨ emacs å…§å»ºçš„ <code>eww</code> å°‡å…¶è½‰æ›ç‚ºç´”æ–‡å­—æª”å¥½æ–¹ä¾¿é–±è®€ï¼Œä¸¦ç”¨ä¸€äº› <a href="http://www.djcbsoftware.nl/code/mu/mu4e/Displaying-rich_002dtext-messages.html" target="_blank" rel="external">å»ºè­°</a> çš„æŒ‰éµè¨­å®š</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">require</span> '<span style="color: #ccaaff;">mu4e-contrib</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> mu4e-html2text-command 'mu4e-shr2text<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">try to emulate some of the eww key-bindings</span><span style="color: #aadddd;">(</span>add-hook 'mu4e-view-mode-hook          <span style="color: #81d4fa;">(</span><span style="color: #aaffaa;">lambda</span> <span style="color: #aaccff;">()</span>            <span style="color: #aaccff;">(</span>local-set-key <span style="color: #aaeecc;">(</span>kbd <span style="color: #aadddd;">"&lt;tab&gt;"</span><span style="color: #aaeecc;">)</span> 'shr-next-link<span style="color: #aaccff;">)</span>            <span style="color: #aaccff;">(</span>local-set-key <span style="color: #aaeecc;">(</span>kbd <span style="color: #aadddd;">"&lt;backtab&gt;"</span><span style="color: #aaeecc;">)</span> 'shr-previous-link<span style="color: #aaccff;">)</span><span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span></pre></div><p>ç•¶ç„¶ï¼Œåœ¨åœ–å½¢ä»‹é¢ä¸‹çš„ emacs æ˜¯å¯ä»¥é¡¯ç¤ºåœ–åƒçš„ï¼Œå› æ­¤ä½ å¯ä»¥è¨­å®š <code>mu4e-view-show-images</code> ä¾†è®“ mu4e é¡¯ç¤ºåœ–ç‰‡</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> mu4e-view-show-images t<span style="color: #aadddd;">)</span></pre></div><p>å†ä¾†å°±æ˜¯å¯„ä¿¡çš„è¨­å®šï¼Œé€™é‚Šå¯¦éš›ä¸Šç”¨çš„æ˜¯ emacs å…§å»ºçš„ smtp åŠŸèƒ½ï¼Œå› æ­¤ç…§è‘—è¨­å®šå°±å¥½</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">SMTP setup</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> message-send-mail-function 'smtpmail-send-it      smtpmail-stream-type 'starttls      starttls-use-gnutls t<span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">Personal info</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> user-full-name <span style="color: #aadddd;">"Yen-Chin, Lee"</span><span style="color: #aadddd;">)</span>          <span style="color: #5f5f5f; font-style: italic;">; </span><span style="color: #9ac; font-style: italic;">FIXME: add your info here</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> user-mail-address <span style="color: #aadddd;">"coldnew.tw@gmail.com"</span><span style="color: #aadddd;">)</span><span style="color: #5f5f5f; font-style: italic;">; </span><span style="color: #9ac; font-style: italic;">FIXME: add your info here</span><span style="color: #5f5f5f; font-style: italic;">;; </span><span style="color: #9ac; font-style: italic;">gmail setup</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> smtpmail-smtp-server <span style="color: #aadddd;">"smtp.gmail.com"</span><span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> smtpmail-smtp-service 587<span style="color: #aadddd;">)</span><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> smtpmail-smtp-user <span style="color: #aadddd;">"YOUR-GMAIL-ADDRESS"</span><span style="color: #aadddd;">)</span> <span style="color: #5f5f5f; font-style: italic;">; </span><span style="color: #9ac; font-style: italic;">FIXME: add your gmail addr here</span></pre></div><p>å¦‚æœä½ æƒ³è¦è¨­å®šä½ çš„ç°½åæª”ï¼Œå‰‡å¯ä»¥è¨­å®š <code>mu4e-compose-signature</code> é€™å€‹è®Šæ•¸</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #aadddd;">(</span><span style="color: #aaffaa;">setq</span> mu4e-compose-signature <span style="color: #aadddd;">"Sent from my emacs."</span><span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-orgacf1185" class="outline-2"><h2 id="orgacf1185">ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„é¡å¤–è¨­å®š</h2><div class="outline-text-2" id="text-orgacf1185"><p>ç¬¬ä¸€æ¬¡é€²è¡Œä½¿ç”¨çš„æ™‚å€™ï¼Œæˆ‘å€‘è¦å…ˆé€é <a href="http://offlineimap.org/" target="_blank" rel="external">offlineimap</a> ä¾†æ”¶å– Gmail ä¸Šçš„éƒµä»¶ï¼Œæ–¼æ˜¯åœ¨å¦å¤–ä¸€å€‹çµ‚ç«¯æ©Ÿä¸Šæ‰‹å‹•åŸ·è¡Œ offlineimap é€™å€‹ç¨‹å¼ï¼Œå¦‚æœä½ ä»¿ç…§æˆ‘çš„è¨­å®šï¼Œä½ æœƒçœ‹åˆ°åŸ·è¡Œå®Œ offlineimap å¾Œï¼Œemacs æœƒä¾†ç›¸ä½ è©¢å• <code>~/.authinfo.gpg</code> çš„å¯†ç¢¼ï¼Œæä¾›çµ¦ä»–å¾Œ offlineimap å°±é–‹å§‹ä¸‹è¼‰éƒµä»¶äº†</p><pre class="example">coldnew@osx ~ $ offlineimapOfflineIMAP 6.6.0  Licensed under the GNU GPL v2 or any later version (with an OpenSSL exception)Account sync Gmail: *** Processing account Gmail Establishing connection to imap.gmail.com:993Folder [mailing-list]/linux-input [acc: Gmail]: Copy message 4371 (4369 of 9933) Gmail-Remote:[mailing-list]/linux-input -&gt; Gmail-LocalFolder [mailing-list]/emacs-devel [acc: Gmail]: Copy message 14129 (13112 of 41986) Gmail-Remote:[mailing-list]/emacs-devel -&gt; Gmail-LocalFolder [mailing-list]/Clojure [acc: Gmail]: Copy message 14012 (13123 of 36061) Gmail-Remote:[mailing-list]/Clojure -&gt; Gmail-LocalFolder [mailing-list]/linux-kernel-arm [acc: Gmail]: Copy message 2981 (2981 of 272523) Gmail-Remote:[mailing-list]/linux-kernel-arm -&gt; Gmail-Local</pre><p>éƒµä»¶å–å¾—å®Œæˆå¾Œï¼Œæˆ‘å€‘è¦è®“ <code>mu</code> ç´¢å¼•æ‰€æœ‰çš„éƒµä»¶ï¼Œé€™é‚Šé€™äº›å‹•ä½œåªæœ‰ç¬¬ä¸€æ¬¡è¨­ç«‹ç’°å¢ƒæ™‚éœ€è¦åŸ·è¡Œï¼Œä¹‹å¾Œé€é emacs çš„ <code>mu4e</code> å°±æœƒè‡ªå‹•é€²è¡ŒæŠ“å–éƒµä»¶å’Œç´¢å¼•çš„å‹•ä½œ</p><pre class="example">coldnew@osx ~ $  mu indexindexing messages under /Users/coldnew/Maildir [/Users/coldnew/.mu/xapian]\ processing mail; processed: 12300; updated/new: 12300, cleaned-up: 0| processing mail; processed: 12375; updated/new: 12375, cleaned-up: 0</pre></div></div><div id="outline-container-orge351c26" class="outline-2"><h2 id="orge351c26">åœ¨ emacs ä¸‹è§€çœ‹éƒµä»¶</h2><div class="outline-text-2" id="text-orge351c26"><p>å‰é¢çš„è¨­å®šéƒ½å®Œæˆå¾Œï¼Œå°±å¯ä»¥åŸ·è¡Œ <code>M-x mu4e</code> ä¾†å•Ÿå‹•æˆ‘å€‘ä¾†å•Ÿå‹•æˆ‘å€‘çš„ mu4e ç¨‹å¼ï¼Œé¦–å…ˆæœƒé€²åˆ°æ­¡è¿ç•«é¢</p><div class="figure"><p><img src="b1.png"></p></div><p>æ¥ä¸‹ä¾†è¼¸å…¥ <code>j</code> åˆ‡æ›è¦ç€è¦½çš„ä¿¡ä»¶ç¾¤çµ„</p><div class="figure"><p><img src="b2.png"></p></div><p>ç„¶å¾Œå°ä½ æœ‰èˆˆè¶£çš„ä¿¡ä»¶æŒ‰ä¸‹ <code>ENTER</code> å¾Œå°±å¯ä»¥çœ‹åˆ°å…§æ–‡å›‰~</p><div class="figure"><p><img src="b3.png"></p></div><p>æ›´å¤šçš„æ“ä½œå°±ä¸åœ¨é€™é‚Šè´…è¿°äº†ï¼Œè«‹åƒè€ƒ <a href="http://www.djcbsoftware.nl/code/mu/mu4e/index.html" target="_blank" rel="external">mu4e Manual</a> ã€‚</p></div></div><div id="outline-container-org8677b65" class="outline-2"><h2 id="org8677b65">åœ¨ emacs ä¸‹å¯„é€ä¿¡ä»¶</h2><div class="outline-text-2" id="text-org8677b65"><p>æœƒæ”¶ä¿¡äº†ä»¥å¾Œï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹æ€æ¨£ç™¼é€ä¿¡ä»¶ï¼Œå‰é¢èªªåˆ°äº† mu4e å¯¦éš›ä¸Šæ˜¯é€é emacs å…§å»ºçš„åŠŸèƒ½ä¾†å¯„é€ä¿¡ä»¶ï¼Œå› æ­¤æˆ‘å€‘åªè¦å‘¼å« <a href="http://www.gnu.org/software/emacs/manual/html_node/emacs/Sending-Mail.html" target="_blank" rel="external">compose-mail</a> é€™å€‹å‘½ä»¤ (<code>C-x m</code>) å³å¯é€²å…¥å¯«ä¿¡ä»¶çš„è¦–çª—</p><div class="figure"><p><img src="c1.png"></p></div><p>å¡«å¯«å®Œæˆä½ çš„è¨Šæ¯å¾Œï¼Œåªè¦è¼¸å…¥ <code>C-c C-c</code> å°±æœƒå°‡ä¿¡ä»¶å¯„é€å‡ºå»å›‰ï¼Œé€™é‚Šæ˜¯æˆ‘åœ¨ gmail æ”¶åˆ°çš„çµæœ</p><div class="figure"><p><img src="c2.png"></p></div></div></div><div id="outline-container-org1eccde6" class="outline-2"><h2 id="org1eccde6">ç¸½çµ</h2><div class="outline-text-2" id="text-org1eccde6"><p>æˆ‘è‡ªå·±ä½¿ç”¨ emacs çš„ç¿’æ…£æ˜¯ç”¨ä»–ä¾†çœ‹ mailing-list, ç•¢ç«Ÿä¿¡ä»¶å¤ªå¤šç”¨ gmail æˆ–æ˜¯ app ä¸è¦‹çš„å¥½ç€è¦½ï¼Œç§äººä¿¡ä»¶æ‰æœƒä½¿ç”¨ APP æˆ–æ˜¯ thunderbird ä¾†æ”¶ã€‚å°æˆ‘è€Œè¨€åœ¨ emacs ä¸­æ”¶ä¿¡æœ‰å¹¾å€‹å¥½è™•</p><ol class="org-ol"><li><p>é«˜åº¦èˆ‡ emacs æ•´åˆ</p><p>æˆ‘å¯ä»¥è‡ªè¡Œè¨­å®šæˆ‘éœ€è¦çš„åŠŸèƒ½(æ›¿ patch ä¸Šè‰²)ï¼Œä¸¦ä¸”æ”¶ä¿¡æ™‚ä¸éœ€è¦é›¢é–‹ emacsã€‚</p></li><li><p>æ–¹ä¾¿å¯„ä¿¡</p><p>é™¤äº†æ”¶ä¿¡ä»¥å¤–ï¼Œç›´æ¥åœ¨ emacs ä¸­å¯„ä¿¡åŒæ™‚ä»£è¡¨äº†æˆ‘å¯ä»¥ç”¨è‡ªå·±è¨­å®šå¥½çš„å¿«æ·éµä¾†ä¿®æ”¹ä¿¡ä»¶ï¼Œé€™æ˜¯éå¸¸æ„‰å¿«çš„äº‹æƒ…ã€‚</p></li></ol></div></div><div id="outline-container-org9ad9a14" class="outline-2"><h2 id="org9ad9a14">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org9ad9a14"><p><code>[1]</code> <a href="http://www.djcbsoftware.nl/code/mu/mu4e.html" target="_blank" rel="external">http://www.djcbsoftware.nl/code/mu/mu4e.html</a></p><p><code>[2]</code> <a href="http://rudolfochrist.github.io/blog/2015/03/21/offlineimap-with-ssl-files-on-osx/" target="_blank" rel="external">Offlineimap with SSL files on OSX</a></p><p><code>[3]</code> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1588425#p1588425" target="_blank" rel="external">offlineimap stops working after update to 6.6.0</a></p><p><code>[4]</code> <a href="https://gist.github.com/areina/3879626" target="_blank" rel="external">Manage your gmail account in emacs with mu4e</a></p><p><code>[5]</code> <a href="https://productforums.google.com/forum/#!topic/gmail/WUaXHSdI3WM" target="_blank" rel="external">2-step authentication for IMap?</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/6a7aa5c1/#disqus_thread</comments>
    </item>
    
    <item>
      <title>åœ¨ emacs ä¸‹ä½¿ç”¨ verify-url æª¢æŸ¥ä¸å­˜åœ¨çš„ URL</title>
      <link>https://coldnew.github.io/d761102/</link>
      <guid>https://coldnew.github.io/d761102/</guid>
      <pubDate>Sun, 27 Dec 2015 09:19:00 GMT</pubDate>
      <description>
      
        &lt;p&gt;
åœ¨å¯«æ–‡ç« çš„æ™‚å€™ï¼Œå¸¸å¸¸éœ€è¦æ’å…¥ä¸€äº›ç¶²é é€£çµï¼Œæœ‰æ™‚å€™æ‰‹èª¤æˆ–æ˜¯é€£çµå·²ç¶“å¹´ä¹…å¤±ä¿®ï¼Œé€™æ™‚å€™
å°±éœ€è¦å€‹å¥½æ–¹å¼ä¾†å¹«å¿™é€²è¡Œæª¢æŸ¥ï¼Œ&lt;a href=&quot;https://github.com/lujun9972/verify-url&quot;&gt;verify-url&lt;/a&gt; å°±æ˜¯ä¸€å€‹åœ¨ emacs ä¸‹å¹«å¿™æª¢æŸ¥ä¸å­˜åœ¨çš„ URL
çš„å¥½å·¥å…·ã€‚
&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>åœ¨å¯«æ–‡ç« çš„æ™‚å€™ï¼Œå¸¸å¸¸éœ€è¦æ’å…¥ä¸€äº›ç¶²é é€£çµï¼Œæœ‰æ™‚å€™æ‰‹èª¤æˆ–æ˜¯é€£çµå·²ç¶“å¹´ä¹…å¤±ä¿®ï¼Œé€™æ™‚å€™å°±éœ€è¦å€‹å¥½æ–¹å¼ä¾†å¹«å¿™é€²è¡Œæª¢æŸ¥ï¼Œ<a href="https://github.com/lujun9972/verify-url" target="_blank" rel="external">verify-url</a> å°±æ˜¯ä¸€å€‹åœ¨ emacs ä¸‹å¹«å¿™æª¢æŸ¥ä¸å­˜åœ¨çš„ URLçš„å¥½å·¥å…·ã€‚</p><a id="more"></a><div id="outline-container-org2dc007b" class="outline-2"><h2 id="org2dc007b">å®‰è£ verify-url</h2><div class="outline-text-2" id="text-org2dc007b"><p>è‡ªå¾ emacs æ•´åˆäº† package.el å¾Œï¼Œå®‰è£æ–°çš„å¥—ä»¶éƒ½éå¸¸è¼•é¬†ï¼Œä½ å¯ä»¥ç›´æ¥é€éä»¥ä¸‹å‘½ä»¤ä¾†å®‰è£</p><pre class="example">M-x package-install verify-url</pre><p>å¦‚æœä½ æœ‰ä½¿ç”¨ <a href="https://github.com/cask/cask" target="_blank" rel="external">Cask</a> ä½œç‚º emacs-lisp é–‹ç™¼å·¥å…·ï¼Œå‰‡å¯ä»¥åœ¨ä½ çš„ <code>Cask</code> æª”æ¡ˆåŠ å…¥ï¼š</p><div class="org-src-container"><pre class="src src-emacs-lisp"><span style="color: #aadddd;">(</span>depends-on <span style="color: #aadddd;">"verify-url"</span><span style="color: #aadddd;">)</span></pre></div></div></div><div id="outline-container-org178333c" class="outline-2"><h2 id="org178333c">å¦‚ä½•ä½¿ç”¨ verify-url</h2><div class="outline-text-2" id="text-org178333c"><p>å®‰è£å®Œå¾Œï¼Œæˆ‘å€‘å¯ä»¥ç”¨å¼„å€‹éå¸¸ç°¡å–®çš„ç¯„ä¾‹ä¾†æ¸¬è©¦ï¼Œå‡è¨­æˆ‘å€‘æ­£åœ¨ç·¨è¼¯çš„æ–‡ä»¶æœ‰ä»¥ä¸‹å…§å®¹:</p><div class="org-src-container"><pre class="src src-text">google's link: http://google.cominvalid url1: http://invalid.urlcoldnew's blog: https://coldnew.github.ioinvalid url2: https://unvaliable.url</pre></div><p>æ¥ä¸‹ä¾†è¼¸å…¥ <code>M-x verify-url</code> ä½ å°±æœƒçœ‹åˆ°æœ‰å•é¡Œçš„ URL è¢«ä¸Šè‰²äº†:</p><div class="figure"><p><img src="verify-url.png"></p></div></div></div><div id="outline-container-orgb4ab518" class="outline-2"><h2 id="orgb4ab518">å¿«é€Ÿè·³è½‰åˆ°å¤±æ•ˆçš„ link</h2><div class="outline-text-2" id="text-orgb4ab518"><p><a href="https://github.com/lujun9972/verify-url" target="_blank" rel="external">verify-url</a> å…§å»ºäº†å…©å€‹æœ‰ç”¨çš„å‘½ä»¤ï¼Œå¯ä»¥è®“æˆ‘å€‘å¿«é€Ÿè·³è½‰åˆ°éŒ¯èª¤çš„é€£çµï¼Œä½ ä¹Ÿå¯ä»¥é€éä»–å€‘é€²è¡Œå¿«é€Ÿçš„è·³è½‰</p><ul class="org-ul"><li>verify-url/next-invalid-url</li><li>verify-url/previous-invalid-url</li></ul></div></div><div id="outline-container-org9b793eb" class="outline-2"><h2 id="org9b793eb">å»¶ä¼¸é–±è®€</h2><div class="outline-text-2" id="text-org9b793eb"><p><code>[1]</code> <a href="https://github.com/lujun9972/verify-url" target="_blank" rel="external">https://github.com/lujun9972/verify-url</a></p><p><code>[2]</code> <a href="http://rubikitch.com/2015/12/24/verify-url/" target="_blank" rel="external">emacs verify-url.el : ã€ãƒªãƒ³ã‚¯åˆ‡ã‚Œæ¤œå‡ºã€‘ãƒãƒƒãƒ•ã‚¡å…¨é«”/region å…§ã®URLã®å­˜åœ¨ç¢ºèªã‚’ã™ã‚‹</a></p></div></div>]]></content:encoded>
      
      <comments>https://coldnew.github.io/d761102/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
